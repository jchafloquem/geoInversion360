import{a as je,b as ze,c as jt,d as Ze,e as U}from"./chunk-3PX2NF5B.js";import{c as Ye,d as Ct,e as Et}from"./chunk-FRK363RQ.js";import{a as Ot}from"./chunk-UZSTUBKI.js";import{e as zt,f as Ut}from"./chunk-VLZLY64K.js";import{a as V}from"./chunk-PEDNASRA.js";import{a as $}from"./chunk-AP5GTQWL.js";import{a as Nt}from"./chunk-X2T2CBLR.js";import{a as Lt,c as _t}from"./chunk-IFFYADB3.js";import{a as Ge}from"./chunk-XNQ3DOLM.js";import{a as De}from"./chunk-BQGKYIFD.js";import{a as Ne,b as fe,c as Tt}from"./chunk-N2UPSTDF.js";import{a as I}from"./chunk-OTZFAVTW.js";import{a as z,b as Ie,c as ke,d as H}from"./chunk-LPSYEDCA.js";import{a as q,b as pe}from"./chunk-E565SJS7.js";import{a as O,b as A,c as Te,d as Oe,e as Ce,f as Ee,k as Le,l as _e,n as It}from"./chunk-2FFPK7GU.js";import{a as We,b as Pt,c as Mt}from"./chunk-BYCT4PTQ.js";import{a as Rt}from"./chunk-VV6VBK4L.js";import{b as Me}from"./chunk-GXZQZHAF.js";import{a as Ft}from"./chunk-MJ4RSERD.js";import{a as le}from"./chunk-BVW6ULEA.js";import{a as Pe}from"./chunk-7C6Z24SS.js";import{b as bt}from"./chunk-IEUNGS56.js";import{a as wt,f as At,q as St}from"./chunk-BYQI7UDX.js";import{e as Ae,g as Se,j as vt,l as be,m as Fe,p as Re}from"./chunk-5QLB7ZJ7.js";import{a as it}from"./chunk-ZWI7LLTZ.js";import{o as yt}from"./chunk-4HUAEW4D.js";import{g as ae}from"./chunk-XWRPBDYS.js";import{a as M}from"./chunk-BCREO4Q5.js";import{b as pt,l as P,v as ve}from"./chunk-SO6OJFOM.js";import{f as xt}from"./chunk-TMZNSBQB.js";import{A as we,B as gt,F as dt,G as ce,a as S,c as ie,e as Z,f as ft,l as D,m as mt,n as ut,u as ht}from"./chunk-ZGLJFDS6.js";import{W as ct,Y as lt}from"./chunk-OFVMJORF.js";import{a as st,c as at}from"./chunk-2FYXACXP.js";import{b as nt}from"./chunk-RP7XSKHE.js";import{a as ot}from"./chunk-LYPZUCFI.js";import{H as rt,r as tt}from"./chunk-BRGZVJPZ.js";import{I as w,a as Xe,d as Ke}from"./chunk-Z5NXR7SL.js";import{S as ye}from"./chunk-7JLWSSXP.js";import{a as x}from"./chunk-W3WDPWBE.js";import{g as Je,h as Y,j as Qe,o as xe,s as et}from"./chunk-JKP4I6UL.js";import{q as N,s as j}from"./chunk-BRWS572J.js";import{a as se,b as de,g as E}from"./chunk-JEGVIFEP.js";var Vt="Mesh must be loaded before applying operations",Bt="Provided component is not part of the list of components",Dt="Expected polygon to be a Polygon instance",X="Expected location to be a Point instance",me=class extends j{constructor(){super("invalid-input:location",X)}};function kt(e,t,o){let r=wr(Gt,e,t,o)?Gt:[0,0,1];return Math.abs(r[2])>Math.cos(xt(80))?M.Z:Math.abs(r[1])>Math.abs(r[0])?M.Y:M.X}function wr(e,t,o,r){let n=(a=>!Array.isArray(a[0]))(t)?(a,i)=>t[3*a+i]:(a,i)=>t[a][i],s=r?lt(r)/ct(r):1;return Ut(e,(a,i)=>D(a,n(i,0)*s,n(i,1)*s,n(i,2)),o)}var Gt=zt();function Wt(e){let t=Sr(e.rings,e.hasZ,Ve.CCW_IS_HOLE,e.spatialReference),o=new Array,r=0,n=0;for(let i of t.polygons){let l=i.count,c=i.index,f=Mt(t.position,3*c,3*l),u=i.holeIndices.map(p=>p-c),m=De(Ot(f,u,3));o.push({position:f,faces:m}),r+=f.length,n+=m.length}let s=Ar(o,r,n),a=Array.isArray(s.position)?Ge(s.position,3,{originalIndices:s.faces}):Ge(s.position.buffer,6,{originalIndices:s.faces});return s.position=Pt(new Float64Array(a.buffer)),s.faces=a.indices,s}function Ar(e,t,o){if(e.length===1)return e[0];let r=We(t),n=new Array(o),s=0,a=0,i=0;for(let l of e){for(let c=0;c<l.position.length;c++)r[s++]=l.position[c];for(let c of l.faces)n[a++]=c+i;i=s/3}return{position:r,faces:De(n)}}function Sr(e,t,o,r){let n=e.length,s=new Array(n),a=new Array(n),i=new Array(n),l=0;for(let h=0;h<n;++h)l+=e[h].length;let c=0,f=0,u=0,m=We(3*l),p=0;for(let h=n-1;h>=0;h--){let g=e[h],F=o===Ve.CCW_IS_HOLE&&br(g,t,r);if(F&&n!==1)s[c++]=g;else{let C=g.length;for(let d=0;d<c;++d)C+=s[d].length;let v={index:p,pathLengths:new Array(c+1),count:C,holeIndices:new Array(c)};v.pathLengths[0]=g.length,g.length>0&&(i[u++]={index:p,count:g.length}),p=F?Ue(g,g.length-1,-1,m,p,g.length,t):Ue(g,0,1,m,p,g.length,t);for(let d=0;d<c;++d){let R=s[d];v.holeIndices[d]=p,v.pathLengths[d+1]=R.length,R.length>0&&(i[u++]={index:p,count:R.length}),p=Ue(R,0,1,m,p,R.length,t)}c=0,v.count>0&&(a[f++]=v)}}for(let h=0;h<c;++h){let g=s[h];g.length>0&&(i[u++]={index:p,count:g.length}),p=Ue(g,0,1,m,p,g.length,t)}return a.length=f,i.length=u,{position:m,polygons:a,outlines:i}}function Ue(e,t,o,r,n,s,a){n*=3;for(let i=0;i<s;++i){let l=e[t];r[n++]=l[0],r[n++]=l[1],r[n++]=a?l[2]:0,t+=o}return n/3}function br(e,t,o){if(!t)return!ae(e);let r=e.length-1;switch(kt(e,r,o)){case M.X:return!ae(e,M.Y,M.Z);case M.Y:return!ae(e,M.X,M.Z);case M.Z:return!ae(e,M.X,M.Y)}}var Ve;(function(e){e[e.NONE=0]="NONE",e[e.CCW_IS_HOLE=1]="CCW_IS_HOLE"})(Ve||(Ve={}));function Zt([e,t,o,r,n,s],a,i,l){Yt??=new Float64Array(24);let c=Yt;return c[0]=e,c[1]=t,c[2]=o,c[3]=e,c[4]=n,c[5]=o,c[6]=r,c[7]=n,c[8]=o,c[9]=r,c[10]=t,c[11]=o,c[12]=e,c[13]=t,c[14]=s,c[15]=e,c[16]=n,c[17]=s,c[18]=r,c[19]=n,c[20]=s,c[21]=r,c[22]=t,c[23]=s,It({positions:c,transform:a,vertexSpace:i,inSpatialReference:l,outSpatialReference:l,outPositions:c}),He(c,l)}var Yt=null;function qe(e){if(e.length===0)return St;let t=wt([Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,-Number.POSITIVE_INFINITY,-Number.POSITIVE_INFINITY,-Number.POSITIVE_INFINITY]);return At(t,e),t}function He(e,t){let[o,r,n,s,a,i]=qe(e);return new ve({xmin:o,ymin:r,zmin:n,xmax:s,ymax:a,zmax:i,spatialReference:t})}function K(e,t,o,r){if(r!==void 0){Ke(e(),"option: geographic",{replacement:"Use mesh `vertexSpace` and spatial reference to control how operations are performed instead.",version:"4.30",warnOnce:!0});let n=t.type==="local";if(!z(t)||r===n)return o.isGeographic||o.isWebMercator&&r;e().warnOnce(`Specifying the 'geographic' parameter (${r}) for a Mesh vertex space of type "${t.type}" is not supported. This parameter will be ignored.`)}switch(t.type){case"georeferenced":return o.isGeographic;case"local":return o.isGeographic||o.isWebMercator}}var ue=()=>N.getLogger("esri.geometry.support.meshUtils.centerAt");function qt(e,t,o){if(!e.vertexAttributes?.position)return;let{vertexSpace:r}=e,n=o?.origin??e.anchor,s=K(ue,r,n.spatialReference,o?.geographic);z(r)?Fr(e,t,n):s?Rr(e,t,n):Pr(e,t,n)}function Fr(e,t,o){let{vertexSpace:r}=e;if(!z(r))return;let n=$t,s=Ht;if(!I(t,s,e.spatialReference))return void A(ue(),t.spatialReference,e.spatialReference,O);if(!I(o,n,e.spatialReference)){let i=e.origin;return n[0]=i.x,n[1]=i.y,n[2]=i.z,void A(ue(),o.spatialReference,e.spatialReference,O)}let a=ut(Ir,s,n);r.origin=mt(S(),r.origin,a)}function Rr(e,t,o){let r=ie(o.x,o.y,o.z??0),n=fe(e,new pe({origin:r}));if(!n)return;let s=ie(t.x,t.y,t.z??0),a=fe({vertexAttributes:n,spatialReference:e.spatialReference,vertexSpace:new pe({origin:s})},new q);if(!a)return;let{position:i,normal:l,tangent:c}=a;e.vertexAttributes.position=i,e.vertexAttributes.normal=l,e.vertexAttributes.tangent=c,e.vertexAttributesChanged()}function Pr(e,t,o){let r=$t,n=Ht;if(I(t,n,e.spatialReference)){if(!I(o,r,e.spatialReference)){let s=e.origin;return r[0]=s.x,r[1]=s.y,r[2]=s.z,void A(ue(),o.spatialReference,e.spatialReference,O)}Mr(e.vertexAttributes.position,n,r),e.vertexAttributesChanged()}else A(ue(),t.spatialReference,e.spatialReference,O)}function Mr(e,t,o){if(e)for(let r=0;r<e.length;r+=3)for(let n=0;n<3;n++)e[r+n]+=t[n]-o[n]}var Ht=S(),$t=S(),Ir=S();function Xt(e,t,o){return E(this,null,function*(){let{source:r}=t,{loadGLTFMesh:n}=yield xe(import("./chunk-GLFHCL2D.js"),o),s=yield Or(r,o);Y(o);let a=n(new P({x:0,y:0,z:0,spatialReference:e.spatialReference}),s.url,{resolveFile:Tr(s),signal:o?.signal,expectedType:s.type});a.then(()=>s.dispose(),()=>s.dispose());let{vertexAttributes:i,components:l}=yield a;e.vertexAttributes=i,e.components=l})}function Tr(e){let t=rt(e.url);return o=>{let r=tt(o,t,t),n=r?r.replace(/^ *\.\//,""):null;return(n?e.files.get(n):null)??o}}function Or(e,t){return E(this,null,function*(){if(Array.isArray(e)){if(!e.length)throw new j("mesh-load-external:missing-assets","There must be at least one file to load");return e[0]instanceof File?Er(e):Lr(e,t)}return Kt(e)})}function Cr(e,t){return E(this,null,function*(){let{parts:o,assetMimeType:r,assetName:n}=e;if(o.length===1)return new J(o[0].partUrl);let s=yield e.toBlob(t);return Y(t),J.fromBlob(s,tr(n,r))})}function Kt(e){return J.fromBlob(e,tr(e.name,e.type))}function Er(e){return er(e.map(t=>({name:t.name,mimeType:t.type,source:Kt(t)})))}function Lr(e,t){return E(this,null,function*(){let o=yield et(e.map(r=>E(this,null,function*(){let n=yield Cr(r);return Y(t),{name:r.assetName,mimeType:r.assetMimeType,source:n}})));if(Qe(t))throw o.forEach(r=>r.source.dispose()),Je();return er(o)})}var Jt=/^model\/gltf\+json$/,Qt=/^model\/gltf-binary$/,$e=/\.gltf$/i,_r=/\.glb$/i;function er(e){let t=new Map,o,r=null;for(let{name:n,mimeType:s,source:a}of e)r===null&&(Jt.test(s)||$e.test(n)?(r=a.url,o="gltf"):(Qt.test(s)||_r.test(n))&&(r=a.url,o="glb")),t.set(n,a.url),a.files.forEach((i,l)=>t.set(l,i));if(r==null)throw new j("mesh-load-external:missing-files","Missing files to load external mesh source");return new J(r,()=>e.forEach(({source:n})=>n.dispose()),t,o)}var J=class e{constructor(t,o=()=>{},r=new Map,n){this.url=t,this.dispose=o,this.files=r,this.type=n}static fromBlob(t,o){let r=URL.createObjectURL(t);return new e(r,()=>URL.revokeObjectURL(r),void 0,o)}};function tr(e,t){return Jt.test(t)||$e.test(e)?"gltf":Qt.test(t)||$e.test(e)?"glb":void 0}var _=class extends bt{constructor(e){super(e),this.externalSources=new nt,this._explicitDisplaySource=null,this.addHandles(at(()=>this.externalSources,"after-remove",({item:t})=>{t===this._explicitDisplaySource&&(this._explicitDisplaySource=null)},{sync:!0,onListenerRemove:()=>this._explicitDisplaySource=null}))}get displaySource(){return this._explicitDisplaySource??this._implicitDisplaySource}set displaySource(e){if(e!=null&&!Ye(e))throw new Error("Cannot use this source for display: it is not in a supported format.");this._explicitDisplaySource=e,e&&this.externalSources.every(t=>!Et(t,e))&&this.externalSources.add(e)}clearSources(){this.externalSources.removeAll()}getExternalSourcesOnService(e){return this.externalSources.items.filter(t=>Ct(t,e))}get _implicitDisplaySource(){return this.externalSources.find(Ye)}};x([w()],_.prototype,"externalSources",void 0),x([w()],_.prototype,"displaySource",null),x([w()],_.prototype,"_implicitDisplaySource",null),x([w()],_.prototype,"_explicitDisplaySource",void 0),_=x([ye("esri.geometry.support.meshUtils.Metadata")],_);function rr(){let{faceDescriptions:e,faceVertexOffsets:t,uvScales:o}=Ur,r=4*e.length,n=new Float64Array(3*r),s=new Float32Array(3*r),a=new Float32Array(2*r),i=new Uint32Array(2*e.length*3),l=0,c=0,f=0,u=0;for(let m=0;m<e.length;m++){let p=e[m],h=l/3;for(let F of t)i[u++]=h+F;let g=p.corners;for(let F=0;F<4;F++){let C=g[F],v=0;a[f++]=.25*o[F][0]+p.uvOrigin[0],a[f++]=p.uvOrigin[1]-.25*o[F][1];for(let d=0;d<3;d++)p.axis[d]!==0?(n[l++]=.5*p.axis[d],s[c++]=p.axis[d]):(n[l++]=.5*C[v++],s[c++]=0)}}return{position:n,normal:s,uv:a,faces:i}}function or(e,t){let o=e.components[0],r=o.faces,n=Vr[t],s=6*n,a=new Array(6),i=new Array(r.length-6),l=0,c=0;for(let f=0;f<r.length;f++)f>=s&&f<s+6?a[l++]=r[f]:i[c++]=r[f];if(e.vertexAttributes.uv!=null){let f=new Float32Array(e.vertexAttributes.uv),u=4*n*2,m=[0,1,1,1,1,0,0,0];for(let p=0;p<m.length;p++)f[u+p]=m[p];e.vertexAttributes.uv=f}return e.components=[new V({faces:a,material:o.material}),new V({faces:i})],e}function nr(e=0){let t=Math.round(8*2**e),o=2*t,r=(t-1)*(o+1)+2*o,n=new Float64Array(3*r),s=new Float32Array(3*r),a=new Float32Array(2*r),i=new Uint32Array(3*((t-1)*o*2)),l=0,c=0,f=0,u=0;for(let m=0;m<=t;m++){let p=m/t*Math.PI+.5*Math.PI,h=Math.cos(p),g=Math.sin(p);y[2]=g;let F=m===0||m===t,C=F?o-1:o;for(let v=0;v<=C;v++){let d=v/C*2*Math.PI;y[0]=-Math.sin(d)*h,y[1]=Math.cos(d)*h;for(let R=0;R<3;R++)n[l]=.5*y[R],s[l]=y[R],++l;a[c++]=(v+(F?.5:0))/o,a[c++]=m/t,m!==0&&v!==o&&(m!==t&&(i[f++]=u,i[f++]=u+1,i[f++]=u-o),m!==1&&(i[f++]=u,i[f++]=u-o,i[f++]=u-o-1)),u++}}return{position:n,normal:s,uv:a,faces:i}}function sr(e=0){let o=Math.round(16*2**e),r=4*(o+1)+2*o,n=new Float64Array(3*r),s=new Float32Array(3*r),a=new Float32Array(2*r),i=new Uint32Array(3*(4*o)),l=0,c=0,f=0,u=0,m=0;for(let p=0;p<=5;p++){let h=p===0||p===5,g=p<=1||p>=4,F=p===2||p===4,C=h?o-1:o;for(let v=0;v<=C;v++){let d=v/C*2*Math.PI,R=h?0:.5;y[0]=R*Math.sin(d),y[1]=R*-Math.cos(d),y[2]=p<=2?.5:-.5;for(let W=0;W<3;W++)n[l++]=y[W],s[c++]=g?W===2?p<=1?1:-1:0:W===2?0:y[W]/R;a[f++]=(v+(h?.5:0))/o,a[f++]=p<=1?1*p/3:p<=3?1*(p-2)/3+1/3:1*(p-4)/3+2/3,F||p===0||v===o||(p!==5&&(i[u++]=m,i[u++]=m+1,i[u++]=m-o),p!==1&&(i[u++]=m,i[u++]=m-o,i[u++]=m-o-1)),m++}}return{position:n,normal:s,uv:a,faces:i}}function ar(e,t){let o=typeof t=="number"?t:t!=null?t.width:1,r=typeof t=="number"?t:t!=null?t.height:1;switch(e){case"up":case"down":return{width:o,depth:r};case"north":case"south":return{width:o,height:r};case"east":case"west":return{depth:o,height:r}}}function ir(e){let t=he.facingAxisOrderSwap[e],o=he.position,r=he.normal,n=new Float64Array(o.length),s=new Float32Array(r.length),a=0;for(let i=0;i<4;i++){let l=a;for(let c=0;c<3;c++){let f=t[c],u=Math.abs(f)-1,m=f>=0?1:-1;n[a]=o[l+u]*m,s[a]=r[l+u]*m,a++}}return{position:n,normal:s,uv:new Float32Array(he.uv),faces:new Uint32Array(he.faces),isPlane:!0}}var Q=1,ee=2,te=3,he={position:[-.5,-.5,0,.5,-.5,0,.5,.5,0,-.5,.5,0],normal:[0,0,1,0,0,1,0,0,1,0,0,1],uv:[0,1,1,1,1,0,0,0],faces:[0,1,2,0,2,3],facingAxisOrderSwap:{east:[te,Q,ee],west:[-te,-Q,ee],north:[-Q,te,ee],south:[Q,-te,ee],up:[Q,ee,te],down:[Q,-ee,-te]}};function ge(e,t,o){e.isPlane||Nr(e),zr(e,jr(o?.size,o?.unit,t.spatialReference));let r=H(t,o),n=t.spatialReference.isGeographic?H(t):r,s=fe({vertexAttributes:e,vertexSpace:n,spatialReference:t.spatialReference},r,{allowBufferReuse:!0});return{vertexAttributes:new $(de(se({},s),{uv:e.uv})),vertexSpace:r,components:[new V({faces:e.faces,material:o?.material||null})],spatialReference:t.spatialReference}}function Nr(e){for(let t=0;t<e.position.length;t+=3)e.position[t+2]+=.5}function jr(e,t,o){let r=Tt(t,o);if(e==null&&r===1)return null;if(e==null)return[r,r,r];if(typeof e=="number"){let n=e*r;return[n,n,n]}return[e.width!=null?e.width*r:r,e.depth!=null?e.depth*r:r,e.height!=null?e.height*r:r]}function zr(e,t){if(t!=null){B[0]=t[0],B[4]=t[1],B[8]=t[2];for(let o=0;o<e.position.length;o+=3){for(let r=0;r<3;r++)y[r]=e.position[o+r];ce(y,y,B);for(let r=0;r<3;r++)e.position[o+r]=y[r]}if(t[0]!==t[1]||t[1]!==t[2]){B[0]=1/t[0],B[4]=1/t[1],B[8]=1/t[2];for(let o=0;o<e.normal.length;o+=3){for(let r=0;r<3;r++)y[r]=e.normal[o+r];ce(y,y,B),gt(y,y);for(let r=0;r<3;r++)e.normal[o+r]=y[r]}}}}var Ur={faceDescriptions:[{axis:[0,-1,0],uvOrigin:[0,.625],corners:[[-1,-1],[1,-1],[1,1],[-1,1]]},{axis:[1,0,0],uvOrigin:[.25,.625],corners:[[-1,-1],[1,-1],[1,1],[-1,1]]},{axis:[0,1,0],uvOrigin:[.5,.625],corners:[[1,-1],[-1,-1],[-1,1],[1,1]]},{axis:[-1,0,0],uvOrigin:[.75,.625],corners:[[1,-1],[-1,-1],[-1,1],[1,1]]},{axis:[0,0,1],uvOrigin:[0,.375],corners:[[-1,-1],[1,-1],[1,1],[-1,1]]},{axis:[0,0,-1],uvOrigin:[0,.875],corners:[[-1,1],[1,1],[1,-1],[-1,-1]]}],uvScales:[[0,0],[1,0],[1,1],[0,1]],faceVertexOffsets:[0,1,2,0,2,3]},Vr={south:0,east:1,north:2,west:3,up:4,down:5},y=S(),B=Pe();var G=()=>N.getLogger("esri.geometry.support.meshUtils.rotate");function mr(e,t,o){if(!e.vertexAttributes?.position||t[3]===0)return;let{spatialReference:r,vertexSpace:n}=e,s=o?.origin??e.anchor,a=o?.geographic,i=K(G,n,r,a);Ie(e)?Br(e,t,s):i?Dr(e,t,s):Gr(e,t,s)}function Br(e,t,o){e.transform??=new U;let{vertexSpace:r,transform:n,spatialReference:s}=e,[a,i,l]=r.origin,c=new P({x:a,y:i,z:l,spatialReference:s}),f=re;if(c.equals(o))D(f,0,0,0);else if(!Ne(f,o,e))return void A(G(),o.spatialReference,s,O);Nt(fr,t,Ze(t));let u=Re(cr,fr,Z,ft,f),{localMatrix:m}=n,p=Ae(cr,u,m);n.scale=Fe(S(),p),Se(p,p,we(re,n.scale));let h=n.rotationAxis;n.rotation=ze(p),n.rotationAngle===0&&(n.rotationAxis=h),n.translation=be(S(),p)}function Dr(e,t,o){let r=e.spatialReference,n=Me(r),s=ur;if(!I(o,s,n)&&(A(G(),o.spatialReference,n,"Falling back to mesh origin"),!I(e.origin,s,n)))return void A(G(),e.origin.spatialReference,n);let a=e.vertexAttributes.position,i=e.vertexAttributes.normal,l=e.vertexAttributes.tangent,c=new Float64Array(a.length),f=i!=null?new Float32Array(i.length):null,u=l!=null?new Float32Array(l.length):null;Rt(n,s,Be,n),Ft(pr,Be);let m=lr;ce(lr,t,pr),m[3]=t[3],Ce(a,r,c)&&(i==null||f==null||Te(i,a,c,r,f))&&(l==null||u==null||Le(l,a,c,r,u))?(oe(c,m,3,s),Ee(c,a,r)&&(i==null||f==null||(oe(f,m,3),Oe(f,a,c,r,i)))&&(l==null||u==null||(oe(u,m,4),_e(u,a,c,r,l)))?e.vertexAttributesChanged():A(G(),n,r)):A(G(),r,n)}function Gr(e,t,o){let r=ur;if(!I(o,r,e.spatialReference)){let n=e.origin;return r[0]=n.x,r[1]=n.y,r[2]=n.z,void A(G(),o.spatialReference,e.spatialReference,O)}oe(e.vertexAttributes.position,t,3,r),oe(e.vertexAttributes.normal,t,3),oe(e.vertexAttributes.tangent,t,4),e.vertexAttributesChanged()}function oe(e,t,o,r=Z){if(e!=null){vt(Be,Ze(t),t);for(let n=0;n<e.length;n+=o){for(let s=0;s<3;s++)re[s]=e[n+s]-r[s];dt(re,re,Be);for(let s=0;s<3;s++)e[n+s]=re[s]+r[s]}}}var re=S(),cr=le(),lr=je(),Be=le(),pr=Pe(),ur=S(),fr=Lt();var k=()=>N.getLogger("esri.geometry.support.meshUtils.scale");function gr(e,t,o){if(!e.vertexAttributes?.position)return;let{vertexSpace:r,spatialReference:n}=e,s=o?.origin??e.anchor,a=o?.geographic,i=K(k,r,n,a);Ie(e)?kr(e,t,s):i?Wr(e,t,s):Yr(e,t,s)}function kr(e,t,o){e.transform??=new U;let{vertexSpace:r,transform:n,spatialReference:s}=e,[a,i,l]=r.origin,c=new P({x:a,y:i,z:l,spatialReference:s}),f=ne;if(c.equals(o))D(f,0,0,0);else if(!Ne(f,o,e))return void A(k(),o.spatialReference,s,O);let u=D(Zr,t,t,t),m=Re(hr,_t,Z,u,f),{localMatrix:p}=n,h=Ae(hr,m,p);n.scale=Fe(S(),h),Se(h,h,we(ne,n.scale));let g=n.rotationAxis;n.rotation=ze(h),n.rotationAngle===0&&(n.rotationAxis=g),n.translation=be(S(),h)}function Wr(e,t,o){let r=e.spatialReference,n=Me(r),s=xr;if(!I(o,s,n)&&(A(k(),o.spatialReference,n,"Falling back to mesh origin"),!I(e.origin,s,n)))return void A(k(),e.origin.spatialReference,n);let a=e.vertexAttributes.position,i=e.vertexAttributes.normal,l=e.vertexAttributes.tangent,c=new Float64Array(a.length),f=i!=null?new Float32Array(i.length):null,u=l!=null?new Float32Array(l.length):null;Ce(a,r,c)&&(i==null||f==null||Te(i,a,c,r,f))&&(l==null||u==null||Le(l,a,c,r,u))?(dr(c,t,s),Ee(c,a,r)&&(i==null||f==null||Oe(f,a,c,r,i))&&(l==null||u==null||_e(u,a,c,r,l))?e.vertexAttributesChanged():A(k(),n,r)):A(k(),r,n)}function Yr(e,t,o){let r=xr;if(!I(o,r,e.spatialReference)){let n=e.origin;return r[0]=n.x,r[1]=n.y,r[2]=n.z,void A(k(),o.spatialReference,e.spatialReference,O)}dr(e.vertexAttributes.position,t,r),e.vertexAttributesChanged()}function dr(e,t,o=Z){if(e)for(let r=0;r<e.length;r+=3){for(let n=0;n<3;n++)ne[n]=e[r+n]-o[n];ht(ne,ne,t);for(let n=0;n<3;n++)e[r+n]=ne[n]+o[n]}}var ne=S(),Zr=S(),hr=le(),xr=S();var T,vr="esri.geometry.Mesh";function L(){return N.getLogger(vr)}var qr={base:null,key:"type",defaultKeyValue:"georeferenced",typeMap:{georeferenced:q,local:pe}},b=T=class extends it.LoadableMixin(ot(pt)){constructor(e){super(e),this.components=null,this.vertexSpace=new q,this.transform=null,this.metadata=new _,this.hasZ=!0,this.hasM=!1,this.vertexAttributes=new $,this.type="mesh"}initialize(){(this.metadata.externalSources.length===0||this.vertexAttributes.position.length)&&(this.loadStatus="loaded"),this.when(()=>{this.addHandles(st(()=>({vertexAttributes:this.vertexAttributes,components:this.components?.map(e=>e.clone())}),()=>this._clearSources(),{once:!0,sync:!0}))})}get hasExtent(){return this.loaded?this.vertexAttributes.position.length>0&&(!this.components||this.components.length>0):this.metadata.displaySource?.extent!=null}get _transformedExtent(){let{components:e,spatialReference:t,vertexAttributes:o,vertexSpace:r}=this,n=o.position;if(n.length===0||e&&e.length===0)return new ve({xmin:0,ymin:0,zmin:0,xmax:0,ymax:0,zmax:0,spatialReference:t});if(z(r)){let{_untransformedBounds:s,transform:a}=this;return Zt(s,a,r,t)}return He(n,t)}get _untransformedBounds(){return qe(this.vertexAttributes.position)}get anchor(){let e=ke(this.vertexSpace,this.spatialReference);if(e!=null)return e;let{center:t,zmin:o}=this._transformedExtent;return new P({x:t.x,y:t.y,z:o,spatialReference:this.spatialReference})}get origin(){let e=ke(this.vertexSpace,this.spatialReference);return e??this._transformedExtent.center}get extent(){return this.loaded||this.metadata?.displaySource?.extent==null?this._transformedExtent:this.metadata.displaySource.extent.clone()}addComponent(e){this._checkIfLoaded("addComponent()")&&(this.components||(this.components=[]),this.components.push(V.from(e)),this.notifyChange("components"))}removeComponent(e){if(this._checkIfLoaded("removeComponent()")){if(this.components){let t=this.components.indexOf(e);if(t!==-1)return this.components.splice(t,1),void this.notifyChange("components")}L().error("removeComponent()",Bt)}}rotate(e,t,o,r){return jt(e,t,o,yr),mr(this,yr,r),this}offset(e,t,o){if(!this._checkIfLoaded("offset()"))return this;let{vertexSpace:r,vertexAttributes:n}=this,s=n?.position;if(!s)return this;if(z(r)){let[a,i,l]=r.origin;r.origin=ie(a+e,i+t,l+o)}else{for(let a=0;a<s.length;a+=3)s[a]+=e,s[a+1]+=t,s[a+2]+=o;this.vertexAttributesChanged()}return this}scale(e,t){return this._checkIfLoaded("scale()")?(gr(this,e,t),this):this}centerAt(e,t){return this._checkIfLoaded("centerAt()")?(qt(this,e,t),this):this}load(e){let{metadata:{displaySource:t}}=this;return t&&this.addResolvingPromise(Xt(this,t,e)),Promise.resolve(this)}addExternalSources(e){this.metadata.externalSources.addMany(e)}updateDisplaySource(e){this.metadata.displaySource=e}clone(){return this.cloneAndModifyVertexAttributes(this.vertexAttributes.clone(),this.vertexSpace.clone())}cloneAndModifyVertexAttributes(e,t){let o=null;if(this.components){let n=new Map,s=new Map;o=this.components.map(a=>a.cloneWithDeduplication(n,s))}let r={components:o,spatialReference:this.spatialReference,vertexAttributes:e,vertexSpace:t,transform:this.transform?.clone()??null,metadata:this.metadata.clone()};return new T(r)}cloneShallow(){return new T({components:this.components,spatialReference:this.spatialReference,vertexAttributes:this.vertexAttributes,vertexSpace:this.vertexSpace.clone(),transform:this.transform,metadata:this.metadata})}vertexAttributesChanged(){this.notifyChange("vertexAttributes")}toBinaryGLTF(e){return E(this,null,function*(){let[{toBinaryGLTF:t}]=yield Promise.all([import("./chunk-5ZZXIUSL.js"),this.load(e)]);return Y(e),yield t(this,e)})}get memoryUsage(){let e=0;if(e+=this.vertexAttributes.memoryUsage,this.components!=null)for(let t of this.components)e+=t.memoryUsage;return e}_clearSources(){this.metadata.clearSources()}_checkIfLoaded(e){return!!this.loaded||(L().error(e,Vt),!1)}static createBox(e,t){if(!(e instanceof P))return L().error(".createBox()",X),null;let o=new T(ge(rr(),e,t));return t?.imageFace&&t.imageFace!=="all"?or(o,t.imageFace):o}static createSphere(e,t){return e instanceof P?new T(ge(nr(t?.densificationFactor||0),e,t)):(L().error(".createSphere()",X),null)}static createCylinder(e,t){return e instanceof P?new T(ge(sr(t?.densificationFactor||0),e,t)):(L().error(".createCylinder()",X),null)}static createPlane(e,t){if(!(e instanceof P))return L().error(".createPlane()",X),null;let o=t?.facing??"up",r=ar(o,t?.size);return new T(ge(ir(o),e,de(se({},t),{size:r})))}static createFromPolygon(e,t){if(!(e instanceof yt))return L().error(".createFromPolygon()",Dt),null;let o=Wt(e);return new T({vertexAttributes:new $({position:o.position}),components:[new V({faces:o.faces,shading:"flat",material:t?.material??null})],spatialReference:e.spatialReference,vertexSpace:new q})}static createFromGLTF(e,t,o){return E(this,null,function*(){if(!(e instanceof P)){let n=new me;throw L().error(".createfromGLTF()",n.message),n}let{loadGLTFMesh:r}=yield xe(import("./chunk-GLFHCL2D.js"),o);return new T(yield r(e,t,o))})}static createFromFiles(e,t,o){return E(this,null,function*(){Xe(L(),"`Mesh.createFromFiles` is deprecated in favor of 'SceneLayer.convertMesh'",{replacement:"SceneLayer.convertMesh",version:"4.29"});let r=n=>L().error(".createFromFiles()",n.message);if(!(e instanceof P)){let n=new me;throw r(n),n}if(!o?.layer)throw new j("invalid:no-layer","SceneLayer required for file to mesh conversion.");return o.layer.convertMesh(t,se({location:e},o))})}static createWithExternalSource(e,t,o){let r=o?.extent??null,{spatialReference:n}=e,s=o?.transform?.clone()??new U,a=H(e,o),i={source:t,extent:r},l=new _;return l.externalSources.push(i),new T({metadata:l,transform:s,vertexSpace:a,spatialReference:n})}static createIncomplete(e,t){let{spatialReference:o}=e,r=t?.transform?.clone()??new U,n=H(e,t),s=new T({transform:r,vertexSpace:n,spatialReference:o});return s.addResolvingPromise(Promise.reject(new j("mesh-incomplete","Mesh resources are not complete"))),s}};x([w({type:[V],json:{write:!0}})],b.prototype,"components",void 0),x([w({nonNullable:!0,types:qr,constructOnly:!0,json:{write:!0}})],b.prototype,"vertexSpace",void 0),x([w({type:U,json:{write:!0}})],b.prototype,"transform",void 0),x([w({constructOnly:!0})],b.prototype,"metadata",void 0),x([w()],b.prototype,"hasExtent",null),x([w()],b.prototype,"_transformedExtent",null),x([w()],b.prototype,"_untransformedBounds",null),x([w()],b.prototype,"anchor",null),x([w()],b.prototype,"origin",null),x([w({readOnly:!0,json:{read:!1}})],b.prototype,"extent",null),x([w({readOnly:!0,json:{read:!1,write:!0,default:!0}})],b.prototype,"hasZ",void 0),x([w({readOnly:!0,json:{read:!1,write:!0,default:!1}})],b.prototype,"hasM",void 0),x([w({type:$,nonNullable:!0,json:{write:!0}})],b.prototype,"vertexAttributes",void 0),b=T=x([ye(vr)],b);var yr=je(),ws=b;export{ws as a};
