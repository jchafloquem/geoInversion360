import{a as P}from"./chunk-CYT6KIBU.js";import{a as S}from"./chunk-UH6DTPOD.js";import{k as E}from"./chunk-N3BNSVOS.js";import{a as w}from"./chunk-65ILPZGY.js";import{A as j}from"./chunk-ESBNO4XM.js";import{d as f}from"./chunk-MXSUS5HK.js";import{l as x}from"./chunk-3JLZ7SFH.js";import{a as R}from"./chunk-Y6HWUWZ3.js";import{d as C}from"./chunk-IXNVQC76.js";import{a as A}from"./chunk-MT7BXRRQ.js";import{V as y}from"./chunk-BRGZVJPZ.js";import{N as O}from"./chunk-7JLWSSXP.js";import{s as i}from"./chunk-BRWS572J.js";import{a as b,b as q,g as s}from"./chunk-JEGVIFEP.js";function M(e,t,n){return s(this,null,function*(){t=t.clone(),e.capabilities.query.supportsMaxRecordCountFactor&&(t.maxRecordCountFactor=T(e));let r=L(e),a=e.capabilities.query.supportsPagination;t.start=0,t.num=r;let o=null;for(;;){let d=yield e.source.queryFeaturesJSON(t,n);if(o==null?o=d:o.features=o.features.concat(d.features),o.exceededTransferLimit=d.exceededTransferLimit,!a||!d.exceededTransferLimit)break;t.start+=r}return o})}function L(e){return T(e)*G(e)}function G(e){return e.capabilities.query.maxRecordCount||2e3}function T(e){return e.capabilities.query.supportsMaxRecordCountFactor?f.MAX_MAX_RECORD_COUNT_FACTOR:1}var ne=new A({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch"});function ae(e,t,n,r){return s(this,null,function*(){let a=yield p(e);if(yield I(e,t,r),!a.addAttachment)throw new i(r,"Layer source does not support addAttachment capability");return a.addAttachment(t,n)})}function I(e,t,n){let{attributes:r}=t,{objectIdField:a}=e;return e.capabilities?.data?.supportsAttachment?t?r?a&&r[a]?Promise.resolve():Promise.reject(new i(n,`feature is missing the identifying attribute ${a}`)):Promise.reject(new i(n,"'attributes' are required on a feature to query attachments")):Promise.reject(new i(n,"A feature is required to add/delete/update attachments")):Promise.reject(new i(n,"this layer doesn't support attachments"))}function oe(e,t,n,r,a){return s(this,null,function*(){let o=yield p(e);if(yield I(e,t,a),!o.updateAttachment)throw new i(a,"Layer source does not support updateAttachment capability");return o.updateAttachment(t,n,r)})}function se(e,t,n){return s(this,null,function*(){let{applyEdits:r}=yield import("./chunk-RNLGUBP5.js"),a=yield e.load(),o=n;return a.type==="feature"&&a.infoFor3D&&t.deleteFeatures!=null&&a.globalIdField!=null&&(o=q(b({},o),{globalIdToObjectId:yield N(a,t.deleteFeatures,a.globalIdField)})),r(a,a.source,t,n)})}function ie(e,t,n){return s(this,null,function*(){let{uploadAssets:r}=yield import("./chunk-RNLGUBP5.js"),a=yield e.load();return r(a,a.source,t,n)})}function ue(e,t,n,r){return s(this,null,function*(){let a=yield p(e);if(yield I(e,t,r),!a.deleteAttachments)throw new i(r,"Layer source does not support deleteAttachments capability");return a.deleteAttachments(t,n)})}function ce(e,t,n){return s(this,null,function*(){let r=(yield e.load({signal:t?.signal})).source;if(!r.fetchRecomputedExtents)throw new i(n,"Layer source does not support fetchUpdates capability");return r.fetchRecomputedExtents(t)})}function le(e,t,n,r){return s(this,null,function*(){t=P.from(t),yield e.load();let a=e.source,o=e.capabilities;if(!o?.data?.supportsAttachment)throw new i(r,"this layer doesn't support attachments");let{attachmentTypes:d,objectIds:m,globalIds:h,num:u,size:c,start:l,where:F}=t;if(!o?.operations?.supportsQueryAttachments&&(d?.length>0||h?.length>0||c?.length>0||u||l||F))throw new i(r,"when 'capabilities.operations.supportsQueryAttachments' is false, only objectIds is supported",t);if(!(m?.length||h?.length||F))throw new i(r,"'objectIds', 'globalIds', or 'where' are required to perform attachment query",t);if(!a.queryAttachments)throw new i(r,"Layer source does not support queryAttachments capability",t);return a.queryAttachments(t)})}function de(e,t,n,r){return s(this,null,function*(){let a=yield p(e);if(!a.queryObjectIds)throw new i(r,"Layer source does not support queryObjectIds capability");return a.queryObjectIds(f.from(t)??e.createQuery(),n)})}function pe(e,t,n,r){return s(this,null,function*(){let a=yield p(e);if(!a.queryFeatureCount)throw new i(r,"Layer source does not support queryFeatureCount capability");return a.queryFeatureCount(f.from(t)??e.createQuery(),n)})}function fe(e,t,n,r){return s(this,null,function*(){let a=yield p(e);if(!a.queryExtent)throw new i(r,"Layer source does not support queryExtent capability");return a.queryExtent(f.from(t)??e.createQuery(),n)})}function ye(e,t,n,r){return s(this,null,function*(){let a=yield p(e);if(!a.queryRelatedFeatures)throw new i(r,"Layer source does not support queryRelatedFeatures capability");return a.queryRelatedFeatures(w.from(t),n)})}function me(e,t,n,r){return s(this,null,function*(){let a=yield p(e);if(!a.queryRelatedFeaturesCount)throw new i(r,"Layer source does not support queryRelatedFeaturesCount capability");return a.queryRelatedFeaturesCount(w.from(t),n)})}function he(e){return s(this,null,function*(){let t=e.source;if(t?.refresh)try{let{dataChanged:n,updates:r}=yield t.refresh();if(r!=null&&(e.sourceJSON=b(b({},e.sourceJSON),r),e.read(r,{origin:"service",url:e.parsedUrl})),n)return!0}catch{}if(e.definitionExpression)try{return(yield R(e.definitionExpression,e.fieldsIndex)).hasDateFunctions}catch{}return!1})}function be(e){let t=new f,n=e.capabilities?.data,r=e.capabilities?.query;t.historicMoment=e.historicMoment,t.gdbVersion=e.gdbVersion,t.returnGeometry=!0,r&&(t.compactGeometryEnabled=r.supportsCompactGeometry,t.defaultSpatialReferenceEnabled=r.supportsDefaultSpatialReference),n&&(n.supportsZ&&e.returnZ!=null&&(t.returnZ=e.returnZ),n.supportsM&&e.returnM!=null&&(t.returnM=e.returnM)),t.outFields=["*"];let{timeOffset:a,timeExtent:o}=e;return t.timeExtent=a!=null&&o!=null?o.offset(-a.value,a.unit):o||null,t.multipatchOption=e.geometryType==="multipatch"?"xyFootprint":null,t}function we(e){let{globalIdField:t,fields:n}=e;if(t)return t;if(n){for(let r of n)if(r.type==="esriFieldTypeGlobalID")return r.name}}function ge(e){let{objectIdField:t,fields:n}=e;if(t)return t;if(n){for(let r of n)if(r.type==="esriFieldTypeOID")return r.name}}function Ie(e){return e.currentVersion?e.currentVersion:e.hasOwnProperty("capabilities")||e.hasOwnProperty("drawingInfo")||e.hasOwnProperty("hasAttachments")||e.hasOwnProperty("htmlPopupType")||e.hasOwnProperty("relationships")||e.hasOwnProperty("timeInfo")||e.hasOwnProperty("typeIdField")||e.hasOwnProperty("types")?10:9.3}function Fe(e,t){let{subtypes:n,subtypeField:r}=e;if(!t||!n?.length||!r)return null;let a=t.attributes[r];return a==null?null:n.find(o=>o.code===a)}function p(e){return s(this,null,function*(){return(yield e.load()).source})}function D(e,t){return s(this,null,function*(){if(!y||y.findCredential(e))return;let n;try{let r=yield x(e,t);r&&(n=yield y.checkSignInStatus(`${r}/sharing`))}catch{}if(n)try{let r=t!=null?t.signal:null;yield y.getCredential(e,{signal:r})}catch{}})}function qe(e,t,n){return s(this,null,function*(){let r=e.parsedUrl?.path;r&&e.authenticationTriggerEvent===t&&(yield D(r,n))})}function Oe(e){return!J(e)&&(e.userHasUpdateItemPrivileges||e.editingEnabled)}var g=O({types:j});function Ae(e,t){if(e.defaultSymbol)return e.types?.length?new E({defaultSymbol:g(e.defaultSymbol,e,t),field:e.typeIdField,uniqueValueInfos:e.types.map(n=>({id:n.id,symbol:g(n.symbol,n,t)}))}):new S({symbol:g(e.defaultSymbol,e,t)})}function Ce(e){let t=e.sourceJSON?.cacheMaxAge;if(!t)return!1;let n=e.editingInfo?.lastEditDate?.getTime();return n==null||(t*=1e3,Date.now()-n<t)}function N(e,t,n){return s(this,null,function*(){if(t==null)return null;let r=[],{objectIdField:a}=e;if(t.forEach(u=>{let c=null;if("attributes"in u){let{attributes:l}=u;c={globalId:l[n],objectId:l[a]!=null&&l[a]!==-1?l[a]:null}}else c={globalId:u.globalId,objectId:u.objectId!=null&&u.objectId!==-1?u.objectId:null};c.globalId!=null&&(c.objectId!=null&&c.objectId!==-1||r.push(c.globalId))}),r.length===0)return null;let o=e.createQuery();o.where=r.map(u=>`${n}='${u}'`).join(" OR "),o.returnGeometry=!1,o.outFields=[a,n],o.cacheHint=!1;let d=yield C(M(e,o));if(!d.ok)return null;let m=new Map,h=d.value.features;for(let u of h){let c=u.attributes[n],l=u.attributes[a];c!=null&&l!=null&&l!==-1&&m.set(c,l)}return m})}function xe(e,t,n){if(!t||!n||!e)return null;let r=n.getAttribute(t);return r==null?null:e.find(a=>{let{id:o}=a;return o!=null&&o.toString()===r.toString()})??null}function J(e){return e.sourceJSON?.isMultiServicesView||Q(e)}function Q(e){return!!e.sourceJSON?.capabilities?.toLowerCase().split(",").map(t=>t.trim()).includes("map")}export{ne as a,ae as b,oe as c,se as d,ie as e,ue as f,ce as g,le as h,de as i,pe as j,fe as k,ye as l,me as m,he as n,be as o,we as p,ge as q,Ie as r,Fe as s,qe as t,Oe as u,Ae as v,Ce as w,N as x,xe as y,J as z};
