import{a as U}from"./chunk-OTZFAVTW.js";import{e as Q}from"./chunk-LPSYEDCA.js";import{b as g,c as W,d as X,e as Z,f as _,g as N,h as O,k as $,l as nn}from"./chunk-2FFPK7GU.js";import{b as y,d as j,g as T}from"./chunk-Z6XPPWSB.js";import{a as F}from"./chunk-VV6VBK4L.js";import{b as m}from"./chunk-GXZQZHAF.js";import{n as H}from"./chunk-MJ4RSERD.js";import{a as w,c as K}from"./chunk-BVW6ULEA.js";import{a as J}from"./chunk-7C6Z24SS.js";import{d as S,e as E,g as C,q as z}from"./chunk-5QLB7ZJ7.js";import{k as Y}from"./chunk-TMZNSBQB.js";import{F as L,a as k,n as D,z as h}from"./chunk-ZGLJFDS6.js";import{T as B,Z as I}from"./chunk-OFVMJORF.js";import{q as V}from"./chunk-BRWS572J.js";var p=()=>V.getLogger("esri.geometry.support.meshUtils.vertexSpaceConversion");function Mn(n,t,{vertexSpace:r,spatialReference:e}){if(r.type==="georeferenced"){let u=n;if(!U(t,u,e))return!1;let{origin:c}=r;return D(n,u,c),!0}let o=m(e),a=n;if(!U(t,a,o))return!1;let{origin:i}=r,l=rn;if(!F(e,i,l,o))return!1;let s=S(rn,l);return s!=null&&(L(n,a,s),!0)}function bn(n,t,r){let{vertexSpace:e,transform:o,vertexAttributes:a}=n,i=P(n.spatialReference,r,v.SOURCE|v.TARGET);if(Q(e,t)&&(!o||z(o.localMatrix,K))&&Y(i,1)){let{position:l,normal:s,tangent:u}=a,c=r?.allowBufferReuse;return{position:c?l:l.slice(),normal:c?s:s?.slice(),tangent:c?u:u?.slice()}}switch(n.vertexSpace.type){case"local":return t.type==="local"?un(n,n.vertexSpace,t.origin,r):ln(n,n.vertexSpace,t.origin,r);case"georeferenced":return t.type==="local"?sn(n,n.vertexSpace,t.origin,r):an(n,n.vertexSpace,t.origin,r)}}function an({vertexAttributes:n,transform:t,spatialReference:r},{origin:e},o,a){let{position:i,normal:l,tangent:s}=t?d(n,t.localMatrix):n,u=new Float64Array(i.length),c=i;if(e&&(c=T(u,c,e)),o){let x=h(en,o);c=T(u,c,x)}P(r,a,v.NONE);let A=a?.allowBufferReuse;return{position:c!==n.position||A?c:c.slice(),normal:l!==n.normal||A?l:l?.slice(),tangent:s!==n.tangent||A?s:s?.slice()}}function ln({spatialReference:n,vertexAttributes:t,transform:r},{origin:e},o,a){let i=m(n);if(!F(n,e,f,i))return g(p(),n,i),null;r&&E(f,f,r.localMatrix),on(f,n,a,v.SOURCE);let l=new Float64Array(t.position.length),s=fn(t.position,f,n,l);if(!s)return null;let u=pn(s,l,t.normal,f,n);if(t.normal&&!u)return null;let c=mn(s,l,t.tangent,f,n);if(t.tangent&&!c)return null;if(o){let A=h(en,o);T(s,s,A)}return{position:s,normal:u,tangent:c}}function sn({vertexAttributes:n,spatialReference:t,transform:r},{origin:e},o,a){let i=m(t);if(!F(t,o,f,i))return g(p(),t,i),null;let l=1/P(t,a,v.TARGET);C(f,f,[l,l,l]);let s=S(R,f),{position:u,normal:c,tangent:A}=cn(n,e,r),x=new Float64Array(u.length),M=gn(u,t,s,x);if(!M)return null;let b=H(Fn,s),G=vn(c,u,x,t,b,c!==n.normal?c:void 0);if(!G&&c)return null;let q=An(A,u,x,t,b,A!==n.tangent?A:void 0);return!q&&A?null:{position:M,normal:G,tangent:q}}function cn(n,t,r){if(!t)return n;if(!r){let{position:o,normal:a,tangent:i}=n;return{position:T(new Float64Array(o.length),o,t),tangent:i,normal:a}}let e=d(n,r.localMatrix);return T(e.position,e.position,t),e}function un({vertexAttributes:n,spatialReference:t,transform:r},{origin:e},o,a){let i=m(t);if(!F(t,e,f,i))return g(p(),t,i),null;if(r&&E(f,f,r.localMatrix),!F(t,o,R,i))return g(p(),i,t),null;S(R,R);let l=E(f,R,f);return on(l,t,a,v.SOURCE|v.TARGET),d(n,l)}function d(n,t){let r=new Float64Array(n.position.length);y(r,n.position,t);let e=n.normal?new Float32Array(n.normal.length):null,o=n.tangent?new Float32Array(n.tangent.length):null;return e&&n.normal&&N(n.normal,e,t),o&&n.tangent&&O(n.tangent,o,t),{position:r,normal:e,tangent:o}}function fn(n,t,r,e){y(e,n,t);let o=new Float64Array(n.length);return _(e,o,r)?o:(g(p(),m(r),r),null)}function pn(n,t,r,e,o){if(r==null)return null;let a=new Float32Array(r.length);return N(r,a,e),X(a,n,t,o,a)?a:(g(p(),m(o),o),null)}function mn(n,t,r,e,o){if(r==null)return null;let a=new Float32Array(r.length);return O(r,a,e),nn(a,n,t,o,a)?a:(g(p(),m(o),o),null)}function on(n,t,r,e){let o=P(t,r,e);o!==1&&C(n,n,[o,o,o])}function P(n,t,r){let e=!!(r&v.SOURCE),o=!!(r&v.TARGET),a=t?.sourceUnit,i=t?.targetUnit;if(!a&&!i)return 1;let l=tn(a,n);!e&&a&&l!==1&&(p().warn("source unit conversion not supported"),l=1);let s=1/tn(i,n);return!o&&i&&s!==1&&(p().warn("target unit conversion not supported"),s=1),l*s}function gn(n,t,r,e){let o=Z(n,t,e);if(!o)return g(p(),t,m(t)),null;let a=new Float64Array(o.length);return y(a,o,r),a}function vn(n,t,r,e,o,a){if(n==null)return null;let i=a??new Float32Array(n.length);return W(n,t,r,e,i)?(j(i,i,o),i):(g(p(),e,m(e)),null)}function An(n,t,r,e,o,a){if(n==null)return null;let i=a??new Float32Array(n.length);return $(n,t,r,e,i)?(j(i,i,o,4),i):(g(p(),e,m(e)),null)}function tn(n,t){if(n==null)return 1;let r=I(t);return 1/B(r,"meters",n)}var f=w(),R=w(),Fn=J(),en=k(),rn=w(),v;(function(n){n[n.NONE=0]="NONE",n[n.SOURCE=1]="SOURCE",n[n.TARGET=2]="TARGET"})(v||(v={}));export{Mn as a,bn as b,tn as c};
