import{a as Vt,b as Z,f as wt,h as Dt,i as Xt,j as ge,l as Xe}from"./chunk-GSOOUCJN.js";import{a as Ye,d as _t}from"./chunk-YUIUJIOR.js";import{b as qe,c as Ot,d as de,e as me}from"./chunk-MP46524Y.js";import{a as pe}from"./chunk-IFCRPPYQ.js";import{a as Je,l as Ke,v as he}from"./chunk-SO6OJFOM.js";import{a as He,b as We}from"./chunk-DG5QI6E2.js";import{a as qt}from"./chunk-MT7BXRRQ.js";import{a as ze}from"./chunk-NNKLK2DS.js";import{b as Yt}from"./chunk-VU5W7W6Y.js";import{I as G,S as je,T as yt}from"./chunk-Z5NXR7SL.js";import{S as gt}from"./chunk-7JLWSSXP.js";import{a as O}from"./chunk-W3WDPWBE.js";import{g as Ve,j as _e}from"./chunk-JKP4I6UL.js";import{a as Lt}from"./chunk-TZHKPIVH.js";import{b as tt,q as fe,s as mt}from"./chunk-BRWS572J.js";import{a as X,b as Q,g as ft}from"./chunk-JEGVIFEP.js";var ye,Ze,$e,Qe={exports:{}};Ze=Qe,ye=function(){function t(){this.pos=0,this.bufferLength=0,this.eof=!1,this.buffer=null}return t.prototype={ensureBuffer:function(e){var r=this.buffer,n=r?r.byteLength:0;if(e<n)return r;for(var a=512;a<e;)a<<=1;for(var s=new Uint8Array(a),h=0;h<n;++h)s[h]=r[h];return this.buffer=s},getByte:function(){for(var e=this.pos;this.bufferLength<=e;){if(this.eof)return null;this.readBlock()}return this.buffer[this.pos++]},getBytes:function(e){var r=this.pos;if(e){this.ensureBuffer(r+e);for(var n=r+e;!this.eof&&this.bufferLength<n;)this.readBlock();var a=this.bufferLength;n>a&&(n=a)}else{for(;!this.eof;)this.readBlock();n=this.bufferLength}return this.pos=n,this.buffer.subarray(r,n)},lookChar:function(){for(var e=this.pos;this.bufferLength<=e;){if(this.eof)return null;this.readBlock()}return String.fromCharCode(this.buffer[this.pos])},getChar:function(){for(var e=this.pos;this.bufferLength<=e;){if(this.eof)return null;this.readBlock()}return String.fromCharCode(this.buffer[this.pos++])},makeSubStream:function(e,r,n){for(var a=e+r;this.bufferLength<=a&&!this.eof;)this.readBlock();return new Stream(this.buffer,e,r,n)},skip:function(e){e||(e=1),this.pos+=e},reset:function(){this.pos=0}},t}(),($e=function(){if(!self||!self.Uint32Array)return null;var t=new Uint32Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),e=new Uint32Array([3,4,5,6,7,8,9,10,65547,65549,65551,65553,131091,131095,131099,131103,196643,196651,196659,196667,262211,262227,262243,262259,327811,327843,327875,327907,258,258,258]),r=new Uint32Array([1,2,3,4,65541,65543,131081,131085,196625,196633,262177,262193,327745,327777,393345,393409,459009,459137,524801,525057,590849,591361,657409,658433,724993,727041,794625,798721,868353,876545]),n=[new Uint32Array([459008,524368,524304,524568,459024,524400,524336,590016,459016,524384,524320,589984,524288,524416,524352,590048,459012,524376,524312,589968,459028,524408,524344,590032,459020,524392,524328,59e4,524296,524424,524360,590064,459010,524372,524308,524572,459026,524404,524340,590024,459018,524388,524324,589992,524292,524420,524356,590056,459014,524380,524316,589976,459030,524412,524348,590040,459022,524396,524332,590008,524300,524428,524364,590072,459009,524370,524306,524570,459025,524402,524338,590020,459017,524386,524322,589988,524290,524418,524354,590052,459013,524378,524314,589972,459029,524410,524346,590036,459021,524394,524330,590004,524298,524426,524362,590068,459011,524374,524310,524574,459027,524406,524342,590028,459019,524390,524326,589996,524294,524422,524358,590060,459015,524382,524318,589980,459031,524414,524350,590044,459023,524398,524334,590012,524302,524430,524366,590076,459008,524369,524305,524569,459024,524401,524337,590018,459016,524385,524321,589986,524289,524417,524353,590050,459012,524377,524313,589970,459028,524409,524345,590034,459020,524393,524329,590002,524297,524425,524361,590066,459010,524373,524309,524573,459026,524405,524341,590026,459018,524389,524325,589994,524293,524421,524357,590058,459014,524381,524317,589978,459030,524413,524349,590042,459022,524397,524333,590010,524301,524429,524365,590074,459009,524371,524307,524571,459025,524403,524339,590022,459017,524387,524323,589990,524291,524419,524355,590054,459013,524379,524315,589974,459029,524411,524347,590038,459021,524395,524331,590006,524299,524427,524363,590070,459011,524375,524311,524575,459027,524407,524343,590030,459019,524391,524327,589998,524295,524423,524359,590062,459015,524383,524319,589982,459031,524415,524351,590046,459023,524399,524335,590014,524303,524431,524367,590078,459008,524368,524304,524568,459024,524400,524336,590017,459016,524384,524320,589985,524288,524416,524352,590049,459012,524376,524312,589969,459028,524408,524344,590033,459020,524392,524328,590001,524296,524424,524360,590065,459010,524372,524308,524572,459026,524404,524340,590025,459018,524388,524324,589993,524292,524420,524356,590057,459014,524380,524316,589977,459030,524412,524348,590041,459022,524396,524332,590009,524300,524428,524364,590073,459009,524370,524306,524570,459025,524402,524338,590021,459017,524386,524322,589989,524290,524418,524354,590053,459013,524378,524314,589973,459029,524410,524346,590037,459021,524394,524330,590005,524298,524426,524362,590069,459011,524374,524310,524574,459027,524406,524342,590029,459019,524390,524326,589997,524294,524422,524358,590061,459015,524382,524318,589981,459031,524414,524350,590045,459023,524398,524334,590013,524302,524430,524366,590077,459008,524369,524305,524569,459024,524401,524337,590019,459016,524385,524321,589987,524289,524417,524353,590051,459012,524377,524313,589971,459028,524409,524345,590035,459020,524393,524329,590003,524297,524425,524361,590067,459010,524373,524309,524573,459026,524405,524341,590027,459018,524389,524325,589995,524293,524421,524357,590059,459014,524381,524317,589979,459030,524413,524349,590043,459022,524397,524333,590011,524301,524429,524365,590075,459009,524371,524307,524571,459025,524403,524339,590023,459017,524387,524323,589991,524291,524419,524355,590055,459013,524379,524315,589975,459029,524411,524347,590039,459021,524395,524331,590007,524299,524427,524363,590071,459011,524375,524311,524575,459027,524407,524343,590031,459019,524391,524327,589999,524295,524423,524359,590063,459015,524383,524319,589983,459031,524415,524351,590047,459023,524399,524335,590015,524303,524431,524367,590079]),9],a=[new Uint32Array([327680,327696,327688,327704,327684,327700,327692,327708,327682,327698,327690,327706,327686,327702,327694,0,327681,327697,327689,327705,327685,327701,327693,327709,327683,327699,327691,327707,327687,327703,327695,0]),5];function s(o){throw new Error(o)}function h(o){var l=0,u=o[l++],i=o[l++];u!=-1&&i!=-1||s("Invalid header in flate stream"),(15&u)!=8&&s("Unknown compression method in flate stream"),((u<<8)+i)%31!=0&&s("Bad FCHECK in flate stream"),32&i&&s("FDICT bit set in flate stream"),this.bytes=o,this.bytesPos=l,this.codeSize=0,this.codeBuf=0,ye.call(this)}return h.prototype=Object.create(ye.prototype),h.prototype.getBits=function(o){for(var l,u=this.codeSize,i=this.codeBuf,c=this.bytes,p=this.bytesPos;u<o;)(l=c[p++])===void 0&&s("Bad encoding in flate stream"),i|=l<<u,u+=8;return l=i&(1<<o)-1,this.codeBuf=i>>o,this.codeSize=u-=o,this.bytesPos=p,l},h.prototype.getCode=function(o){for(var l=o[0],u=o[1],i=this.codeSize,c=this.codeBuf,p=this.bytes,C=this.bytesPos;i<u;){var g;(g=p[C++])===void 0&&s("Bad encoding in flate stream"),c|=g<<i,i+=8}var w=l[c&(1<<u)-1],S=w>>16,f=65535&w;return(i==0||i<S||S==0)&&s("Bad encoding in flate stream"),this.codeBuf=c>>S,this.codeSize=i-S,this.bytesPos=C,f},h.prototype.generateHuffmanTable=function(o){for(var l=o.length,u=0,i=0;i<l;++i)o[i]>u&&(u=o[i]);for(var c=1<<u,p=new Uint32Array(c),C=1,g=0,w=2;C<=u;++C,g<<=1,w<<=1)for(var S=0;S<l;++S)if(o[S]==C){var f=0,d=g;for(i=0;i<C;++i)f=f<<1|1&d,d>>=1;for(i=f;i<c;i+=w)p[i]=C<<16|S;++g}return[p,u]},h.prototype.readBlock=function(){function o(N,V,D,F,z){for(var Y=N.getBits(D)+F;Y-- >0;)V[w++]=z}var l=this.getBits(3);if(1&l&&(this.eof=!0),(l>>=1)!=0){var u,i;if(l==1)u=n,i=a;else if(l==2){for(var c=this.getBits(5)+257,p=this.getBits(5)+1,C=this.getBits(4)+4,g=Array(t.length),w=0;w<C;)g[t[w++]]=this.getBits(3);for(var S=this.generateHuffmanTable(g),f=0,d=(w=0,c+p),m=new Array(d);w<d;){var y=this.getCode(S);y==16?o(this,m,2,3,f):y==17?o(this,m,3,3,f=0):y==18?o(this,m,7,11,f=0):m[w++]=f=y}u=this.generateHuffmanTable(m.slice(0,c)),i=this.generateHuffmanTable(m.slice(c,d))}else s("Unknown block type in flate stream");for(var v=(L=this.buffer)?L.length:0,k=this.bufferLength;;){var b=this.getCode(u);if(b<256)k+1>=v&&(v=(L=this.ensureBuffer(k+1)).length),L[k++]=b;else{if(b==256)return void(this.bufferLength=k);var I=(b=e[b-=257])>>16;I>0&&(I=this.getBits(I)),f=(65535&b)+I,b=this.getCode(i),(I=(b=r[b])>>16)>0&&(I=this.getBits(I));var T=(65535&b)+I;k+f>=v&&(v=(L=this.ensureBuffer(k+f)).length);for(var x=0;x<f;++x,++k)L[k]=L[k-T]}}}else{var A,E=this.bytes,P=this.bytesPos;(A=E[P++])===void 0&&s("Bad block header in flate stream");var R=A;(A=E[P++])===void 0&&s("Bad block header in flate stream"),R|=A<<8,(A=E[P++])===void 0&&s("Bad block header in flate stream");var M=A;(A=E[P++])===void 0&&s("Bad block header in flate stream"),(M|=A<<8)!=(65535&~R)&&s("Bad uncompressed block length in flate stream"),this.codeBuf=0,this.codeSize=0;var B=this.bufferLength,L=this.ensureBuffer(B+R),j=B+R;this.bufferLength=j;for(var H=B;H<j;++H){if((A=E[P++])===void 0){this.eof=!0;break}L[H]=A}this.bytesPos=P}},h}())!==void 0&&(Ze.exports=$e);var vt=Yt(Qe.exports);var Zt=class t{constructor(e){this._canvas=null,this._ctx=null,e&&(this._canvas=e.canvas,this._ctx=e.ctx||e.canvas&&e.canvas.getContext("2d"))}decode(e,r,n){if(!e||e.byteLength<10)throw new mt("imagecanvasdecoder: decode","required a valid encoded data as input.");let{width:a=0,height:s=0,format:h}=r,{applyJpegMask:o}=r;if(o&&(!a||!s))throw new mt("imagecanvasdecoder: decode","image width and height are needed to apply jpeg mask directly to canvas");return new Promise((l,u)=>{let i=null;h==="jpg"&&o&&(i=t._getMask(e,{width:a,height:s}));let c=new Blob([new Uint8Array(e)],{type:"image/"+h=="jpg"?"jpeg":h}),p=URL.createObjectURL(c),C=new Image,g;C.src=p,C.onload=()=>{if(URL.revokeObjectURL(p),_e(n))return void u(Ve());a=C.width,s=C.height,this._canvas&&this._ctx?(this._canvas.width===a&&this._canvas.height===s||(this._canvas.width=a,this._canvas.height=s),this._ctx.clearRect(0,0,a,s)):(this._canvas=document.createElement("canvas"),this._canvas.width=a,this._canvas.height=s,this._ctx=this._canvas.getContext("2d")),this._ctx.drawImage(C,0,0);let w=this._ctx.getImageData(0,0,a,s),S;if(g=w.data,r.renderOnCanvas){if(i)for(S=0;S<i.length;S++)i[S]?g[4*S+3]=255:g[4*S+3]=0;return this._ctx.putImageData(w,0,0),void l(null)}let f=a*s,d=new Uint8Array(f),m=new Uint8Array(f),y=new Uint8Array(f);if(i)for(S=0;S<f;S++)d[S]=g[4*S],m[S]=g[4*S+1],y[S]=g[4*S+2];else for(i=new Uint8Array(f),S=0;S<f;S++)d[S]=g[4*S],m[S]=g[4*S+1],y[S]=g[4*S+2],i[S]=g[4*S+3];l({width:a,height:s,pixels:[d,m,y],mask:i,pixelType:"u8"})},C.onerror=()=>{URL.revokeObjectURL(p),u("cannot load image")}})}static _getMask(e,r){let n=null;try{let a=new Uint8Array(e),s=Math.ceil(a.length/2),h=0,o=a.length-2;for(h=s;h<o&&(a[h]!==255||a[h+1]!==217);h++);if(h+=2,h<a.length-1){let l=new vt(a.subarray(h)).getBytes();n=new Uint8Array(r.width*r.height);let u=0;for(let i=0;i<l.length;i++)for(let c=7;c>=0;c--)n[u++]=l[i]>>c&1}}catch{}return n}};var tr,er,rr,or={exports:{}};tr=or,er=function(){var t=function(){function e(r){this.message="JPEG error: "+r}return e.prototype=new Error,e.prototype.name="JpegError",e.constructor=e,e}();return function(){if(!self||!self.Uint8ClampedArray)return null;var e=new Uint8Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]),r=4017,n=799,a=3406,s=2276,h=1567,o=3784,l=5793,u=2896;function i(){this.decodeTransform=null,this.colorTransform=-1}function c(f,d){for(var m,y,v=0,k=[],b=16;b>0&&!f[b-1];)b--;k.push({children:[],index:0});var I,T=k[0];for(m=0;m<b;m++){for(y=0;y<f[m];y++){for((T=k.pop()).children[T.index]=d[v];T.index>0;)T=k.pop();for(T.index++,k.push(T);k.length<=m;)k.push(I={children:[],index:0}),T.children[T.index]=I.children,T=I;v++}m+1<b&&(k.push(I={children:[],index:0}),T.children[T.index]=I.children,T=I)}return k[0].children}function p(f,d,m){return 64*((f.blocksPerLine+1)*d+m)}function C(f,d,m,y,v,k,b,I,T){var x=m.mcusPerLine,A=m.progressive,E=d,P=0,R=0;function M(){if(R>0)return R--,P>>R&1;if((P=f[d++])===255){var U=f[d++];if(U)throw new t("unexpected marker "+(P<<8|U).toString(16))}return R=7,P>>>7}function B(U){for(var W=U;;){if(typeof(W=W[M()])=="number")return W;if(typeof W!="object")throw new t("invalid huffman sequence")}}function L(U){for(var W=0;U>0;)W=W<<1|M(),U--;return W}function j(U){if(U===1)return M()===1?1:-1;var W=L(U);return W>=1<<U-1?W:W+(-1<<U)+1}function H(U,W){var J=B(U.huffmanTableDC),et=J===0?0:j(J);U.blockData[W]=U.pred+=et;for(var nt=1;nt<64;){var ct=B(U.huffmanTableAC),rt=15&ct,at=ct>>4;if(rt!==0){var Fr=e[nt+=at];U.blockData[W+Fr]=j(rt),nt++}else{if(at<15)break;nt+=16}}}function N(U,W){var J=B(U.huffmanTableDC),et=J===0?0:j(J)<<T;U.blockData[W]=U.pred+=et}function V(U,W){U.blockData[W]|=M()<<T}var D=0;function F(U,W){if(D>0)D--;else for(var J=k,et=b;J<=et;){var nt=B(U.huffmanTableAC),ct=15&nt,rt=nt>>4;if(ct!==0){var at=e[J+=rt];U.blockData[W+at]=j(ct)*(1<<T),J++}else{if(rt<15){D=L(rt)+(1<<rt)-1;break}J+=16}}}var z,Y=0;function $(U,W){for(var J,et,nt=k,ct=b,rt=0;nt<=ct;){var at=e[nt];switch(Y){case 0:if(rt=(et=B(U.huffmanTableAC))>>4,(J=15&et)==0)rt<15?(D=L(rt)+(1<<rt),Y=4):(rt=16,Y=1);else{if(J!==1)throw new t("invalid ACn encoding");z=j(J),Y=rt?2:3}continue;case 1:case 2:U.blockData[W+at]?U.blockData[W+at]+=M()<<T:--rt==0&&(Y=Y===2?3:0);break;case 3:U.blockData[W+at]?U.blockData[W+at]+=M()<<T:(U.blockData[W+at]=z<<T,Y=0);break;case 4:U.blockData[W+at]&&(U.blockData[W+at]+=M()<<T)}nt++}Y===4&&--D==0&&(Y=0)}function pt(U,W,J,et,nt){var ct=J%x;W(U,p(U,(J/x|0)*U.v+et,ct*U.h+nt))}function Mt(U,W,J){W(U,p(U,J/U.blocksPerLine|0,J%U.blocksPerLine))}var dt,st,Ct,Tt,q,Ft,kt=y.length;Ft=A?k===0?I===0?N:V:I===0?F:$:H;var ut,It,Wt,Jt,bt=0;for(It=kt===1?y[0].blocksPerLine*y[0].blocksPerColumn:x*m.mcusPerColumn;bt<It;){var Kt=v?Math.min(It-bt,v):It;for(st=0;st<kt;st++)y[st].pred=0;if(D=0,kt===1)for(dt=y[0],q=0;q<Kt;q++)Mt(dt,Ft,bt),bt++;else for(q=0;q<Kt;q++){for(st=0;st<kt;st++)for(Wt=(dt=y[st]).h,Jt=dt.v,Ct=0;Ct<Jt;Ct++)for(Tt=0;Tt<Wt;Tt++)pt(dt,Ft,bt,Ct,Tt);bt++}R=0,(ut=S(f,d))&&ut.invalid&&(console.log("decodeScan - unexpected MCU data, next marker is: "+ut.invalid),d=ut.offset);var xt=ut&&ut.marker;if(!xt||xt<=65280)throw new t("marker was not found");if(!(xt>=65488&&xt<=65495))break;d+=2}return(ut=S(f,d))&&ut.invalid&&(console.log("decodeScan - unexpected Scan data, next marker is: "+ut.invalid),d=ut.offset),d-E}function g(f,d,m){var y,v,k,b,I,T,x,A,E,P,R,M,B,L,j,H,N,V=f.quantizationTable,D=f.blockData;if(!V)throw new t("missing required Quantization Table.");for(var F=0;F<64;F+=8)E=D[d+F],P=D[d+F+1],R=D[d+F+2],M=D[d+F+3],B=D[d+F+4],L=D[d+F+5],j=D[d+F+6],H=D[d+F+7],E*=V[F],P|R|M|B|L|j|H?(P*=V[F+1],R*=V[F+2],M*=V[F+3],B*=V[F+4],L*=V[F+5],j*=V[F+6],H*=V[F+7],v=(y=(y=l*E+128>>8)+(v=l*B+128>>8)+1>>1)-v,N=(k=R)*o+(b=j)*h+128>>8,k=k*h-b*o+128>>8,x=(I=(I=u*(P-H)+128>>8)+(x=L<<4)+1>>1)-x,T=(A=(A=u*(P+H)+128>>8)+(T=M<<4)+1>>1)-T,b=(y=y+(b=N)+1>>1)-b,k=(v=v+k+1>>1)-k,N=I*s+A*a+2048>>12,I=I*a-A*s+2048>>12,A=N,N=T*n+x*r+2048>>12,T=T*r-x*n+2048>>12,x=N,m[F]=y+A,m[F+7]=y-A,m[F+1]=v+x,m[F+6]=v-x,m[F+2]=k+T,m[F+5]=k-T,m[F+3]=b+I,m[F+4]=b-I):(N=l*E+512>>10,m[F]=N,m[F+1]=N,m[F+2]=N,m[F+3]=N,m[F+4]=N,m[F+5]=N,m[F+6]=N,m[F+7]=N);for(var z=0;z<8;++z)E=m[z],(P=m[z+8])|(R=m[z+16])|(M=m[z+24])|(B=m[z+32])|(L=m[z+40])|(j=m[z+48])|(H=m[z+56])?(v=(y=4112+((y=l*E+2048>>12)+(v=l*B+2048>>12)+1>>1))-v,N=(k=R)*o+(b=j)*h+2048>>12,k=k*h-b*o+2048>>12,b=N,x=(I=(I=u*(P-H)+2048>>12)+(x=L)+1>>1)-x,T=(A=(A=u*(P+H)+2048>>12)+(T=M)+1>>1)-T,N=I*s+A*a+2048>>12,I=I*a-A*s+2048>>12,A=N,N=T*n+x*r+2048>>12,T=T*r-x*n+2048>>12,E=(E=(y=y+b+1>>1)+A)<16?0:E>=4080?255:E>>4,P=(P=(v=v+k+1>>1)+(x=N))<16?0:P>=4080?255:P>>4,R=(R=(k=v-k)+T)<16?0:R>=4080?255:R>>4,M=(M=(b=y-b)+I)<16?0:M>=4080?255:M>>4,B=(B=b-I)<16?0:B>=4080?255:B>>4,L=(L=k-T)<16?0:L>=4080?255:L>>4,j=(j=v-x)<16?0:j>=4080?255:j>>4,H=(H=y-A)<16?0:H>=4080?255:H>>4,D[d+z]=E,D[d+z+8]=P,D[d+z+16]=R,D[d+z+24]=M,D[d+z+32]=B,D[d+z+40]=L,D[d+z+48]=j,D[d+z+56]=H):(N=(N=l*E+8192>>14)<-2040?0:N>=2024?255:N+2056>>4,D[d+z]=N,D[d+z+8]=N,D[d+z+16]=N,D[d+z+24]=N,D[d+z+32]=N,D[d+z+40]=N,D[d+z+48]=N,D[d+z+56]=N)}function w(f,d){for(var m=d.blocksPerLine,y=d.blocksPerColumn,v=new Int16Array(64),k=0;k<y;k++)for(var b=0;b<m;b++)g(d,p(d,k,b),v);return d.blockData}function S(f,d,m){function y(T){return f[T]<<8|f[T+1]}var v=f.length-1,k=m<d?m:d;if(d>=v)return null;var b=y(d);if(b>=65472&&b<=65534)return{invalid:null,marker:b,offset:d};for(var I=y(k);!(I>=65472&&I<=65534);){if(++k>=v)return null;I=y(k)}return{invalid:b.toString(16),marker:I,offset:k}}return i.prototype={parse:function(f){function d(){var U=f[b]<<8|f[b+1];return b+=2,U}function m(){var U=d(),W=b+U-2,J=S(f,W,b);J&&J.invalid&&(console.log("readDataBlock - incorrect length, next marker is: "+J.invalid),W=J.offset);var et=f.subarray(b,W);return b+=et.length,et}function y(U){for(var W=Math.ceil(U.samplesPerLine/8/U.maxH),J=Math.ceil(U.scanLines/8/U.maxV),et=0;et<U.components.length;et++){q=U.components[et];var nt=Math.ceil(Math.ceil(U.samplesPerLine/8)*q.h/U.maxH),ct=Math.ceil(Math.ceil(U.scanLines/8)*q.v/U.maxV),rt=W*q.h,at=J*q.v*64*(rt+1);q.blockData=new Int16Array(at),q.blocksPerLine=nt,q.blocksPerColumn=ct}U.mcusPerLine=W,U.mcusPerColumn=J}var v,k,b=0,I=null,T=null,x=[],A=[],E=[],P=d();if(P!==65496)throw new t("SOI not found");for(P=d();P!==65497;){var R,M,B;switch(P){case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:var L=m();P===65504&&L[0]===74&&L[1]===70&&L[2]===73&&L[3]===70&&L[4]===0&&(I={version:{major:L[5],minor:L[6]},densityUnits:L[7],xDensity:L[8]<<8|L[9],yDensity:L[10]<<8|L[11],thumbWidth:L[12],thumbHeight:L[13],thumbData:L.subarray(14,14+3*L[12]*L[13])}),P===65518&&L[0]===65&&L[1]===100&&L[2]===111&&L[3]===98&&L[4]===101&&(T={version:L[5]<<8|L[6],flags0:L[7]<<8|L[8],flags1:L[9]<<8|L[10],transformCode:L[11]});break;case 65499:for(var j=d()+b-2;b<j;){var H=f[b++],N=new Uint16Array(64);if(H>>4){if(H>>4!=1)throw new t("DQT - invalid table spec");for(M=0;M<64;M++)N[e[M]]=d()}else for(M=0;M<64;M++)N[e[M]]=f[b++];x[15&H]=N}break;case 65472:case 65473:case 65474:if(v)throw new t("Only single frame JPEGs supported");d(),(v={}).extended=P===65473,v.progressive=P===65474,v.precision=f[b++],v.scanLines=d(),v.samplesPerLine=d(),v.components=[],v.componentIds={};var V,D=f[b++],F=0,z=0;for(R=0;R<D;R++){V=f[b];var Y=f[b+1]>>4,$=15&f[b+1];F<Y&&(F=Y),z<$&&(z=$);var pt=f[b+2];B=v.components.push({h:Y,v:$,quantizationId:pt,quantizationTable:null}),v.componentIds[V]=B-1,b+=3}v.maxH=F,v.maxV=z,y(v);break;case 65476:var Mt=d();for(R=2;R<Mt;){var dt=f[b++],st=new Uint8Array(16),Ct=0;for(M=0;M<16;M++,b++)Ct+=st[M]=f[b];var Tt=new Uint8Array(Ct);for(M=0;M<Ct;M++,b++)Tt[M]=f[b];R+=17+Ct,(dt>>4?A:E)[15&dt]=c(st,Tt)}break;case 65501:d(),k=d();break;case 65498:d();var q,Ft=f[b++],kt=[];for(R=0;R<Ft;R++){var ut=v.componentIds[f[b++]];q=v.components[ut];var It=f[b++];q.huffmanTableDC=E[It>>4],q.huffmanTableAC=A[15&It],kt.push(q)}var Wt=f[b++],Jt=f[b++],bt=f[b++],Kt=C(f,b,v,kt,k,Wt,Jt,bt>>4,15&bt);b+=Kt;break;case 65535:f[b]!==255&&b--;break;default:if(f[b-3]===255&&f[b-2]>=192&&f[b-2]<=254){b-=3;break}throw new t("unknown marker "+P.toString(16))}P=d()}for(this.width=v.samplesPerLine,this.height=v.scanLines,this.jfif=I,this.eof=b,this.adobe=T,this.components=[],R=0;R<v.components.length;R++){var xt=x[(q=v.components[R]).quantizationId];xt&&(q.quantizationTable=xt),this.components.push({output:w(v,q),scaleX:q.h/v.maxH,scaleY:q.v/v.maxV,blocksPerLine:q.blocksPerLine,blocksPerColumn:q.blocksPerColumn})}this.numComponents=this.components.length},_getLinearizedBlockData:function(f,d){var m,y,v,k,b,I,T,x,A,E,P,R=this.width/f,M=this.height/d,B=0,L=this.components.length,j=f*d*L,H=new Uint8ClampedArray(j),N=new Uint32Array(f),V=4294967288;for(T=0;T<L;T++){for(y=(m=this.components[T]).scaleX*R,v=m.scaleY*M,B=T,P=m.output,k=m.blocksPerLine+1<<3,b=0;b<f;b++)x=0|b*y,N[b]=(x&V)<<3|7&x;for(I=0;I<d;I++)for(E=k*((x=0|I*v)&V)|(7&x)<<3,b=0;b<f;b++)H[B]=P[E+N[b]],B+=L}var D=this.decodeTransform;if(D)for(T=0;T<j;)for(x=0,A=0;x<L;x++,T++,A+=2)H[T]=(H[T]*D[A]>>8)+D[A+1];return H},_isColorConversionNeeded:function(){return this.adobe?!!this.adobe.transformCode:this.numComponents===3?this.colorTransform!==0:this.colorTransform===1},_convertYccToRgb:function(f){for(var d,m,y,v=0,k=f.length;v<k;v+=3)d=f[v],m=f[v+1],y=f[v+2],f[v]=d-179.456+1.402*y,f[v+1]=d+135.459-.344*m-.714*y,f[v+2]=d-226.816+1.772*m;return f},_convertYcckToRgb:function(f){for(var d,m,y,v,k=0,b=0,I=f.length;b<I;b+=4)d=f[b],m=f[b+1],y=f[b+2],v=f[b+3],f[k++]=m*(-660635669420364e-19*m+.000437130475926232*y-54080610064599e-18*d+.00048449797120281*v-.154362151871126)-122.67195406894+y*(-.000957964378445773*y+.000817076911346625*d-.00477271405408747*v+1.53380253221734)+d*(.000961250184130688*d-.00266257332283933*v+.48357088451265)+v*(-.000336197177618394*v+.484791561490776),f[k++]=107.268039397724+m*(219927104525741e-19*m-.000640992018297945*y+.000659397001245577*d+.000426105652938837*v-.176491792462875)+y*(-.000778269941513683*y+.00130872261408275*d+.000770482631801132*v-.151051492775562)+d*(.00126935368114843*d-.00265090189010898*v+.25802910206845)+v*(-.000318913117588328*v-.213742400323665),f[k++]=m*(-.000570115196973677*m-263409051004589e-19*y+.0020741088115012*d-.00288260236853442*v+.814272968359295)-20.810012546947+y*(-153496057440975e-19*y-.000132689043961446*d+.000560833691242812*v-.195152027534049)+d*(.00174418132927582*d-.00255243321439347*v+.116935020465145)+v*(-.000343531996510555*v+.24165260232407);return f},_convertYcckToCmyk:function(f){for(var d,m,y,v=0,k=f.length;v<k;v+=4)d=f[v],m=f[v+1],y=f[v+2],f[v]=434.456-d-1.402*y,f[v+1]=119.541-d+.344*m+.714*y,f[v+2]=481.816-d-1.772*m;return f},_convertCmykToRgb:function(f){for(var d,m,y,v,k=0,b=1/255,I=0,T=f.length;I<T;I+=4)d=f[I]*b,m=f[I+1]*b,y=f[I+2]*b,v=f[I+3]*b,f[k++]=255+d*(-4.387332384609988*d+54.48615194189176*m+18.82290502165302*y+212.25662451639585*v-285.2331026137004)+m*(1.7149763477362134*m-5.6096736904047315*y-17.873870861415444*v-5.497006427196366)+y*(-2.5217340131683033*y-21.248923337353073*v+17.5119270841813)-v*(21.86122147463605*v+189.48180835922747),f[k++]=255+d*(8.841041422036149*d+60.118027045597366*m+6.871425592049007*y+31.159100130055922*v-79.2970844816548)+m*(-15.310361306967817*m+17.575251261109482*y+131.35250912493976*v-190.9453302588951)+y*(4.444339102852739*y+9.8632861493405*v-24.86741582555878)-v*(20.737325471181034*v+187.80453709719578),f[k++]=255+d*(.8842522430003296*d+8.078677503112928*m+30.89978309703729*y-.23883238689178934*v-14.183576799673286)+m*(10.49593273432072*m+63.02378494754052*y+50.606957656360734*v-112.23884253719248)+y*(.03296041114873217*y+115.60384449646641*v-193.58209356861505)-v*(22.33816807309886*v+180.12613974708367);return f},getData:function(f,d,m){if(this.numComponents>4)throw new t("Unsupported color mode");var y=this._getLinearizedBlockData(f,d);if(this.numComponents===1&&m){for(var v=y.length,k=new Uint8ClampedArray(3*v),b=0,I=0;I<v;I++){var T=y[I];k[b++]=T,k[b++]=T,k[b++]=T}return k}if(this.numComponents===3&&this._isColorConversionNeeded())return this._convertYccToRgb(y);if(this.numComponents===4){if(this._isColorConversionNeeded())return m?this._convertYcckToRgb(y):this._convertYcckToCmyk(y);if(m)return this._convertCmykToRgb(y)}return y}},i}()},(rr=er())!==void 0&&(tr.exports=rr);var $t=Yt(or.exports);var Qt=class{static decode(e,r=!1){let n=new Uint8Array(e),a=new $t;a.parse(n);let{width:s,height:h,numComponents:o,eof:l}=a,u=a.getData(s,h,!0),i=s*h,c,p=null,C=0,g=0,w=0;if(!r&&l<n.length-1)try{let S=new vt(n.subarray(l)).getBytes();p=new Uint8Array(i);let f=0;for(C=0;C<S.length;C++)for(w=7;w>=0;w--)p[f++]=S[C]>>w&1}catch{}if(o===1&&u.length===s*h){let S=new Uint8Array(u.buffer);c=[S,S,S]}else{for(c=[],C=0;C<3;C++)c.push(new Uint8Array(i));for(w=0,g=0;g<i;g++)for(C=0;C<3;C++)c[C][g]=u[w++]}return{width:s,height:h,pixels:c,mask:p}}};var ir=[{pixelType:"S8",size:1,ctor:Int8Array,range:[-128,127]},{pixelType:"U8",size:1,ctor:Uint8Array,range:[0,255]},{pixelType:"S16",size:2,ctor:Int16Array,range:[-32768,32767]},{pixelType:"U16",size:2,ctor:Uint16Array,range:[0,65536]},{pixelType:"S32",size:4,ctor:Int32Array,range:[-2147483648,2147483647]},{pixelType:"U32",size:4,ctor:Uint32Array,range:[0,4294967296]},{pixelType:"F32",size:4,ctor:Float32Array,range:[-34027999387901484e22,34027999387901484e22]},{pixelType:"F64",size:8,ctor:Float64Array,range:[-17976931348623157e292,17976931348623157e292]}],Ce=null;function ee(){return Ce||(Ce=import("./chunk-TSSAQ5YJ.js").then(t=>t.l).then(({default:t})=>t({locateFile:e=>ze(`esri/layers/support/rasterFormats/${e}`)})).then(t=>{_r(t)}),Ce)}var te={getBlobInfo:null,decode:null};function Vr(t){return 16+(t>>3<<3)}function St(t,e,r){r.set(t.slice(e,e+r.length))}function _r(t){let{_malloc:e,_free:r,_lerc_getBlobInfo:n,_lerc_getDataRanges:a,_lerc_decode_4D:s,asm:h}=t,o,l=Object.values(h).find(i=>i&&"buffer"in i&&i.buffer===t.HEAPU8.buffer),u=i=>{let c=i.map(w=>Vr(w)),p=c.reduce((w,S)=>w+S),C=e(p);o=new Uint8Array(l.buffer);let g=c[0];c[0]=C;for(let w=1;w<c.length;w++){let S=c[w];c[w]=c[w-1]+g,g=S}return c};te.getBlobInfo=i=>{let C=new Uint8Array(48),g=new Uint8Array(8*3),[w,S,f]=u([i.length,C.length,g.length]);o.set(i,w),o.set(C,S),o.set(g,f);let d=n(w,i.length,S,f,12,3);if(d)throw r(w),new Error(`lerc-getBlobInfo: error code is ${d}`);o=new Uint8Array(l.buffer),St(o,S,C),St(o,f,g);let m=new Uint32Array(C.buffer),y=new Float64Array(g.buffer),[v,k,,b,I,T,x,A,E,P,R]=m,M={version:v,depthCount:P,width:b,height:I,validPixelCount:x,bandCount:T,blobSize:A,maskCount:E,dataType:k,minValue:y[0],maxValue:y[1],maxZerror:y[2],statistics:[],bandCountWithNoData:R};if(R&&P>1)return r(w),M;if(P===1&&T===1)return r(w),M.statistics.push({minValue:y[0],maxValue:y[1]}),M;let B=P*T*8,L=new Uint8Array(B),j=new Uint8Array(B),H=w,N=0,V=0,D=!1;if(o.byteLength<w+2*B?(r(w),D=!0,[H,N,V]=u([i.length,B,B]),o.set(i,H)):[N,V]=u([B,B]),o.set(L,N),o.set(j,V),d=a(H,i.length,P,T,N,V),d)throw r(H),D||r(N),new Error(`lerc-getDataRanges: error code is ${d}`);o=new Uint8Array(l.buffer),St(o,N,L),St(o,V,j);let F=new Float64Array(L.buffer),z=new Float64Array(j.buffer),Y=M.statistics;for(let $=0;$<T;$++)if(P>1){let pt=F.slice($*P,($+1)*P),Mt=z.slice($*P,($+1)*P),dt=Math.min.apply(null,pt),st=Math.max.apply(null,Mt);Y.push({minValue:dt,maxValue:st,depthStats:{minValues:pt,maxValues:Mt}})}else Y.push({minValue:F[$],maxValue:z[$]});return r(H),D||r(N),M},te.decode=(i,c)=>{let{maskCount:p,depthCount:C,bandCount:g,width:w,height:S,dataType:f,bandCountWithNoData:d}=c,m=ir[f],y=w*S,v=new Uint8Array(y*g),k=y*C*g*m.size,b=new Uint8Array(k),I=new Uint8Array(g),T=new Uint8Array(8*g),[x,A,E,P,R]=u([i.length,v.length,b.length,I.length,T.length]);o.set(i,x),o.set(v,A),o.set(b,E),o.set(I,P),o.set(T,R);let M=s(x,i.length,p,A,C,w,S,g,f,E,P,R);if(M)throw r(x),new Error(`lerc-decode: error code is ${M}`);o=new Uint8Array(l.buffer),St(o,E,b),St(o,A,v);let B=null;if(d){St(o,P,I),St(o,R,T),B=[];let L=new Float64Array(T.buffer);for(let j=0;j<I.length;j++)B.push(I[j]?L[j]:null)}return r(x),{data:b,maskData:v,noDataValues:B}}}function jr(t,e,r,n,a){if(r<2)return t;let s=new n(e*r);for(let h=0,o=0;h<e;h++)for(let l=0,u=h;l<r;l++,u+=e)s[u]=t[o++];return s}function re(t,e={}){let r=e.inputOffset??0,n=t instanceof Uint8Array?t.subarray(r):new Uint8Array(t,r),a=te.getBlobInfo(n),{data:s,maskData:h,noDataValues:o}=te.decode(n,a),{width:l,height:u,bandCount:i,depthCount:c,dataType:p,maskCount:C,statistics:g}=a,w=ir[p],S=new w.ctor(s.buffer),f=[],d=[],m=l*u,y=m*c;for(let x=0;x<i;x++){let A=S.subarray(x*y,(x+1)*y);if(e.returnInterleaved)f.push(A);else{let E=jr(A,m,c,w.ctor);f.push(E)}d.push(h.subarray(x*y,(x+1)*y))}let v=C===0?null:C===1?d[0]:new Uint8Array(m);if(C>1){v.set(d[0]);for(let x=1;x<d.length;x++){let A=d[x];for(let E=0;E<m;E++)v[E]=v[E]&A[E]}}let{noDataValue:k}=e,b=k!=null&&w.range[0]<=k&&w.range[1]>=k;if(C>0&&b)for(let x=0;x<i;x++){let A=f[x],E=d[x]||v;for(let P=0;P<m;P++)E[P]===0&&(A[P]=k)}let I=C===i&&i>1?d:null,{pixelType:T}=w;return{width:l,height:u,bandCount:i,pixelType:T,depthCount:c,statistics:g,pixels:f,mask:v,bandMasks:I,noDataValues:o}}function zr(t,e,r,n=!0){if(e%4!=0||r%4!=0){let a=new ArrayBuffer(4*Math.ceil(r/4)),s=new Uint8Array(a),h=new Uint8Array(t,e,r);if(n)for(let o=0;o<s.length;o+=4)s[o]=h[o+3],s[o+1]=h[o+2],s[o+2]=h[o+1],s[o+3]=h[o];else s.set(h);return new Uint32Array(s.buffer)}if(n){let a=new Uint8Array(t,e,r),s=new Uint8Array(a.length);for(let h=0;h<s.length;h+=4)s[h]=a[h+3],s[h+1]=a[h+2],s[h+2]=a[h+1],s[h+3]=a[h];return new Uint32Array(s.buffer)}return new Uint32Array(t,e,r/4)}function nr(){let t=[];for(let e=0;e<=257;e++)t[e]=[e];return t}function ar(t,e){for(let r=0;r<e.length;r++)t.push(e[r])}var Ut=new Set;function jt(t,e,r,n=!0){let a=zr(t,e,r,n),s=9,h=nr(),o=32,l=h.length,u=[],i=1,c=a[0],p=0,C=a.length,g=8*(4*C-r),w=[];for(;c!=null;){if(o>=s)o-=s,p=c>>>32-s,c<<=s;else{p=c>>>32-o,c=a[i++];let f=s-o;o=32-f,p=(p<<f)+(c>>>o),c<<=f}if(p===257)break;if(p===256){s=9,h=nr(),l=h.length,u=[];continue}let S=h[p];if(S==null){if(p>h.length)throw new Error("data integrity issue: code does not exist on code page");u.push(u[0]),h[l++]=u.slice(),ar(w,u)}else ar(w,S),u.push(S[0]),u.length>1&&(h[l++]=u.slice()),u=S.slice();if(Ut.has(l)&&s++,o===0&&(c=a[i++],o=32),i>C||i===C&&o<=g)break}return new Uint8Array(w)}Ut.add(511),Ut.add(1023),Ut.add(2047),Ut.add(4095),Ut.add(8191);var sr=(t,e)=>{let r=e.width*e.height,n=e.pixelType;return Math.floor(t.byteLength/(r*lr(n)))},lr=t=>{let e=1;switch(t){case Uint8Array:case Int8Array:e=1;break;case Uint16Array:case Int16Array:e=2;break;case Uint32Array:case Int32Array:case Float32Array:e=4;break;case Float64Array:e=8}return e},Hr=(t,e)=>{if(8*t.byteLength<e)return null;let r=new Uint8Array(t,0,Math.ceil(e/8)),n=new Uint8Array(e),a=0,s=0,h=0,o=0;for(h=0;h<r.length-1;h++)for(s=r[h],o=7;o>=0;o--)n[a++]=s>>o&1;for(o=7;a<e-1;)s=r[r.length-1],n[a++]=s>>o&1,o--;return n},oe=class{static decode(e,r){let n=r.pixelType,a=[],s=r.width*r.height,h=sr(e,r),{bandIds:o,format:l}=r,u=o?.length||sr(e,r),i=e.byteLength-e.byteLength%(s*lr(n)),c=new n(e,0,s*h),p,C,g,w,S=null;if(l==="bip")for(p=0;p<u;p++){for(g=new n(s),w=o?o[p]:p,C=0;C<s;C++)g[C]=c[C*h+w];a.push(g)}else if(l==="bsq")for(p=0;p<u;p++)w=o?o[p]:p,a.push(c.subarray(w*s,(w+1)*s));return i<e.byteLength-1&&(S=Hr(e.slice(i),s)),{pixels:a,mask:S}}};function ur(t,e){let r=0,n="",a=0,s=0,h=t.length;for(;r<h;)s=t[r++],a=s>>4,a<8?a=1:a===15?(a=4,s=(7&s)<<18|(63&t[r++])<<12|(63&t[r++])<<6|63&t[r++]):a===14?(a=3,s=(15&s)<<12|(63&t[r++])<<6|63&t[r++]):(a=2,s=(31&s)<<6|63&t[r++]),(s!==0||e)&&(n+=String.fromCharCode(s));return n}var we=(()=>{let t=[];return t[254]="NEWSUBFILETYPE",t[255]="SUBFILETYPE",t[256]="IMAGEWIDTH",t[257]="IMAGELENGTH",t[258]="BITSPERSAMPLE",t[259]="COMPRESSION",t[262]="PHOTOMETRICINTERPRETATION",t[263]="THRESHHOLDING",t[264]="CELLWIDTH",t[265]="CELLLENGTH",t[266]="FILLORDER",t[269]="DOCUMENTNAME",t[270]="IMAGEDESCRIPTION",t[271]="MAKE",t[272]="MODEL",t[273]="STRIPOFFSETS",t[274]="ORIENTATION",t[277]="SAMPLESPERPIXEL",t[278]="ROWSPERSTRIP",t[279]="STRIPBYTECOUNTS",t[280]="MINSAMPLEVALUE",t[281]="MAXSAMPLEVALUE",t[282]="XRESOLUTION",t[283]="YRESOLUTION",t[284]="PLANARCONFIGURATION",t[285]="PAGENAME",t[286]="XPOSITION",t[287]="YPOSITION",t[288]="FREEOFFSETS",t[289]="FREEBYTECOUNTS",t[290]="GRAYRESPONSEUNIT",t[291]="GRAYRESPONSECURVE",t[292]="T4OPTIONS",t[293]="T6OPTIONS",t[296]="RESOLUTIONUNIT",t[297]="PAGENUMBER",t[300]="COLORRESPONSEUNIT",t[301]="TRANSFERFUNCTION",t[305]="SOFTWARE",t[306]="DATETIME",t[315]="ARTIST",t[316]="HOSTCOMPUTER",t[317]="PREDICTOR",t[318]="WHITEPOINT",t[319]="PRIMARYCHROMATICITIES",t[320]="COLORMAP",t[321]="HALFTONEHINTS",t[322]="TILEWIDTH",t[323]="TILELENGTH",t[324]="TILEOFFSETS",t[325]="TILEBYTECOUNTS",t[326]="BADFAXLINES",t[327]="CLEANFAXDATA",t[328]="CONSECUTIVEBADFAXLINES",t[330]="SUBIFD",t[332]="INKSET",t[333]="INKNAMES",t[334]="NUMBEROFINKS",t[336]="DOTRANGE",t[337]="TARGETPRINTER",t[338]="EXTRASAMPLES",t[339]="SAMPLEFORMAT",t[340]="SMINSAMPLEVALUE",t[341]="SMAXSAMPLEVALUE",t[342]="TRANSFERRANGE",t[347]="JPEGTABLES",t[512]="JPEGPROC",t[513]="JPEGIFOFFSET",t[514]="JPEGIFBYTECOUNT",t[515]="JPEGRESTARTINTERVAL",t[517]="JPEGLOSSLESSPREDICTORS",t[518]="JPEGPOINTTRANSFORM",t[519]="JPEGQTABLES",t[520]="JPEGDCTABLES",t[521]="JPEGACTABLES",t[529]="YCBCRCOEFFICIENTS",t[530]="YCBCRSUBSAMPLING",t[531]="YCBCRPOSITIONING",t[532]="REFERENCEBLACKWHITE",t[700]="XMP",t[33550]="GEOPIXELSCALE",t[33922]="GEOTIEPOINTS",t[33432]="COPYRIGHT",t[42112]="GDAL_METADATA",t[42113]="GDAL_NODATA",t[50844]="RPCCOEFFICIENT",t[34264]="GEOTRANSMATRIX",t[34735]="GEOKEYDIRECTORY",t[34736]="GEODOUBLEPARAMS",t[34737]="GEOASCIIPARAMS",t[34665]="EXIFIFD",t[34853]="GPSIFD",t[40965]="INTEROPERABILITYIFD",t})(),Wr=(()=>{let t=we.slice();return t[36864]="ExifVersion",t[40960]="FlashpixVersion",t[40961]="ColorSpace",t[42240]="Gamma",t[37121]="ComponentsConfiguration",t[37122]="CompressedBitsPerPixel",t[40962]="PixelXDimension",t[40963]="PixelYDimension",t[37500]="MakerNote",t[37510]="UserComment",t[40964]="RelatedSoundFile",t[36867]="DateTimeOriginal",t[36868]="DateTimeDigitized",t[36880]="OffsetTime",t[36881]="OffsetTimeOriginal",t[36882]="OffsetTimeDigitized",t[37520]="SubSecTime",t[37521]="SubSecTimeOriginal",t[37522]="SubSecTimeDigitized",t[37888]="Temperature",t[37889]="Humidity",t[37890]="Pressure",t[37891]="WaterDepth",t[37892]="Acceleration",t[37893]="CameraElevationAngle",t[42016]="ImageUniqueID",t[42032]="CameraOwnerName",t[42033]="BodySerialNumber",t[42034]="LensSpecification",t[42035]="LensMake",t[42036]="LensModel",t[42037]="LensSerialNumber",t[33434]="ExposureTime",t[33437]="FNumber",t[34850]="ExposureProgram",t[34852]="SpectralSensitivity",t[34855]="PhotographicSensitivity",t[34856]="OECF",t[34864]="SensitivityType",t[34865]="StandardOutputSensitivity",t[34866]="RecommendedExposureIndex",t[34867]="ISOSpeed",t[34868]="ISOSpeedLatitudeyyy",t[34869]="ISOSpeedLatitudezzz",t[37377]="ShutterSpeedValue",t[37378]="ApertureValue",t[37379]="BrightnessValue",t[37380]="ExposureBiasValue",t[37381]="MaxApertureValue",t[37382]="SubjectDistance",t[37383]="MeteringMode",t[37384]="LightSource",t[37385]="Flash",t[37386]="FocalLength",t[37396]="SubjectArea",t[41483]="FlashEnergy",t[41484]="SpatialFrequencyResponse",t[41486]="FocalPlaneXResolution",t[41487]="FocalPlaneYResolution",t[41488]="FocalPlaneResolutionUnit",t[41492]="SubjectLocation",t[41493]="ExposureIndex",t[41495]="SensingMethod",t[41728]="FileSource",t[41729]="SceneType",t[41730]="CFAPattern",t[41985]="CustomRendered",t[41986]="ExposureMode",t[41987]="WhiteBalance",t[41988]="DigitalZoomRatio",t[41989]="FocalLengthIn35mmFilm",t[41990]="SceneCaptureType",t[41991]="GainControl",t[41992]="Contrast",t[41993]="Saturation",t[41994]="Sharpness",t[41995]="DeviceSettingDescription",t[41996]="SubjectDistanceRange",t})(),Jr=["GPSVersionID","GPSLatitudeRef","GPSLatitude","GPSLongitudeRef","GPSLongitude","GPSAltitudeRef","GPSAltitude","GPSTimeStamp","GPSSatellites","GPSStatus","GPSMeasureMode","GPSDOP","GPSSpeedRef","GPSSpeed","GPSTrackRef","GPSTrack","GPSImgDirectionRef","GPSImgDirection","GPSMapDatum","GPSDestLatitudeRef","GPSDestLatitude","GPSDestLongitudeRef","GPSDestLongitude","GPSDestBearingRef","GPSDestBearing","GPSDestDistanceRef","GPSDestDistance","GPSProcessingMethod","GPSAreaInformation","GPSDateStamp","GPSDifferential","GPSHPositioningError"],Kr=(()=>{let t=[];return t[1024]="GTModelTypeGeoKey",t[1025]="GTRasterTypeGeoKey",t[1026]="GTCitationGeoKey",t[2048]="GeographicTypeGeoKey",t[2049]="GeogCitationGeoKey",t[2050]="GeogGeodeticDatumGeoKey",t[2051]="GeogPrimeMeridianGeoKey",t[2052]="GeogLinearUnitsGeoKey",t[2053]="GeogLinearUnitSizeGeoKey",t[2054]="GeogAngularUnitsGeoKey",t[2055]="GeogAngularUnitSizeGeoKey",t[2056]="GeogEllipsoidGeoKey",t[2057]="GeogSemiMajorAxisGeoKey",t[2058]="GeogSemiMinorAxisGeoKey",t[2059]="GeogInvFlatteningGeoKey",t[2061]="GeogPrimeMeridianLongGeoKey",t[2060]="GeogAzimuthUnitsGeoKey",t[3072]="ProjectedCSTypeGeoKey",t[3073]="PCSCitationGeoKey",t[3074]="ProjectionGeoKey",t[3075]="ProjCoordTransGeoKey",t[3076]="ProjLinearUnitsGeoKey",t[3077]="ProjLinearUnitSizeGeoKey",t[3078]="ProjStdParallel1GeoKey",t[3079]="ProjStdParallel2GeoKey",t[3080]="ProjNatOriginLongGeoKey",t[3081]="ProjNatOriginLatGeoKey",t[3082]="ProjFalseEastingGeoKey",t[3083]="ProjFalseNorthingGeoKey",t[3084]="ProjFalseOriginLongGeoKey",t[3085]="ProjFalseOriginLatGeoKey",t[3086]="ProjFalseOriginEastingGeoKey",t[3087]="ProjFalseOriginNorthingGeoKey",t[3088]="ProjCenterLongGeoKey",t[3090]="ProjCenterEastingGeoKey",t[3091]="ProjCenterNorthingGeoKey",t[3092]="ProjScaleAtNatOriginGeoKey",t[3093]="ProjScaleAtCenterGeoKey",t[3094]="ProjAzimuthAngleGeoKey",t[3095]="ProjStraightVertPoleLongGeoKey",t[4096]="VerticalCSTypeGeoKey",t[4097]="VerticalCitationGeoKey",t[4098]="VerticalDatumGeoKey",t[4099]="VerticalUnitsGeoKey",t})(),qr=(t,e)=>{let r=(e||we)[t];return r===void 0&&(r="unknown"+String(t)),r},be=new Map;be.set("EXIFIFD",Wr),be.set("GPSIFD",Jr);var At={tiffTags:we,ifdTags:be,geoKeys:Kr,getTagName:qr};var zt=(()=>{let t=new ArrayBuffer(4),e=new Uint8Array(t);return new Uint32Array(t)[0]=1,e[0]===1})();var cr=[0,1,1,2,4,8,1,1,2,4,8,4,8,-1,-1,-1,8,8,8],Gt=4294967296,Yr=new Set([1,5,6,7,8,34712,34887]);function xe(t,e){let r="unknown";return t===3?r=e===64?"f64":"f32":t===1?e===1?r="u1":e===2?r="u2":e===4?r="u4":e<=8?r="u8":e<=16?r="u16":e<=32&&(r="u32"):t===2&&(e<=8?r="s8":e<=16?r="s16":e<=32&&(r="s32")),r}function ne(t){let e=null;switch(t?t.toLowerCase():"f32"){case"u1":case"u2":case"u4":case"u8":e=Uint8Array;break;case"u16":e=Uint16Array;break;case"u32":e=Uint32Array;break;case"s8":e=Int8Array;break;case"s16":e=Int16Array;break;case"s32":e=Int32Array;break;case"f64":e=Float64Array;break;default:e=Float32Array}return e}function Xr(t,e){return{x:e[0]*t.x+e[1]*t.y+e[2],y:e[3]*t.x+e[4]*t.y+e[5]}}function hr(t,e){return t.get(e)?.values}function Et(t,e){return t.get(e)?.values}function fr(t,e){return t.get(e)?.values?.[0]}function _(t,e){return t.get(e)?.values?.[0]}function ve(t,e,r,n=0,a=At.tiffTags,s=4){let h=s===8,o=h?Ee(new DataView(t,r,8),0,e):new DataView(t,r,2).getUint16(0,e),l=4+2*s,u=h?8:2,i=u+o*l;if(r+i>t.byteLength)return{success:!1,ifd:null,nextIFD:null,requiredBufferSize:i};let c=r+i+4<=t.byteLength?ie(new DataView(t,r+i,s===8?8:4),0,e,s===8):null,p=r+u,C=new Map,g,w,S,f,d,m=0,y=0;for(let v=0;v<o;v++){w=new DataView(t,p+l*v,l),S=w.getUint16(0,e),d=w.getUint16(2,e),f=At.getTagName(S,a);let k=[];s===2?(m=w.getUint16(4,e),y=w.getUint16(6,e)):s===4?(m=w.getUint32(4,e),y=w.getUint32(8,e)):s===8&&(m=ie(w,4,e,!0),y=ie(w,12,e,!0),k.push(w.getUint32(12,e)),k.push(w.getUint32(16,e))),g={id:S,type:d,valueCount:m,valueOffset:y,valueOffsets:k,values:null},ro(t,e,g,n,!1,s),C.set(f,g)}return{success:!0,ifd:C,nextIFD:c,requiredBufferSize:i}}var Zr=(t,e)=>re(t,{inputOffset:e}).pixels[0];function Se(t,e){if(e!==1&&e!==2&&e!==4)return t;let r=new Uint8Array(t),n=8/e,a=new Uint8Array(t.byteLength*n),s=0,h=2**e-1;for(let o=0;o<r.length;o++){let l=r[o];for(let u=0;u<n;u++)a[s++]=l<<e*u>>>8-e&h}return a.buffer}function Te(t,e,r){let n=new $t;n.parse(t),n.colorTransform=r===6?-1:0;let a=n.getData(n.width,n.height,e!==1&&e!==4);return new Uint8Array(a.buffer)}function ke(t){let e=new vt(t).getBytes(),r=new ArrayBuffer(e.length),n=new Uint8Array(r);return n.set(e),n}function Ie(t,e,r,n,a){return ft(this,null,function*(){let s=zt===e,h=_(r,"BITSPERSAMPLE"),o=_(r,"SAMPLESPERPIXEL")??1,l=_(r,"PHOTOMETRICINTERPRETATION"),u=_(r,"SAMPLEFORMAT")??1,i=xe(u,h),c=_(r,"COMPRESSION")??1,p=ne(i),C,g,w;if(c===34887)return yield ee(),Zr(t,n);if(c===1)C=t.slice(n,n+a),g=new Uint8Array(C);else if(c===8||c===32946)g=new Uint8Array(t,n,a),g=ke(g),C=g.buffer;else if(c===6)g=new Uint8Array(t,n,a),g=Te(g,o,l),C=g.buffer;else if(c===7){let m=r.get("JPEGTABLES").values,y=m.length-2;g=new Uint8Array(y+a-2);for(let k=0;k<y;k++)g[k]=m[k];let v=new Uint8Array(t,n+2,a-2);for(let k=0;k<v.length;k++)g[y+k]=v[k];g=Te(g,o,l),C=g.buffer}else{if(c!==5)throw new Error("tiff-decode: unsupport compression "+c);g=jt(t,n,a,e),C=g.buffer}if(C=Se(C,h),i==="u8"||i==="s8"||s)w=new p(C);else{C=new ArrayBuffer(g.length);let m=new Uint8Array(C);switch(i){case"u16":case"s16":for(let y=0;y<g.length;y+=2)m[y]=g[y+1],m[y+1]=g[y];break;case"u32":case"s32":case"f32":for(let y=0;y<g.length;y+=4)m[y]=g[y+3],m[y+1]=g[y+2],m[y+2]=g[y+1],m[y+3]=g[y]}w=new p(C)}let S=_(r,"PREDICTOR")??1,f=_(r,"TILEWIDTH"),d=_(r,"TILELENGTH");if(S>1&&(c===5||c===8||c===32946)&&f&&d){let m=ae(r),y=new p(w.length);y.set(w),w=so(y,d,f,u===3&&S===3,m?1:o)}return w})}function $r(t,e,r){return ft(this,null,function*(){let n=Et(r,"TILEOFFSETS");if(n===void 0)return null;let a=Et(r,"TILEBYTECOUNTS"),{width:s,height:h,pixelType:o,tileWidth:l,tileHeight:u}=Ae([r]),i=ae(r,e),c=_(r,"SAMPLESPERPIXEL")||e.planes,p=s*h,C=_(r,"BITSPERSAMPLE"),g=(_(r,"COMPRESSION")??1)===34887,w=ne(o),S=[];for(let L=0;L<c;L++)S.push(new w(p));let f,d,m,y,v,k,b,I,T,x,A,E,P,R=Math.ceil(s/l),M=new Uint8Array(p).fill(255),B=!1;if(C%8==0)if(g&&i&&c>1){let L=Math.round(n.length/c);for(f=0;f<L;f++){k=Math.floor(f/R)*u,b=f%R*l,I=k*s+b;for(let j=0;j<c;j++){let H=f*c+j;for(a[H]===0?(m=null,B=!0):m=yield Ie(t,e.littleEndian,r,n[H],a[H]),x=0,T=I,E=Math.min(l,s-b),A=Math.min(u,h-k),P=S[j],y=0;y<A;y++)for(T=I+y*s,x=y*l,v=0;v<E;v++,T++,x++)m?P[T]=m[x]:M[T]=0}}}else for(f=0;f<n.length;f++)for(k=Math.floor(f/R)*u,b=f%R*l,I=k*s+b,a[f]===0?(m=null,B=!0):m=yield Ie(t,e.littleEndian,r,n[f],a[f]),x=0,T=I,E=Math.min(l,s-b),A=Math.min(u,h-k),d=0;d<c;d++)if(P=S[d],i||g)for(y=0;y<A;y++)for(T=I+y*s,x=l*u*d+y*l,v=0;v<E;v++,T++,x++)m?P[T]=m[x]:M[T]=0;else for(y=0;y<A;y++)for(T=I+y*s,x=y*l*c+d,v=0;v<E;v++,T++,x+=c)m?P[T]=m[x]:M[T]=0;return{width:s,height:h,pixelType:o,pixels:S,mask:B?M:void 0}})}var Qr=(t,e,r)=>{let n=zt===e.littleEndian,a=Et(r,"STRIPOFFSETS");if(a===void 0)return null;let{width:s,height:h,pixelType:o}=Ae([r]),l=_(r,"SAMPLESPERPIXEL")||e.planes,u=_(r,"PHOTOMETRICINTERPRETATION"),i=s*h,c=_(r,"BITSPERSAMPLE"),p=ne(o),C=new p(i*l),g=Et(r,"STRIPBYTECOUNTS"),w=_(r,"ROWSPERSTRIP"),S=_(r,"COMPRESSION")??1,f,d,m,y,v,k,b,I,T;if(c%8==0)for(f=0;f<a.length;f++){if(v=f*(w*s)*l,o==="u8"||o==="s8"||n)S===8||S===32946?(b=new Uint8Array(t,a[f],g[f]),b=ke(b),k=b.buffer):S===6?(b=new Uint8Array(t,a[f],g[f]),b=Te(b,l,u),k=b.buffer):S===5?(b=jt(t,a[f],g[f],e.littleEndian),k=b.buffer):k=t.slice(a[f],a[f]+g[f]),k=Se(k,c),y=new p(k);else{switch(S===6||S===8||S===32946?(b=new Uint8Array(t,a[f],g[f]),I=ke(b),k=I.buffer):(k=new ArrayBuffer(g[f]),b=new Uint8Array(t,a[f],g[f]),I=new Uint8Array(k)),o){case"u16":case"s16":for(m=0;m<b.length;m+=2)I[m]=b[m+1],I[m+1]=b[m];break;case"u32":case"s32":case"f32":for(m=0;m<b.length;m+=4)I[m]=b[m+3],I[m+1]=b[m+2],I[m+2]=b[m+1],I[m+3]=b[m]}k=Se(k,c),y=new p(k)}C.set(y,v)}let x=[];if(l===1)x.push(C);else for(f=0;f<l;f++){for(T=new p(i),d=0;d<i;d++)T[d]=C[d*l+f];x.push(T)}return{width:s,height:h,pixelType:o,pixels:x}},to=(t,e,r)=>{if(!(t&&t.length>0&&e&&r))return null;let n,a,s,h=t[0].length,o=t.length,l=new Uint8Array(h);for(let u=0;u<o;u++)if(n=t[u],a=e[u],s=r[u],u===0)for(let i=0;i<h;i++)l[i]=n[i]<a||n[i]>s?0:1;else for(let i=0;i<h;i++)l[i]&&(l[i]=n[i]<a||n[i]>s?0:1);return l},eo=t=>{if(!t)return null;let e=t.match(/<Item(.*?)Item>/gi);if(!e||e.length===0)return null;let r=new Map,n,a,s,h,o;for(let f=0;f<e.length;f++)n=e[f],a=n.slice(6,n.indexOf(">")),h=n.indexOf("sample="),h>-1&&(o=n.slice(h+8,n.indexOf('"',h+8))),h=n.indexOf("name="),h>-1&&(a=n.slice(h+6,n.indexOf('"',h+6))),a&&(s=n.slice(n.indexOf(">")+1,n.indexOf("</Item>")).trim(),o!=null?r.has(a)?r.get(a)[o]=s:r.set(a,[s]):r.set(a,s)),o=null;let l=r.get("STATISTICS_MINIMUM"),u=r.get("STATISTICS_MAXIMUM"),i=r.get("STATISTICS_MEAN"),c=r.get("STATISTICS_STDDEV"),p=null;if(l&&u){p=[];for(let f=0;f<l.length;f++)p.push({min:parseFloat(l[f]),max:parseFloat(u[f]),avg:i&&parseFloat(i[f]),stddev:c&&parseFloat(c[f])})}let C=r.get("BandName"),g=r.get("WavelengthMin"),w=r.get("WavelengthMax"),S=null;if(C){S=[];for(let f=0;f<C.length;f++)S.push({BandName:C[f],WavelengthMin:g&&parseFloat(g[f]),WavelengthMax:w&&parseFloat(w[f])})}return{statistics:p,bandProperties:S,dataType:r.get("DataType"),rawMetadata:r}};function ro(t,e,r,n=0,a=!1,s=4){if(r.values)return!0;let h=r.type,o=r.valueCount,l=r.valueOffset,u=[],i=cr[h],c=8*i,p=o*i,C=o*cr[h]*8,g,w,S=s===8?64:32,f=r.valueOffsets;if(C>S&&p>(a?t.byteLength:t?t.byteLength-l+n:0))return r.offlineOffsetSize=[l,p],r.values=null,!1;if(C<=S){if(!e)if(S<=32)l>>>=32-C;else{let d=f?.length?f[0]:l>>>0,m=f?.length?f[1]:Math.round((l-d)/Gt);C<=32?(l=d>>>32-C,f[0]=l):(l=d*2**(32-C)+(m>>>32-C),f[0]=d,f[1]=m>>>32-C)}if(o===1&&c===S)u=[l];else if(S===64){let d=f?.length?f[0]:l>>>0,m=f?.length?f[1]:Math.round((l-d)/Gt),y=d,v=32;for(w=1;w<=o;w++){let k=32-c*w%32;if(v<c){let b=y<<k>>>32-v,I=m<<32-v>>>32-v;y=m,u.push(b+I*2**(c-v)),v-=32-(c-v)}else u.push(y<<k>>>32-c),v-=c;v===0&&(v=32,y=m)}}else for(w=1;w<=o;w++){let d=32-c*w;u.push(l<<d>>>32-c)}}else{l-=n,a&&(l=0);for(let d=l;d<l+p;d+=i){switch(h){case 1:case 2:case 7:g=new DataView(t,d,1).getUint8(0);break;case 3:g=new DataView(t,d,2).getUint16(0,e);break;case 4:case 13:g=new DataView(t,d,4).getUint32(0,e);break;case 5:g=new DataView(t,d,4).getUint32(0,e)/new DataView(t,d+4,4).getUint32(0,e);break;case 6:g=new DataView(t,d,1).getInt8(0);break;case 8:g=new DataView(t,d,2).getInt16(0,e);break;case 9:g=new DataView(t,d,4).getInt32(0,e);break;case 10:g=new DataView(t,d,4).getInt32(0,e)/new DataView(t,d+4,4).getInt32(0,e);break;case 11:g=new DataView(t,d,4).getFloat32(0,e);break;case 12:g=new DataView(t,d,8).getFloat64(0,e);break;case 16:case 18:g=Ee(new DataView(t,d,8),0,e);break;case 17:g=io(new DataView(t,d,8),0,e);break;default:g=null}u.push(g)}}if(h===2){let d="",m=u;for(u=[],w=0;w<m.length;w++)m[w]===0&&d!==""?(u.push(d),d=""):d+=String.fromCharCode(m[w]);d===""&&u.length!==0||u.push(d)}return r.values=u,!0}function Ae(t){let e=t[0],r=_(e,"TILEWIDTH"),n=_(e,"TILELENGTH"),a=_(e,"IMAGEWIDTH"),s=_(e,"IMAGELENGTH"),h=_(e,"BITSPERSAMPLE"),o=_(e,"SAMPLESPERPIXEL"),l=_(e,"SAMPLEFORMAT")??1,u=xe(l,h),i=ae(e),c=hr(e,"GDAL_NODATA"),p=null;c?.length&&(p=c.map(V=>parseFloat(V)),p.some(V=>isNaN(V))&&(p=null));let C=_(e,"COMPRESSION")??1,g;switch(C){case 1:g="NONE";break;case 2:case 3:case 4:case 32771:g="CCITT";break;case 5:g="LZW";break;case 6:case 7:g="JPEG";break;case 32773:g="PACKBITS";break;case 8:case 32946:g="DEFLATE";break;case 34712:g="JPEG2000";break;case 34887:g="LERC";break;default:g=String(C)}let w=!0,S="";Yr.has(C)||(w=!1,S+="unsupported tag compression "+C),l>3&&(w=!1,S+="unsupported tag sampleFormat "+l),h!==1&&h!==2&&h!==4&&h%8!=0&&(w=!1,S+="unsupported tag bitsPerSample "+h);let f=fr(e,"GEOASCIIPARAMS"),d;if(f){let V=f.split("|").find(F=>F.includes("ESRI PE String = ")),D=V?V.replace("ESRI PE String = ",""):"";d=D.startsWith("COMPD_CS")||D.startsWith("PROJCS")||D.startsWith("GEOGCS")?{wkid:null,wkt:D}:null}let m=Et(e,"GEOTIEPOINTS"),y=Et(e,"GEOPIXELSCALE"),v=Et(e,"GEOTRANSMATRIX"),k=e.has("GEOKEYDIRECTORY")?e.get("GEOKEYDIRECTORY").data:null,b,I,T=!1,x=!1;if(k){T=_(k,"GTRasterTypeGeoKey")===2;let V=_(k,"GTModelTypeGeoKey");if(V===2){let D=_(k,"GeographicTypeGeoKey");D>=1024&&D<=32766&&(d={wkid:D}),d||D!==32767||(x=!0,d={wkid:4326})}else if(V===1){let D=_(k,"ProjectedCSTypeGeoKey");D>=1024&&D<=32766&&(d={wkid:D})}}if(y&&m&&m.length>=6?(b=[y[0],0,m[3]-m[0]*y[0],0,-Math.abs(y[1]),m[4]-m[1]*y[1]],T&&(b[2]-=.5*b[0]+.5*b[1],b[5]-=.5*b[3]+.5*b[4])):v&&v.length===16&&(b=T?[v[0],v[1],v[3]-.5*v[0],v[4],v[5],v[7]-.5*v[5]]:[v[0],v[1],v[3],v[4],v[5],v[7]]),b){let V=[{x:0,y:s},{x:0,y:0},{x:a,y:s},{x:a,y:0}],D,F=Number.POSITIVE_INFINITY,z=Number.POSITIVE_INFINITY,Y=Number.NEGATIVE_INFINITY,$=Number.NEGATIVE_INFINITY;for(let pt=0;pt<V.length;pt++)D=Xr(V[pt],b),F=D.x>F?F:D.x,Y=D.x<Y?Y:D.x,z=D.y>z?z:D.y,$=D.y<$?$:D.y;I={xmin:F,xmax:Y,ymin:z,ymax:$,spatialReference:d}}else I={xmin:-.5,ymin:.5-s,xmax:a-.5,ymax:.5,spatialReference:d};x&&(I.xmax-I.xmin>400||Math.max(Math.abs(I.xmin),Math.abs(I.xmax))>361)&&(d=null,I.spatialReference=null);let A=pr(t),E,P,R,M,B;if(A.length>0){R=Math.round(Math.log(a/_(A[0],"IMAGEWIDTH"))/Math.LN2);let V=A[A.length-1];M=A.length,E=_(V,"TILEWIDTH"),P=_(V,"TILELENGTH")}E=M!=null&&M>0?E||r:null,P=M!=null&&M>0?P||n:null,r&&(B=[{maxCol:Math.ceil(a/r)-1,maxRow:Math.ceil(s/n)-1,minRow:0,minCol:0}],A.forEach(V=>{B.push({maxCol:Math.ceil(_(V,"IMAGEWIDTH")/_(V,"TILEWIDTH"))-1,maxRow:Math.ceil(_(V,"IMAGELENGTH")/_(V,"TILELENGTH"))-1,minRow:0,minCol:0})}));let L=fr(t[0],"GDAL_METADATA"),j=eo(L);S+=" "+mr({width:a,height:s,tileWidth:r,tileHeight:n,planes:o,ifds:t});let H=dr(t).length===A.length+1,N=A?.length?A.map(V=>({x:a/_(V,"IMAGEWIDTH"),y:s/_(V,"IMAGELENGTH")})):void 0;return{width:a,height:s,tileWidth:r,tileHeight:n,planes:o,isBSQ:i,pixelType:u,compression:g,noData:p,hasMaskBand:H,isSupported:w,pyramidResolutions:N,message:S,extent:I,isPseudoGeographic:x,affine:y?null:b,firstPyramidLevel:R,maximumPyramidLevel:M,pyramidBlockWidth:E,pyramidBlockHeight:P,tileBoundary:B,metadata:j}}function ae(t,e){let r=hr(t,"PLANARCONFIGURATION");return r?r[0]===2:!!e&&e.isBSQ}function pr(t){return t.filter(e=>_(e,"NEWSUBFILETYPE")===1)}function dr(t){return t.filter(e=>{let r=!(4&~(_(e,"NEWSUBFILETYPE")??0)),n=_(e,"PHOTOMETRICINTERPRETATION")===4;return r&&n})}function oo(t){let{littleEndian:e,isBigTiff:r,firstIFDPos:n}=no(t),a=n,s=[];do{let h=ao(t,e,a,0,At.tiffTags,r?8:4);if(!h.success)break;s.push(h.ifd),a=h.nextIFD}while(a>0);return Q(X({},Ae(s)),{littleEndian:e,isBigTiff:r,ifds:s,pyramidIFDs:pr(s),maskIFDs:dr(s)})}function Ee(t,e,r){let n=t.getUint32(e,r),a=t.getUint32(e+4,r);return r?a*Gt+n:n*Gt+a}function io(t,e,r){let n=r?t.getInt32(e,r):t.getUint32(e,r),a=r?t.getUint32(e+4,r):t.getInt32(e+4,r),s=(r?n:a)>=0?1:-1;return r?n*=s:a*=s,s*(r?a*Gt+n:n*Gt+a)}function ie(t,e,r,n){return n?Ee(t,e,r):t.getUint32(e,r)}function no(t){let e=new DataView(t,0,16),r=e.getUint16(0,!1),n=null;if(r===18761)n=!0;else{if(r!==19789)throw new Error("unexpected endianess byte");n=!1}let a=e.getUint16(2,n);if(a!==42&&a!==43)throw new Error("unexpected tiff identifier");let s=4,h=a===43;if(h){let o=e.getUint16(s,n);if(s+=2,o!==8)throw new Error("unsupported bigtiff version");if(e.getUint16(s,n)!==0)throw new Error("unsupported bigtiff version");s+=2}return{littleEndian:n,isBigTiff:h,firstIFDPos:ie(e,s,n,h)}}function ao(t,e,r,n=0,a=At.tiffTags,s=4){let h=ve(t,e,r,n,a,s),o,l=h.ifd;if(l){if(At.ifdTags.forEach((u,i)=>{l.has(i)&&(o=l.get(i),o.data=ve(t,e,o.valueOffset-n,n,u).ifd)}),l.has("GEOKEYDIRECTORY")){o=l.get("GEOKEYDIRECTORY");let u=o.values;if(u&&u.length>4){let i=u[0]+"."+u[1]+"."+u[2];o.data=ve(t,e,o.valueOffset+6-n,n,At.geoKeys,2).ifd,o.data&&o.data.set("GEOTIFFVersion",{id:0,type:2,valueCount:1,valueOffset:null,values:[i]})}}if(l.has("XMP")){o=l.get("XMP");let u=o.values;typeof u[0]=="number"&&o.type===7&&(o.values=[ur(new Uint8Array(u))])}}return h}function mr(t){let{width:e,height:r,tileHeight:n,tileWidth:a}=t,s=t.planes,h=a?a*n:e*r,o=_(t.ifds[0],"BITSPERSAMPLE"),l="";return h*s>2**30/(o>8?o/8:1)&&(l=a?"tiled tiff exceeding 1 gigabits per tile is not supported":"scanline tiff exceeding 1 gigabits is not supported"),l}function so(t,e,r,n,a){let s=n?4:1,h=r*s*a;n&&(t=new Uint8Array(t.buffer));for(let u=0;u<e;u++){let i=u*h;for(let c=a;c<h;c++)t[i+c]+=t[i+c-a]}if(!n)return t;let o=new Uint8Array(t.length),l=r*a;for(let u=0;u<e;u++){let i=u*h;for(let c=0;c<l;c++)for(let p=0;p<s;p++)o[i+c*s+p]=t[i+c+(s-p-1)*l]}return new Float32Array(o.buffer)}function gr(t,e){return ft(this,null,function*(){let{headerInfo:r,ifd:n,offsets:a,sizes:s}=e,h=[];for(let T=0;T<a.length;T++){s[T];let x=yield Ie(t,r.littleEndian,n,a[T],s[T]||t.byteLength);h.push(x)}let o=ae(n,r),l=_(n,"BITSPERSAMPLE"),u=xe(_(n,"SAMPLEFORMAT")??1,l),i=_(n,"SAMPLESPERPIXEL")||r.planes,c=ne(u),p=_(n,"TILEWIDTH"),C=_(n,"TILELENGTH"),g=_(n,"COMPRESSION")??1,w=p*C,S,f=[],d=h[0],m=g===34887;for(let T=0;T<i;T++){if(S=new c(w),h.length===i)d=h[T],d.length===w&&(S=d);else if(d.length)if(o||m)S=d.length===w?d:d.slice(w*T,w*(T+1));else for(let x=0;x<w;x++)S[x]=d[x*i+T];f.push(S)}let y=r.noData?r.noData[0]:e.noDataValue,v=r.metadata?r.metadata.statistics:null,k=v?v.map(T=>T.min):null,b=v?v.map(T=>T.max):null,I={pixelType:u,width:p,height:C,pixels:f,noDataValue:y};return y!=null?_t(I,y):k&&b&&e.applyMinMaxConstraint&&(I.mask=to(f,k,b)),I})}function yr(r){return ft(this,arguments,function*(t,e={}){let n=e.pyramidLevel||0,a=e.headerInfo||oo(t),{ifds:s,noData:h}=a;if(s.length===0)throw new Error("no valid image file directory");let o=mr(a);if(o)throw o;let l=null,u=n===-1?s[s.length-1]:s[n],i=h??e.noDataValue;return l=a.tileWidth?yield $r(t,a,u):Qr(t,a,u),l&&(i!=null&&_t(l,i),l)})}var lo=function(t){var e,r,n,a,s,h;function o(l){var u,i,c,p,C,g,w,S,f,d,m,y,v;for(this.data=l,this.pos=8,this.palette=[],this.imgData=[],this.transparency={},this.animation=null,this.text={},C=null;;){switch(u=this.readUInt32(),S=(function(){var k,b;for(b=[],k=0;k<4;++k)b.push(String.fromCharCode(this.data[this.pos++]));return b}).call(this).join(""),S){case"IHDR":this.width=this.readUInt32(),this.height=this.readUInt32(),this.bits=this.data[this.pos++],this.colorType=this.data[this.pos++],this.compressionMethod=this.data[this.pos++],this.filterMethod=this.data[this.pos++],this.interlaceMethod=this.data[this.pos++];break;case"acTL":this.animation={numFrames:this.readUInt32(),numPlays:this.readUInt32()||1/0,frames:[]};break;case"PLTE":this.palette=this.read(u);break;case"fcTL":C&&this.animation.frames.push(C),this.pos+=4,C={width:this.readUInt32(),height:this.readUInt32(),xOffset:this.readUInt32(),yOffset:this.readUInt32()},p=this.readUInt16(),c=this.readUInt16()||100,C.delay=1e3*p/c,C.disposeOp=this.data[this.pos++],C.blendOp=this.data[this.pos++],C.data=[];break;case"IDAT":case"fdAT":for(S==="fdAT"&&(this.pos+=4,u-=4),l=C?.data||this.imgData,m=0;0<=u?m<u:m>u;0<=u?++m:--m)l.push(this.data[this.pos++]);break;case"tRNS":switch(this.transparency={},this.colorType){case 3:if(this.transparency.indexed=this.read(u),(f=255-this.transparency.indexed.length)>0)for(y=0;0<=f?y<f:y>f;0<=f?++y:--y)this.transparency.indexed.push(255);break;case 0:this.transparency.grayscale=this.read(u)[0];break;case 2:this.transparency.rgb=this.read(u)}break;case"tEXt":g=(d=this.read(u)).indexOf(0),w=String.fromCharCode.apply(String,d.slice(0,g)),this.text[w]=String.fromCharCode.apply(String,d.slice(g+1));break;case"IEND":return C&&this.animation.frames.push(C),this.colors=(function(){switch(this.colorType){case 0:case 3:case 4:return 1;case 2:case 6:return 3}}).call(this),this.hasAlphaChannel=(v=this.colorType)===4||v===6,i=this.colors+(this.hasAlphaChannel?1:0),this.pixelBitlength=this.bits*i,this.colorSpace=(function(){switch(this.colors){case 1:return"DeviceGray";case 3:return"DeviceRGB"}}).call(this),void(this.imgData=new Uint8Array(this.imgData));default:this.pos+=u}if(this.pos+=4,this.pos>this.data.length)throw new Error("Incomplete or corrupt PNG file")}}return o.load=function(l,u,i){var c;return typeof u=="function"&&(i=u),(c=new XMLHttpRequest).open("GET",l,!0),c.responseType="arraybuffer",c.onload=function(){var p;return p=new o(new Uint8Array(c.response||c.mozResponseArrayBuffer)),typeof u?.getContext=="function"&&p.render(u),typeof i=="function"?i(p):void 0},c.send(null)},r=1,n=2,e=0,o.prototype.read=function(l){var u,i;for(i=[],u=0;0<=l?u<l:u>l;0<=l?++u:--u)i.push(this.data[this.pos++]);return i},o.prototype.readUInt32=function(){return this.data[this.pos++]<<24|this.data[this.pos++]<<16|this.data[this.pos++]<<8|this.data[this.pos++]},o.prototype.readUInt16=function(){return this.data[this.pos++]<<8|this.data[this.pos++]},o.prototype.decodePixels=function(l){var u,i,c,p,C,g,w,S,f,d,m,y,v,k,b,I,T,x,A,E,P,R,M;if(l==null&&(l=this.imgData),l.length===0)return new Uint8Array(0);for(l=(l=new vt(l)).getBytes(),I=(y=this.pixelBitlength/8)*this.width,v=new Uint8Array(I*this.height),g=l.length,b=0,k=0,i=0;k<g;){switch(l[k++]){case 0:for(p=A=0;A<I;p=A+=1)v[i++]=l[k++];break;case 1:for(p=E=0;E<I;p=E+=1)u=l[k++],C=p<y?0:v[i-y],v[i++]=(u+C)%256;break;case 2:for(p=P=0;P<I;p=P+=1)u=l[k++],c=(p-p%y)/y,T=b&&v[(b-1)*I+c*y+p%y],v[i++]=(T+u)%256;break;case 3:for(p=R=0;R<I;p=R+=1)u=l[k++],c=(p-p%y)/y,C=p<y?0:v[i-y],T=b&&v[(b-1)*I+c*y+p%y],v[i++]=(u+Math.floor((C+T)/2))%256;break;case 4:for(p=M=0;M<I;p=M+=1)u=l[k++],c=(p-p%y)/y,C=p<y?0:v[i-y],b===0?T=x=0:(T=v[(b-1)*I+c*y+p%y],x=c&&v[(b-1)*I+(c-1)*y+p%y]),w=C+T-x,S=Math.abs(w-C),d=Math.abs(w-T),m=Math.abs(w-x),f=S<=d&&S<=m?C:d<=m?T:x,v[i++]=(u+f)%256;break;default:throw new Error("Invalid filter algorithm: "+l[k-1])}b++}return v},o.prototype.decodePalette=function(){var l,u,i,c,p,C,g,w,S;for(i=this.palette,C=this.transparency.indexed||[],p=new Uint8Array((C.length||0)+i.length),c=0,i.length,l=0,u=g=0,w=i.length;g<w;u=g+=3)p[c++]=i[u],p[c++]=i[u+1],p[c++]=i[u+2],p[c++]=(S=C[l++])!=null?S:255;return p},o.prototype.copyToImageData=function(l,u){var i,c,p,C,g,w,S,f,d,m,y;if(c=this.colors,d=null,i=this.hasAlphaChannel,this.palette.length&&(d=(y=this._decodedPalette)!=null?y:this._decodedPalette=this.decodePalette(),c=4,i=!0),f=(p=l.data||l).length,g=d||u,C=w=0,c===1)for(;C<f;)S=d?4*u[C/4]:w,m=g[S++],p[C++]=m,p[C++]=m,p[C++]=m,p[C++]=i?g[S++]:this.transparency.grayscale&&this.transparency.grayscale===m?0:255,w=S;else for(;C<f;)S=d?4*u[C/4]:w,p[C++]=g[S++],p[C++]=g[S++],p[C++]=g[S++],p[C++]=i?g[S++]:this.transparency.rgb&&this.transparency.rgb[1]===g[S-3]&&this.transparency.rgb[3]===g[S-2]&&this.transparency.rgb[5]===g[S-1]?0:255,w=S},o.prototype.decode=function(){var l;return l=new Uint8Array(this.width*this.height*4),this.copyToImageData(l,this.decodePixels()),l},s=t.document&&t.document.createElement("canvas"),h=s&&s.getContext("2d"),a=function(l){var u;return h.width=l.width,h.height=l.height,h.clearRect(0,0,l.width,l.height),h.putImageData(l,0,0),(u=new Image).src=s.toDataURL(),u},o.prototype.decodeFrames=function(l){var u,i,c,p,C,g,w,S;if(this.animation){for(S=[],i=C=0,g=(w=this.animation.frames).length;C<g;i=++C)u=w[i],c=l.createImageData(u.width,u.height),p=this.decodePixels(new Uint8Array(u.data)),this.copyToImageData(c,p),u.imageData=c,S.push(u.image=a(c));return S}},o.prototype.renderFrame=function(l,u){var i,c,p;return i=(c=this.animation.frames)[u],p=c[u-1],u===0&&l.clearRect(0,0,this.width,this.height),p?.disposeOp===r?l.clearRect(p.xOffset,p.yOffset,p.width,p.height):p?.disposeOp===n&&l.putImageData(p.imageData,p.xOffset,p.yOffset),i.blendOp===e&&l.clearRect(i.xOffset,i.yOffset,i.width,i.height),l.drawImage(i.image,i.xOffset,i.yOffset)},o.prototype.animate=function(l){var u,i,c,p,C,g,w=this;return i=0,g=this.animation,p=g.numFrames,c=g.frames,C=g.numPlays,(u=function(){var S,f;if(S=i++%p,f=c[S],w.renderFrame(l,S),p>1&&i/p<C)return w.animation._timeout=setTimeout(u,f.delay)})()},o.prototype.stopAnimation=function(){var l;return clearTimeout((l=this.animation)!=null?l._timeout:void 0)},o.prototype.render=function(l){var u,i;return l._png&&l._png.stopAnimation(),l._png=this,l.width=this.width,l.height=this.height,u=l.getContext("2d"),this.animation?(this.decodeFrames(u),this.animate(u)):(i=u.createImageData(this.width,this.height),this.copyToImageData(i,this.decodePixels()),u.putImageData(i,0,0))},o}(self),uo=new Set(["jpg","png","bmp","gif"]);function co(t,e){return ft(this,null,function*(){if(!zt)throw new mt("rasterCoded:decode","lerc decoder is not supported on big endian platform");yield ee();let{offset:r}=e,{width:n,height:a,pixelType:s,statistics:h,depthCount:o,noDataValues:l,bandMasks:u,pixels:i,mask:c}=re(t,{inputOffset:r,returnInterleaved:e.returnInterleaved}),p=new Z({width:n,height:a,pixelType:s.toLowerCase(),pixels:i,mask:c,statistics:h.map(({minValue:C,maxValue:g})=>new Vt(C,g)),bandMasks:u,depthCount:o,noDataValues:l});return h?.length||p.updateStatistics(),p})}function fo(t,e){return ft(this,null,function*(){let r=yield yr(t,Q(X({},e),{noDataValue:null}));Lt(r);let n=new Z({width:r.width,height:r.height,pixels:r.pixels,pixelType:r.pixelType.toLowerCase(),mask:r.mask,bandMasks:r.bandMasks,statistics:null});return n.updateStatistics(),n})}function ho(t,e){return ft(this,null,function*(){let r=yield gr(t,e.customOptions),n=new Z({width:r.width,height:r.height,pixels:r.pixels,pixelType:r.pixelType.toLowerCase(),mask:r.mask,statistics:null});return n.updateStatistics(),n})}function Cr(t,e){let r=e.pixelType||"u8",n=Z.getPixelArrayConstructor(r),a=r==="u8"?t:new n(t.buffer),s=[],h=e.planes||1;if(h===1)s.push(a);else for(let l=0;l<h;l++){let u=(e.width||1)*(e.height||t.length),i=new n(u);for(let c=0;c<u;c++)i[c]=a[c*h+l];s.push(i)}let o=new Z({width:e.width||1,height:e.height||t.length,pixels:s,pixelType:r,statistics:null});return o.updateStatistics(),o}function po(t,e){return Cr(new vt(new Uint8Array(t)).getBytes(),e)}function mo(t,e){return Cr(jt(t,e.offset,e.eof,!e.isInputBigEndian),e)}function go(t,e,r){let{pixelTypeCtor:n}=vo(e.pixelType),a=(0,oe.decode)(t,{width:e.width,height:e.height,pixelType:n,format:r}),s=new Z({width:e.width,height:e.height,pixels:a.pixels,pixelType:e.pixelType,mask:a.mask,statistics:null});return s.updateStatistics(),s}function yo(t,e){let r=Qt.decode(t,e.hasNoZlibMask??void 0),n=new Z({width:r.width,height:r.height,pixels:r.pixels,pixelType:"u8",mask:r.mask,statistics:null});return n.updateStatistics(),n}function Co(t,e){let r=new Uint8Array(t),n=new lo(r),{width:a,height:s}=e,h=a*s,o=n.decode(),l,u=0,i=0,c=new Uint8Array(h);for(u=0;u<h;u++)c[u]=o[4*u+3];let p=new Z({width:a,height:s,pixels:[],pixelType:"u8",mask:c,statistics:[]});for(u=0;u<3;u++){for(l=new Uint8Array(h),i=0;i<h;i++)l[i]=o[4*i+u];p.addData({pixels:l})}return p.updateStatistics(),p}function bo(t,e,r,n){return ft(this,null,function*(){let a=new Zt,s=X({applyJpegMask:!1,format:e},r),h=yield a.decode(t,s,n),o=new Z(h);return o.updateStatistics(),o})}function br(t){if(t==null)throw new mt("rasterCodec:decode","parameter encodeddata is required.");let e=new Uint8Array(t,0,10),r="";return e[0]===255&&e[1]===216?r="jpg":e[0]===137&&e[1]===80&&e[2]===78&&e[3]===71?r="png":e[0]===67&&e[1]===110&&e[2]===116&&e[3]===90&&e[4]===73&&e[5]===109&&e[6]===97&&e[7]===103&&e[8]===101&&e[9]===32?r="lerc":e[0]===76&&e[1]===101&&e[2]===114&&e[3]===99&&e[4]===50&&e[5]===32?r="lerc2":e[0]===73&&e[1]===73&&e[2]===42&&e[3]===0||e[0]===77&&e[1]===77&&e[2]===0&&e[3]===42||e[0]===73&&e[1]===73&&e[2]===43&&e[3]===0||e[0]===77&&e[1]===77&&e[2]===0&&e[3]===43?r="tiff":e[0]===71&&e[1]===73&&e[2]===70?r="gif":e[0]===66&&e[1]===77?r="bmp":String.fromCharCode.apply(null,e).toLowerCase().includes("error")&&(r="error"),r}function wo(t){let e=null;switch(t){case"lerc":case"lerc2":e=co;break;case"jpg":e=yo;break;case"png":e=Co;break;case"bsq":case"bip":e=(r,n)=>go(r,n,t);break;case"tiff":e=fo;break;case"deflate":e=po;break;case"lzw":e=mo;break;case"error":e=()=>{throw new mt("rasterCodec:decode","input data contains error")};break;default:e=()=>{throw new mt("rasterCodec:decode","unsupported raster format")}}return e}function vo(t){let e=null,r=null;switch(t?t.toLowerCase():"f32"){case"u1":case"u2":case"u4":case"u8":r=255,e=Uint8Array;break;case"u16":r=r||65535,e=Uint16Array;break;case"u32":r=r||2**32-1,e=Uint32Array;break;case"s8":r=r||-128,e=Int8Array;break;case"s16":r=r||-32768,e=Int16Array;break;case"s32":r=r||0-2**31,e=Int32Array;break;default:e=Float32Array}return{pixelTypeCtor:e,noDataValue:r}}function So(t,e=1){if(!t)return;let{pixels:r,width:n,height:a,mask:s}=t;if(!r||r.length===0)return;let h=r.length,o=n-1,l=a-1,u=[],i,c,p,C,g,w,S=null,f=Z.getPixelArrayConstructor(t.pixelType);if(e===0){for(i=0;i<h;i++){for(g=r[i],w=new f(o*l),c=0;c<l;c++)for(C=c*n,p=0;p<o;p++)w[c*o+p]=g[C+p];u.push(w)}if(s!=null)for(S=new Uint8Array(o*l),c=0;c<l;c++)for(C=c*n,p=0;p<o;p++)S[c*o+p]=s[C+p]}else{for(i=0;i<h;i++){for(g=r[i],w=new f(o*l),c=0;c<l;c++)for(C=c*n,p=0;p<o;p++)w[c*o+p]=(g[C+p]+g[C+p+1]+g[C+n+p]+g[C+n+p+1])/4;u.push(w)}if(s)for(S=new Uint8Array(o*l),c=0;c<l;c++)for(C=c*n,p=0;p<o;p++)S[c*o+p]=Math.min.apply(null,[s[C+p],s[C+p+1],s[C+n+p],s[C+n+p+1]])}t.width=o,t.height=l,t.mask=S,t.pixels=u}function Ri(t){let e=br(t);return e==="lerc2"?e="lerc":e==="error"&&(e=""),e}function Mi(n){return ft(this,arguments,function*(t,e={},r){if(t==null)throw new mt("rasterCodec:decode","missing encodeddata parameter.");let a=e.format?.toLowerCase();if(!(a!=="bsq"&&a!=="bip"||e.width!=null&&e.height!=null))throw new mt("rasterCodec:decode","requires width and height in options parameter.");if(a==="tiff"&&e.customOptions)return ho(t,e);if((!a||a!=="bsq"&&a!=="bip"&&a!=="deflate"&&a!=="lzw")&&(a=br(t)),e.useCanvas&&uo.has(a))return bo(t,a,e,r);let s=wo(a),h;e.isPoint&&((e=X({},e)).width!=null&&e.width++,e.height!=null&&e.height++);let{offsets:o}=e;if(o&&o.length>1){let l=o.map((c,p)=>s(t.slice(c,o[p+1]),e)),u=yield Promise.all(l);h=u[0],h.pixels=u.map(c=>c.pixels[0]);let i=u.map(c=>c.mask);u.some(c=>c!=null)&&(i.forEach((c,p)=>{c==null&&(i[p]=new Uint8Array(h.width*h.height).fill(255))}),h.bandMasks=i,h.mask=Z.combineBandMasks(i)),h.updateStatistics()}else h=yield s(t,Q(X({},e),{offset:o?.[0]??e.offset}));return a!=="jpg"&&e.noDataValue!=null&&h.depthCount===1&&_t(h,e.noDataValue,{customFloatTolerance:e.tolerance}),e.isPoint&&So(h),h})}var Ui=new qt({none:"none",standardDeviation:"standard-deviation",histogramEqualization:"histogram-equalization",minMax:"min-max",percentClip:"percent-clip",sigmoid:"sigmoid"}),wr={0:"none",3:"standardDeviation",4:"histogramEqualization",5:"minMax",6:"percentClip",9:"sigmoid"};var Pe=1,To=[.299,.587,.114];function Re(t,e=256){e=Math.min(e,256);let{size:r,counts:n}=t,a=new Uint8Array(r),s=n.reduce((i,c)=>i+c/e,0),h=0,o=0,l=0,u=s;for(let i=0;i<r;i++)if(l+=n[i],!(i<r-1&&l+n[i+1]<u)){for(;h<e-1&&u<l;)h++,u+=s;for(let c=o;c<=i;c++)a[c]=h;o=i+1}for(let i=o;i<r;i++)a[i]=e-1;return a}function Me(t){let{minCutOff:e,maxCutOff:r,gamma:n,pixelType:a,rounding:s}=t,h=t.outMin||0,o=t.outMax||255;if(!["u8","u16","s8","s16"].includes(a))return null;let l=e.length,u,i,c=0;a==="s8"?c=-127:a==="s16"&&(c=-32767);let p=256;["u16","s16"].includes(a)&&(p=65536);let C=[],g=[],w=o-h;for(u=0;u<l;u++)g[u]=r[u]-e[u],C[u]=g[u]===0?0:w/g[u];let S,f=[],d,m,y;if(n&&n.length>=l){let v=Sr(l,n);for(u=0;u<l;u++){for(y=[],i=0;i<p;i++)if(g[u]!==0)if(d=i+c,S=(d-e[u])/g[u],m=1,n[u]>1&&(m-=(1/w)**(S*v[u])),d<r[u]&&d>e[u]){let k=m*w*S**(1/n[u])+h;y[i]=s==="floor"?Math.floor(k):s==="round"?Math.round(k):k}else d>=r[u]?y[i]=o:y[i]=h;else y[i]=h;f[u]=y}}else for(u=0;u<l;u++){for(y=[],i=0;i<p;i++)if(d=i+c,d<=e[u])y[i]=h;else if(d>=r[u])y[i]=o;else{let v=(d-e[u])*C[u]+h;y[i]=s==="floor"?Math.floor(v):s==="round"?Math.round(v):v}f[u]=y}if(t.contrastOffset!=null){let v=ko(t.contrastOffset,t.brightnessOffset);for(u=0;u<l;u++)for(y=f[u],i=0;i<p;i++)y[i]=v[y[i]]}return{lut:f,offset:c}}function ko(t,e){let r=Math.min(Math.max(t,-100),100),n=Math.min(Math.max(e??0,-100),100),a=255,s=128,h=0,o=0,l=new Uint8Array(256);for(h=0;h<256;h++)r>0&&r<100?o=(200*h-100*a+2*a*n)/(2*(100-r))+s:r<=0&&r>-100?o=(200*h-100*a+2*a*n)*(100+r)/2e4+s:r===100?(o=200*h-100*a+(a+1)*(100-r)+2*a*n,o=o>0?a:0):r===-100&&(o=s),l[h]=o>a?a:o<0?0:o;return l}function vr(t,e,r){let n=[];for(let a=0;a<e.length;a++){let s=0,h=0,o=0;"min"in e[a]?{min:s,max:h,avg:o}=e[a]:[s,h,o]=e[a];let l=o??0;t!=="u8"&&(l=255*(l-s)/(h-s)),r&&(l*=To[a]),n.push(Io(l))}return n}function Io(t){if(t<=0||t>=255)return Pe;let e=0;t!==150&&(e=t<=150?45*Math.cos(.01047*t):17*Math.sin(.021*t));let r=255,n=t+e,a=Math.log(t/r),s=Math.log(n/r);if(s===0)return Pe;let h=a/s;return isNaN(h)?Pe:Math.min(9.9,Math.max(.01,h))}function xo(t,e,r,n){let a=1/0,s=-1/0,h=0,o=0,l=0,u=0,i=t.length,c=new Map,p=[];for(let b=0;b<i;b++){let I=t[b];if(!e||e[b]){p.push(I);let T=(c.get(I)??0)+1;c.set(I,T),T>u&&(u=T,l=I),a=I<a?I:a,s=I>s?I:s,h+=I,o++}}if(o===0)return{statistics:{min:0,max:0,avg:0,stddev:0,mode:0,median:0},histogram:null};let C=h/o,g=0;for(let b=0;b<i;b++)e&&!e[b]||(g+=(t[b]-C)**2);let w=e?e.filter(b=>b).length:i,S=w<=1?0:Math.sqrt(g/(w-1));p.sort((b,I)=>b-I);let f=o>>>1,d={min:a,max:s,avg:C,stddev:S,mode:l,median:o%2?p[Math.floor(f)]:(p[f-1]+p[f])/2};if(["u8","s8","u4","u2","u1"].includes(r)){let b=s-a+1,I=new Uint32Array(b);for(let T=0;T<i;T++)e&&!e[T]||I[t[T]-a]++;return{statistics:d,histogram:{min:a-.5,max:s+.5,size:b,counts:I}}}let m=256,y=new Uint32Array(m),v=(s-a)/m;if(v===0)return{statistics:d,histogram:{min:a,max:s,size:1,counts:new Uint32Array(1).fill(o)}};let k=new Uint32Array(m+1);for(let b=0;b<i;b++)e&&!e[b]||k[Math.floor((t[b]-a)/v)]++;for(let b=0;b<m-1;b++)y[b]=k[b];return y[m-1]=k[m-1]+k[m],{statistics:d,histogram:{min:a,max:s,size:m,counts:y}}}function _i(t){let{pixels:e,mask:r,pixelType:n,bandMasks:a}=t,s=e.map((h,o)=>xo(h,a?.[o]??r,n));return{statistics:s.map(({statistics:h})=>h),histograms:s.map(({histogram:h})=>h)}}function Ao(t){if(!t?.pixels?.length)return null;let{pixels:e,mask:r,bandMasks:n,pixelType:a}=t,s=t.width*t.height,h=e.length,o=[],l=[],u=256,i,c,p,C;for(let g=0;g<h;g++){p=new Uint32Array(u);let w=e[g],S=n?.[g]??r;if(a==="u8"){if(i=255,c=0,S){for(let A=0;A<s;A++)if(S[A]){let E=w[A];i=E<i?E:i,c=E>c?E:c,p[E]++}}else for(let A=0;A<s;A++){let E=w[A];i=E<i?E:i,c=E>c?E:c,p[E]++}p=p.slice(i,c+1)}else{let A=!1;t.statistics||(t.updateStatistics(),A=!0);let E=t.statistics;i=E[g].minValue,c=E[g].maxValue;let P=(c-i)/u;if(P===0){!E||t.validPixelCount||A||t.updateStatistics();let R=(t.validPixelCount||t.width*t.height)/u;for(let M=0;M<u;M++)p[M]=Math.round(R*(M+1))-Math.round(R*M)}else{C=new Uint32Array(u+1);for(let R=0;R<s;R++)S&&!S[R]||C[Math.floor((w[R]-i)/P)]++;for(let R=0;R<u-1;R++)p[R]=C[R];p[u-1]=C[u-1]+C[u]}}let f=a==="u8"?i-.5:i,d=a==="u8"?c+.5:c;o.push({min:f,max:d,size:p.length,counts:p});let m=0,y=0,v=0;for(let A=0;A<p.length;A++)m+=p[A],y+=A*p[A];let k=y/m;for(let A=0;A<p.length;A++)v+=p[A]*(A-k)**2;let b=Math.sqrt(v/(m-1)),I=(d-f)/p.length,T=(k+(a==="u8"?0:.5))*I+i,x=b*I;l.push({min:i,max:c,avg:T,stddev:x})}return{statistics:l,histograms:o}}function ji(t){let e=[];for(let r=0;r<t.length;r++){let{min:n,max:a,size:s,counts:h}=t[r],o=0,l=0;for(let g=0;g<s;g++)o+=h[g],l+=g*h[g];let u=l/o,i=0;for(let g=0;g<s;g++)i+=h[g]*(g-u)**2;let c=(a-n)/s,p=(u+.5)*c+n,C=Math.sqrt(i/(o-1))*c;e.push({min:n,max:a,avg:p,stddev:C})}return e}function Nt(t,e){let{pixelBlock:r,bandIds:n,returnHistogramLut:a,rasterInfo:s}=e,h=null,o=null,l=t.stretchType;if(typeof l=="number"&&(l=wr[l]),t.dra)if(l==="minMax"&&r?.statistics)h=r.statistics.map(x=>[x.minValue,x.maxValue,0,0]);else{let x=Ao(r);h=x!=null?x.statistics:null,o=x!=null?x.histograms:null}else h=t.statistics?.length?t.statistics:s.statistics,o="histograms"in t?t.histograms:void 0,o||(o=s.histograms);l!=="percentClip"&&l!=="histogramEqualization"||o?.length||(l="minMax");let u=h?.length||o?.length||s.bandCount,i=[],c=[],p,C,g,w,S,f,d,m,y;h&&!Array.isArray(h[0])&&(h=h.map(x=>[x.min,x.max,x.avg,x.stddev]));let[v,k]=Ye(s.pixelType);if(!h?.length){for(h=[],m=0;m<u;m++)h.push([v,k,1,1]);l==="standardDeviation"&&(l="minMax")}switch(l){case"none":for(m=0;m<u;m++)i[m]=v,c[m]=k;break;case"minMax":for(m=0;m<u;m++){let x=h[m];i[m]=x[0],c[m]=x[1]}break;case"standardDeviation":{let{numberOfStandardDeviations:x=2}=t;for(m=0;m<u;m++){let A=h[m];i[m]=A[2]-x*A[3],c[m]=A[2]+x*A[3],i[m]<A[0]&&(i[m]=A[0]),c[m]>A[1]&&(c[m]=A[1])}}break;case"histogramEqualization":for(Lt(o),m=0;m<u;m++)i[m]=o[m].min,c[m]=o[m].max;break;case"percentClip":for(Lt(o),m=0;m<o.length;m++){for(p=o[m],S=new Uint32Array(p.size),w=[...p.counts],w.length>=20&&(w[0]=w[1]=w[2]=w[w.length-1]=w[w.length-2]=0),g=0,C=(p.max-p.min)/p.size,d=p.min===-.5&&C===1?.5:0,y=0;y<p.size;y++)g+=w[y],S[y]=g;for(f=(t.minPercent||0)*g/100,i[m]=p.min+d,y=0;y<p.size;y++)if(S[y]>f){i[m]=p.min+C*(y+d);break}for(f=(1-(t.maxPercent||0)/100)*g,c[m]=p.max+d,y=p.size-2;y>=0;y--)if(S[y]<f){c[m]=p.min+C*(y+2-d);break}if(c[m]<i[m]){let x=i[m];i[m]=c[m],c[m]=x}}break;default:for(m=0;m<u;m++){let x=h[m];i[m]=x[0],c[m]=x[1]}}let b,I,T;return l==="histogramEqualization"?(Lt(o),I=o[0].size||256,b=0,a&&(T=o.map(x=>Re(x)))):(I=t.max||255,b=t.min||0),Eo({minCutOff:i,maxCutOff:c,outMax:I,outMin:b,histogramLut:T},n)}function Eo(t,e){if(e==null||e.length===0)return t;let r=Math.max.apply(null,e),{minCutOff:n,maxCutOff:a,outMin:s,outMax:h,histogramLut:o}=t;return n.length===e.length||n.length<=r?t:{minCutOff:e.map(l=>n[l]),maxCutOff:e.map(l=>a[l]),histogramLut:o?e.map(l=>o[l]):null,outMin:s,outMax:h}}function Sr(t,e){let r=new Float32Array(t);for(let n=0;n<t;n++)e[n]>1?e[n]>2?r[n]=6.5+(e[n]-2)**2.5:r[n]=6.5+100*(2-e[n])**4:r[n]=1;return r}function se(t,e){if(!t?.pixels?.length)return t;let{mask:r,bandMasks:n,width:a,height:s,pixels:h}=t,{minCutOff:o,maxCutOff:l,gamma:u}=e,i=e.outMin||0,c=e.outMax||255,p=a*s,C=e.outputPixelType||"u8",g=t.pixels.map(()=>Z.createEmptyBand(C,p)),w=g.length,S=c-i,f=[],d=[];for(let b=0;b<w;b++)d[b]=l[b]-o[b],f[b]=d[b]===0?0:S/d[b];let m=C.startsWith("u")||C.startsWith("s"),y=u&&u.length>=w,v=!!e.isRenderer;if(y){let b=Sr(w,u);for(let I=0;I<w;I++){let T=n?.[I]??r;for(let x=0;x<p;x++)if(T==null||T[x]){if(d[I]===0){g[I][x]=i;continue}let A=h[I][x],E=(A-o[I])/d[I],P=1;if(u[I]>1&&(P-=(1/S)**(E*b[I])),A<l[I]&&A>o[I]){let R=P*S*E**(1/u[I])+i;g[I][x]=v?Math.floor(R):m?Math.round(R):R}else A>=l[I]?g[I][x]=c:g[I][x]=i}}}else for(let b=0;b<w;b++){let I=n?.[b]??r;for(let T=0;T<p;T++)if(I==null||I[T]){let x=h[b][T];if(x<l[b]&&x>o[b]){let A=(x-o[b])*f[b]+i;g[b][T]=v?Math.floor(A):m?Math.round(A):A}else x>=l[b]?g[b][T]=c:g[b][T]=i}}let k=new Z({width:a,height:s,mask:r,bandMasks:n,pixels:g,pixelType:C});return k.updateStatistics(),k}var Le;function Pt(t){return t=Number(t),isNaN(t)?void 0:t}var ht=Le=class extends yt{constructor(){super(...arguments),this.name=null,this.minWavelength=void 0,this.maxWavelength=void 0,this.radianceBias=void 0,this.radianceGain=void 0,this.reflectanceBias=void 0,this.reflectanceGain=void 0,this.solarIrradiance=void 0}clone(){return new Le({name:this.name,minWavelength:this.minWavelength,maxWavelength:this.maxWavelength,radianceBias:this.radianceBias,radianceGain:this.radianceGain,reflectanceBias:this.reflectanceBias,reflectanceGain:this.reflectanceGain,solarIrradiance:this.solarIrradiance})}};O([G({json:{name:"BandName",write:!0}})],ht.prototype,"name",void 0),O([G({json:{name:"WavelengthMin",read:{reader:Pt},write:!0}})],ht.prototype,"minWavelength",void 0),O([G({json:{name:"WavelengthMax",read:{reader:Pt},write:!0}})],ht.prototype,"maxWavelength",void 0),O([G({json:{name:"RadianceBias",read:{reader:Pt},write:!0}})],ht.prototype,"radianceBias",void 0),O([G({json:{name:"RadianceGain",read:{reader:Pt},write:!0}})],ht.prototype,"radianceGain",void 0),O([G({json:{name:"ReflectanceBias",read:{reader:Pt},write:!0}})],ht.prototype,"reflectanceBias",void 0),O([G({json:{name:"ReflectanceGain",read:{reader:Pt},write:!0}})],ht.prototype,"reflectanceGain",void 0),O([G({json:{name:"SolarIrradiance",read:{reader:Pt},write:!0}})],ht.prototype,"solarIrradiance",void 0),ht=Le=O([gt("esri.layers.support.RasterBandInfo")],ht);var Oe=ht;var De;function Ht(t){return t=Number(t),isNaN(t)?void 0:t}var lt=De=class extends yt{constructor(){super(...arguments),this.acquisitionDate=void 0,this.cloudCover=void 0,this.productName=void 0,this.sensorName=null,this.sensorAzimuth=void 0,this.sensorElevation=void 0,this.sunAzimuth=void 0,this.sunElevation=void 0}readAcquisitionDate(t){return new Date(t)}writeAcquisitionDate(t,e){e.AcquisitionDate=t.getTime()}clone(){return new De({acquisitionDate:this.acquisitionDate,cloudCover:this.cloudCover,productName:this.productName,sensorName:this.sensorName,sensorAzimuth:this.sensorAzimuth,sensorElevation:this.sensorElevation,sunAzimuth:this.sunAzimuth,sunElevation:this.sunElevation})}};O([G({json:{name:"AcquisitionDate",write:!0}})],lt.prototype,"acquisitionDate",void 0),O([Je("acquisitionDate")],lt.prototype,"readAcquisitionDate",null),O([He("acquisitionDate")],lt.prototype,"writeAcquisitionDate",null),O([G({json:{name:"CloudCover",read:{reader:Ht},write:!0}})],lt.prototype,"cloudCover",void 0),O([G({json:{name:"ProductName",write:!0}})],lt.prototype,"productName",void 0),O([G({json:{name:"SensorName",write:!0}})],lt.prototype,"sensorName",void 0),O([G({json:{name:"SensorAzimuth",read:{reader:Ht},write:!0}})],lt.prototype,"sensorAzimuth",void 0),O([G({json:{name:"SensorElevation",read:{reader:Ht},write:!0}})],lt.prototype,"sensorElevation",void 0),O([G({json:{name:"SunAzimuth",read:{reader:Ht},write:!0}})],lt.prototype,"sunAzimuth",void 0),O([G({json:{name:"SunElevation",read:{reader:Ht},write:!0}})],lt.prototype,"sunElevation",void 0),lt=De=O([gt("esri.layers.support.RasterSensorInfo")],lt);var Tr=lt;var Ue,ot=Ue=class extends yt{constructor(){super(...arguments),this.blockWidth=void 0,this.blockHeight=void 0,this.compression=null,this.origin=null,this.firstPyramidLevel=null,this.maximumPyramidLevel=null,this.pyramidScalingFactor=2,this.pyramidBlockWidth=null,this.pyramidBlockHeight=null,this.isVirtualTileInfo=!1,this.tileInfo=null,this.transposeInfo=null,this.blockBoundary=null}clone(){return new Ue({blockWidth:this.blockWidth,blockHeight:this.blockHeight,compression:this.compression,origin:tt(this.origin),firstPyramidLevel:this.firstPyramidLevel,maximumPyramidLevel:this.maximumPyramidLevel,pyramidResolutions:tt(this.pyramidResolutions),pyramidScalingFactor:this.pyramidScalingFactor,pyramidBlockWidth:this.pyramidBlockWidth,pyramidBlockHeight:this.pyramidBlockHeight,isVirtualTileInfo:this.isVirtualTileInfo,tileInfo:tt(this.tileInfo),transposeInfo:tt(this.transposeInfo),blockBoundary:tt(this.blockBoundary)})}};O([G({type:Number,json:{write:!0}})],ot.prototype,"blockWidth",void 0),O([G({type:Number,json:{write:!0}})],ot.prototype,"blockHeight",void 0),O([G({type:String,json:{write:!0}})],ot.prototype,"compression",void 0),O([G({type:Ke,json:{write:!0}})],ot.prototype,"origin",void 0),O([G({type:Number,json:{write:!0}})],ot.prototype,"firstPyramidLevel",void 0),O([G({type:Number,json:{write:!0}})],ot.prototype,"maximumPyramidLevel",void 0),O([G({json:{write:!0}})],ot.prototype,"pyramidResolutions",void 0),O([G({type:Number,json:{write:!0}})],ot.prototype,"pyramidScalingFactor",void 0),O([G({type:Number,json:{write:!0}})],ot.prototype,"pyramidBlockWidth",void 0),O([G({type:Number,json:{write:!0}})],ot.prototype,"pyramidBlockHeight",void 0),O([G({type:Boolean,json:{write:!0}})],ot.prototype,"isVirtualTileInfo",void 0),O([G({json:{write:!0}})],ot.prototype,"tileInfo",void 0),O([G()],ot.prototype,"transposeInfo",void 0),O([G()],ot.prototype,"blockBoundary",void 0),ot=Ue=O([gt("esri.layers.support.RasterStorageInfo")],ot);var kr=ot;var Ge,K=Ge=class extends yt{constructor(t){super(t),this.attributeTable=null,this.bandCount=null,this.colormap=null,this.extent=null,this.format=void 0,this.height=null,this.width=null,this.histograms=null,this.keyProperties={},this.multidimensionalInfo=null,this.noDataValue=null,this.pixelSize=null,this.pixelType=null,this.isPseudoSpatialReference=!1,this.spatialReference=null,this.statistics=null,this.storageInfo=null,this.transform=null}get bandInfos(){let t=this.keyProperties.BandProperties,{bandCount:e}=this;if(!t?.length||t.length<e){let n=[];for(let a=1;a<=e;a++)n.push(new Oe({name:"band_"+a}));return n}let r=t.map(n=>Oe.fromJSON(n));for(let n=0;n<r.length;n++)r[n].name=r[n].name||"band_"+(n+1);return r}get dataType(){let t=this.keyProperties?.DataType?.toLowerCase()??"generic";return t==="stdtime"?"standard-time":t}get nativeExtent(){return this._get("nativeExtent")||this.extent}set nativeExtent(t){t&&this._set("nativeExtent",t)}get nativePixelSize(){if(this.transform==null||!this.transform.affectsPixelSize)return this.pixelSize;let t=this.nativeExtent;return{x:t.width/this.width,y:t.height/this.height}}get hasMultidimensionalTranspose(){return!!this.storageInfo?.transposeInfo}get sensorInfo(){if(this.keyProperties?.SensorName)return Tr.fromJSON(this.keyProperties)}clone(){return new Ge({attributeTable:tt(this.attributeTable),bandCount:this.bandCount,colormap:tt(this.colormap),extent:tt(this.extent),format:this.format,height:this.height,width:this.width,histograms:tt(this.histograms),keyProperties:tt(this.keyProperties),multidimensionalInfo:tt(this.multidimensionalInfo),noDataValue:this.noDataValue,pixelSize:tt(this.pixelSize),pixelType:this.pixelType,isPseudoSpatialReference:this.isPseudoSpatialReference,spatialReference:tt(this.spatialReference),statistics:tt(this.statistics),storageInfo:tt(this.storageInfo),transform:tt(this.transform)})}};O([G({json:{write:!0}})],K.prototype,"attributeTable",void 0),O([G({json:{write:!0}})],K.prototype,"bandCount",void 0),O([G({readOnly:!0})],K.prototype,"bandInfos",null),O([G({json:{write:!0}})],K.prototype,"colormap",void 0),O([G({type:String,readOnly:!0})],K.prototype,"dataType",null),O([G({type:he,json:{write:!0}})],K.prototype,"extent",void 0),O([G({type:he,json:{write:!0}})],K.prototype,"nativeExtent",null),O([G({json:{write:!0}})],K.prototype,"nativePixelSize",null),O([G({json:{write:!0}})],K.prototype,"format",void 0),O([G({json:{write:!0}})],K.prototype,"height",void 0),O([G({json:{write:!0}})],K.prototype,"width",void 0),O([G({json:{write:!0}})],K.prototype,"hasMultidimensionalTranspose",null),O([G({json:{write:!0}})],K.prototype,"histograms",void 0),O([G({json:{write:!0}})],K.prototype,"keyProperties",void 0),O([G({json:{write:!0}})],K.prototype,"multidimensionalInfo",void 0),O([G({json:{write:!0}})],K.prototype,"noDataValue",void 0),O([G({json:{write:!0}})],K.prototype,"pixelSize",void 0),O([G({json:{write:!0}})],K.prototype,"pixelType",void 0),O([G()],K.prototype,"isPseudoSpatialReference",void 0),O([G({readOnly:!0})],K.prototype,"sensorInfo",null),O([G({type:We,json:{write:!0}})],K.prototype,"spatialReference",void 0),O([G({json:{write:!0}})],K.prototype,"statistics",void 0),O([G({type:kr,json:{write:!0}})],K.prototype,"storageInfo",void 0),O([G({json:{write:!0}})],K.prototype,"transform",void 0),K=Ge=O([gt("esri.layers.support.RasterInfo")],K);var Ir=K;var it=1,Bt=1/111e3;function Ne(t){let{altitude:e,azimuth:r}=t,{hillshadeType:n,pixelSizePower:a=1,pixelSizeFactor:s=1,scalingType:h,isGCS:o,resolution:l}=t,u=n==="multi-directional"?2*t.zFactor:t.zFactor,{x:i,y:c}=l,p=u/(8*i),C=u/(8*c);if(o&&u>.001&&(p/=Bt,C/=Bt),h==="adjusted")if(o){let E=i*Bt,P=c*Bt;p=(u+E**a*s)/(8*E),C=(u+P**a*s)/(8*P)}else p=(u+i**a*s)/(8*i),C=(u+c**a*s)/(8*c);let g=(90-e)*Math.PI/180,w=Math.cos(g),S=(360-r+90)*Math.PI/180,f=Math.sin(g)*Math.cos(S),d=Math.sin(g)*Math.sin(S),m=[315,270,225,360,180,0],y=[60,60,60,60,60,90],v=new Float32Array([3,5,3,2,1,4]),k=v.reduce((E,P)=>E+P),b=v.map(E=>E/k),I=n==="multi-directional"?m.length:1,T=new Float32Array(6),x=new Float32Array(6),A=new Float32Array(6);if(n==="multi-directional")for(let E=0;E<I;E++)e=y[E],r=m[E],g=(90-e)*Math.PI/180,w=Math.cos(g),S=(360-r+90)*Math.PI/180,f=Math.sin(g)*Math.cos(S),d=Math.sin(g)*Math.sin(S),T[E]=w,x[E]=f,A[E]=d;else T.fill(w),x.fill(f),A.fill(d);return{resolution:l,factor:[p,C],sinZcosA:f,sinZsinA:d,cosZ:w,sinZcosAs:x,sinZsinAs:A,cosZs:T,weights:b,hillshadeType:["traditional","multi-directional"].indexOf(n)}}function le(t,e){let{width:r,height:n}=t,a=r*n,s=new Uint8Array(a),h=t.mask!=null,o;if(h){o=new Uint8Array(t.mask);for(let k=0;k<o.length;k++)o[k]&&(s[k]=1,o[k]=1)}let l=t.pixels[0],u=new Float32Array(a),i=new Float32Array(a),c,p=0;if(e){let{resolution:k}=e,b=k?(k.x+k.y)/2:1;p=200*e.zFactor/(b*b),c=new Float32Array(a)}let C=e?.curvatureType,g,w,S,f,d,m,y,v;for(let k=it;k<n-it;k++){let b=k*r;for(let I=it;I<r-it;I++){let T=b+I;if(!o||o[T]!==0){if(o){if(o[T-r-1]+o[T-r]+o[T-r+1]+o[T-1]+o[T+1]+o[T+r-1]+o[T+r]+o[T+r+1]<7){s[T]=0;continue}g=o[T-r-1]?l[T-r-1]:l[T],w=o[T-r]?l[T-r]:l[T],S=o[T-r+1]?l[T-r+1]:l[T],f=o[T-1]?l[T-1]:l[T],d=o[T+1]?l[T+1]:l[T],m=o[T+r-1]?l[T+r-1]:l[T],y=o[T+r]?l[T+r]:l[T],v=o[T+r+1]?l[T+r+1]:l[T]}else g=l[T-r-1],w=l[T-r],S=l[T-r+1],f=l[T-1],d=l[T+1],m=l[T+r-1],y=l[T+r],v=l[T+r+1];if(u[T]=S+d+d+v-(g+f+f+m),i[T]=m+y+y+v-(g+w+w+S),c!=null){let x=l[T],A=.5*(f+d)-x,E=.5*(w+y)-x;if(C==="standard")c[T]=-p*(A+E);else{let P=(-g+S+m-v)/4,R=(-f+d)/2,M=(w-y)/2,B=R*R,L=M*M,j=B+L;j&&(c[T]=C==="profile"?p*(A*B+E*L+P*R*M)/j:-p*(A*L+E*B-P*R*M)/j)}}}}}return{outMask:h?s:null,dzxs:u,dzys:i,curvatures:c}}function ue(t,e,r){for(let n=0;n<r;n++)t[n*e]=t[n*e+1],t[(n+1)*e-1]=t[(n+1)*e-2];for(let n=1;n<e-1;n++)t[n]=t[n+e],t[n+(r-1)*e]=t[n+(r-2)*e]}function xr(t,e){if(!wt(t))return t;let{factor:r,sinZcosA:n,sinZsinA:a,cosZ:s,sinZcosAs:h,sinZsinAs:o,cosZs:l,weights:u}=Ne(e),[i,c]=r,p=e.hillshadeType==="traditional",{width:C,height:g}=t,w=new Uint8Array(C*g),{dzxs:S,dzys:f,outMask:d}=le(t);for(let m=it;m<g-it;m++){let y=m*C;for(let v=it;v<C-it;v++){let k=y+v;if(!d||d[k]){let b=S[k]*i,I=f[k]*c,T=Math.sqrt(1+b*b+I*I),x=0;if(p){let A=255*(s+a*I-n*b)/T;A<0&&(A=0),x=A}else{let A=o.length;for(let E=0;E<A;E++){let P=255*(l[E]+o[E]*I-h[E]*b)/T;P<0&&(P=0),x+=P*u[E]}}w[k]=255&x}}}return ue(w,C,g),new Z({width:C,height:g,pixels:[w],mask:d,pixelType:"u8",validPixelCount:t.validPixelCount,statistics:[new Vt(0,255)]})}function Ar(t,e,r,n){if(!wt(t)||!wt(e))return;let{min:a,max:s}=n,h=t.pixels[0],{pixels:o,mask:l}=e,u=o[0],i=255.00001/(s-a),c=new Uint8ClampedArray(u.length),p=new Uint8ClampedArray(u.length),C=new Uint8ClampedArray(u.length),g=r.length-1;for(let w=0;w<u.length;w++){if(l&&l[w]===0)continue;let S=Math.floor((u[w]-a)*i),[f,d]=r[S<0?0:S>g?g:S],m=h[w],y=m*d,v=y*(1-Math.abs(f%2-1)),k=m-y;switch(Math.floor(f)){case 0:c[w]=y+k,p[w]=v+k,C[w]=k;break;case 1:c[w]=v+k,p[w]=y+k,C[w]=k;break;case 2:c[w]=k,p[w]=y+k,C[w]=v+k;break;case 3:c[w]=k,p[w]=v+k,C[w]=y+k;break;case 4:c[w]=v+k,p[w]=k,C[w]=y+k;break;case 5:case 6:c[w]=y+k,p[w]=k,C[w]=v+k}}t.pixels=[c,p,C],t.updateStatistics()}function Bn(t,e){if(!wt(t))return t;let r=e.zFactor,n=e.pixelSizePower??1,a=e.pixelSizeFactor??1,s=e.slopeType,h=e.isGCS,{x:o,y:l}=e.resolution,u=r/(8*o),i=r/(8*l);h&&Math.abs(r-1)<1e-4&&(u/=Bt,i/=Bt),s==="adjusted"&&(u=(r+o**n*a)/(8*o),i=(r+l**n*a)/(8*l));let{dzxs:c,dzys:p,outMask:C}=le(t),{width:g,height:w}=t,S=new Float32Array(g*w);for(let d=it;d<w-it;d++){let m=d*g;for(let y=it;y<g-it;y++){let v=m+y;if(!C||C[v]){let k=c[v]*u,b=p[v]*i,I=Math.sqrt(k*k+b*b);S[m+y]=s==="percent-rise"?100*I:57.2957795*Math.atan(I)}}}ue(S,g,w);let f=new Z({width:g,height:w,pixels:[S],mask:C,pixelType:"f32",validPixelCount:t.validPixelCount});return f.updateStatistics(),f}function Fn(t,e={}){if(!wt(t))return t;let{resolution:r}=e,n=r?1/r.x:1,a=r?1/r.y:1,{dzxs:s,dzys:h,outMask:o}=le(t),{width:l,height:u}=t,i=new Float32Array(l*u);for(let c=it;c<u-it;c++){let p=c*l;for(let C=it;C<l-it;C++){let g=p+C;if(!o||o[g]){let w=s[g]*n,S=h[g]*a,f=-1;w===0&&S===0||(f=90-57.29578*Math.atan2(S,-w),f<0&&(f+=360),f===360?f=0:f>360&&(f%=360)),i[p+C]=f}}}return ue(i,l,u),new Z({width:l,height:u,pixels:[i],mask:o,pixelType:"f32",validPixelCount:t.validPixelCount,statistics:[new Vt(-1,360)]})}function Vn(t,e){if(!wt(t))return t;let{curvatures:r,outMask:n}=le(t,e),{width:a,height:s}=t;ue(r,a,s);let h=new Z({width:a,height:s,pixels:[r],mask:n,pixelType:"f32",validPixelCount:t.validPixelCount});return h.updateStatistics(),h}var Jn=["random","ndvi","ndvi2","ndvi3","elevation","gray","hillshade"],Lr=[{id:"aspect",type:"multipart",colorRamps:[{fromColor:[190,190,190],toColor:[255,45,8]},{fromColor:[255,45,8],toColor:[255,181,61]},{fromColor:[255,181,61],toColor:[255,254,52]},{fromColor:[255,254,52],toColor:[0,251,50]},{fromColor:[0,251,50],toColor:[255,254,52]},{fromColor:[0,253,255],toColor:[0,181,255]},{fromColor:[0,181,255],toColor:[26,35,253]},{fromColor:[26,35,253],toColor:[255,57,251]},{fromColor:[255,57,251],toColor:[255,45,8]}]},{id:"black-to-white",fromColor:[0,0,0],toColor:[255,255,255]},{id:"blue-bright",fromColor:[204,204,255],toColor:[0,0,224]},{id:"blue-light-to-dark",fromColor:[211,229,232],toColor:[46,100,140]},{id:"blue-green-bright",fromColor:[203,245,234],toColor:[48,207,146]},{id:"blue-green-light-to-dark",fromColor:[216,242,237],toColor:[21,79,74]},{id:"brown-light-to-dark",fromColor:[240,236,170],toColor:[102,72,48]},{id:"brown-to-blue-green-diverging-right",type:"multipart",colorRamps:[{fromColor:[156,85,31],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[33,130,145]}]},{id:"brown-to-blue-green-diverging-dark",type:"multipart",colorRamps:[{fromColor:[110,70,45],toColor:[204,204,102]},{fromColor:[204,204,102],toColor:[48,100,102]}]},{id:"coefficient-bias",fromColor:[214,214,255],toColor:[0,57,148]},{id:"cold-to-hot-diverging",type:"multipart",colorRamps:[{fromColor:[69,117,181],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[214,47,39]}]},{id:"condition-number",type:"multipart",colorRamps:[{fromColor:[0,97,0],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[255,34,0]}]},{id:"cyan-to-purple",type:"multipart",colorRamps:[{fromColor:[0,245,245],toColor:[0,0,245]},{fromColor:[0,0,245],toColor:[245,0,245]}]},{id:"cyan-light-to-blue-dark",type:"multipart",colorRamps:[{fromColor:[182,237,240],toColor:[31,131,224]},{fromColor:[31,131,224],toColor:[9,9,145]}]},{id:"distance",fromColor:[255,200,0],toColor:[0,0,255]},{id:"elevation1",type:"multipart",colorRamps:[{fromColor:[175,240,233],toColor:[255,255,179]},{fromColor:[255,255,179],toColor:[0,128,64]},{fromColor:[0,128,64],toColor:[252,186,3]},{fromColor:[252,186,3],toColor:[128,0,0]},{fromColor:[120,0,0],toColor:[105,48,13]},{fromColor:[105,48,13],toColor:[171,171,171]},{fromColor:[171,171,171],toColor:[255,252,255]}]},{id:"elevation2",type:"multipart",colorRamps:[{fromColor:[118,219,211],toColor:[255,255,199]},{fromColor:[255,255,199],toColor:[255,255,128]},{fromColor:[255,255,128],toColor:[217,194,121]},{fromColor:[217,194,121],toColor:[135,96,38]},{fromColor:[135,96,38],toColor:[150,150,181]},{fromColor:[150,150,181],toColor:[181,150,181]},{fromColor:[181,150,181],toColor:[255,252,255]}]},{id:"errors",fromColor:[255,235,214],toColor:[196,10,10]},{id:"gray-light-to-dark",fromColor:[219,219,219],toColor:[69,69,69]},{id:"green-bright",fromColor:[204,255,204],toColor:[14,204,14]},{id:"green-light-to-dark",fromColor:[220,245,233],toColor:[34,102,51]},{id:"green-to-blue",type:"multipart",colorRamps:[{fromColor:[32,204,16],toColor:[0,242,242]},{fromColor:[0,242,242],toColor:[2,33,227]}]},{id:"orange-bright",fromColor:[255,235,204],toColor:[240,118,5]},{id:"orange-light-to-dark",fromColor:[250,233,212],toColor:[171,65,36]},{id:"partial-spectrum",type:"multipart",colorRamps:[{fromColor:[242,241,162],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[255,0,0]},{fromColor:[252,3,69],toColor:[176,7,237]},{fromColor:[176,7,237],toColor:[2,29,173]}]},{id:"partial-spectrum-1-diverging",type:"multipart",colorRamps:[{fromColor:[135,38,38],toColor:[240,149,12]},{fromColor:[240,149,12],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[74,80,181]},{fromColor:[74,80,181],toColor:[39,32,122]}]},{id:"partial-spectrum-2-diverging",type:"multipart",colorRamps:[{fromColor:[115,77,42],toColor:[201,137,52]},{fromColor:[201,137,52],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[91,63,176]},{fromColor:[91,63,176],toColor:[81,13,97]}]},{id:"pink-to-yellow-green-diverging-bright",type:"multipart",colorRamps:[{fromColor:[158,30,113],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[99,110,45]}]},{id:"pink-to-yellow-green-diverging-dark",type:"multipart",colorRamps:[{fromColor:[97,47,73],toColor:[204,204,102]},{fromColor:[204,204,102],toColor:[22,59,15]}]},{id:"precipitation",type:"multipart",colorRamps:[{fromColor:[194,82,60],toColor:[237,161,19]},{fromColor:[237,161,19],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[0,219,0]},{fromColor:[0,219,0],toColor:[32,153,143]},{fromColor:[32,153,143],toColor:[11,44,122]}]},{id:"prediction",type:"multipart",colorRamps:[{fromColor:[40,146,199],toColor:[250,250,100]},{fromColor:[250,250,100],toColor:[232,16,20]}]},{id:"purple-bright",fromColor:[255,204,255],toColor:[199,0,199]},{id:"purple-to-green-diverging-bright",type:"multipart",colorRamps:[{fromColor:[77,32,150],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[20,122,11]}]},{id:"purple-to-green-diverging-dark",type:"multipart",colorRamps:[{fromColor:[67,14,89],toColor:[204,204,102]},{fromColor:[204,204,102],toColor:[24,79,15]}]},{id:"purple-blue-bright",fromColor:[223,184,230],toColor:[112,12,242]},{id:"purple-blue-light-to-dark",fromColor:[229,213,242],toColor:[93,44,112]},{id:"purple-red-bright",fromColor:[255,204,225],toColor:[199,0,99]},{id:"purple-red-light-to-dark",fromColor:[250,215,246],toColor:[143,17,57]},{id:"red-bright",fromColor:[255,204,204],toColor:[219,0,0]},{id:"red-light-to-dark",fromColor:[255,224,224],toColor:[143,10,10]},{id:"red-to-blue-diverging-bright",type:"multipart",colorRamps:[{fromColor:[196,69,57],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[48,95,207]}]},{id:"red-to-blue-diverging-dark",type:"multipart",colorRamps:[{fromColor:[107,13,13],toColor:[204,204,102]},{fromColor:[204,204,102],toColor:[13,53,97]}]},{id:"red-to-green",type:"multipart",colorRamps:[{fromColor:[245,0,0],toColor:[245,245,0]},{fromColor:[245,245,0],toColor:[0,245,0]}]},{id:"red-to-green-diverging-bright",type:"multipart",colorRamps:[{fromColor:[186,20,20],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[54,145,33]}]},{id:"red-to-green-diverging-dark",type:"multipart",colorRamps:[{fromColor:[97,21,13],toColor:[204,204,102]},{fromColor:[204,204,102],toColor:[16,69,16]}]},{id:"slope",type:"multipart",colorRamps:[{fromColor:[56,168,0],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[255,0,0]}]},{id:"spectrum-full-bright",type:"multipart",colorRamps:[{fromColor:[255,0,0],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[0,255,255]},{fromColor:[0,255,255],toColor:[0,0,255]}]},{id:"spectrum-full-dark",type:"multipart",colorRamps:[{fromColor:[153,0,0],toColor:[153,153,0]},{fromColor:[153,153,0],toColor:[0,153,153]},{fromColor:[0,153,153],toColor:[0,0,153]}]},{id:"spectrum-full-light",type:"multipart",colorRamps:[{fromColor:[255,153,153],toColor:[255,255,153]},{fromColor:[255,255,153],toColor:[153,255,255]},{fromColor:[153,255,255],toColor:[153,153,255]}]},{id:"surface",type:"multipart",colorRamps:[{fromColor:[112,153,89],toColor:[242,238,162]},{fromColor:[242,238,162],toColor:[242,206,133]},{fromColor:[242,206,133],toColor:[194,140,124]},{fromColor:[194,140,124],toColor:[255,242,255]}]},{id:"temperature",type:"multipart",colorRamps:[{fromColor:[255,252,255],toColor:[255,0,255]},{fromColor:[255,0,255],toColor:[0,0,255]},{fromColor:[0,0,255],toColor:[0,255,255]},{fromColor:[0,255,255],toColor:[0,255,0]},{fromColor:[0,255,0],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[255,128,0]},{fromColor:[255,128,0],toColor:[128,0,0]}]},{id:"white-to-black",fromColor:[255,255,255],toColor:[0,0,0]},{id:"yellow-to-dark-red",type:"multipart",colorRamps:[{fromColor:[255,255,128],toColor:[242,167,46]},{fromColor:[242,167,46],toColor:[107,0,0]}]},{id:"yellow-to-green-to-dark-blue",type:"multipart",colorRamps:[{fromColor:[255,255,128],toColor:[56,224,9]},{fromColor:[56,224,9],toColor:[26,147,171]},{fromColor:[26,147,171],toColor:[12,16,120]}]},{id:"yellow-to-red",fromColor:[245,245,0],toColor:[255,0,0]},{id:"yellow-green-bright",fromColor:[236,252,204],toColor:[157,204,16]},{id:"yellow-green-light-to-dark",fromColor:[215,240,175],toColor:[96,107,45]}],Po=new qt({Aspect:"aspect","Black to White":"black-to-white","Blue Bright":"blue-bright","Blue Light to Dark":"blue-light-to-dark","Blue-Green Bright":"blue-green-bright","Blue-Green Light to Dark":"blue-green-light-to-dark","Brown Light to Dark":"brown-light-to-dark","Brown to Blue Green Diverging, Bright":"brown-to-blue-green-diverging-right","Brown to Blue Green Diverging, Dark":"brown-to-blue-green-diverging-dark","Coefficient Bias":"coefficient-bias","Cold to Hot Diverging":"cold-to-hot-diverging","Condition Number":"condition-number","Cyan to Purple":"cyan-to-purple","Cyan-Light to Blue-Dark":"cyan-light-to-blue-dark",Distance:"distance","Elevation #1":"elevation1","Elevation #2":"elevation2",Errors:"errors","Gray Light to Dark":"gray-light-to-dark","Green Bright":"green-bright","Green Light to Dark":"green-light-to-dark","Green to Blue":"green-to-blue","Orange Bright":"orange-bright","Orange Light to Dark":"orange-light-to-dark","Partial Spectrum":"partial-spectrum","Partial Spectrum 1 Diverging":"partial-spectrum-1-diverging","Partial Spectrum 2 Diverging":"partial-spectrum-2-diverging","Pink to YellowGreen Diverging, Bright":"pink-to-yellow-green-diverging-bright","Pink to YellowGreen Diverging, Dark":"pink-to-yellow-green-diverging-dark",Precipitation:"precipitation",Prediction:"prediction","Purple Bright":"purple-bright","Purple to Green Diverging, Bright":"purple-to-green-diverging-bright","Purple to Green Diverging, Dark":"purple-to-green-diverging-dark","Purple-Blue Bright":"purple-blue-bright","Purple-Blue Light to Dark":"purple-blue-light-to-dark","Purple-Red Bright":"purple-red-bright","Purple-Red Light to Dark":"purple-red-light-to-dark","Red Bright":"red-bright","Red Light to Dark":"red-light-to-dark","Red to Blue Diverging, Bright":"red-to-blue-diverging-bright","Red to Blue Diverging, Dark":"red-to-blue-diverging-dark","Red to Green":"red-to-green","Red to Green Diverging, Bright":"red-to-green-diverging-bright","Red to Green Diverging, Dark":"red-to-green-diverging-dark",Slope:"slope","Spectrum-Full Bright":"spectrum-full-bright","Spectrum-Full Dark":"spectrum-full-dark","Spectrum-Full Light":"spectrum-full-light",Surface:"surface",Temperature:"temperature","White to Black":"white-to-black","Yellow to Dark Red":"yellow-to-dark-red","Yellow to Green to Dark Blue":"yellow-to-green-to-dark-blue","Yellow to Red":"yellow-to-red","Yellow-Green Bright":"yellow-green-bright","Yellow-Green Light to Dark":"yellow-green-light-to-dark"});function ce(t,e){if(!t||!e||t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(t[r]>e[r]+2||t[r]<e[r]-2)return!1;return!0}function Er(t){let e=t.clone();return e.fromColor=t.toColor,e.toColor=t.fromColor,e.algorithm=t.algorithm,e}function Ro(t){if(t.type==="multipart"){let e=t.clone();return e.colorRamps?.length&&(e.colorRamps=e.colorRamps.reverse().map(r=>Er(r))),e}return Er(t)}function Pr(t,e){if(!t)return;let r=e??Lr,n=null;return t.type==="algorithmic"?r.some(a=>{if(ce(t.fromColor.toRgb(),a.fromColor)&&ce(t.toColor.toRgb(),a.toColor))return n=a.id,!0}):t.type==="multipart"&&r.some(a=>{let s=t.colorRamps,h=a.colorRamps;if(s&&h&&s.length===h.length&&!h.some((o,l)=>{if(!ce(s[l].fromColor.toRgb(),new pe(o.fromColor).toRgb())||!ce(s[l].toColor.toRgb(),new pe(o.toColor).toRgb()))return!0})){if(n)return!0;n=a.id}}),n}function Mo(t,e,r=!1){if(!t)return;let n=!1,a=Pr(t,e);return a!=null||r||(n=!0,a=Pr(t=Ro(t),e)),a?{id:a,inverted:n}:void 0}function Lo(t,e=!1){let r=typeof t=="string"?t:Mo(t,void 0,e)?.id;return r?Po.toJSON(r):null}function Kn(t,e="esriCIELabAlgorithm"){let r=Lr.find(({id:n})=>n===t);return r?r.colorRamps?{type:"multipart",colorRamps:r.colorRamps.map(n=>({type:"algorithmic",algorithm:e,fromColor:[...n.fromColor],toColor:[...n.toColor]}))}:{type:"algorithmic",algorithm:e,fromColor:[...r.fromColor],toColor:[...r.toColor]}:null}function Or(t){let e=(t=t||{}).numColors||256,r=t.distanceOffset||0,n=t.isCustomInterval!=null?t.isCustomInterval:t.distanceInterval!==null&&t.distanceInterval!==1/(e-1),a=t.distanceInterval||1/(e-1);return Q(X({},t),{numColors:e,distanceOffset:r,interpolateAlpha:!!t.interpolateAlpha,distanceInterval:a,isCustomInterval:n,weights:t.weights})}function Oo(t,e,r){let{numColors:n,distanceOffset:a,distanceInterval:s,isCustomInterval:h}=r,o=t.s===0,l=e.s===0,u=t.h,i=e.h;o&&!l?u=i:l&&!o&&(e=Q(X({},e),{h:u}),i=u);let c,p=Math.abs(i-u),C=360;p<C/2?c=(i-u)*s:(p=C-p,c=u>i?p*s:-p*s);let g=(e.s-t.s)*s,w=(e.v-t.v)*s,{s:S,v:f}=t,d=u;if(a){let y=a/s;d=(d+y*c+C)%C,S+=y*g,f+=y*w}let m=[];for(let y=0;y<n-1;y++)m.push({h:d,s:S,v:f}),d=(d+c+C)%C,S+=g,f+=w;return m.push(h?{h:d,s:S,v:f}:e),m}function Do(t,e,r){let{numColors:n,distanceOffset:a,distanceInterval:s,isCustomInterval:h}=r,{l:o,a:l,b:u}=t,i=(e.l-o)*s,c=(e.a-l)*s,p=(e.b-u)*s,C=[];if(a){let g=a/s;o+=g*i,l+=g*c,u+=g*p}for(let g=0;g<n-1;g++)C.push({l:o,a:l,b:u}),o+=i,l+=c,u+=p;return C.push(h?{l:o,a:l,b:u}:e),C}function Uo(t,e,r){let{numColors:n,distanceOffset:a,distanceInterval:s,isCustomInterval:h}=r,o=t.h,l=e.h,u=2*Math.PI,i;if(o<=l){let d=l-o,m=l-o-u;i=Math.abs(m)<Math.abs(d)?m:d}else{let d=l+u-o,m=l-o;i=Math.abs(m)<Math.abs(d)?m:d}let c=i*s,p=(e.l-t.l)*s,C=(e.c-t.c)*s,{l:g,c:w,h:S}=t;if(a){let d=a/s;g+=d*p,w+=d*C,S=(S+d*c+u)%u}let f=[];for(let d=0;d<n-1;d++)f.push({l:g,c:w,h:S}),g+=p,w+=C,S=(S+c+u)%u;return f.push(h?{l:g,c:w,h:S}:e),f}function Dr(t,e){let{fromColor:r,toColor:n}=t;r=[...r],n=[...n],r.length===3&&(r=r.concat([255])),n.length===3&&(n=n.concat([255]));let a=t.algorithm||"esriCIELabAlgorithm",s=Or(e),{numColors:h,distanceOffset:o,isCustomInterval:l,interpolateAlpha:u}=s;if(h===1&&o===0)return[r];if(h===2&&o===0&&!l)return[r,n];let i={r:r[0],g:r[1],b:r[2]},c={r:n[0],g:n[1],b:n[2]},p=a==="esriCIELabAlgorithm"?Do(de(i),de(c),s):a==="esriHSVAlgorithm"?Oo(Ot(i),Ot(c),s):Uo(me(i),me(c),s),C=[],g=r[3]??255,w=((n[3]??255)-g)/(h-1);for(let S=0;S<h;S++){let{r:f,g:d,b:m}=qe(p[S]),y=u?Math.round(g+w*S):255;C.push([f,d,m,y])}return C}function Go(t,e){let{numColors:r,interpolateAlpha:n}=Or(e),a=e?.weights,{colorRamps:s}=t;if(a){let c=a.reduce((p,C)=>p+C);a=a.map(p=>p/c)}else{a=[];for(let c=0;c<s.length;c++)a[c]=1/s.length}let h=[],o=1/(r-1),l=0,u=!1;for(let c=0;c<s.length;c++){let p=h.length,C=u?0:p*o-l;l+=a[c];let g=c===s.length-1?r-1-p:(a[c]-C)/o;if(u=Math.ceil(g)===g,g=Math.ceil(g),g===0)continue;let w=Dr(s[c],{numColors:g,interpolateAlpha:n,distanceOffset:C/a[c],distanceInterval:o/a[c]});h.push(...w)}let i=[...s[s.length-1].toColor];return i.length===3&&i.push(255),h.push(i),h}function No(t,e){let r=je(t)?t.toJSON():t;return r.type==="multipart"?Go(r,e):Dr(r,e)}function Be(t,e){let r=No(t,e),n=e?.interpolateAlpha;return r.forEach((a,s)=>{a.unshift(s),n||a.pop()}),r}function Rr(t){let e=Ot(t);return{type:"HsvColor",Hue:e.h,Saturation:e.s,Value:e.v,AlphaValue:255}}function Mr(t){return{Algorithm:t.toJSON()?.Algorithm||"esriHSVAlgorithm",type:"AlgorithmicColorRamp",FromColor:Rr(t.fromColor),ToColor:Rr(t.toColor)}}function qn(t){let e=Lo(t);if(!e)return null;if(t.type==="algorithmic")return Q(X({},Mr(t)),{Name:e});if(t.colorRamps){let r=t.colorRamps.map(Mr);return{type:"MultiPartColorRamp",NumColorRamps:r.length,ArrayOfColorRamp:r,Name:e}}return null}function Yn(t){let e=t.reverse().map(r=>{let n=r.toString(16);return n.length<2?"0"+n:n});return 4294967295&Number.parseInt(e.join(""),16)}function Bo(t){return["u8","s8"].includes(t.pixelType)&&t.statistics?.[0]?.min!=null&&t.statistics[0]?.max!=null&&t.bandCount===1}function Ur(t,e){let{attributeTable:r,bandCount:n}=t;return r==null&&Bo(t)?!0:!(r==null||n>1||e&&r.fields.find(a=>a.name.toLowerCase()===e.toLowerCase())==null)}function Gr(t){let{bandCount:e,dataType:r,pixelType:n}=t;return r==="elevation"||r==="generic"&&e===1&&(n==="s16"||n==="s32"||n==="f32"||n==="f64")}function Nr(t,e=!1){let{bandCount:r,colormap:n,pixelType:a}=t;return r===1&&(!!n?.length||!e&&a==="u8")}function $n(t,e=!1){let{attributeTable:r,bandCount:n}=t;return n===1&&(!e||r!=null||t.histograms!=null)}function Qn(t){let{dataType:e}=t;return e==="vector-uv"||e==="vector-magdir"}function ta(t){let{dataType:e}=t;return e==="vector-uv"||e==="vector-magdir"}var Rt=class extends yt{constructor(t){super(t)}bind(){let{rendererJSON:t}=this;if(!t)return{success:!1};let e;switch(this.lookup={rendererJSON:{}},t.type){case"uniqueValue":e=this._updateUVRenderer(t);break;case"rasterColormap":e=this._updateColormapRenderer(t);break;case"rasterStretch":e=this._updateStretchRenderer(t);break;case"classBreaks":e=this._updateClassBreaksRenderer(t);break;case"rasterShadedRelief":e=this._updateShadedReliefRenderer(t);break;case"vectorField":e=this._updateVectorFieldRenderer();break;case"flowRenderer":e=this._updateFlowRenderer()}return e}symbolize(t){let e=t?.pixelBlock;if(!Br(e))return e;if(t.simpleStretchParams&&this.rendererJSON.type==="rasterStretch")return this.simpleStretch(e,t.simpleStretchParams);try{let r;switch(e.pixels.length>3&&(e=e.extractBands(t.bandIds??[0,1,2])),this.rendererJSON.type){case"uniqueValue":case"rasterColormap":r=this._symbolizeColormap(e);break;case"classBreaks":r=this._symbolizeClassBreaks(e);break;case"rasterStretch":r=this._symbolizeStretch(e,t.bandIds);break;case"rasterShadedRelief":{let n=t.extent,a=n.spatialReference.isGeographic,s={x:(n.xmax-n.xmin)/e.width,y:(n.ymax-n.ymin)/e.height};r=this._symbolizeShadedRelief(e,{isGCS:a,resolution:s});break}}return r}catch(r){return fe.getLogger(this).error("symbolize",r.message),e}}simpleStretch(t,e){if(!Br(t))return t;try{return t.pixels.length>3&&(t=t.extractBands([0,1,2])),se(t,Q(X({},e),{isRenderer:!0}))}catch(r){return fe.getLogger(this).error("symbolize",r.message),t}}generateWebGLParameters(t){if(["uniqueValue","rasterColormap","classBreaks"].includes(this.rendererJSON.type)){let{indexedColormap:h,offset:o}=this.lookup.colormapLut||{};return{colormap:h,colormapOffset:o,type:"lut"}}let{pixelBlock:e,isGCS:r,resolution:n,bandIds:a}=t,{rendererJSON:s}=this;return s.type==="rasterStretch"?this._generateStretchWebGLParams(e,s,a):s.type==="rasterShadedRelief"?this._generateShadedReliefWebGLParams(s,r,n??void 0):s.type==="vectorField"?this._generateVectorFieldWebGLParams(s):null}_isLUTChanged(t){if(!this.lookup||!this.lookup.rendererJSON)return!0;if("colorRamp"in this.rendererJSON){let e=this.rendererJSON.colorRamp;return t?JSON.stringify(e)!==JSON.stringify(this.lookup.rendererJSON.colorRamp):(this.rendererJSON,this.lookup.rendererJSON,JSON.stringify(this.rendererJSON)!==JSON.stringify(this.lookup.rendererJSON))}return JSON.stringify(this.rendererJSON)!==JSON.stringify(this.lookup.rendererJSON)}_symbolizeColormap(t){return this._isLUTChanged()&&!this.bind().success?t:Xt(t,this.lookup.colormapLut)}_symbolizeClassBreaks(t){let{canUseIndexedLUT:e}=this._analyzeClassBreaks(this.rendererJSON);return this._isLUTChanged()&&!this.bind().success?t:e?Xt(t,this.lookup.colormapLut):Xe(t,this.lookup.remapLut??[])}_symbolizeStretch(t,e){let{rasterInfo:r}=this,{pixelType:n,bandCount:a}=r,s=this.rendererJSON,h=["u8","u16","s8","s16"].includes(n),o,l,{dra:u}=s,{gamma:i}=this.lookup;if(s.stretchType==="histogramEqualization"){let c=u?null:this.lookup?.histogramLut,p=Nt(s,{rasterInfo:r,pixelBlock:t,bandIds:e,returnHistogramLut:!c}),C=se(t,Q(X({},p),{gamma:i,isRenderer:!0}));l=ge(C,{lut:u?p.histogramLut:c,offset:0})}else if(h){if(u){let c=Nt(s,{rasterInfo:r,pixelBlock:t,bandIds:e});o=Me(Q(X({pixelType:n},c),{gamma:i,rounding:"floor"}))}else if(this._isLUTChanged()){if(!this.bind().success)return t;o=this.lookup?this.lookup.stretchLut:null}else o=this.lookup?this.lookup.stretchLut:null;if(!o)return t;a>1&&e!=null&&e.length===t?.pixels.length&&o?.lut.length===a&&(o={lut:e.map(c=>o.lut[c]),offset:o.offset}),l=ge(t,o)}else{let c=Nt(s,{rasterInfo:r,pixelBlock:t,bandIds:e});l=se(t,Q(X({},c),{gamma:i,isRenderer:!0}))}if(s.colorRamp){if(this._isLUTChanged(!0)&&!this.bind().success)return t;l=Xt(l,this.lookup?.colormapLut)}return l}_symbolizeShadedRelief(t,e){let r=this.rendererJSON,n=X(X({},r),e),a=xr(t,n);if(!r.colorRamp)return a;let s;if(this._isLUTChanged(!0)){if(!this.bind().success)return a;s=this.lookup?this.lookup.hsvMap:null}else s=this.lookup?this.lookup.hsvMap:null;if(!s)return a;let h=this.rasterInfo.statistics?.[0]??{min:0,max:8e3};return Ar(a,t,s,h),a}_isVectorFieldData(){let{bandCount:t,dataType:e}=this.rasterInfo;return t===2&&(e==="vector-magdir"||e==="vector-uv")}_updateVectorFieldRenderer(){return this._isVectorFieldData()?{success:!0}:{success:!1,error:`Unsupported data type "${this.rasterInfo.dataType}"; VectorFieldRenderer only supports "vector-magdir" and "vector-uv".`}}_updateFlowRenderer(){return this._isVectorFieldData()?{success:!0}:{success:!1,error:`Unsupported data type "${this.rasterInfo.dataType}"; FlowRenderer only supports "vector-magdir" and "vector-uv".`}}_updateUVRenderer(t){let{bandCount:e,attributeTable:r,pixelType:n}=this.rasterInfo,a=t.field1;if(!a)return{success:!1,error:"Unsupported renderer; missing UniqueValueRenderer.field."};let s=t.defaultSymbol,h=e===1&&["u8","s8"].includes(n);if(!Ur(this.rasterInfo,a)&&!h)return{success:!1,error:"Unsupported data; UniqueValueRenderer is only supported on single band data with a valid raster attribute table."};let o=[];if(r!=null){let u=r.fields.find(i=>i.name.toLowerCase()==="value");if(!u)return{success:!1,error:"Unsupported data; the data's raster attribute table does not have a value field."};r.features.forEach(i=>{let c=t.uniqueValueInfos?.find(C=>String(C.value)===String(i.attributes[a])),p=c?.symbol?.color;p?o.push([i.attributes[u.name]].concat(p)):s&&o.push([i.attributes[u.name]].concat(s.color))})}else{if(a.toLowerCase()!=="value")return{success:!1,error:'Unsupported renderer; UniqueValueRenderer.field must be "Value" when raster attribute table is not available.'};t.uniqueValueInfos?.forEach(u=>{let i=u?.symbol?.color;i?o.push([parseInt(""+u.value,10)].concat(i)):s&&o.push([parseInt(""+u.value,10)].concat(s?.color))})}if(o.length===0)return{success:!1,error:"Invalid UniqueValueRenderer. Cannot find matching records in the raster attribute table."};let l=Dt({colormap:o});return this.lookup={rendererJSON:t,colormapLut:l},this.canRenderInWebGL=Fe(l?.indexedColormap),{success:!0}}_updateColormapRenderer(t){if(!Nr(this.rasterInfo))return{success:!1,error:"Unsupported data; the data source does not have a colormap."};let e=t.colormapInfos.map(n=>[n.value].concat(n.color)).sort((n,a)=>n[0]-a[0]);if(!e||e.length===0)return{success:!1,error:"Unsupported renderer; ColormapRenderer must have meaningful colormapInfos."};let r=Dt({colormap:e});return this.lookup={rendererJSON:t,colormapLut:r},this.canRenderInWebGL=Fe(r?.indexedColormap),{success:!0}}_updateShadedReliefRenderer(t){if(!Gr(this.rasterInfo))return{success:!1,error:`Unsupported data type "${this.rasterInfo.dataType}"; ShadedReliefRenderer only supports "elevation", or single band float/s16 data.`};if(t.colorRamp){let e=Be(t.colorRamp,{interpolateAlpha:!0}),r=Dt({colormap:e}),n=[],a=r.indexedColormap;for(let s=0;s<a.length;s+=4){let h=Ot({r:a[s],g:a[s+1],b:a[s+2]});n.push([h.h/60,h.s/100,255*h.v/100])}this.lookup={rendererJSON:t,colormapLut:r,hsvMap:n}}else this.lookup=null;return this.canRenderInWebGL=!0,{success:!0}}_analyzeClassBreaks(t){let{attributeTable:e,pixelType:r}=this.rasterInfo,n=e!=null?e.fields.find(h=>h.name.toLowerCase()==="value"):null,a=e!=null?e.fields.find(h=>h.name.toLowerCase()===t.field.toLowerCase()):null,s=n!=null&&a!==null;return{canUseIndexedLUT:["u8","u16","s8","s16"].includes(r)||s,tableValueField:n,tableBreakField:a}}_updateClassBreaksRenderer(t){let{attributeTable:e}=this.rasterInfo,{canUseIndexedLUT:r,tableValueField:n,tableBreakField:a}=this._analyzeClassBreaks(t),s=t.classBreakInfos;if(!s?.length)return{success:!1,error:"Unsupported renderer; missing or invalid ClassBreaksRenderer.classBreakInfos."};let h=s.sort((c,p)=>c.classMaxValue-p.classMaxValue),o=h[h.length-1],l=t.minValue;if(!r){let c=[];for(let p=0;p<h.length;p++)c.push({value:h[p].classMinValue??l,mappedColor:h[p].symbol.color}),l=h[p].classMaxValue;return c.push({value:o.classMaxValue,mappedColor:o.symbol.color}),this.lookup={rendererJSON:t,remapLut:c},this.canRenderInWebGL=!1,{success:!0}}let u=[];if(e!=null&&n!=null&&a!==null&&n!==a){let c=n.name,p=a.name,C=h[h.length-1],{classMaxValue:g}=C;l=t.minValue;for(let w of e.features){let S=w.attributes[c],f=w.attributes[p],d=f===g?C:f<l?null:h.find(({classMaxValue:m})=>m>f);d&&u.push([S].concat(d.symbol.color))}}else{l=Math.floor(t.minValue);for(let c=0;c<h.length;c++){let p=h[c];for(let C=l;C<p.classMaxValue;C++)u.push([C].concat(p.symbol.color));l=Math.ceil(p.classMaxValue)}o.classMaxValue===l&&u.push([o.classMaxValue].concat(o.symbol.color))}let i=Dt({colormap:u,fillUnspecified:!1});return this.lookup={rendererJSON:t,colormapLut:i},this.canRenderInWebGL=Fe(i?.indexedColormap),{success:!0}}_updateStretchRenderer(t){let{stretchType:e,dra:r}=t;if(!(e==="none"||t.statistics?.length||Vo(this.rasterInfo.statistics)||r))return{success:!1,error:"Unsupported renderer; StretchRenderer.statistics is required when dynamic range adjustment is not used."};let n=t.histograms||this.rasterInfo.histograms;!Fo(t.stretchType)||n?.length||r||(e="minMax");let{computeGamma:a,useGamma:s,colorRamp:h}=t,{gamma:o}=t;if(s&&a&&!o?.length){let i=t.statistics?.length?t.statistics:this.rasterInfo.statistics;o=vr(this.rasterInfo.pixelType,i)}let l=this.rasterInfo.pixelType,u=!r&&["u8","u16","s8","s16"].includes(l);if(e==="histogramEqualization"){let i=n.map(c=>Re(c));this.lookup={rendererJSON:t,histogramLut:i}}else if(u){let i=Nt(t,{rasterInfo:this.rasterInfo}),c=Me(Q(X({pixelType:l},i),{gamma:s?o:null,rounding:"floor"}));this.lookup={rendererJSON:t,stretchLut:c}}if(h&&!_o(h)){let i=Be(h,{interpolateAlpha:!0});this.lookup||(this.lookup={rendererJSON:t}),this.lookup.colormapLut=Dt({colormap:i}),this.lookup.rendererJSON=t}return this.lookup.gamma=s&&o?.length?o:null,this.canRenderInWebGL=!0,{success:!0}}_generateStretchWebGLParams(t,e,r){let n=null,a=null,s=this.lookup?.colormapLut;e.colorRamp&&s&&(n=s.indexedColormap,a=s.offset),e.stretchType==="histogramEqualization"&&(e=Q(X({},e),{stretchType:"minMax"}));let{gamma:h}=this.lookup,o=!(!e.useGamma||!h?.some(m=>m!==1)),{minCutOff:l,maxCutOff:u,outMin:i,outMax:c}=Nt(e,{rasterInfo:this.rasterInfo,pixelBlock:t,bandIds:r}),p=0;t!=null&&(p=t.getPlaneCount(),p===2&&((t=t.clone()).statistics=[t.statistics[0]],t.pixels=[t.pixels[0]]));let{bandCount:C}=this.rasterInfo,g=Math.min(3,r?.length||p||C,C),w=new Float32Array(g),S=n||o?1:255,f;for(f=0;f<l.length;f++)w[f]=u[f]===l[f]?0:(c-i)/(u[f]-l[f])/S;let d=new Float32Array(g);if(o&&h)for(f=0;f<g;f++)h[f]>1?h[f]>2?d[f]=6.5+(h[f]-2)**2.5:d[f]=6.5+100*(2-h[f])**4:d[f]=1;return{bandCount:g,outMin:i/S,outMax:c/S,minCutOff:l,maxCutOff:u,factor:w,useGamma:o,gamma:o?h:[1,1,1],gammaCorrection:o?d:[1,1,1],colormap:n,colormapOffset:a,stretchType:e.stretchType,type:"stretch"}}_generateShadedReliefWebGLParams(t,e=!1,r={x:0,y:0}){let n=null,a=null,s=this.lookup?.colormapLut;t.colorRamp&&s&&(n=s.indexedColormap,a=s.offset);let h=Q(X({},t),{isGCS:e,resolution:r}),o=Ne(h),l=this.rasterInfo.statistics?.[0];return Q(X({},o),{minValue:l?.min??0,maxValue:l?.max??8e3,hillshadeType:t.hillshadeType==="traditional"?0:1,type:"hillshade",colormap:n,colormapOffset:a})}_generateVectorFieldWebGLParams(t){let{style:e,inputUnit:r,outputUnit:n,visualVariables:a,symbolTileSize:s,flowRepresentation:h}=t,o,l=this.rasterInfo.statistics?.[0].min??0,u=this.rasterInfo.statistics?.[0].max??50,i=a?.find(f=>f.type==="sizeInfo")??{type:"sizeInfo",field:"Magnitude",maxDataValue:u,maxSize:.8*s,minDataValue:l,minSize:.2*s},c=i.minDataValue??l,p=i.maxDataValue??u,C=i.maxSize!=null&&i.minSize!=null?[i.minSize/s,i.maxSize/s]:[.2,.8];if(e==="wind_speed"){let f=(C[0]+C[1])/2;C[0]=C[1]=f}let g=c!=null&&p!=null?[c,p]:null;if(e==="classified_arrow")if(c!=null&&p!=null&&i!=null){o=[];let f=(i.maxDataValue-i.minDataValue)/5;for(let d=0;d<6;d++)o.push(i.minDataValue+f*d)}else o=[0,1e-6,3.5,7,10.5,14];let w=h==="flow_to"==(e==="ocean_current_kn"||e==="ocean_current_m")?0:Math.PI,S=a?.find(f=>f.type==="rotationInfo");return{breakValues:o,dataRange:g,inputUnit:r,outputUnit:n,symbolTileSize:s,symbolPercentRange:C,style:e||"single_arrow",rotation:w,rotationType:this.rasterInfo.storageInfo?.tileInfo&&this.rasterInfo.dataType==="vector-uv"?"geographic":S?.rotationType||t.rotationType,type:"vectorField"}}};O([G({json:{write:!0}})],Rt.prototype,"rendererJSON",void 0),O([G({type:Ir,json:{write:!0}})],Rt.prototype,"rasterInfo",void 0),O([G({json:{write:!0}})],Rt.prototype,"lookup",void 0),O([G()],Rt.prototype,"canRenderInWebGL",void 0),Rt=O([gt("esri.renderers.support.RasterSymbolizer")],Rt);var ga=Rt;function Fe(t){return!!t?.length&&t.length<=16384}function Fo(t){return t==="percentClip"||t==="histogramEqualization"}function Vo(t){return t!=null&&t.length>0&&t[0].min!=null&&t[0].max!=null}function Br(t){return wt(t)&&t.validPixelCount!==0}function _o(t){return t.type==="algorithmic"&&["0,0,0,255","0,0,0"].includes(t.fromColor.join(","))&&["255,255,255,255","255,255,255"].includes(t.toColor.join(","))}export{ur as a,At as b,zt as c,ro as d,Ae as e,ae as f,pr as g,dr as h,no as i,ao as j,Ri as k,Mi as l,kr as m,Ir as n,Bt as o,Bn as p,Fn as q,Vn as r,Jn as s,Lr as t,Po as u,Lo as v,Kn as w,No as x,Be as y,qn as z,Yn as A,Ui as B,wr as C,Me as D,ko as E,_i as F,Ao as G,ji as H,Nt as I,Sr as J,se as K,Ur as L,Gr as M,Nr as N,$n as O,Qn as P,ta as Q,ga as R};
