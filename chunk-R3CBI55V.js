import{i as V}from"./chunk-QPP4HOHY.js";import{a as L,b as q,m as Z}from"./chunk-WQ4ZETPN.js";import{b as P,c as U,d as A,e as W}from"./chunk-DDHMQRMR.js";import"./chunk-7C77LBCZ.js";import"./chunk-LK52GLIE.js";import{f as E}from"./chunk-MP46524Y.js";import{b as R}from"./chunk-GH3IUQVA.js";import"./chunk-AC7AQWXQ.js";import"./chunk-BPPBSQ5N.js";import"./chunk-ESBNO4XM.js";import"./chunk-3A7OIH4J.js";import"./chunk-RMS5474O.js";import{d as z}from"./chunk-2SHNUN5D.js";import{a as F}from"./chunk-IFCRPPYQ.js";import"./chunk-IEUNGS56.js";import"./chunk-SPAOTNUK.js";import"./chunk-BYQI7UDX.js";import"./chunk-7WFRJSY3.js";import"./chunk-FUBITVJ7.js";import"./chunk-VOH7XGOR.js";import"./chunk-Y6HWUWZ3.js";import{a as w}from"./chunk-AQ74ANSJ.js";import"./chunk-5UCI4TUX.js";import"./chunk-SAOUSUZE.js";import"./chunk-PPFMRTTD.js";import"./chunk-IWJQ3PU6.js";import"./chunk-Z5Q76SB7.js";import"./chunk-TTN7UOJS.js";import"./chunk-5QLB7ZJ7.js";import"./chunk-E5R4OI7X.js";import"./chunk-7S6PD5JC.js";import"./chunk-ZWI7LLTZ.js";import"./chunk-6NCXSKJD.js";import"./chunk-4HUAEW4D.js";import"./chunk-XWRPBDYS.js";import"./chunk-TCCAOREC.js";import"./chunk-BCREO4Q5.js";import"./chunk-SO6OJFOM.js";import"./chunk-DG5QI6E2.js";import"./chunk-TMZNSBQB.js";import"./chunk-ZGLJFDS6.js";import"./chunk-RSDQHAJX.js";import"./chunk-OFVMJORF.js";import"./chunk-72VQRINQ.js";import"./chunk-R2RE6SI6.js";import"./chunk-2FYXACXP.js";import"./chunk-XGVKSCMM.js";import"./chunk-FX2VBPAM.js";import"./chunk-K4GPNFIS.js";import"./chunk-RP7XSKHE.js";import"./chunk-VV7MGXTC.js";import"./chunk-IXNVQC76.js";import"./chunk-LYPZUCFI.js";import"./chunk-QYC4ILGT.js";import"./chunk-HFQFGALU.js";import"./chunk-5TSEU5EE.js";import"./chunk-VC35VCVT.js";import"./chunk-MT7BXRRQ.js";import"./chunk-NNKLK2DS.js";import"./chunk-VU5W7W6Y.js";import"./chunk-BRGZVJPZ.js";import"./chunk-Z5NXR7SL.js";import"./chunk-7JLWSSXP.js";import"./chunk-W3WDPWBE.js";import"./chunk-JKP4I6UL.js";import"./chunk-TZHKPIVH.js";import"./chunk-JPDAKIWT.js";import"./chunk-W6LY37E4.js";import{s as O}from"./chunk-BRWS572J.js";import"./chunk-AKNRR36C.js";import{a as x,b as M,g as B}from"./chunk-JEGVIFEP.js";var J="picture-fill",N="picture-marker",Q="simple-fill",X="simple-line",Y="simple-marker",_="text",$="Aa",ee=L.size,j=L.maxSize,ae=L.maxOutlineSize,H=L.lineWidth,I=225,te=document.createElement("canvas");function K(a,e){let n=te.getContext("2d"),t=[];e&&(e.weight&&t.push(e.weight),e.size&&t.push(e.size+"px"),e.family&&t.push(e.family)),n.font=t.join(" ");let{width:r,actualBoundingBoxLeft:s,actualBoundingBoxRight:p,actualBoundingBoxAscent:h,actualBoundingBoxDescent:c}=n.measureText(a);return{width:Math.ceil(Math.max(r,s+p)),height:Math.ceil(h+c),x:Math.floor(s),y:Math.floor((h-c)/2)}}function k(a){let e=a?.size;return{width:e!=null&&typeof e=="object"&&"width"in e?w(e.width):null,height:e!=null&&typeof e=="object"&&"height"in e?w(e.height):null}}function ne(a,e){return B(this,null,function*(){let n=e.fill,t=a.color;if(n?.type==="pattern"&&t&&a.type!==J){let r=yield U(n.src,t.toCss(!0));n.src=r,e.fill=n}})}function le(a,e,n,t){return B(this,null,function*(){if(!("font"in a)||!a.font||e.shape.type!=="text")return;try{yield R(a.font)}catch{}let{width:r,height:s}=k(t);if(!/[\uE600-\uE6FF]/.test(e.shape.text)){let{width:p,height:h,x:c,y:d}=K(e.shape.text,{weight:e.font?.weight,size:e.font?.size,family:e.font?.family});n[0]=r??p,n[1]=s??h,e.shape.x=c,e.shape.y=d;let f=t?.rotation!=null?t.rotation:"angle"in a?a.angle:null;if(f){let l=f*(Math.PI/180),o=Math.abs(Math.sin(l)),v=Math.abs(Math.cos(l));n[1]=n[0]*o+n[1]*v}}})}function oe(a,e,n,t,r){if(a.haloColor!=null&&a.haloSize!=null){r.masking??=n.map(()=>[]);let s=w(a.haloSize);t[0]+=s,t[1]+=s,n.unshift([M(x({},e),{fill:null,stroke:{color:a.haloColor,width:2*s,join:"round",cap:"round"}})]),r.masking.unshift([{shape:{type:"rect",x:0,y:0,width:t[0]+2*z,height:t[1]+2*z},fill:[255,255,255],stroke:null},M(x({},e),{fill:[0,0,0,0],stroke:null})])}a.backgroundColor==null&&a.borderLineColor==null||(t[0]+=2*z,t[1]+=2*z,n.unshift([{shape:{type:"rect",x:0,y:0,width:t[0],height:t[1]},fill:a.backgroundColor,stroke:{color:a.borderLineColor,width:w(a.borderLineSize)}}]),r.masking?.unshift([]))}function G(a,e){return a>e?"dark":"light"}function ie(a,e){let n=typeof e?.size=="number"?e?.size:null,t=n!=null?w(n):null,r=e?.maxSize!=null?w(e.maxSize):null,s=e?.rotation!=null?e.rotation:"angle"in a?a.angle:null,p=P(a),h=A(a);se(a,245)!=="dark"||e?.ignoreWhiteSymbols||(h=M(x({width:.75},h),{color:"#bdc3c7"}));let c={shape:null,fill:p,stroke:h,offset:[0,0]};h?.width&&(h.width=Math.min(h.width,ae));let d=h?.width||0,f=e?.size!=null&&(e?.scale==null||e?.scale),l=0,o=0,v=!1;switch(a.type){case Y:{let u=a.style,{width:m,height:i}=k(e),b=m===i&&m!=null?m:t??Math.min(w(a.size),r||j);switch(l=b,o=b,u){case"circle":c.shape={type:"circle",cx:0,cy:0,r:.5*b},f||(l+=d,o+=d);break;case"cross":c.shape={type:"path",path:[{command:"M",values:[0,.5*o]},{command:"L",values:[l,.5*o]},{command:"M",values:[.5*l,0]},{command:"L",values:[.5*l,o]}]};break;case"diamond":c.shape={type:"path",path:[{command:"M",values:[0,.5*o]},{command:"L",values:[.5*l,0]},{command:"L",values:[l,.5*o]},{command:"L",values:[.5*l,o]},{command:"Z",values:[]}]},f||(l+=d,o+=d);break;case"square":c.shape={type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[l,0]},{command:"L",values:[l,o]},{command:"L",values:[0,o]},{command:"Z",values:[]}]},f||(l+=d,o+=d),s&&(v=!0);break;case"triangle":c.shape={type:"path",path:[{command:"M",values:[.5*l,0]},{command:"L",values:[l,o]},{command:"L",values:[0,o]},{command:"Z",values:[]}]},f||(l+=d,o+=d),s&&(v=!0);break;case"x":c.shape={type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[l,o]},{command:"M",values:[l,0]},{command:"L",values:[0,o]}]},s&&(v=!0);break;case"path":c.shape={type:"path",path:a.path||""},f||(l+=d,o+=d),s&&(v=!0),f=!0}break}case X:{let{width:u,height:m}=k(e),i=W(h).reduce((D,C)=>D+C,0),b=i&&Math.ceil(H/i),g=m??t??d,y=u??(i*b||H);h&&(h.width=g),l=y,o=g,f=!0,c.shape={type:"path",path:[{command:"M",values:[g/2,o/2]},{command:"L",values:[l-g/2,o/2]}]};break}case J:case Q:{let u=typeof e?.symbolConfig=="object"&&!!e?.symbolConfig?.isSquareFill,{width:m,height:i}=k(e);l=!u&&m!==i||m==null?t??ee:m,o=!u&&m!==i||i==null?l:i,f||(l+=d,o+=d),f=!0,c.shape=u?{type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[l,0]},{command:"L",values:[l,o]},{command:"L",values:[0,o]},{command:"L",values:[0,0]},{command:"Z",values:[]}]}:q.fill[0];break}case N:{let u=Math.min(w(a.width),r||j),m=Math.min(w(a.height),r||j),{width:i,height:b}=k(e),g=i===b&&i!=null?i:t??Math.max(u,m),y=u/m;l=y<=1?Math.ceil(g*y):g,o=y<=1?g:Math.ceil(g/y),c.shape={type:"image",x:-Math.round(l/2),y:-Math.round(o/2),width:l,height:o,src:a.url||""},s&&(v=!0);break}case _:{let u=a,m=e?.overrideText||u.text||$,i=u.font,{width:b,height:g}=k(e),y=g??t??Math.min(w(i.size),r||j),{width:D,height:C}=K(m,{weight:i.weight,size:y,family:i.family}),S=/[\uE600-\uE6FF]/.test(m);l=b??(S?y:D),o=S?y:C;let T=.5*(S?y:C);S&&(T+=5),c.shape={type:"text",text:m,x:u.xoffset||0,y:u.yoffset||T,align:"middle",alignBaseline:u.verticalAlignment,decoration:i&&i.decoration,rotated:u.rotated,kerning:u.kerning},c.font=i&&{size:y,style:i.style,decoration:i.decoration,weight:i.weight,family:i.family};break}}return{shapeDescriptor:c,size:[l,o],renderOptions:{node:e?.node,scale:f,opacity:e?.opacity,rotation:s,useRotationSize:v,effectView:e?.effectView,ariaLabel:e?.ariaLabel}}}function ye(a,e){return B(this,null,function*(){let{shapeDescriptor:n,size:t,renderOptions:r}=ie(a,e);if(!n.shape)throw new O("symbolPreview: renderPreviewHTML2D","symbol not supported.");yield ne(a,n),yield le(a,n,t,e);let s=[[n]];if(typeof e?.symbolConfig=="object"&&e?.symbolConfig?.applyColorModulation){let p=.6*t[0];s.unshift([M(x({},n),{offset:[-p,0],fill:Z(n.fill,-.3)})]),s.push([M(x({},n),{offset:[p,0],fill:Z(n.fill,.3)})]),t[0]+=2*p,r.scale=!1}return a.type==="text"&&oe(a,n,s,t,r),V(s,t,r)})}function se(a,e=I){let n=P(a),t=A(a),r=!n||"type"in n?null:new F(n),s=t?.color?new F(t?.color):null,p=r?G(E(r),e):null,h=s?G(E(s),e):null;return h?p?p===h?p:e>=I?"light":"dark":h:p}export{se as getContrastingBackgroundTheme,ie as getRenderSymbolParameters,ye as previewSymbol2D};
