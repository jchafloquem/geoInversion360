import{a as j}from"./chunk-4ZBUTOIE.js";import{a as b}from"./chunk-GGQ2PCO6.js";import{a as m}from"./chunk-WDTJILD4.js";import{a as H}from"./chunk-6NTMQUAJ.js";import{c as F}from"./chunk-PHCUTV4M.js";import{a as R}from"./chunk-GHKFJTCN.js";import{a as $}from"./chunk-IZF35GKA.js";import{a as E}from"./chunk-EB5RRWIA.js";import{a as v}from"./chunk-RWIKH4KN.js";import{a as G}from"./chunk-IEUO5FDE.js";import{a as N}from"./chunk-ALZMTSHO.js";import{a as B}from"./chunk-HIQGSNLD.js";import{a as P}from"./chunk-QU77E3KV.js";import{a as c}from"./chunk-FUBITVJ7.js";import{a as V}from"./chunk-N566L3JG.js";import{a as C}from"./chunk-SO6OJFOM.js";import{a as L}from"./chunk-DG5QI6E2.js";import{a as f,c as A,f as g,h as T}from"./chunk-2FYXACXP.js";import{b as u}from"./chunk-RP7XSKHE.js";import{I as p,k as M}from"./chunk-Z5NXR7SL.js";import{S as h,b as I}from"./chunk-7JLWSSXP.js";import{a as l}from"./chunk-W3WDPWBE.js";import{k as O,w as x,y as S}from"./chunk-JKP4I6UL.js";import{q as d}from"./chunk-BRWS572J.js";import{g as y}from"./chunk-JEGVIFEP.js";function k(e){return new b({getCollections:()=>[e.tables,e.layers],getChildrenFunction:r=>{let t=[];return"tables"in r&&t.push(r.tables),"layers"in r&&t.push(r.layers),t},itemFilterFunction:r=>{let t=r.parent;return!!t&&"tables"in t&&t.tables.includes(r)}})}function D(e){for(let r of e.values())r?.destroy();e.clear()}function w(e,r,t){let i,s;if(e)for(let a=0,o=e.length;a<o;a++){if(i=e.at(a),i?.[r]===t)return i;if(i?.type==="group"&&(s=w(i.layers,r,t),s))return s}}var J=e=>{let r=class extends e{constructor(...t){super(...t),this.layers=new u;let i=o=>{o.parent&&"remove"in o.parent&&o.parent.remove(o)},s=o=>{o.parent=this,this.layerAdded(o),o.type!=="elevation"&&o.type!=="base-elevation"||d.getLogger(this).error(`Layer 'title:${o.title}, id:${o.id}' of type '${o.type}' is not supported as an operational layer and will therefore be ignored.`)},a=o=>{o.parent=null,this.layerRemoved(o)};this.addHandles([this.layers.on("before-add",o=>{if(o.item===this)return o.preventDefault(),void d.getLogger(this).error("#add()","Cannot add layer to itself.");i(o.item)}),this.layers.on("after-add",o=>s(o.item)),this.layers.on("after-remove",o=>a(o.item))])}destroy(){let t=this.layers.toArray();for(let i of t)i.destroy();this.layers.destroy()}set layers(t){this._set("layers",c(t,this._get("layers")))}add(t,i){let s=this.layers;if(i=s.getNextIndex(i),t instanceof v){let a=t;a.parent===this?this.reorder(a,i):s.add(a,i)}else x(t)?t.then(a=>{this.destroyed||this.add(a,i)}):d.getLogger(this).error("#add()","The item being added is not a Layer or a Promise that resolves to a Layer.")}addMany(t,i){let s=this.layers,a=s.getNextIndex(i);t.slice().forEach(o=>{o.parent!==this?(s.add(o,a),a+=1):this.reorder(o,a)})}findLayerById(t){return w(this.layers,"id",t)}findLayerByUid(t){return w(this.layers,"uid",t)}remove(t){return this.layers.remove(t)}removeMany(t){return this.layers.removeMany(t)}removeAll(){return this.layers.removeAll()}reorder(t,i){return this.layers.reorder(t,i)}layerAdded(t){}layerRemoved(t){}};return l([p()],r.prototype,"layers",null),r=l([h("esri.support.LayersMixin")],r),r};function _(e,r,t){if(e)for(let i=0,s=e.length;i<s;i++){let a=e.at(i);if(a[r]===t)return a;if(a?.type==="group"){let o=_(a.tables,r,t);if(o)return o}}}var U=e=>{let r=class extends e{constructor(...t){super(...t),this.tables=new u,this.addHandles([this.tables.on("after-add",i=>{let s=i.item;s.parent&&s.parent!==this&&"tables"in s.parent&&s.parent.tables.remove(s),s.parent=this,s.type!=="feature"&&d.getLogger(this).error(`Layer 'title:${s.title}, id:${s.id}' of type '${s.type}' is not supported as a table and will therefore be ignored.`)}),this.tables.on("after-remove",i=>{i.item.parent=null})])}destroy(){let t=this.tables.toArray();for(let i of t)i.destroy();this.tables.destroy()}set tables(t){this._set("tables",c(t,this._get("tables")))}findTableById(t){return _(this.tables,"id",t)}findTableByUid(t){return _(this.tables,"uid",t)}};return l([p()],r.prototype,"tables",null),r=l([h("esri.support.TablesMixin")],r),r};var n=class extends F(R($(H(U(J(E(v))))))){constructor(e){super(e),this.allLayers=new b({getCollections:()=>[this.layers],getChildrenFunction:r=>"layers"in r?r.layers:null}),this.allTables=k(this),this.fullExtent=void 0,this.operationalLayerType="GroupLayer",this.spatialReference=void 0,this.type="group",this._debouncedSaveOperations=S((r,t,i)=>y(this,null,function*(){let{save:s,saveAs:a}=yield import("./chunk-JJT6VLP3.js");switch(r){case m.SAVE:return s(this,t);case m.SAVE_AS:return a(this,i,t)}}))}initialize(){this._enforceVisibility(this.visibilityMode,this.visible),this.addHandles([f(()=>{let e=this.parent;for(;e&&"parent"in e&&e.parent;)e=e.parent;return e&&j in e},e=>{let r="prevent-adding-tables";this.removeHandles(r),e&&(this.tables.removeAll(),this.addHandles(A(()=>this.tables,"before-add",t=>{t.preventDefault(),d.getLogger(this).errorOnce("tables","tables in group layers in a webscene are not supported. Please move the tables from the group layer to the webscene if you want to persist them.")}),r))},T),f(()=>this.visible,this._onVisibilityChange.bind(this),g)])}destroy(){this.allLayers.destroy(),this.allTables.destroy()}get sourceIsPortalItem(){return this.portalItem&&this.originIdOf("portalItem")===M.USER}_writeLayers(e,r,t,i){let s=[];if(!e)return s;e.forEach(a=>{let o=B(a,i.webmap?i.webmap.getLayerJSONFromResourceInfo(a):null,i);o?.layerType&&s.push(o)}),r.layers=s}set portalItem(e){this._set("portalItem",e)}readPortalItem(e,r,t){let{itemId:i,layerType:s}=r;if(s==="GroupLayer"&&i)return new V({id:i,portal:t?.portal})}writePortalItem(e,r){e?.id&&(r.itemId=e.id)}set visibilityMode(e){let r=this._get("visibilityMode")!==e;this._set("visibilityMode",e),r&&this._enforceVisibility(e,this.visible)}beforeSave(){return y(this,null,function*(){return G(this)})}load(e){let r=this.loadFromPortal({supportedTypes:["Feature Service","Feature Collection","Group Layer","Scene Service"],layerModuleTypeMap:N},e).catch(t=>{if(O(t),this.sourceIsPortalItem)throw t});return this.addResolvingPromise(r),Promise.resolve(this)}loadAll(){return y(this,null,function*(){return P(this,e=>{e(this.layers,this.tables)})})}save(e){return y(this,null,function*(){return this._debouncedSaveOperations(m.SAVE,e)})}saveAs(e,r){return y(this,null,function*(){return this._debouncedSaveOperations(m.SAVE_AS,r,e)})}layerAdded(e){e.visible&&this.visibilityMode==="exclusive"?this._turnOffOtherLayers(e):this.visibilityMode==="inherited"&&(e.visible=this.visible),this.hasHandles(e.uid)?console.error(`Layer read to Grouplayer: uid=${e.uid}`):this.addHandles(f(()=>e.visible,r=>this._onChildVisibilityChange(e,r),g),e.uid)}layerRemoved(e){this.removeHandles(e.uid),this._enforceVisibility(this.visibilityMode,this.visible)}_turnOffOtherLayers(e){this.layers.forEach(r=>{r!==e&&(r.visible=!1)})}_enforceVisibility(e,r){if(!I(this).initialized)return;let t=this.layers,i=t.find(s=>s.visible);switch(e){case"exclusive":t.length&&!i&&(i=t.at(0),i.visible=!0),this._turnOffOtherLayers(i);break;case"inherited":t.forEach(s=>{s.visible=r})}}_onVisibilityChange(e){this.visibilityMode==="inherited"&&this.layers.forEach(r=>{r.visible=e})}_onChildVisibilityChange(e,r){switch(this.visibilityMode){case"exclusive":r?this._turnOffOtherLayers(e):this._isAnyLayerVisible()||(e.visible=!0);break;case"inherited":e.visible=this.visible}}_isAnyLayerVisible(){return this.layers.some(e=>e.visible)}};l([p({readOnly:!0,dependsOn:[]})],n.prototype,"allLayers",void 0),l([p({readOnly:!0})],n.prototype,"allTables",void 0),l([p({json:{read:!0,write:!0}})],n.prototype,"blendMode",void 0),l([p()],n.prototype,"fullExtent",void 0),l([p({readOnly:!0})],n.prototype,"sourceIsPortalItem",null),l([p({json:{read:!1,write:{ignoreOrigin:!0}}})],n.prototype,"layers",void 0),l([L("layers")],n.prototype,"_writeLayers",null),l([p({type:["GroupLayer"]})],n.prototype,"operationalLayerType",void 0),l([p({json:{origins:{"web-map":{read:!1,write:{overridePolicy(e,r,t){return{enabled:e?.type==="Group Layer"&&t?.initiator!==this}}}},"web-scene":{read:!1,write:!1}}}})],n.prototype,"portalItem",null),l([C("web-map","portalItem",["itemId"])],n.prototype,"readPortalItem",null),l([L("web-map","portalItem",{itemId:{type:String}})],n.prototype,"writePortalItem",null),l([p()],n.prototype,"spatialReference",void 0),l([p({json:{read:!1},readOnly:!0,value:"group"})],n.prototype,"type",void 0),l([p({type:["independent","inherited","exclusive"],value:"independent",json:{write:!0,origins:{"web-map":{type:["independent","exclusive"],write:(e,r,t)=>{e!=="inherited"&&(r[t]=e)}}}}})],n.prototype,"visibilityMode",null),n=l([h("esri.layers.GroupLayer")],n);var ze=n;export{k as a,D as b,J as c,U as d,ze as e};
