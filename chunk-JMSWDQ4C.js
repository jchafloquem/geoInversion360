import{a as Sn,b as Kc,c as Yc,d as Qc,e as Xc}from"./chunk-3RTUR5RQ.js";import{a as B,b as Rc,c as xt}from"./chunk-26SKQHBO.js";import{a as Se,b as Co,c as To,d as Dc,e as $e,g as Vc,h as Ac,j as zc,k as Fc,l as Oc,m as Nc,n as $c,o as Hc,p as Bc,q as Wc,r as Uc,s as _n,t as Gc,v as Zc,w as bn,x as qc,z as jc}from"./chunk-3AHP4NH4.js";import{a as fn}from"./chunk-QAJCY744.js";import{a as xn}from"./chunk-BKLTKOZS.js";import{b as Jc}from"./chunk-A74TRSYK.js";import{a as cc,b as Lo}from"./chunk-4ZJCWL5T.js";import{a as $,b as Ke,c as nc,d as Ee,e as $i,f as ac,g as lc,h as bo,i as pc,j as So,k as fc,l as gc,m as Ic,n as Ec,o as St,p as Pc,r as kc,t as xo}from"./chunk-WHLV5SNG.js";import{h as uc,i as mc}from"./chunk-QPP4HOHY.js";import{a as hc}from"./chunk-WQ4ZETPN.js";import{a as wn,b as Sc,c as xc,d as Cc}from"./chunk-TMKRZUEM.js";import{a as dc,b as Tc,c as Lc,d as Mc}from"./chunk-YQKTNFZY.js";import{d as yc,e as vc,g as wc,h as gn,i as _c,j as yn,k as bc,l as vn}from"./chunk-6YY7MALF.js";import{a as rc}from"./chunk-R4ZRZJFL.js";import{a as sc}from"./chunk-F2TG7X3S.js";import{a as oc,b as hn,c as un}from"./chunk-NLPSVYXX.js";import{a as tc,i as ic,o as dn}from"./chunk-DDHMQRMR.js";import{a as Qp,b as _o,c as Xp,d as Jp,e as ec}from"./chunk-YBJFSBAU.js";import{a as di}from"./chunk-GGQ2PCO6.js";import{a as cn}from"./chunk-YUIUJIOR.js";import{b as jp,c as Kp}from"./chunk-IGLWZTM3.js";import{a as Gt}from"./chunk-RXT7IR37.js";import{a as Cs}from"./chunk-FJJ2HK4Z.js";import{a as wo}from"./chunk-OTCE2CL6.js";import{d as qp}from"./chunk-KFCU4KQY.js";import{c as pp}from"./chunk-7C77LBCZ.js";import{a as Yp}from"./chunk-TH7OTU7Q.js";import{a as vo}from"./chunk-UH6DTPOD.js";import{d as Zp,e as Ms}from"./chunk-N3BNSVOS.js";import{a as ln}from"./chunk-WPJ6OJRK.js";import{a as Bp}from"./chunk-MJN6ZDZD.js";import{a as Vp,b as Ap}from"./chunk-HMLFVNCH.js";import{a as an}from"./chunk-I46ARENO.js";import{c as Fp,e as Op,g as Np,j as $p,k as Hp}from"./chunk-AC7AQWXQ.js";import{a as Dp}from"./chunk-EZIYNRHJ.js";import{b as nn}from"./chunk-37H4LYIE.js";import{a as zp}from"./chunk-4FSVG2A5.js";import{a as ct,b as pn}from"./chunk-3Q427ME6.js";import{a as yo}from"./chunk-MAPO7YGF.js";import{n as go}from"./chunk-OLIJD5I4.js";import{a as Xl,b as Vi}from"./chunk-OOE2LCNP.js";import{a as Rp}from"./chunk-I3S324BU.js";import{o as Gp}from"./chunk-ESBNO4XM.js";import{a as Wp,b as Up}from"./chunk-RMS5474O.js";import{k as ci,m as Ni}from"./chunk-2SHNUN5D.js";import{a as ye}from"./chunk-IFCRPPYQ.js";import{a as sn,b as hp,d as up}from"./chunk-GYYF3HMQ.js";import{a as Oi}from"./chunk-2EA2KAER.js";import{b as Ip,c as Ep,g as Pp,h as on,i as kp}from"./chunk-MJ4RSERD.js";import{a as Fi,b as Cp,d as Tp,f as Lp,n as pi}from"./chunk-J57HR4DB.js";import{a as Ut}from"./chunk-Y5GQJM6D.js";import{a as ai,b as li}from"./chunk-V34KIKJR.js";import{d as rn}from"./chunk-MXSUS5HK.js";import{a as Ql}from"./chunk-EK4W5QYS.js";import{b as Jl}from"./chunk-SPJDFBYB.js";import{a as Mp}from"./chunk-IEUNGS56.js";import{c as xp}from"./chunk-RQQJT345.js";import{a as mp,b as fp,c as gp,d as yp,e as vp,f as wp,g as _p,h as bp}from"./chunk-CD7FGRAU.js";import{b as Zt}from"./chunk-G4NJ66JB.js";import{a as Tl}from"./chunk-QU77E3KV.js";import{a as ep,b as tp,c as ip,d as Wt,e as sp,f as op,k as rp,m as np,n as ap}from"./chunk-3JLZ7SFH.js";import{a as ao}from"./chunk-FUBITVJ7.js";import{a as cp}from"./chunk-Y6HWUWZ3.js";import{a as lt,b as lp,d as X}from"./chunk-AQ74ANSJ.js";import{a as dp}from"./chunk-TTN7UOJS.js";import{c as mn}from"./chunk-7S6PD5JC.js";import{a as at}from"./chunk-ZWI7LLTZ.js";import{b as Ai,d as Sp,f as zi,g as pt,q as fo}from"./chunk-ATXTHXJA.js";import{o as Yl}from"./chunk-4HUAEW4D.js";import{b as Fl}from"./chunk-XWRPBDYS.js";import{a as Ne,c as Gl,g as Zl,h as ql,j as jl,l as Kl}from"./chunk-TCCAOREC.js";import{c as Xr,d as Jr,f as lo,i as Vl,k as Al,l as N,m as po,o as zl,v as Oe}from"./chunk-SO6OJFOM.js";import{a as Ll,b as se}from"./chunk-DG5QI6E2.js";import{b as tn,d as Ls,f as bt,g as Hl,j as mo,l as Bl,m as Wl,p as Ul}from"./chunk-TMZNSBQB.js";import{C as en,a as Ts,k as Nl,m as $l,n as ho,u as uo}from"./chunk-ZGLJFDS6.js";import{a as co,c as Ol}from"./chunk-RSDQHAJX.js";import{B as kl,D as Rl,Y as Dl,d as jr,g as Ml,h as Kr,j as xs,k as je,l as Yr,m as Ri,p as Di,r as _t,s as Il,u as El,v as Pl,x as Qr}from"./chunk-OFVMJORF.js";import{a as oo,b as ro,c as Gr,d as Zr,e as Ie,f as re,g as Q}from"./chunk-6OZZJZHT.js";import{b as Ss,g as u}from"./chunk-72VQRINQ.js";import{c as Cl}from"./chunk-MDSLION2.js";import{f as Sl,g as Bt,i as xl}from"./chunk-R2RE6SI6.js";import{a as _,b as le,c as fe,d as nt,e as bl,f as wt,g as O,h as Me}from"./chunk-2FYXACXP.js";import{b as to,c as ni}from"./chunk-XGVKSCMM.js";import{b as io}from"./chunk-FX2VBPAM.js";import{a as Ur,b as vl}from"./chunk-K4GPNFIS.js";import{b as D}from"./chunk-RP7XSKHE.js";import{a as Le}from"./chunk-VV7MGXTC.js";import{c as _l,e as ki}from"./chunk-IXNVQC76.js";import{a as no,b as wl}from"./chunk-LYPZUCFI.js";import{a as ri,c as Pi}from"./chunk-HFQFGALU.js";import{a as ge}from"./chunk-VC35VCVT.js";import{a as yl}from"./chunk-MT7BXRRQ.js";import{a as so}from"./chunk-NNKLK2DS.js";import{O as fl,Y as gl,aa as qr}from"./chunk-BRGZVJPZ.js";import{B as cl,I as l,L as C,R as ml,T as Ei,d as Or,f as Xa,g as Nr,h as Js,i as Mi,k as Ii,o as bs,r as pl,s as qe}from"./chunk-Z5NXR7SL.js";import{H as Br,M as Wr,S as y,s as Ht,t as dl,y as hl,z as ul}from"./chunk-7JLWSSXP.js";import{a}from"./chunk-W3WDPWBE.js";import{a as st,c as ot,e as el,g as $r,h as ae,j as tl,m as eo,o as il,p as rt,q as Hr,s as sl,u as ol,v as rl,w as nl,y as al,z as oi}from"./chunk-JKP4I6UL.js";import{b as oe,d as ue,e as _s,h as Ja}from"./chunk-TZHKPIVH.js";import{a as ll}from"./chunk-JPDAKIWT.js";import{U as Ya}from"./chunk-4D3TEMZK.js";import{b as ws,o as Qa,q as P,s as x}from"./chunk-BRWS572J.js";import{a as ie,f as Fr,m as we}from"./chunk-AKNRR36C.js";import{a as A,b as he,g as v}from"./chunk-JEGVIFEP.js";var Ye;(function(e){e[e.NORTH=0]="NORTH",e[e.NORTH_EAST=1]="NORTH_EAST",e[e.EAST=2]="EAST",e[e.SOUTH_EAST=3]="SOUTH_EAST",e[e.SOUTH=4]="SOUTH",e[e.SOUTH_WEST=5]="SOUTH_WEST",e[e.WEST=6]="WEST",e[e.NORTH_WEST=7]="NORTH_WEST"})(Ye||(Ye={}));function ed(e){return Cn(e)||kl(e)||Rl(e)}function Cn(e){return Pl(e)||Qr(e)}var Xu=12,xe=class e{constructor(t){let i=e.checkUnsupported(t);if(i!=null)throw i;let s=t;this.spatialReference=s.spatialReference,this._isWebMercator=this.spatialReference.isWebMercator,this._isGCS=El(this.spatialReference),this.origin=[s.origin.x,s.origin.y],this.pixelSize=s.size[0],this.dpi=s.dpi;let o=s.lods.reduce((d,h)=>(h.level<d.minLod.level&&(d.minLod=h),d.max=Math.max(d.max,h.level),d),{minLod:s.lods[0],max:-1/0}),r=o.minLod,n=2**r.level,p=r.resolution*n,c=r.scale*n;this.levels=new Array(o.max+1);for(let d=0;d<this.levels.length;d++)this.levels[d]={resolution:p,scale:c,tileSize:[p*s.size[0],p*s.size[1]]},p/=2,c/=2}clone(){return new e(this.toTileInfo())}toTileInfo(){return new li({dpi:this.dpi,origin:new N({x:this.origin[0],y:this.origin[1],spatialReference:this.spatialReference}),size:[this.pixelSize,this.pixelSize],spatialReference:this.spatialReference,lods:this.levels.map((t,i)=>new ai({level:i,scale:t.scale,resolution:t.resolution}))})}getExtent(t,i,s,o){let r=this.levels[t],n=r.tileSize[0],p=r.tileSize[1];o[0]=this.origin[0]+s*n,o[2]=this.origin[0]+(s+1)*n,o[3]=this.origin[1]-i*p,o[1]=this.origin[1]-(i+1)*p}convertExtentToRadians(t,i){this._isWebMercator?(i[0]=Xr(t[0]),i[1]=Jr(t[1]),i[2]=Xr(t[2]),i[3]=Jr(t[3])):this._isGCS&&(i[0]=bt(t[0]),i[1]=bt(t[1]),i[2]=bt(t[2]),i[3]=bt(t[3]))}getExtentGeometry(t,i,s,o=new Oe){return this.getExtent(t,i,s,dt),o.spatialReference=this.spatialReference,o.xmin=dt[0],o.ymin=dt[1],o.xmax=dt[2],o.ymax=dt[3],o.zmin=void 0,o.zmax=void 0,o}ensureMaxLod(t){if(t==null)return!1;let i=!1;for(;this.levels.length<=t;){let{resolution:s,scale:o}=this.levels[this.levels.length-1],r=s/2*this.pixelSize;this.levels.push({resolution:s/2,scale:o/2,tileSize:[r,r]}),i=!0}return i}capMaxLod(t){this.levels.length>t+1&&(this.levels.length=t+1)}getMaxLod(){return this.levels.length-1}scaleAtLevel(t){return this.levels[0].scale/2**t}levelAtScale(t){let i=this.levels[0].scale;return t>=i?0:Math.log(i/t)*Math.LOG2E}resolutionAtLevel(t){return this.levels[0].resolution/2**t}compatibleWith(t,i=1/0){if(e.checkUnsupported(t))return!1;let s=new e(t);if(!s.spatialReference.equals(this.spatialReference)||s.pixelSize!==this.pixelSize)return!1;let o=Math.min(this.levels.length-1,s.levels.length-1,i),r=this.levels[o].resolution,n=.5*r;return!mo(s.origin[0],this.origin[0],n)||!mo(s.origin[1],this.origin[1],n)?!1:(n=.5*r/2**o/this.pixelSize*Xu,mo(r,s.levels[o].resolution,n))}rootTilesInExtent(t,i=null,s=1/0){let o=new Array,r=this.levels[0].tileSize;if(t==null||r[0]===0||r[1]===0)return o;e.computeRowColExtent(t,r,this.origin,dt);let n=dt[1],p=dt[3],c=dt[0],d=dt[2],h=d-c,m=p-n;if(h*m>s){let f=Math.floor(Math.sqrt(s));m>f&&(n=n+Math.floor(.5*m)-Math.floor(.5*f),p=n+f),h>f&&(c=c+Math.floor(.5*h)-Math.floor(.5*f),d=c+f)}for(let f=n;f<p;f++)for(let w=c;w<d;w++)o.push([0,f,w]);return i!=null&&(i[0]=this.origin[0]+c*r[0],i[1]=this.origin[1]-p*r[1],i[2]=this.origin[0]+d*r[0],i[3]=this.origin[1]-n*r[1]),o}static computeRowColExtent(t,i,s,o){let r=.001*(t[2]-t[0]+(t[3]-t[1]));o[0]=Math.max(0,Math.floor((t[0]+r-s[0])/i[0])),o[2]=Math.max(0,Math.ceil((t[2]-r-s[0])/i[0])),o[1]=Math.max(0,Math.floor((s[1]-t[3]+r)/i[1])),o[3]=Math.max(0,Math.ceil((s[1]-t[1]-r)/i[1]))}static isPowerOfTwo(t){let i=t.lods,s=i[0].resolution*2**i[0].level;return!i.some(o=>!Bl(o.resolution,s/2**o.level))}static hasGapInLevels(t){let i=t.lods.map(s=>s.level);i.sort((s,o)=>s-o);for(let s=1;s<i.length;s++)if(i[s]!==i[0]+s)return!0;return!1}static tileSizeSupported(t){let i=t.size[1];return i===t.size[0]&&!(i&i-1)&&i>=128&&i<=512}static hasOriginPerLODs(t){let i=t.origin;return t.lods.some(s=>s.origin!=null&&(s.origin[0]!==i.x||s.origin[1]!==i.y))}static getMissingTileInfoError(){return new x("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}static checkUnsupported(t){return t==null?Is():t.lods.length<1?new x("tilingscheme:generic","Tiling scheme must have at least one level"):e.isPowerOfTwo(t)?e.hasGapInLevels(t)?new x("tilingscheme:gaps","Tiling scheme levels must not have gaps between min and max level"):e.tileSizeSupported(t)?e.hasOriginPerLODs(t)?new x("tilingscheme:multiple-origin","Tiling scheme levels must not have their own origin"):null:new x("tilingscheme:tile-size","Tiles must be square and size must be one of [128, 256, 512]"):new x("tilingscheme:power-of-two","Tiling scheme must be power of two")}static fromExtent(t,i){let s=t[2]-t[0],o=t[3]-t[1],r=Dl(i),n=1.2*Math.max(s,o),p=256,c=n/p,d=c*r*(96/.0254),h=new e(new li({size:[p,p],origin:new N({x:t[0]-.5*(n-s),y:t[3]+.5*(n-o)}),lods:[new ai({level:0,resolution:c,scale:d})],spatialReference:i}));return h.ensureMaxLod(20),h}static makeWebMercatorAuxiliarySphere(t){let i=new e(e.WebMercatorAuxiliarySphereTileInfo);return i.ensureMaxLod(t),i}static makeGCSWithTileSize(t,i=256,s=16){let o=256/i,r=new e(new li({size:[i,i],origin:new N({x:-180,y:90,spatialReference:t}),spatialReference:t,lods:[new ai({level:0,resolution:.703125*o,scale:295497598570834e-6*o})]}));return r.ensureMaxLod(s),r}get test(){}};function Is(){return new x("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}xe.WebMercatorAuxiliarySphereTileInfo=new li({size:[256,256],origin:new N({x:-20037508342787e-6,y:20037508342787e-6,spatialReference:se.WebMercator}),spatialReference:se.WebMercator,lods:[new ai({level:0,resolution:156543.03392800014,scale:591657527591555e-6})]}),xe.WebMercatorAuxiliarySphere=xe.makeWebMercatorAuxiliarySphere(19);var dt=Ne();var Tn=64;var ry=Wl(Ul/10);var Ju=Ne();xe.WebMercatorAuxiliarySphere.getExtent(0,0,0,Ju);var ny=Ne([-180,-90,180,90]);var Hi=Ts(),em=Ts(),Ct=Ts(),Tt=Ts();function tm(e,t,i=0){let s=e.extent;if(s==null)return!1;if(i===0)return jl(s,t);let o=Math.min(s[2]-s[0],s[3]-s[1]);return Kl(s,t,i*o)}function Mo(e,t,i,s){Nl(Hi,i),Hi[s]=t[s];let o=ho(Hi,Hi,t),r=ho(em,e,t),n=en(r,o),p=en(o,o),c;c=n<=0?t:p<=n?i:$l(Hi,t,uo(o,o,n/p));let d=ho(Hi,e,c);return Math.PI/2-Math.atan(d[2]/Math.sqrt(d[0]*d[0]+d[1]*d[1]))}function im(e,t,i){let s=e.extent;if(s==null)return 0;Ct[0]=s[0],Ct[1]=s[1],Ct[2]=i,Tt[0]=s[2],Tt[1]=s[3],Tt[2]=i;let o=1/0,r=1/0;return t[0]<Ct[0]?o=Mo(t,Ct,Tt,0):t[0]>Tt[0]&&(o=Mo(t,Tt,Ct,0)),t[1]<Ct[1]?r=Mo(t,Ct,Tt,1):t[1]>Tt[1]&&(r=Mo(t,Tt,Ct,1)),Math.min(o,r)}function sm(e,t,i,s){if(e==null)return Is();let o=e.spatialReference;if(o.isGeographic&&!Cn(o))return new x("tilingscheme:local-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in local scenes");let r=xe.checkUnsupported(e);return r??(i==null?new x("tilingscheme:extent-not-exist","The layer does not provide a layer extent."):om(e,i)||(t==null||o.equals(t)||t.isWGS84&&o.isWebMercator?null:new x("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the local scene")))}function om(e,t){let i=e.lods,s=i[0].resolution*2**i[0].level,o=[s*e.size[0],s*e.size[1]],r=[e.origin.x,e.origin.y],n=Gl(t),p=Ne();xe.computeRowColExtent(n,o,r,p);let c=(p[2]-p[0])*(p[3]-p[1]);if(c>Tn){let d=i[0].scale*2**i[0].level,h=Math.max((n[3]-n[1])/e.size[1],(n[2]-n[0])/e.size[0])*d/s,m=Math.floor(Math.log(h)/Math.log(10));return h=Math.ceil(h/10**m)*10**m,new x("tilingscheme:too-many-root-tiles","Scale of level 0 of the tiling scheme (1:"+Math.floor(d).toLocaleString()+") is too large for the layer's extent. Suggested scale: 1:"+h.toLocaleString()+".",{level0Scale:d,suggestedLevel0Scale:h,requiredNumRootTiles:c,allowedNumRootTiles:Tn})}return null}var td=Object.freeze(Object.defineProperty({__proto__:null,checkIfTileInfoSupportedForViewSR:sm,isInsideExtent:tm,tiltToExtentEdge:im},Symbol.toStringTag,{value:"Module"}));function rm(){return!0}function nm(){return 0}function am(e,t,i,s){if(e==null)return Is();let o=e?.lods.length-1,r=e.spatialReference;if(r.isWebMercator){if(!xe.makeWebMercatorAuxiliarySphere(o).compatibleWith(e,s))return new x("tilingscheme:incompatible-global-web-mercator","The tiling scheme is not compatible with the ArcGIS Online Web Mercator tiling scheme")}else{if(!ed(r))return new x("tilingscheme:global-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in global scenes");if(!xe.makeGCSWithTileSize(e.spatialReference,e.size[0],o).compatibleWith(e,s))return e.spatialReference.isWGS84?new x("tilingscheme:incompatible-global-wgs84","The tiling scheme is not compatible with the ArcGIS Online WGS84 tiling scheme"):new x("tilingscheme:incompatible-global","The tiling scheme is not compatible with the ArcGIS Online tiling scheme")}return t==null||e.spatialReference.equals(t)?null:new x("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the global scene")}var id=Object.freeze(Object.defineProperty({__proto__:null,checkIfTileInfoSupportedForViewSR:am,isInsideExtent:rm,tiltToExtentEdge:nm},Symbol.toStringTag,{value:"Module"}));var lm={[ct.Global]:id,[ct.Local]:td};function Io(e,t,i,s,o){return lm[s].checkIfTileInfoSupportedForViewSR(e,i,t,o)}function sd(e,t,i){let s=rp(e);if(s!=null){if(!D.isCollection(s))return{tileInfo:s.tileInfo,fullExtent:s.fullExtent};{let o=s.find(r=>Io(r.tileInfo,r.fullExtent,t,i)==null);if(o)return{tileInfo:o.tileInfo,fullExtent:o.fullExtent}}}return{tileInfo:null,fullExtent:null}}var Dy=[Ye.NORTH,Ye.EAST,Ye.SOUTH,Ye.WEST],Vy=[Ye.NORTH_EAST,Ye.SOUTH_EAST,Ye.SOUTH_WEST,Ye.NORTH_WEST];function od(e,t){return e!=null&&(t==null||(t===ct.Local?!e.isGeographic||e.isWGS84||e.wkid===Di.CGCS2000:e.isWebMercator||e.isWGS84||e.wkid===Di.CGCS2000||e.wkid===Di.GCSMARS2000||e.wkid===Di.GCSMARS2000_SPHERE||e.wkid===Di.GCSMOON2000))}function nd(i){return v(this,arguments,function*(e,t={}){let{basemap:s,view:o}=e;yield s.load(t),pm(s),yield dm(s,o,t),ae(t)})}function ad(i){return v(this,arguments,function*(e,t={}){let{basemap:s,view:o}=e;ae(t);let r=s.baseLayers.find(c=>c.type==="unknown")?.loadError;if(r!=null)throw r;if(!o||"spatialReferenceLocked"in o&&!o.spatialReferenceLocked||(yield s.load(t),ae(t),s.baseLayers.length===0))return;let n=s.baseLayers.at(0);if(!op(n))return;if(s.spatialReference){if(o.spatialReference.equals(s.spatialReference))return;rd()}yield n.load(t),ae(t);let p=(("supportedSpatialReferences"in n?n.supportedSpatialReferences:null)||["tileInfo"in n?n.tileInfo?.spatialReference:null]).filter(we);p.length!==0&&p.every(c=>!o.spatialReference.equals(c))&&rd()})}function rd(){throw new x("basemap-compatibility:incompatible-spatial-reference","Basemap spatial reference is not compatible with the view")}function pm(e){if(e.baseLayers.length===0&&e.referenceLayers.length===0)return;let t=e.baseLayers.concat(e.referenceLayers).toArray().filter(i=>!ep(i)).map(i=>cm(i));if(t.length)throw t[0]}function cm(e){return new x("basemap-compatibility:unsupported-basemap-layer-type","Unsupported basemap layer type ${operationalLayerType}",{layer:e,operationalLayerType:e.operationalLayerType||"unknown"})}function dm(e,t,i){return v(this,null,function*(){if(e.baseLayers.length===0)return;let s=e.baseLayers.at(0);if(sp(s)){try{yield s.load(i)}catch(o){let r="basemap-compatibility:unknown-error",n="Unknown basemap compatibility error",{name:p=r,message:c=n,details:d}=o;throw new x(p,c,d)}hm(s,t)}})}function hm(e,t){let i=t.state.viewingMode;if(!i)return;let s,o;if(e?.type==="wmts"){let p=sd(e,t.spatialReference,i);if(p.tileInfo==null)throw new x("basemapgalleryitem:tiling-scheme-incompatible","Basemap tiling scheme is incompatible with the view");s=p.tileInfo,o=p.fullExtent}else s=e.tileInfo,o=e.fullExtent;if(s==null)return;if(!od(s.spatialReference,i))throw new x(`basemapgalleryitem:spatial-reference-unsupported-${pn(i)}`,`Basemap spatial reference is unsupported in ${pn(i)} mode`);let r=e?.type==="vector-tile"?s.getCompatibleForVTL(256):null;if(i===ct.Global){let p=Io(s,o,null,i);if(p&&e?.type==="vector-tile"&&o!=null&&r&&!Io(r,o,null,i)&&(p=null),p){let c=s.spatialReference.isWebMercator?"web-mercator":"wgs84";throw new x(`basemapgalleryitem:tiling-scheme-unsupported-${c}-global`,"Basemap tiling scheme is unsupported in global mode",{error:p})}}else if(xe.checkUnsupported(s))throw new x("basemapgalleryitem:tiling-scheme-unsupported-local","Basemap tiling scheme is unsupported in local mode");let n=t.basemapTerrain?.tilingScheme;if(n&&!n.compatibleWith(s)&&(e?.type!=="vector-tile"||!r||!n.compatibleWith(r)))throw new x("basemapgalleryitem:tiling-scheme-incompatible","Basemap tiling scheme is incompatible with the view")}var ht=class extends Xl(C){constructor(e){super(e),this.compatibilityFunction=null,this.error=null,this.state="loading",this.view=null}initialize(){let e=()=>this.refresh();this.addHandles([_(()=>this.basemap?.loadStatus,e),_(()=>this.compatibilityFunction,e),_(()=>this.view&&"basemapTerrain"in this.view&&this.view.basemapTerrain?.tilingScheme,e),_(()=>this.view?.ready,e),_(()=>this.view?.spatialReference,e)]),this.refresh()}destroy(){this._cancelRefresh(),this.basemap=null,this.compatibilityFunction=null,this.view=null}get _spatialReferenceTask(){return _p(this.view,this.basemap)}set basemap(e){e&&e.load().catch(()=>{}),this._set("basemap",e)}get spatialReference(){return this._spatialReferenceTask.spatialReference}refresh(){this._cancelRefresh(),this._set("state","loading");let e=this.basemap?.loadStatus;if(e!=="loaded"&&e!=="failed")return;if(!this.compatibilityFunction)return void(e==="loaded"?(this._set("state","ready"),this._set("error",null)):(this._set("state","error"),this._set("error",this.basemap.loadError)));let t=new AbortController,{signal:i}=t;this.compatibilityFunction(this,{signal:i}).then(()=>nt(()=>!this._spatialReferenceTask.updating,i)).then(()=>{this._set("state","ready"),this._set("error",null)}).catch(s=>{rt(s)||(this._set("state","error"),this._set("error",s))}),this._refreshController=t}_cancelRefresh(){this._refreshController&&(this._refreshController.abort(),this._refreshController=null)}};a([l({readOnly:!0})],ht.prototype,"_spatialReferenceTask",null),a([l()],ht.prototype,"basemap",null),a([l()],ht.prototype,"compatibilityFunction",void 0),a([l({readOnly:!0})],ht.prototype,"error",void 0),a([l({readOnly:!0})],ht.prototype,"spatialReference",null),a([l({readOnly:!0})],ht.prototype,"state",void 0),a([l()],ht.prototype,"view",void 0),ht=a([y("esri.widgets.BasemapGallery.support.BasemapGalleryItem")],ht);var Ln=ht;var ld=D.ofType(Zt),Es=class extends C{constructor(e){super(e),this.basemaps=new ld}destroy(){this.basemaps.forEach(e=>e.destroy())}get state(){return"ready"}refresh(){}};a([l({type:ld})],Es.prototype,"basemaps",void 0),a([l({readOnly:!0})],Es.prototype,"state",null),Es=a([y("esri.widgets.BasemapGallery.support.LocalBasemapsSource")],Es);var Eo=Es;var pd=D.ofType(Zt),ut=class extends at.LoadableMixin(no(Eo)){constructor(e){super(e),this._lastPortalBasemapFetchController=null,this.basemaps=new pd,this.filterFunction=null,this.portal=mn.getDefault(),this.query=null,this.updateBasemapsCallback=null,this.viewType=null}initialize(){this.addHandles(_(()=>[this.filterFunction,this.loadStatus,this.portal?.basemapGalleryGroupQuery,this.portal?.basemapGalleryGroupQuery3D,this.portal?.user,this.query,this.updateBasemapsCallback],()=>this.refresh(),O))}destroy(){this.filterFunction=null,this.portal=null,this.basemaps.forEach(e=>e.destroy())}get state(){return this.loadStatus==="not-loaded"?"not-loaded":this.loadStatus==="loading"||this._lastPortalBasemapFetchController?"loading":"ready"}load(e){return this.addResolvingPromise(this.portal.load(e)),Promise.resolve(this)}refresh(){return v(this,null,function*(){if(this.loadStatus!=="loaded")return;this._lastPortalBasemapFetchController&&(this._lastPortalBasemapFetchController.abort(),this._lastPortalBasemapFetchController=null);let e=this.portal,t=new AbortController;this._lastPortalBasemapFetchController=t,this.notifyChange("state");try{let i=yield e.fetchBasemaps(this._toQueryString(this.query),{signal:t.signal,include3d:this.viewType==="3d"||void 0});yield this._updateBasemaps(i)}catch(i){if(rt(i))throw i;P.getLogger(this).warn(new x("basemap-source:fetch-basemaps-error","Could not fetch basemaps from portal.",{error:i})),yield this._updateBasemaps()}this._lastPortalBasemapFetchController=null,this.notifyChange("state")})}_toQueryString(e){return e&&typeof e!="string"?Object.keys(e).map(t=>`${t}:${e[t]}`).join(" AND "):e}_updateBasemaps(){return v(this,arguments,function*(e=[]){let t=yield this._filterBasemaps(e);t=this.updateBasemapsCallback?yield this.updateBasemapsCallback(t):t,this.basemaps.removeAll(),this.basemaps.addMany(t)})}_filterBasemaps(e){return v(this,null,function*(){if(!this.filterFunction)return e;let t=e.map(this.filterFunction),i=yield Promise.all(t);return e.filter((s,o)=>i[o])})}};a([l({readOnly:!0,type:pd})],ut.prototype,"basemaps",void 0),a([l()],ut.prototype,"filterFunction",void 0),a([l({type:mn})],ut.prototype,"portal",void 0),a([l()],ut.prototype,"query",void 0),a([l({readOnly:!0})],ut.prototype,"state",null),a([l()],ut.prototype,"updateBasemapsCallback",void 0),a([l()],ut.prototype,"viewType",void 0),ut=a([y("esri.widgets.BasemapGallery.support.PortalBasemapsSource")],ut);var Bi=ut;var cd=D.ofType(Ln);function um(e){return e&&e.declaredClass==="esri.portal.Portal"}function mm(e){return e&&!(e instanceof Bi)&&(!!e.portal||!!e.query)}function fm(e){return e&&"basemaps"in e&&"state"in e&&"refresh"in e}var He=class extends at{constructor(e){super(e),this._loadingProjectionEngine=!1,this.items=new cd,this.source=new Bi,this.view=null}initialize(){let e=()=>this._recreateItems();this.addHandles([_(()=>this.state==="ready"?this.compatibilityFunction:null,()=>this._updateItems()),fe(()=>this.source?.basemaps,"change",e,{onListenerAdd:e}),le(()=>this.view,()=>{this.source instanceof Bi&&(this.source.viewType=this.view?.type)},{once:!0})])}destroy(){let e=this.source.basemaps.find(t=>t===this.activeBasemap);e&&this.source.basemaps.remove(e),this.source?.destroy()}get activeBasemap(){return this.view?.map?.basemap??null}set activeBasemap(e){let t=this.view;if(!t?.map)return;let i=typeof e=="string"?Zt.fromId(e):e;if(!i||!t.ready)return t.map.basemap=i,void this._clearOverride("activeBasemap");let s=i.spatialReference||this.items?.find(o=>this.basemapEquals(i,o.basemap))?.spatialReference;if(s&&"spatialReferenceLocked"in t&&!t.spatialReferenceLocked){let o=t.spatialReference;if(s!=null&&!_t(o,s)&&!fo(t.spatialReference,s)&&!Ai())return this._override("activeBasemap",i),this._loadingProjectionEngine=!0,void zi().then(()=>{this._get("activeBasemap")===e&&(t.map.basemap=e,t.spatialReference=s,this._clearOverride("activeBasemap"))},()=>{}).then(()=>{this._loadingProjectionEngine=!1});t.map.basemap=i,this._clearOverride("activeBasemap"),s==null||_t(t.spatialReference,s)||(t.spatialReference=s)}else t.map.basemap=i,this._clearOverride("activeBasemap")}get activeBasemapIndex(){let{state:e,activeBasemap:t}=this;return e!=="ready"?-1:this._findBasemapIndex(t)}get compatibilityFunction(){return this.view?.type==="3d"?nd:ad}set compatibilityFunction(e){this._overrideIfSome("compatibilityFunction",e)}castSource(e){return Array.isArray(e)||D.isCollection(e)?new Eo({basemaps:Array.isArray(e)?new D(e):e}):um(e)?new Bi({portal:e}):mm(e)?new Bi(e):fm(e)?e:null}get state(){return this.view?.ready&&this.source?this._loadingProjectionEngine?"loading":"ready":"disabled"}basemapEquals(e,t){return wp(e,t)}refresh(){this._recreateItems()}load(){return this.loadSource()}loadSource(e){return this.addResolvingPromise(at.isLoadable(this.source)?this.source.load(e):null),Promise.resolve(this)}_findBasemapIndex(e){let{items:t}=this,i=t.findIndex(s=>s.basemap===e);return i===-1?t.findIndex(s=>this.basemapEquals(s.basemap,e)):i}_recreateItems(){let e=this.source?.basemaps??[],{view:t,compatibilityFunction:i}=this,s=new Map(this.items.map(r=>[r.basemap,r])),o=e.map(r=>{let n=s.get(r);return n?(s.delete(r),n):new Ln({basemap:r,compatibilityFunction:i,view:t})});this.items.removeAll(),this.items.addMany(o),s.forEach(r=>r.destroy())}_updateItems(){for(let e of this.items)e.compatibilityFunction=this.compatibilityFunction,e.view=this.view}};a([l()],He.prototype,"_loadingProjectionEngine",void 0),a([l()],He.prototype,"activeBasemap",null),a([l({readOnly:!0})],He.prototype,"activeBasemapIndex",null),a([l()],He.prototype,"compatibilityFunction",null),a([l({readOnly:!0,type:cd})],He.prototype,"items",void 0),a([l()],He.prototype,"source",void 0),a([ge("source")],He.prototype,"castSource",null),a([l({readOnly:!0})],He.prototype,"state",null),a([l()],He.prototype,"view",void 0),He=a([y("esri.widgets.BasemapGallery.BasemapGalleryViewModel")],He);var dd=He;var De="esri-basemap-gallery",Pe={base:De,sourceLoading:`${De}--source-loading`,layoutGrid:`${De}--grid`,narrowItems:`${De}--narrow-items`,loader:`${De}__loader`,item:`${De}__item`,itemContainer:`${De}__item-container`,itemContent:`${De}__item-content`,itemTitle:`${De}__item-title`,itemTagsContainer:`${De}__item-tags-container`,itemThumbnail:`${De}__item-thumbnail`,selectedItem:`${De}__item--selected`,itemError:`${De}__item--error`};var Mn={small:200,default:280,wide:420},_e=class extends re{constructor(e,t){super(e,t),this.disabled=!1,this.headingLevel=2,this.messages=null,this.viewModel=new dd,this._focusBasemapItemEnabled=!1,this._container=null,this._width=0,this._onContainerCreated=i=>{this._container=i}}initialize(){this.addHandles([Sl(()=>this._container,({contentRect:e})=>{this._width=e.width}),le(()=>this.source,()=>this.viewModel.loadSource(),{sync:!0,initial:!0})])}loadDependencies(){return Ie({scrim:()=>import("./chunk-LKZELGNG.js"),chip:()=>import("./chunk-VUTY7PD7.js")})}get activeBasemap(){return this.viewModel.activeBasemap}set activeBasemap(e){this.viewModel.activeBasemap=e}get icon(){return"basemap"}set icon(e){this._overrideIfSome("icon",e)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get source(){return this.viewModel.source}set source(e){this.viewModel.source=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}render(){let e=this.source.state==="loading",t=this.disabled||this.viewModel.state==="disabled",i=this.viewModel.items,s={[Pe.sourceLoading]:e,[$.disabled]:t},o=this._width;o<=Mn.small||o>=Mn.wide?s[Pe.layoutGrid]=!0:o<Mn.default&&(s[Pe.narrowItems]=!0);let r=e?u("div",{class:Pe.loader,key:"loader"}):null,n=e?null:i.length>0?u("ul",{"aria-disabled":this.disabled,"aria-label":this.label,bind:this,class:Pe.itemContainer,key:"item-container",onkeydown:this._handleKeyDown,role:"radiogroup"},i.map((p,c)=>this._renderBasemapGalleryItem(p,c)).toArray()):u("div",{class:$.empty,key:"empty-message"},u(Ke,{level:this.headingLevel},this.messages.noBasemaps));return u("div",{afterCreate:this._onContainerCreated,class:this.classes(Pe.base,$.widget,$.panel,s),key:"container"},this._width===0?null:[r,n])}_getRoundRobinIndex(e,t){return(e+t)%t}_handleKeyDown(e){let{key:t}=e;if(!["ArrowUp","ArrowDown","ArrowRight","ArrowLeft"].includes(t))return;e.preventDefault();let{items:i,activeBasemapIndex:s}=this.viewModel,o=t==="ArrowUp"||t==="ArrowLeft"?this._getRoundRobinIndex(Math.max(s-1,-1),i.length):this._getRoundRobinIndex(s+1,i.length),r=i.at(o);r?.state==="ready"&&(this.viewModel.activeBasemap=r.basemap),this._focusBasemapItemEnabled=!0}_focusBasemapItem(e){this._focusBasemapItemEnabled&&e.tabIndex===0&&(e.focus(),this._focusBasemapItemEnabled=!1)}_handleClick(e){let t=e.currentTarget["data-item"];t.state==="ready"&&(this.viewModel.activeBasemap=t.basemap)}_renderBasemapGalleryItem(e,t){let i=bp(e.basemap)||so("esri/themes/base/images/basemap-toggle-64.svg"),s=e.basemap.title,o=e.basemap.portalItem?.snippet,r=e.error?.message||o||s,{viewModel:{state:n,activeBasemapIndex:p}}=this,c=this.disabled||n==="disabled",d=p===t,h=d||p===-1&&t===0?0:-1,m=n==="loading",f={[Pe.selectedItem]:d,[Pe.itemError]:e.state==="error"},w=`basemapgallery-item-${e.uid}`;return u("li",{afterUpdate:this._focusBasemapItem,"aria-checked":d.toString(),"aria-disabled":c.toString(),"aria-labelledby":w,bind:this,class:this.classes(Pe.item,f),"data-item":e,key:e.uid,onclick:this._handleClick,onkeydown:this._handleClick,role:"radio",tabIndex:h,title:r},u("img",{alt:"",class:Pe.itemThumbnail,src:i}),u("div",{class:Pe.itemContent,key:"content"},u("div",{class:Pe.itemTitle,key:"title"},u("span",{id:w},s)),yp(e.basemap)?this._renderTags(e.basemap):null),e.state==="loading"||d&&m?u("calcite-scrim",null,u("span",{"aria-hidden":"true",class:$.loaderAnimation,key:"loader",role:"presentation"})):null)}_renderTags(e){return u("div",{class:Pe.itemTagsContainer,key:"tag"},this._render3DTag(),vp(e)?this._renderBetaTag():null)}_render3DTag(){let{messages:e}=this;return u("calcite-chip",{key:"tag-3d",scale:"s",value:e.tag3D},this.messages.tag3D)}_renderBetaTag(){let{messages:e}=this;return u("calcite-chip",{appearance:"outline-fill",key:"tag-beta",scale:"s",value:e.tagBeta},this.messages.tagBeta)}};a([l()],_e.prototype,"activeBasemap",null),a([l()],_e.prototype,"disabled",void 0),a([l()],_e.prototype,"headingLevel",void 0),a([l()],_e.prototype,"icon",null),a([l()],_e.prototype,"label",null),a([l(),Q("esri/widgets/BasemapGallery/t9n/BasemapGallery")],_e.prototype,"messages",void 0),a([l()],_e.prototype,"source",null),a([l()],_e.prototype,"view",null),a([l()],_e.prototype,"viewModel",void 0),a([l()],_e.prototype,"_focusBasemapItemEnabled",void 0),a([l()],_e.prototype,"_container",void 0),a([l()],_e.prototype,"_width",void 0),a([Ee()],_e.prototype,"_handleClick",null),_e=a([y("esri.widgets.BasemapGallery")],_e);var hd=_e;var Wi=class extends C{constructor(e){super(e),this.format=null,this.position={coordinate:null,location:null}}get displayCoordinate(){return this.format?.getDisplayCoordinate(this.position?.coordinate)}};a([l({readOnly:!0})],Wi.prototype,"displayCoordinate",null),a([l()],Wi.prototype,"format",void 0),a([l()],Wi.prototype,"position",void 0),Wi=a([y("esri.widgets.CoordinateConversion.support.Conversion")],Wi);var qt=Wi;function gm(e,t){let i=In(t);return[e[0].toFixed(i),e[1].toFixed(i)]}function In(e){return e>=500?6:e<500&&e>=50?7:e<50&&e>=5?8:9}function ud(e,t){let i=e.includes(",")?",":" ",[s,o,r]=e.split(i).map(p=>{let c=p.trim();return c?Number(c):null});if(!Po(s)||!Po(o))return null;let n=new N({x:s,y:o,spatialReference:t||se.WGS84});return r&&(n.z=r,n.hasZ=!0),n}function Po(e){return typeof e=="number"&&isFinite(e)}function Ps(e){return!!e&&Po(e.x)&&Po(e.y)}function En(e,t){if(e.spatialReference.isGeographic&&t){let[i,s]=gm([e.x,e.y],t);return`${i}, ${s}`}return`${e.x.toFixed(3)}, ${e.y.toFixed(3)}`}var ym=["dd","dms","ddm","mgrs","usng","utm"];function md(e){return ym.includes(e)}function fd(e,t){let i=[];e=(e=(e=e.replaceAll(/[\u00B0\u00BA]/g,"^")).replaceAll("\u2032","'")).replaceAll("\u2033",'"');let s=jt(t);return xs.dmsToGeog(s,1,[e],i)?new N(i[0][0],i[0][1],t||se.WGS84):null}function gd(e,t,i){let s=[],o=xd(i);if(o===-1)return console.warn(`invalid conversionMode: ${i}`),null;let r=jt(t);return je.mgrsToGeogExtended(r,1,[e],o,s)?new N(s[0][0],s[0][1],t||se.WGS84):null}function yd(e,t){let i=[];!t&&/\(.+27/.test(e)&&(t=se.GCS_NAD_1927);let s=jt(t);return Yr.usngToGeog(s,1,[e],i)?new N(i[0][0],i[0][1],t||se.WGS84):null}function vd(e,t,i){let s=[],o=Cd(i);if(o===-1)return console.warn(`invalid conversionMode: ${i}`),null;let r=jt(t);return Ri.utmToGeog(r,1,[e],o,s)?new N(s[0][0],s[0][1],t||se.WGS84):null}function wd(e,t,i=0){let s=[[e.x,e.y]],o=[],r=jt(e.spatialReference),n=0;switch(t){case"dd":n=xs.geogToDd(r,1,s,i,o);break;case"ddm":n=xs.geogToDdm(r,1,s,i,o);break;case"dms":n=xs.geogToDms(r,1,s,i,o);break;default:return console.warn(`invalid format: ${t}`),null}return n?o[0]:null}function _d(e,t,i=0,s=!1){let o=[[e.x,e.y]],r=[],n=jt(e.spatialReference),p=xd(t);return p===-1?(console.warn(`invalid conversionMode: ${t}`),null):(s&&(p|=je.PE_MGRS_ADD_SPACES),je.geogToMgrsExtended(n,1,o,i,!1,p,r)?r[0]:null)}function bd(e,t=0,i=!1){let s=[[e.x,e.y]],o=[],r=jt(e.spatialReference);return Yr.geogToUsng(r,1,s,t,!1,i,o)?o[0]:null}function Sd(e,t,i=!1){let s=[[e.x,e.y]],o=[],r=jt(e.spatialReference),n=Cd(t);return n===-1?(console.warn(`invalid conversionMode: ${t}`),null):(i&&(n|=Ri.PE_UTM_OPTS_ADD_SPACES),Ri.geogToUtm(r,1,s,n,o)?o[0]:null)}function jt(e){let t=null;if(e||(e=se.WGS84),e.wkid){if(t=Kr.geogcs(e.wkid),!t)throw new x("coordinate-formatter:invalid-spatial-reference","wkid is not valid")}else{if(!e.wkt2&&!e.wkt)throw new x("coordinate-formatter:invalid-spatial-reference","wkid and wkt are missing");if(t=Kr.fromString(Ml.PE_TYPE_GEOGCS,e.wkt2||e.wkt),!t)throw new x("coordinate-formatter:invalid-spatial-reference","wkt is not valid")}return t}function xd(e){let t=-1;switch(e){case"automatic":t=je.PE_MGRS_STYLE_AUTO;break;case"new-180-in-zone-01":t=je.PE_MGRS_STYLE_NEW|je.PE_MGRS_180_ZONE_1_PLUS;break;case"new-180-in-zone-60":t=je.PE_MGRS_STYLE_NEW;break;case"old-180-in-zone-01":t=je.PE_MGRS_STYLE_OLD|je.PE_MGRS_180_ZONE_1_PLUS;break;case"old-180-in-zone-60":t=je.PE_MGRS_STYLE_OLD}return t}function Cd(e){let t=-1;switch(e){case"latitude-band-indicators":t=Ri.PE_UTM_OPTS_NONE;break;case"north-south-indicators":t=Ri.PE_UTM_OPTS_NS}return t}var Ce=class extends C{constructor(e){super(e),this.conversionInfo=null,this.coordinateSegments=null,this._currentPattern=void 0,this.defaultPattern=null,this.name=null,this.viewModel=null}get currentPattern(){return(this._currentPattern||this.defaultPattern)??""}set currentPattern(e){this._currentPattern=e}get label(){return this.name??""}set label(e){this._overrideIfSome("label",e)}get hasDisplayProperties(){return!(!this.defaultPattern||!this.coordinateSegments)}get spatialReference(){return this.name==="basemap"?this._viewSpatialReference:this.conversionInfo?.spatialReference??se.WGS84}set spatialReference(e){this._overrideIfSome("spatialReference",e)}get _viewSpatialReference(){return this.viewModel?.view?.spatialReference??se.WGS84}get _additionalCharactersPattern(){let e=this.coordinateSegments;if(!e)return null;let t=e.map(s=>s.alias),i=this.currentPattern.replaceAll(new RegExp(`["nsew${t.join()}]`,"gi"),"").replaceAll(" ","");return new RegExp(`[${i}]`,"g")}get test(){}convert(e){return v(this,null,function*(){if(!Ps(e))throw new x("format:invalid-point","Could not convert invalid point.",{point:e});let t=this.conversionInfo?.convert;if(t)return Promise.resolve().then(()=>t(e));let i=yield this._project(e,this.spatialReference);return{location:i,coordinate:yield this._getCoordinate(i)}})}getConversionStrategy(){let e=this._viewSpatialReference;return this.conversionInfo?.convert||this.viewModel?.formatterAvailable||this.name==="xy"&&(e.isWebMercator||e.isWGS84)||this.name==="basemap"?"client":"server"}getDisplayCoordinate(e){if(!e)return null;if(!this.coordinateSegments||!this.currentPattern)return e;let t=this.currentPattern,i=this._getSegmentMatches(e,!1);for(let s=this.coordinateSegments.length-1;s>=0;s--){let o=this.coordinateSegments[s];t=t.replace(o.alias,i[s])}return t}_parseUserInput(e){let{defaultPattern:t,_additionalCharactersPattern:i,coordinateSegments:s}=this;if(!t||!i)return"";let o=t.replace(i,"");e=e.replace(i,"");let r=this._getSegmentMatches(e,!0);if(s)for(let n=s.length-1;n>=0;n--){let p=s[n];o=o.replace(p.alias,r[n])}return o}_getSegmentMatches(e,t){let i=new Array,{coordinateSegments:s}=this;if(!s)return i;for(let o=0;o<s.length;o++){let r=s[o],n=e.match(r.searchPattern);if(!n){i.push("");continue}let p=n[0];if(e=e.replace(p,"").trim(),r.substitution){let c=t?r.substitution.input(p):r.substitution.output(p);c&&(p=`${c}`)}i.push(p)}return i}reverseConvert(e){return v(this,null,function*(){let t=this._parseUserInput(e),i=this.conversionInfo?.reverseConvert,s;if(i)s=i(t);else if(this.name==="xy"||this.name==="basemap")s=ud(t,this.spatialReference);else if(this.viewModel?.formatterAvailable)switch(this.name){case"dd":case"ddm":case"dms":s=fd(t,this.spatialReference);break;case"mgrs":{s=gd(t,this.spatialReference,"automatic");break}case"utm":{s=vd(t,this.spatialReference,"latitude-band-indicators");break}case"usng":s=yd(t,this.spatialReference);break;default:s=null}if(!s)throw new x("format:invalid-input","Could not parse input into point.",{userInput:e});return this._project(s,this._viewSpatialReference)})}_getCoordinate(e){return v(this,null,function*(){let t=this.viewModel?.view?.scale??0;if(!Ps(e))throw new x("format:invalid-point","Could not transform invalid point into coordinate.",{point:e});if(this.viewModel?.formatterAvailable||this.name==="basemap"||this.name==="xy")switch(this.name){case"dd":case"ddm":case"dms":{let i=In(t);return wd(e,this.name,i)}case"mgrs":return _d(e,"automatic",5,!1);case"usng":return bd(e,5,!1);case"utm":return Sd(e,"latitude-band-indicators",!0);default:return En(e,t)}return En(e,t)})}_project(e,t){return v(this,null,function*(){if(_t(e.spatialReference,t)||!t)return e;if(this.viewModel?.formatterAvailable&&Ai())return pt(e,t);if(!this.viewModel?.formatterAvailable){let i=lo(e,t);if(i!=null)return i}return null})}};a([l()],Ce.prototype,"conversionInfo",void 0),a([l()],Ce.prototype,"coordinateSegments",void 0),a([l()],Ce.prototype,"currentPattern",null),a([l()],Ce.prototype,"_currentPattern",void 0),a([l()],Ce.prototype,"label",null),a([l()],Ce.prototype,"defaultPattern",void 0),a([l({readOnly:!0})],Ce.prototype,"hasDisplayProperties",null),a([l()],Ce.prototype,"name",void 0),a([l({type:se})],Ce.prototype,"spatialReference",null),a([l()],Ce.prototype,"viewModel",void 0),a([l({readOnly:!0})],Ce.prototype,"_viewSpatialReference",null),a([l({readOnly:!0})],Ce.prototype,"_additionalCharactersPattern",null),Ce=a([y("esri.widgets.CoordinateConversion.support.Format")],Ce);var Lt=Ce;var hi=sn().decimal,Ui={N:"north",S:"south",E:"east",W:"west"},ee="\xB0\u200E",ko=new RegExp(`-?\\d+[\\.|\\${hi}]?\\d*`),vm=/^[\\0]+(?=\d)/;function Pn(e,t){let i=ri()==="ar",s=e.abbreviatedDirections.north,o=e.abbreviatedDirections.south,r=e.abbreviatedDirections.east,n=e.abbreviatedDirections.west,p=sn().decimal,c={[s]:"N",[o]:"S",[r]:"E",[n]:"W"},d=new RegExp(`-?\\d+[\\.|\\${p}]?\\d*`),h=new RegExp(`N|S|${s}|${o}`,"i"),m=new RegExp(`E|W|${r}|${n}`,"i"),f={ddm:`Y${ee} A'${e.abbreviatedDirections.north}, X${ee} B'${e.abbreviatedDirections.east}`,dms:`Y${ee} A' B"${e.abbreviatedDirections.north}, X${ee} C' D"${e.abbreviatedDirections.east}`,dd:`Y${ee}${e.abbreviatedDirections.north}, X${ee}${e.abbreviatedDirections.east}`,xy:`X${ee}, Y${ee}`,basemap:"X, Y"},w={ddm:`${e.abbreviatedDirections.north}${ee}Y 'A ,${e.abbreviatedDirections.east}${ee}X 'B`,dms:`${e.abbreviatedDirections.north}${ee}Y 'A "B ,${e.abbreviatedDirections.east}${ee}X 'C "D`,dd:`${e.abbreviatedDirections.north}${ee}Y ,${e.abbreviatedDirections.east}${ee}X`,xy:`X${ee} ,Y${ee}`,basemap:"X ,Y"},S=b=>b!=null&&Object.keys(f).includes(b),T=new RegExp(`\\d{1,2}[\\.|\\${p}]?\\d*`,"i"),F=new RegExp(`\\d{1,3}[\\.|\\${p}]?\\d*`,"i");t.forEach(b=>{let{name:L}=b;if(L==="dd"?b.coordinateSegments=[{alias:"Y",description:"degrees latitude",searchPattern:T,substitution:{input:g=>q(g),output:g=>Z(g)}},{alias:e.abbreviatedDirections.north,description:"north/south indicator",searchPattern:h,substitution:{input:g=>c[g],output:g=>e.abbreviatedDirections[Ui[g]]}},{alias:"X",description:"degrees longitude",searchPattern:F,substitution:{input:g=>q(g),output:g=>Z(g)}},{alias:e.abbreviatedDirections.east,description:"east/west indicator",searchPattern:m,substitution:{input:g=>c[g],output:g=>e.abbreviatedDirections[Ui[g]]}}]:L==="ddm"?b.coordinateSegments=[{alias:"Y",description:"degrees latitude",searchPattern:T,substitution:{input:g=>q(g),output:g=>Z(g)}},{alias:"A",description:"minutes latitude",searchPattern:T,substitution:{input:g=>q(g),output:g=>Z(g)}},{alias:e.abbreviatedDirections.north,description:"north/south indicator",searchPattern:h,substitution:{input:g=>c[g],output:g=>e.abbreviatedDirections[Ui[g]]}},{alias:"X",description:"degrees longitude",searchPattern:F,substitution:{input:g=>q(g),output:g=>Z(g)}},{alias:"B",description:"minutes longitude",searchPattern:T,substitution:{input:g=>q(g),output:g=>Z(g)}},{alias:e.abbreviatedDirections.east,description:"east/west indicator",searchPattern:m,substitution:{input:g=>c[g],output:g=>e.abbreviatedDirections[Ui[g]]}}]:L==="dms"?b.coordinateSegments=[{alias:"Y",description:"degrees latitude",searchPattern:T,substitution:{input:g=>q(g),output:g=>Z(g)}},{alias:"A",description:"minutes latitude",searchPattern:T,substitution:{input:g=>q(g),output:g=>Z(g)}},{alias:"B",description:"seconds latitude",searchPattern:T,substitution:{input:g=>q(g),output:g=>Z(g)}},{alias:e.abbreviatedDirections.north,description:"north/south indicator",searchPattern:h,substitution:{input:g=>c[g],output:g=>e.abbreviatedDirections[Ui[g]]}},{alias:"X",description:"degrees longitude",searchPattern:F,substitution:{input:g=>q(g),output:g=>Z(g)}},{alias:"C",description:"minutes longitude",searchPattern:T,substitution:{input:g=>q(g),output:g=>Z(g)}},{alias:"D",description:"seconds longitude",searchPattern:T,substitution:{input:g=>q(g),output:g=>Z(g)}},{alias:e.abbreviatedDirections.east,description:"east/west indicator",searchPattern:m,substitution:{input:g=>c[g],output:g=>e.abbreviatedDirections[Ui[g]]}}]:(b.name==="xy"||b.name==="basemap")&&(b.coordinateSegments=[{alias:"X",description:"easting",searchPattern:d,substitution:{input:g=>q(g),output:g=>Z(g)}},{alias:"Y",description:"northing",searchPattern:d,substitution:{input:g=>q(g),output:g=>Z(g)}}]),S(L)){let g=i?w[L]:f[L];b.defaultPattern=g,b.currentPattern=g}})}function Td(){let e=new RegExp("N|S","i"),t=new RegExp("E|W","i");return[new Lt({name:"basemap",coordinateSegments:[{alias:"X",description:"easting",searchPattern:ko,substitution:{input:i=>q(i),output:i=>Z(i)}},{alias:"Y",description:"northing",searchPattern:ko,substitution:{input:i=>q(i),output:i=>Z(i)}}],defaultPattern:"X, Y",viewModel:null}),new Lt({name:"dd",coordinateSegments:[{alias:"Y",description:"degrees latitude",searchPattern:new RegExp(`\\d{1,2}[\\.|\\${hi}]?\\d*(?=\\D*?[N|S])`,"i"),substitution:{input:i=>q(i),output:i=>Z(i)}},{alias:"N",description:"north/south indicator",searchPattern:e},{alias:"X",description:"degrees longitude",searchPattern:new RegExp(`\\d{1,3}[\\.|\\${hi}]?\\d*(?=\\D*?[E|W|])`,"i"),substitution:{input:i=>q(i),output:i=>Z(i)}},{alias:"E",description:"east/west indicator",searchPattern:t}],defaultPattern:`Y${ee}N, X${ee}E`,viewModel:null}),new Lt({name:"ddm",coordinateSegments:[{alias:"Y",description:"degrees latitude",searchPattern:new RegExp("\\d{1,2}(?=.*?\\s+.*?[N|S])","i"),substitution:{input:i=>q(i),output:i=>Z(i)}},{alias:"A",description:"minutes latitude",searchPattern:new RegExp(`\\d{1,2}[\\.\\${hi}]?\\d*(?=.*?[N|S])`,"i"),substitution:{input:i=>q(i),output:i=>Z(i)}},{alias:"N",description:"north/south indicator",searchPattern:e},{alias:"X",description:"degrees longitude",searchPattern:new RegExp("\\d{1,3}(?=\\D*?\\s+.*?[E|W])","i"),substitution:{input:i=>q(i),output:i=>Z(i)}},{alias:"B",description:"minutes longitude",searchPattern:new RegExp(`\\d{1,2}[\\.|\\|${hi}]?\\d*(?=.*?[E|W])`,"i"),substitution:{input:i=>q(i),output:i=>Z(i)}},{alias:"E",description:"east/west indicator",searchPattern:t}],defaultPattern:`Y${ee} A'N, X${ee} B'E`,viewModel:null}),new Lt({name:"dms",coordinateSegments:[{alias:"Y",description:"degrees latitude",searchPattern:new RegExp("\\d{1,2}(?=.*?\\s+.*?[N|S])","i"),substitution:{input:i=>q(i),output:i=>Z(i)}},{alias:"A",description:"minutes latitude",searchPattern:new RegExp("\\d{1,2}(?=.*?[N|S])","i"),substitution:{input:i=>q(i),output:i=>Z(i)}},{alias:"B",description:"seconds latitude",searchPattern:new RegExp(`\\d{1,2}[\\.|\\${hi}]?\\d*(?=.*?[N|S])`,"i"),substitution:{input:i=>q(i),output:i=>Z(i)}},{alias:"N",description:"north/south indicator",searchPattern:e},{alias:"X",description:"degrees longitude",searchPattern:new RegExp("\\d{1,3}(?=.*?\\s+.*?[E|W])","i"),substitution:{input:i=>q(i),output:i=>Z(i)}},{alias:"C",description:"minutes longitude",searchPattern:new RegExp("\\d{1,2}(?=.*?[E|W])","i"),substitution:{input:i=>q(i),output:i=>Z(i)}},{alias:"D",description:"seconds longitude",searchPattern:new RegExp(`\\d{1,2}[\\.|\\${hi}]?\\d*(?=.*?[E|W])`,"i"),substitution:{input:i=>q(i),output:i=>Z(i)}},{alias:"E",description:"east/west indicator",searchPattern:t}],defaultPattern:`Y${ee} A' B"N, X${ee} C' D"E`,viewModel:null}),new Lt({name:"xy",coordinateSegments:[{alias:"X",description:"longitude",searchPattern:ko,substitution:{input:i=>q(i),output:i=>Z(i)}},{alias:"Y",description:"latitude",searchPattern:ko,substitution:{input:i=>q(i),output:i=>Z(i)}}],defaultPattern:`X${ee}, Y${ee}`,viewModel:null}),new Lt({name:"mgrs",coordinateSegments:[{alias:"Z",description:"grid zone",searchPattern:/\d{1,2}\w|[abyz]/i},{alias:"S",description:"grid square",searchPattern:/\w{2}/},{alias:"X",description:"easting",searchPattern:/^\d{5}(?=.?\d{5}$)|^\d{4}(?=.?\d{4}$)|^\d{3}(?=.?\d{3}$)|^\d{2}(?=.?\d{2}$)|^\d(?=.?\d$)/},{alias:"Y",description:"northing",searchPattern:/^\d{1,5}/}],defaultPattern:"Z S X Y",viewModel:null}),new Lt({name:"usng",coordinateSegments:[{alias:"Z",description:"grid zone",searchPattern:/\d{1,2}\w|[abyz]/i},{alias:"S",description:"grid square",searchPattern:/\w{2}/},{alias:"X",description:"easting",searchPattern:/^\d{5}(?=.?\d{5}$)|^\d{4}(?=.?\d{4}$)|^\d{3}(?=.?\d{3}$)|^\d{2}(?=.?\d{2}$)|^\d(?=.?\d$)/},{alias:"Y",description:"northing",searchPattern:/^\d{1,5}/}],defaultPattern:"Z S X Y",viewModel:null}),new Lt({name:"utm",coordinateSegments:[{alias:"Z",description:"zone number",searchPattern:/\d{1,2}|[abyz]/i},{alias:"B",description:"latitude band",searchPattern:/^\D/},{alias:"X",description:"easting",searchPattern:/\d{1,7}(?=\s*\d{7}$)/},{alias:"Y",description:"northing",searchPattern:/\d{1,7}/}],defaultPattern:"ZB X Y",viewModel:null})]}function Z(e){let t=e.match(vm),i=t?t[0]:"",s=e.includes(".")?e.split(".")[1].length:0;return i+hp(Number(e),{pattern:"###0.###",places:s,round:-1})}function q(e){return up(e)}var Ro={default:"default",crosshair:"crosshair"},wm=new N([0,0,500]),_m="xy",bm=["mgrs","utm","usng","dd","dms","ddm"],Ld="esri__coordinateConversionWidgetState",mt={conversions:"conversions",formats:"formats",view:"view",viewChange:"view-change"},Sm="esri/images/search/search-symbol-32.png",ve=class extends $i(Le.EventedAccessor){constructor(e){super(e),this._conversionPromise=null,this._locationGraphic=null,this._pointerCount=0,this.conversions=new D,this.formats=new D,this.formatterAvailable=!1,this.messages=null,this.filteredFormats=new D,this.locationSymbol=new Gp({url:so(Sm),width:24,height:24}),this.storageEnabled=!0,this.storageType="session",this.view=null,this._saveWidgetState=this._saveWidgetState.bind(this),this._handleFormatChange=this._handleFormatChange.bind(this),this._handleConversionChange=this._handleConversionChange.bind(this),this._handleViewChange=this._handleViewChange.bind(this),this._onClick=this._onClick.bind(this),this._onPointerMove=this._onPointerMove.bind(this),this._onPointerDown=this._onPointerDown.bind(this),this._onPointerUp=this._onPointerUp.bind(this)}initialize(){let e=()=>v(this,null,function*(){return this.messages=yield io("esri/widgets/CoordinateConversion/t9n/CoordinateConversion")});this.formats.addMany(Td()),e().then(()=>{if(!this.destroyed&&(Pn(this.messages,this.formats),this.storageEnabled&&this._loadWidgetState(),this.formats.forEach(t=>{t.viewModel=this,this.addHandles(_(()=>t.currentPattern,this._saveWidgetState),t.name??"unnamed-format")}),this.addHandles(this.conversions.on("change",this._handleConversionChange),mt.conversions),this.addHandles(this.formats.on("change",this._handleFormatChange),mt.formats),this.addHandles(Pi(()=>{e().then(()=>{Pn(this.messages,this.formats)})})),zi().then(()=>{this.formatterAvailable=!0}).catch(t=>{P.getLogger(this).error(new x("coordinate-conversion:projection-load-failed","Failed to load the projection module.",{error:t})),this.formatterAvailable=!1,this._filterFormatsAndConversions()}).then(()=>this.addHandles(_(()=>this.view,this._handleViewChange,O),mt.viewChange)),this.conversions.length===0)){let t=this.formats.find(i=>i.name===_m)||this.formats.at(0);this.conversions.add(new qt({format:t}))}})}destroy(){this.removeHandles(),this._cleanUpView(this.view),this.view=null}castConversions(e){return this._castToConversions(e)}set currentLocation(e){this._set("currentLocation",e),this._updateConversions()}get currentLocation(){return this._get("currentLocation")||null}set mode(e){switch(e){case"capture":this.currentLocation=null,this._startCaptureMode(),this._set("mode",e);break;case"live":this._startLiveMode(),this._set("mode",e)}}get mode(){return this._get("mode")||"live"}get state(){let{messages:e,view:t}=this,i=t?.ready;return e?i?"ready":t?"loading":"disabled":"disabled"}get storage(){let{storageType:e}=this;return e==="session"?sessionStorage:localStorage}get waitingForConversions(){return this._conversionPromise!=null}setLocation(e){if(this._locationGraphic&&this.view?.graphics.remove(this._locationGraphic),!e)return;let t=e.clone();t.hasZ&&(t.z=void 0),this._locationGraphic=new yo({geometry:t,symbol:this.locationSymbol}),this.view?.graphics.add(this._locationGraphic)}convert(e,t){return v(this,null,function*(){if(!Ps(t))throw new x("coordinate-conversion:invalid-point","Invalid point cannot be converted.",{point:t});return Promise.resolve().then(()=>e.convert(t))})}goToLocation(e){return v(this,null,function*(){let{view:t}=this;if(!t)throw new x("coordinate-conversion:go-to-failed","no view");let i=t.type==="3d"?t.clippingArea:null,s=t.map?.basemap?.baseLayers;if(i||s?.length>0){let o=i??s.at(0)?.fullExtent;if(o!=null&&!o.contains(e))throw new x("coordinate-conversion:go-to-failed","Point outside basemap extent.",{point:e})}return this.callGoTo({target:e})})}pause(){this.currentLocation=null,this.removeHandles(mt.view),this.view&&(this.view.cursor=Ro.default,this._locationGraphic&&this.view.graphics.remove(this._locationGraphic))}previewConversion(i){return v(this,arguments,function*(e,t=this.currentLocation||wm){return(yield Md(e,t)).displayCoordinate})}resume(){this.mode==="capture"?this._startCaptureMode():this._startLiveMode()}reverseConvert(e,t){return t.reverseConvert(e)}updateConversions(e,t){return v(this,null,function*(){if(t?.type!=="point")throw this._clearConversions(this.conversions),new x("coordinate-conversion:invalid-input-point","Point is invalid, conversions cannot be updated.",{point:t});return this._convertMany(e,t)})}_castToConversions(e){let t=new D;return e.forEach(i=>{let s=null;if(i instanceof qt)s=i;else if(typeof i=="string"){let o=this.formats.find(r=>r.name===i);o&&(s=new qt({format:o}))}s&&t.add(s)}),t}_cleanUpView(e){e&&(this._locationGraphic&&e.graphics.remove(this._locationGraphic),this.removeHandles(mt.view),e.cursor=Ro.default)}_clearConversions(e){e.forEach(t=>{t.position={location:null,coordinate:null}})}_convertMany(e,t){return v(this,null,function*(){return Promise.all(e.map(i=>Md(i,t)))})}_handleConversionChange(e){for(let t of e.added){let{format:i}=t;i&&(i.viewModel=this,this.currentLocation&&(this._set("waitingForConversions",!0),this.convert(i,this.currentLocation).then(s=>{t.position=s,this._set("waitingForConversions",!1)})))}this._saveWidgetState()}_handleFormatChange(e){e.added.forEach(t=>{this.addHandles(_(()=>t.currentPattern,this._saveWidgetState),t.name??"unnamed-format"),t.viewModel=this}),e.removed.forEach(t=>{t.viewModel=null;let i=this.conversions.filter(s=>s.format===t);this.conversions.removeMany(i),t.name&&this.removeHandles(t.name)})}_loadWidgetState(){try{let e=JSON.parse(this.storage.getItem(Ld));e&&this._setWidgetState(e)}catch(e){P.getLogger(this).error(new x("coordinate-conversion:invalid-session-storage-json","Could not read from storage.",{error:e}))}}_startCaptureMode(){this.removeHandles(mt.view),this.view&&(this.view.cursor=Ro.crosshair,this.currentLocation&&this.setLocation(this.currentLocation),this.addHandles(this.view.on("click",this._onClick),mt.view))}_startLiveMode(){this._pointerCount=0,this.removeHandles(mt.view),this.view&&(this.view.cursor=Ro.default,this._locationGraphic&&this.view.graphics.remove(this._locationGraphic),this.addHandles([this.view.on("pointer-down",this._onPointerDown),this.view.on("pointer-up",this._onPointerUp),this.view.on("pointer-move",this._onPointerMove)],mt.view))}_handleViewChange(e,t){t&&t!==e&&this._cleanUpView(t),e&&(this.mode==="capture"?this._startCaptureMode():this._startLiveMode(),t&&this._filterFormatsAndConversions())}_onClick(e){if(e.button===0){let t=this.view?.toMap(e),i=t?.normalize();this.setLocation(i),this.currentLocation=i}}_onPointerDown(e){let{pointerType:t}=e;if(this._pointerCount++,(t==="touch"||t==="pen")&&this._pointerCount===1){let i=this.view?.toMap(e);this.currentLocation=i?.normalize()}}_onPointerMove(e){let{pointerType:t}=e;if(t==="mouse"||this._pointerCount===1){let i=this.view?.toMap(e);this.currentLocation=i?.normalize()}}_onPointerUp(){this._pointerCount--}_setWidgetState(e){try{e.formats.forEach(t=>{let i=this.formats.find(s=>s.name===t.name);i&&e.locale===ri()&&t.currentPattern&&(i.currentPattern=t.currentPattern),i&&t.index>=0&&this.conversions.add(new qt({format:i}))})}catch(t){P.getLogger(this).warn(new x("coordinate-conversion:session-storage-read-error","Could not get widget state from stored JSON.",{error:t}))}}_saveWidgetState(){if(!this.storageEnabled)return;let e=this._toJSON();try{this.storage.setItem(Ld,JSON.stringify({formats:e,locale:ri()}))}catch(t){P.getLogger(this).error(new x("coordinate-conversion:local-storage-write-error","Could not write to localStorage.",{error:t}))}}_updateConversions(){return v(this,null,function*(){try{yield this.updateConversions(this.conversions.toArray(),this.currentLocation)}catch{}})}_toJSON(){return this.formats.filter(e=>{let t=e.name;return t==="xy"||t==="basemap"||md(t)}).map(e=>({name:e.name,currentPattern:e.currentPattern,defaultPattern:e.defaultPattern,index:this.conversions.findIndex(t=>t.format===e)})).sort((e,t)=>e.index-t.index).toArray()}_filterFormatsAndConversions(){let{formatterAvailable:e,conversions:t,formats:i}=this;e||this.addHandles(le(()=>this.view?.spatialReference,s=>{let o=s.isWebMercator||s.isWGS84,r=i.filter(c=>{let{name:d}=c;return!!xm(d)||d==="xy"&&!o}),n=this.filteredFormats.filter(c=>c.name==="xy"&&o&&!this.formats.includes(c)),p=t.filter(c=>r.includes(c.format));i.removeMany(r),t.removeMany(p),this.filteredFormats.addMany(r.filter(c=>!this.filteredFormats.includes(c))),i.addMany(n)},{once:!0,initial:!0}),mt.view)}};function Md(e,t){return v(this,null,function*(){try{e.position=yield e.format?.convert(t)}catch{e.position=null}return e})}function xm(e){return bm.includes(e)}a([l()],ve.prototype,"conversions",void 0),a([ge("conversions")],ve.prototype,"castConversions",null),a([l({type:N})],ve.prototype,"currentLocation",null),a([l()],ve.prototype,"formats",void 0),a([l()],ve.prototype,"messages",void 0),a([l()],ve.prototype,"mode",null),a([l()],ve.prototype,"filteredFormats",void 0),a([l({readOnly:!0})],ve.prototype,"state",null),a([l()],ve.prototype,"locationSymbol",void 0),a([l({readOnly:!0,dependsOn:["storageType"]})],ve.prototype,"storage",null),a([l()],ve.prototype,"storageEnabled",void 0),a([l()],ve.prototype,"storageType",void 0),a([l({readOnly:!0})],ve.prototype,"waitingForConversions",null),a([l()],ve.prototype,"view",void 0),ve=a([y("esri.widgets.CoordinateConversion.CoordinateConversionViewModel")],ve);var kn=ve;var Y="esri-coordinate-conversion",z={base:Y,captureMode:`${Y}--capture-mode`,noBasemap:`${Y}--no-basemap`,popup:`${Y}__popup`,clipboardPopup:`${Y}__clipboard-popup`,conversionList:`${Y}__conversion-list`,conversionRow:`${Y}__row`,coordDisplay:`${Y}__display`,expandButton:`${Y}__expand-button`,expanded:`${Y}__conversions-view--expanded`,expandDown:`${Y}__conversions-view--expand-down`,expandUp:`${Y}__conversions-view--expand-up`,conversionsView:`${Y}__conversions-view`,rowSelect:`${Y}__select-row`,toolDisplay:`${Y}__tools`,modeToggle:`${Y}__mode-toggle`,rowButton:`${Y}__row-button`,coordinateInput:`${Y}__input-coordinate`,inputForm:`${Y}__input-form`,inputFormGroup:`${Y}__input-group`,inputSelect:`${Y}__input-select`,sectionHeading:`${Y}__heading`,patternInput:`${Y}__pattern-input`,settings:`${Y}__settings`,settingsFormGroup:`${Y}__settings-group`,settingsFormGroupHorizontal:`${Y}__settings-group-horizontal`,previewCoordinate:`${Y}__preview-coordinate`},Id={settingsButton:!0,inputButton:!0,captureButton:!0,expandButton:!0},Cm=750,Tm=2500,K=class extends re{constructor(e,t){super(e,t),this._popupMessage=null,this._popupTimeoutId=void 0,this._clipboardPopupTimeoutId=void 0,this._coordinateInput=null,this._badInput=!1,this._goToEnabled=!1,this._conversionFormat=null,this._settingsFormat=null,this._previewConversion=null,this._expanded=!1,this._clipboardPopupVisible=!1,this._popupVisible=!1,this._settingsVisible=!1,this._inputVisible=!1,this.headingLevel=4,this.messages=null,this.messagesCommon=null,this.orientation="auto",this.viewModel=new kn,this.visibleElements=A({},Id)}loadDependencies(){return Ie({button:()=>import("./chunk-DLYYRWO3.js"),checkbox:()=>import("./chunk-UGZQDZ24.js"),input:()=>import("./chunk-J7DV7REQ.js"),label:()=>import("./chunk-PZOCZM37.js"),option:()=>import("./chunk-NJ6HRVGO.js"),select:()=>import("./chunk-TCKYKWO3.js")})}get conversions(){return this.viewModel.conversions}set conversions(e){this.viewModel.conversions=e}get currentLocation(){return this.viewModel.currentLocation}set currentLocation(e){this.viewModel.currentLocation=e}get formats(){return this.viewModel.formats}set formats(e){this.viewModel.formats=e}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(e){this.viewModel.goToOverride=e}get icon(){return"coordinate-system"}set icon(e){this._overrideIfSome("icon",e)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get mode(){return this.viewModel.mode}set mode(e){this.viewModel.mode=e}set multipleConversions(e){e===!1&&(this._expanded=!1,this.conversions.splice(1,this.conversions.length-1)),this._set("multipleConversions",e)}get multipleConversions(){let e=this._get("multipleConversions");return typeof e!="boolean"||e}get locationSymbol(){return this.viewModel.locationSymbol}set locationSymbol(e){this.viewModel.locationSymbol=e}get storageEnabled(){return this.viewModel.storageEnabled}set storageEnabled(e){this.viewModel.storageEnabled=e}get storageType(){return this.viewModel.storageType}set storageType(e){this.viewModel.storageType=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}castVisibleElements(e){return A(A({},Id),e)}reverseConvert(e,t){return this.viewModel.reverseConvert(e,t)}render(){let e=this.viewModel?.state,t=e==="disabled"?u("div",{key:"esri-coordinate__no-basemap"},this.messages?.noBasemap):null,i=!t&&this._inputVisible?this._renderInputForm():null,s=!t&&this._settingsVisible?this._renderSettings():null,o=t||i||s?null:this._renderConversionsView(),r=this._popupVisible?this._renderPopup():null,n={[z.captureMode]:this.mode==="capture",[$.disabled]:e==="loading",[z.noBasemap]:e==="disabled"};return u("div",{class:this.classes(z.base,$.widget,n)},r,t,o,s,i)}_addConversion(e){let t=e.target,i=t.selectedOption.value,s=Ed(t);if(i==null||s==null)return;let o=new qt({format:i});t.value="default",s>=0?(this.conversions.removeAt(s),this.conversions.add(o,s)):this.conversions.add(o)}_findSettingsFormat(){return this._settingsFormat||this.conversions.reduceRight((e,t)=>{let i=t.format;return i?.hasDisplayProperties?i:e},null)||this.formats.find(e=>e.hasDisplayProperties)}_hidePopup(){this._popupTimeoutId&&(clearTimeout(this._popupTimeoutId),this._popupTimeoutId=void 0),this._popupVisible=!1,this._popupMessage=null,this.scheduleRender()}_hideClipboardPopup(){this._clipboardPopupTimeoutId&&(clearTimeout(this._clipboardPopupTimeoutId),this._clipboardPopupTimeoutId=void 0),this._clipboardPopupVisible=!1,this.scheduleRender()}_onConvertComplete(){this._inputVisible=!1,this._coordinateInput.value=""}_onCopy(e){let t=Lm(e.currentTarget)?.displayCoordinate;t!=null&&(e.clipboardData?.setData("text/plain",t),this._showClipboardPopup(),e.preventDefault())}_processUserInput(e){let t=Ja(e,"key"),i=this.viewModel;if(t!=="Enter"&&t)this._badInput&&(this._badInput=!1);else{let s=this._conversionFormat||this.conversions.at(0).format;if(!s)return;let o=this._coordinateInput.value;this._reverseConvert(o,s).then(r=>{this.mode==="capture"?i.resume():this.mode="capture",this.currentLocation=r,i.setLocation(r),this._onConvertComplete()}).catch(r=>{P.getLogger(this).error(r),this._showPopup(this.messages?.invalidCoordinate),this._badInput=!0})}}_reverseConvert(e,t){return v(this,null,function*(){let i=this.viewModel,s=yield t.reverseConvert(e);return this._goToEnabled&&s&&i.goToLocation(s).catch(o=>{P.getLogger(this).warn(o),this._showPopup(this.messages?.locationOffBasemap)}),s})}_setInputFormat(e){let t=e.target.selectedOption.value;t!=null&&(this._conversionFormat=t)}_setPreviewConversion(){let e=this._findSettingsFormat(),t=this.viewModel;if(e){let i=this.conversions.find(s=>s.format===e);this._previewConversion=new qt({format:e,position:{location:this.currentLocation,coordinate:i?.position?.coordinate}}),this._previewConversion.position?.coordinate||t.previewConversion(this._previewConversion)}}_setSettingsFormat(e){let t=e.target.selectedOption.value;t!=null&&(this._settingsFormat=t,this._setPreviewConversion())}_showClipboardPopup(){this._clipboardPopupVisible?clearTimeout(this._clipboardPopupTimeoutId):this._clipboardPopupVisible=!0,this.scheduleRender(),this._popupTimeoutId=setTimeout(()=>{this._popupTimeoutId=void 0,this._hideClipboardPopup()},Cm)}_showPopup(e,t=Tm){this._popupMessage=e,this._popupVisible?clearTimeout(this._popupTimeoutId):this._popupVisible=!0,this.scheduleRender(),this._popupTimeoutId=setTimeout(()=>{this._popupTimeoutId=void 0,this._hidePopup()},t)}_toggleGoTo(){this._goToEnabled=!this._goToEnabled}_updateCurrentPattern(e){e.stopPropagation();let t=e.target,i=this._findSettingsFormat();i&&(i.currentPattern=t.value)}_renderConversion(e,t){let{messages:i}=this;if(!i)return u("li",null);let{format:s}=e,o=s?.label??"",r=`${this.id}__list-item-${t}`,n=`${o} ${i.conversionOutputSuffix}`,p=t===0,c=p||this._expanded,d=p?this._renderFirstConversion(e):this._renderTools(t,e,r),h=p&&!e.displayCoordinate?i.noLocation:e.displayCoordinate,m=u("div",{"aria-label":h,class:z.coordDisplay,"data-conversion":e,role:"listitem",tabIndex:0,title:h??""},h),f=this._renderOptions(this.formats.filter(w=>w!==s));return c?u("li",{"aria-label":n,class:z.conversionRow,id:r,key:e,role:"group",tabIndex:0,title:n},u("calcite-select",{"aria-controls":r,bind:this,class:z.rowSelect,"data-index":t,label:i.selectFormat,scale:"s",onCalciteSelectChange:this._addConversion},u("calcite-option",{label:o.toUpperCase(),selected:!0},o.toUpperCase()),f),m,d):null}_renderCopyButton(e){let t=this._clipboardPopupVisible&&this._renderClipboardPopup(),{messagesCommon:i}=this;return i?u("li",{"aria-label":i.copy,bind:this,class:this.classes($.widgetButton,z.rowButton),"data-conversion":e,onclick:this._copyCoordinateOutput,oncopy:this._onCopy,onkeydown:this._copyCoordinateOutput,role:"button",tabIndex:0,title:i.copy},t,u("span",{"aria-hidden":"true",class:ac.duplicate})):u("li",null)}_renderFirstConversion(e){let t=this.id,{messages:i,messagesCommon:s,multipleConversions:o,visibleElements:r}=this;if(!s||!i)return u("ul",null);let n=this.mode==="live"?i.captureMode:i.liveMode,p=this._expanded?s.collapse:s.expand,c=e.displayCoordinate&&this.mode==="capture"?this._renderCopyButton(e):null,d=o&&r.expandButton&&this._renderIconButton({iconType:this._expanded?"chevron-down":"chevron-up",clickFunction:this._toggleExpand,classes:[z.expandButton],attributes:{"aria-controls":`${t}__${z.conversionList}`,label:p}}),h=!o&&r.captureButton&&this._renderIconButton({iconType:this.mode==="live"?"pin-tear":"pin-tear-f",clickFunction:this._toggleMode,classes:[z.modeToggle],attributes:{label:n}});return u("ul",{class:z.toolDisplay},c,d,h)}_renderInputForm(){let e=this._conversionFormat||this.conversions.at(0).format,t=this.formats.findIndex(h=>h.name===e?.name),i=this.id,s=`${i}__${z.coordinateInput}`,o=`${i}__${z.coordinateInput}__header`,r=this._renderOptions(this.formats,!0,t),{messages:n,messagesCommon:p,headingLevel:c}=this;if(!p||!n)return u("div",null);let d=this._renderIconButton({iconType:Bt(this.container)?"arrow-right":"arrow-left",clickFunction:this._toggleInputVisibility,attributes:{label:p.back}});return u("div",{"aria-labelledby":o,class:z.inputForm,key:"esri-coordinate-conversion__input-form",role:"search"},u("div",{class:z.sectionHeading},d,u(Ke,{class:$.heading,id:o,level:c},n.inputCoordTitle)),u("div",{class:z.inputFormGroup},u("calcite-select",{"aria-controls":s,bind:this,class:z.inputSelect,label:n.selectFormat,scale:"s",onCalciteSelectChange:this._setInputFormat},r),u("calcite-input",{afterCreate:xl,"aria-labelledby":o,bind:this,class:z.coordinateInput,"data-format":e,"data-node-ref":"_coordinateInput",id:s,onkeydown:this._processUserInput,placeholder:n.inputCoordTitle,required:!0,scale:"s",spellcheck:!1,status:this._badInput?"invalid":"idle"})),u("div",{class:z.inputFormGroup},u("calcite-label",{layout:"inline",scale:"s"},u("calcite-checkbox",{bind:this,checked:this._goToEnabled,onCalciteCheckboxChange:this._toggleGoTo}),n.goTo),u("calcite-button",{appearance:"outline",bind:this,kind:"neutral",onclick:this._processUserInput,type:"button",width:"auto"},n.convert)))}_renderConversionsView(){let{messages:e}=this;if(!e)return u("div",null);let t=`${this.id}__${z.conversionList}`,i=this._renderPrimaryTools(),s=this._renderOptions(this.formats),o=this.conversions.map((p,c)=>this._renderConversion(p,c)).toArray(),r=this._expanded?u("div",{class:z.conversionRow},u("calcite-select",{"aria-controls":t,bind:this,"data-index":-1,label:e.addConversion,scale:"s",onCalciteSelectChange:this._addConversion},u("calcite-option",{disabled:!0,selected:!0,value:"default"},e.addConversion),s),i):null,n={[z.expanded]:this._expanded,[z.expandUp]:this.orientation==="expand-up",[z.expandDown]:this.orientation==="expand-down"};return u("div",{class:this.classes(z.conversionsView,n),key:"esri-coordinate-conversion__main-view"},u("ul",{"aria-expanded":this._expanded?"true":"false",class:z.conversionList,id:t},o),r)}_renderOptions(e,t,i){let s=this.conversions.at(0),o=s.format?.name;return e.map((r,n)=>{let p=!(t||!s)&&(o===r.name||this.conversions.map(c=>c.format?.name).includes(r.name));return u("calcite-option",{disabled:p,key:r.name??"unnamed-format",label:r.label.toUpperCase(),selected:n===i,value:r},r.label)}).toArray()}_renderPopup(){return u("div",{class:z.popup,role:"alert"},this._popupMessage)}_renderClipboardPopup(){let{messages:e}=this;return e?u("div",{class:this.classes(z.popup,z.clipboardPopup),role:"alert"},e.copySuccessMessage):u("div",null)}_renderPrimaryTools(){let{messages:e,visibleElements:t}=this;if(!e)return u("ul",null);let i=this.mode==="live"?e.captureMode:e.liveMode,s=t.inputButton&&this._renderIconButton({iconType:"pencil",clickFunction:this._toggleInputVisibility,attributes:{label:e.inputCoordTitle}}),o=t.captureButton&&this._renderIconButton({iconType:this.mode==="live"?"pin-tear":"pin-tear-f",clickFunction:this._toggleMode,classes:[z.modeToggle],attributes:{label:i}}),r=t.settingsButton&&this._renderIconButton({iconType:"gear",clickFunction:this._toggleSettingsVisibility,attributes:{label:e.settingsTitle}});return u("ul",{class:z.toolDisplay},s,o,r)}_renderSettings(){let e=this.id,t=`${e}__${z.patternInput}`,i=`${e}__${z.patternInput}__header`,s=`${e}__${z.previewCoordinate}`,o=this.formats.filter(S=>S.hasDisplayProperties),r=this._findSettingsFormat(),n=r?o.indexOf(r):-1,p=this._renderOptions(o,!0,n),c=r?.currentPattern,{messages:d,messagesCommon:h,headingLevel:m}=this;if(!h||!d)return u("div",null);let f=this._renderIconButton({iconType:Bt(this.container)?"arrow-right":"arrow-left",clickFunction:this._toggleSettingsVisibility,attributes:{label:h.back}}),w=this._renderIconButton({iconType:"refresh",clickFunction:this._setDefaultPattern,attributes:{label:d.defaultPattern}});return u("div",{"aria-labelledby":i,class:z.settings,key:z.settings},u("div",{class:z.sectionHeading},f,u(Ke,{class:$.heading,id:i,level:m},d.settingsTitle)),u("div",{class:z.settingsFormGroup},u("label",{for:t},d.changeCoordinateDisplay),u("calcite-select",{bind:this,label:d.selectFormat,width:"full",onCalciteSelectChange:this._setSettingsFormat},p),u("div",{class:z.settingsFormGroupHorizontal},u("calcite-input",{"aria-controls":s,bind:this,class:z.patternInput,id:t,spellcheck:!1,type:"text",value:c,onCalciteInputInput:this._updateCurrentPattern}),w)),u("div",{class:z.settingsFormGroup},u("label",null,h.preview,u("div",{class:z.previewCoordinate,id:s,tabIndex:0},this._previewConversion?.displayCoordinate))))}_renderIconButton(e){let{iconType:t,clickFunction:i,classes:s,attributes:o}=e;return u("calcite-button",A({appearance:"transparent",bind:this,class:this.classes(s),iconStart:t,kind:"neutral",onclick:i,onkeydown:i},o))}_renderTools(e,t,i){let s=t.displayCoordinate&&this.mode==="capture"?this._renderCopyButton(t):null,{messages:o}=this;if(!o)return u("ul",null);let r=this._renderIconButton({iconType:"x",clickFunction:this._removeConversion,attributes:{"aria-controls":i,label:o.removeConversion,"data-index":e}});return u("ul",{class:z.toolDisplay,role:"listitem"},s,u("li",{class:this.classes(z.rowButton)},r))}_copyCoordinateOutput(e){let t=e.target;if(!("createTextRange"in document.body)){let i=window.getSelection(),s=document.createRange();s.selectNodeContents(t),i?.removeAllRanges(),i?.addRange(s)}document.execCommand("copy")}_removeConversion(e){let t=Ed(e.currentTarget);t!=null&&this.conversions.removeAt(t)}_setDefaultPattern(e){e.stopPropagation();let t=this._findSettingsFormat();t&&(t.currentPattern=t.defaultPattern)}_toggleExpand(){this._expanded=!this._expanded}_toggleInputVisibility(){this._inputVisible=!this._inputVisible,this._popupVisible&&this._hidePopup(),this._inputVisible?this.viewModel.pause():this.viewModel.resume()}_toggleMode(){this.mode=this.mode==="live"?"capture":"live"}_toggleSettingsVisibility(){this._settingsVisible=!this._settingsVisible,this._popupVisible&&this._hidePopup(),this._settingsVisible?(this._setPreviewConversion(),this.viewModel.pause()):this.viewModel.resume()}};a([l()],K.prototype,"conversions",null),a([l()],K.prototype,"currentLocation",null),a([l()],K.prototype,"formats",null),a([l()],K.prototype,"goToOverride",null),a([l()],K.prototype,"headingLevel",void 0),a([l()],K.prototype,"icon",null),a([l()],K.prototype,"label",null),a([l(),Q("esri/widgets/CoordinateConversion/t9n/CoordinateConversion")],K.prototype,"messages",void 0),a([l(),Q("esri/t9n/common")],K.prototype,"messagesCommon",void 0),a([l()],K.prototype,"mode",null),a([l()],K.prototype,"orientation",void 0),a([l()],K.prototype,"multipleConversions",null),a([l()],K.prototype,"locationSymbol",null),a([l()],K.prototype,"storageEnabled",null),a([l()],K.prototype,"storageType",null),a([l()],K.prototype,"view",null),a([l({type:kn})],K.prototype,"viewModel",void 0),a([l()],K.prototype,"visibleElements",void 0),a([ge("visibleElements")],K.prototype,"castVisibleElements",null),a([Ee()],K.prototype,"_copyCoordinateOutput",null),a([Ee()],K.prototype,"_removeConversion",null),a([Ee()],K.prototype,"_setDefaultPattern",null),a([Ee()],K.prototype,"_toggleExpand",null),a([Ee()],K.prototype,"_toggleInputVisibility",null),a([Ee()],K.prototype,"_toggleMode",null),a([Ee()],K.prototype,"_toggleSettingsVisibility",null),K=a([y("esri.widgets.CoordinateConversion")],K);var Pd=K;function Ed(e){return e["data-index"]}function Lm(e){return e["data-conversion"]}var Kt=class extends C{constructor(e){super(e),this._viewpointHandle=null,this.group=null}initialize(){this.addHandles(fe(()=>this.view?.ui,"expand",e=>{let{target:t}=e;t&&t!==this&&t.expanded&&t.group&&t.group===this.group&&this._collapse()}))}destroy(){this._viewpointHandle=null,this.view=null}set autoCollapse(e){this._set("autoCollapse",e),this._watchViewpoint()}set expanded(e){let t=!!e;this._set("expanded",t);let i=this.view?.ui;i&&i.emit("expand",{target:this}),this._viewpointHandleChange(t)}get state(){return this.view?.ready?"ready":"disabled"}set view(e){this._get("view")!==e&&(this._set("view",e),e&&le(()=>e.ready,()=>{this.view===e&&this._watchViewpoint()},{once:!0,initial:!0}))}_viewpointHandleChange(e){this._viewpointHandle&&(e?le(()=>this.view?.stationary,()=>this._viewpointHandle?.resume(),{once:!0,initial:!0}):this._viewpointHandle.pause())}_watchViewpoint(){let e="viewpoint";this.removeHandles(e),this._viewpointHandle=null;let{autoCollapse:t,view:i}=this;if(!i||!t)return;let s=bl(()=>i.type==="3d"?i.camera:i.viewpoint,()=>this._collapse());this.addHandles(s,e),this._viewpointHandle=s}_collapse(){this.expanded=!1}};a([l({value:!1})],Kt.prototype,"autoCollapse",null),a([l({value:!1})],Kt.prototype,"expanded",null),a([l()],Kt.prototype,"group",void 0),a([l({readOnly:!0})],Kt.prototype,"state",null),a([l({value:null})],Kt.prototype,"view",null),Kt=a([y("esri.widgets.Expand.ExpandViewModel")],Kt);var Rn=Kt;var Be="esri-expand",Ve={base:Be,toggle:`${Be}__toggle`,popoverContent:`${Be}__popover-content`,panel:`${Be}__panel`,panelContent:`${Be}__panel-content`,sheet:`${Be}__sheet`,panelIconNumber:`${Be}__panel-icon-number`,contentContainer:`${Be}__content-container`,icon:"esri-collapse__icon",iconFlip:"esri-collapse__icon-flip",iconExpanded:`${Be}__icon--expanded`,iconNumber:`${Be}__icon-number`,content:`${Be}__content`,contentExpanded:`${Be}__content--expanded`},kd="chevrons-left",Rd="chevrons-right",te=class extends re{constructor(e,t){super(e,t),this.closeOnEsc=!0,this.collapseTooltip="",this.content="",this.expandTooltip="",this.iconNumber=0,this.messages=null,this.messagesCommon=null,this.mode="auto",this.placement=null,this.viewModel=new Rn,this.toggle=()=>{this.viewModel.expanded=!this.viewModel.expanded},this._handlePopoverClose=i=>{i.target===this._popoverEl&&(this.viewModel.expanded=i.target.open)},this._handleSheetClose=i=>{this.viewModel.expanded=i.target.open},this._handlePanelClose=i=>{this.viewModel.expanded=!i.target.closed},this._handleKeyDown=i=>{this.viewModel.expanded&&i.key==="Escape"&&!this._willCloseOnEsc(i)&&i.preventDefault()},this._storeToggleButtonEl=i=>{this._toggleButtonEl=i},this._storePopoverEl=i=>{this._popoverEl=i}}loadDependencies(){return Ie({button:()=>import("./chunk-DLYYRWO3.js"),icon:()=>import("./chunk-WEV76HGW.js"),panel:()=>import("./chunk-NV7KKZNY.js"),popover:()=>import("./chunk-MSHLXUFW.js"),sheet:()=>import("./chunk-5QZHF7HQ.js")})}get expandTitle(){let{expanded:e,messagesCommon:t,collapseTooltip:i,expandTooltip:s}=this;return(e?i||t?.collapse:s||t?.expand)??""}get _displaySheet(){switch(this.mode){case"drawer":return!0;case"auto":return this.viewModel.view?.widthBreakpoint==="xsmall";default:return!1}}get autoCollapse(){return this.viewModel.autoCollapse}set autoCollapse(e){this.viewModel.autoCollapse=e}get collapseIcon(){return Rd}set collapseIcon(e){this._overrideIfSome("collapseIcon",e)}get expanded(){return this.viewModel.expanded}set expanded(e){this.viewModel.expanded=e}get expandIcon(){return bo(this.content)?this.content.icon:kd}set expandIcon(e){this._overrideIfSome("expandIcon",e)}get group(){return this.viewModel.group}set group(e){this.viewModel.group=e}get icon(){return null}get label(){return(bo(this.content)?this.content.label:null)??this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}expand(){this.viewModel.expanded=!0}collapse(){this.viewModel.expanded=!1}render(){let{_displaySheet:e,_toggleButtonEl:t,viewModel:{expanded:i},label:s,placement:o}=this;return u("div",{class:this.classes(Ve.base,$.widget)},this._renderToggle(),e?u("calcite-sheet",{class:Ve.sheet,heightScale:"l",label:s,onkeydown:this._handleKeyDown,open:i,position:"block-end",onCalciteSheetClose:this._handleSheetClose},u("calcite-panel",{class:Ve.panel,closable:!0,closed:!i,heading:s,onkeydown:this._handleKeyDown,onCalcitePanelClose:this._handlePanelClose},u("div",{class:Ve.panelContent},this._renderContent()))):t?u("calcite-popover",{afterCreate:this._storePopoverEl,afterUpdate:this._storePopoverEl,label:s,onkeydown:this._handleKeyDown,open:i,overlayPositioning:"fixed",placement:o??this._getPlacement(),referenceElement:t,onCalcitePopoverClose:this._handlePopoverClose},u("div",{class:Ve.popoverContent},this._renderContent())):null)}_getPlacement(){let{container:e,view:t}=this,i=e&&t?t.ui.getPosition(e):null;if(!i||i==="manual")return"auto";let[s,o]=i.split("-");return`${o==="right"?"left":"right"}-${s==="bottom"?"end":"start"}`}_willCloseOnEsc(e){let{closeOnEsc:t}=this;return typeof t=="function"?t(e):t}_renderBadgeNumber(){let{expanded:e,iconNumber:t}=this;return t&&!e?u("span",{class:Ve.iconNumber,key:"expand__icon-number"},t):null}_renderToggleButton(){let{expanded:e,expandTitle:t,expandIcon:i,collapseIcon:s}=this,o=e?s:i,r=o===kd||o===Rd;return u("calcite-button",{afterCreate:this._storeToggleButtonEl,afterUpdate:this._storeToggleButtonEl,class:$.widgetButton,kind:"neutral",label:t,onclick:this.toggle,scale:"s",title:t},o?u("calcite-icon",{class:this.classes(Ve.icon,r&&Ve.iconFlip),icon:o,scale:"s"}):null)}_renderToggle(){return u("div",{class:Ve.toggle},this._renderToggleButton(),this._renderBadgeNumber())}_renderContent(){let{content:e}=this;return typeof e=="string"?u("div",{class:Ve.contentContainer,innerHTML:e,key:"content__string"}):bo(e)?u("div",{class:Ve.contentContainer,key:"content__widget"},e.render()):e instanceof HTMLElement?u("div",{afterCreate:this._attachToNode,bind:e,class:Ve.contentContainer,key:"content__html-element"}):pc(e)?u("div",{afterCreate:this._attachToNode,bind:e.domNode,class:Ve.contentContainer,key:"content__node"}):null}_attachToNode(e){let t=this;e.appendChild(t)}};a([l({readOnly:!0})],te.prototype,"expandTitle",null),a([l()],te.prototype,"_toggleButtonEl",void 0),a([l()],te.prototype,"_displaySheet",null),a([l()],te.prototype,"autoCollapse",null),a([l()],te.prototype,"closeOnEsc",void 0),a([l()],te.prototype,"collapseIcon",null),a([l()],te.prototype,"collapseTooltip",void 0),a([l()],te.prototype,"content",void 0),a([l()],te.prototype,"expanded",null),a([l()],te.prototype,"expandIcon",null),a([l()],te.prototype,"expandTooltip",void 0),a([l()],te.prototype,"group",null),a([l()],te.prototype,"icon",null),a([l()],te.prototype,"iconNumber",void 0),a([l()],te.prototype,"label",null),a([l(),Q("esri/widgets/Expand/t9n/Expand")],te.prototype,"messages",void 0),a([l(),Q("esri/t9n/common")],te.prototype,"messagesCommon",void 0),a([l()],te.prototype,"mode",void 0),a([l()],te.prototype,"placement",void 0),a([l()],te.prototype,"view",null),a([l({type:Rn})],te.prototype,"viewModel",void 0),te=a([y("esri.widgets.Expand")],te);var Dd=te;var Mt=class extends $i(Le.EventedAccessor){constructor(e){super(e),this._initialViewpoint=null,this._goingHomeController=null,this.go=this.go.bind(this)}destroy(){this._cancelGo(),this.view=null}get state(){return this.view?.ready?this._goingHomeController?"going-home":"ready":"disabled"}set view(e){this._initialViewpoint=null,this._set("view",e),e&&e.when().then(()=>{this.view===e&&(this._initialViewpoint=e.viewpoint.clone(),this.notifyChange("viewpoint"))})}get viewpoint(){return this._get("viewpoint")||this._initialViewpoint}set viewpoint(e){this._set("viewpoint",e)}go(){return v(this,null,function*(){if(!this.view?.ready)throw new x("home:disabled-state","Cannot go when disabled.");this._cancelGo(),this.emit("go");let e=new AbortController;this._goingHomeController=e;try{yield this.view?.when(),yield this.callGoTo({target:this.viewpoint,options:{signal:e.signal}})}catch{}this._goingHomeController=null})}cancelGo(){this._cancelGo()}_cancelGo(){let{_goingHomeController:e}=this;e&&e.abort(),this._goingHomeController=null}};a([l()],Mt.prototype,"_goingHomeController",void 0),a([l({readOnly:!0})],Mt.prototype,"state",null),a([l()],Mt.prototype,"view",null),a([l({type:Se})],Mt.prototype,"viewpoint",null),a([l()],Mt.prototype,"go",null),a([l()],Mt.prototype,"cancelGo",null),Mt=a([y("esri.widgets.Home.HomeViewModel")],Mt);var Dn=Mt;var Mm={base:"esri-home"},We=class extends re{constructor(e,t){super(e,t),this.messages=null,this.messagesCommon=null,this.uiStrings=void 0,this.viewModel=new Dn,this._go=()=>{let{viewModel:i}=this;i.state==="going-home"?i.cancelGo():i.go()}}loadDependencies(){return Ie({button:()=>import("./chunk-DLYYRWO3.js"),loader:()=>import("./chunk-C4B6QL4L.js")})}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(e){this.viewModel.goToOverride=e}get icon(){return"home"}set icon(e){this._overrideIfSome("icon",e)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}get viewpoint(){return this.viewModel.viewpoint}set viewpoint(e){this.viewModel.viewpoint=e}cancelGo(){this.viewModel.cancelGo()}go(){return this.viewModel.go()}render(){let{messagesCommon:e,messages:t,icon:i}=this,s=this.viewModel?.state,o=s==="going-home";return u("div",{class:this.classes(Mm.base,$.widget)},u("calcite-button",{class:$.widgetButton,disabled:s==="disabled",iconStart:o?void 0:i,kind:"neutral",label:t.widgetLabel,onclick:this._go,scale:o?"s":"m",title:s==="going-home"?e.cancel:t.title},o?u("calcite-loader",{inline:!0,label:""}):null))}};a([l()],We.prototype,"goToOverride",null),a([l()],We.prototype,"icon",null),a([l()],We.prototype,"label",null),a([l(),Q("esri/widgets/Home/t9n/Home")],We.prototype,"messages",void 0),a([l(),Q("esri/t9n/common")],We.prototype,"messagesCommon",void 0),a([l()],We.prototype,"uiStrings",void 0),a([l()],We.prototype,"view",null),a([l({type:Dn}),lc("go")],We.prototype,"viewModel",void 0),a([l()],We.prototype,"viewpoint",null),We=a([y("esri.widgets.Home")],We);var Vd=We;function Ad(e){return e==null||e.type==="simple"||e.type==="unique-value"||e.type==="class-breaks"||e.type==="dictionary"||e.type==="heatmap"}function zd(e,t,i){let s=e.effectiveClusterRenderer;if(!s||!("visualVariables"in s)||!s.visualVariables)return null;let o=s.visualVariables.find(h=>h.type==="size");if(!("stops"in o)||!o.stops)return null;let r=o.stops.find(h=>h.useMinValue),n=o.stops.find(h=>h.useMaxValue);if(r==null||n==null)return null;let p=i.featuresTilingScheme.getClosestInfoForScale(i.scale).level,c=o.field,d=t.getDisplayStatistics(p,c);return d?new Ms({field:o.field,minSize:e.clusterMinSize,minDataValue:d.minValue,maxSize:e.clusterMaxSize,maxDataValue:d.maxValue}):null}function Fd(e){let i=Math.floor(Math.log10(Math.abs(e)))+1,s=i<4||i>6?4:i,o=1e6,r=Math.abs(e)>=o?"compact":"standard";return to(e,{notation:r,minimumSignificantDigits:2,maximumSignificantDigits:s})}var Od=16,Im="https://utility.arcgis.com/sharing/tools/legend",Em="esri.layers.ImageryLayer",Pm="esri.layers.ImageryTileLayer",km="esri.layers.WCSLayer",Do=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i,Rm=new yl({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch"}),Vo=new Ni({size:6,outline:{color:[128,128,128,.5],width:.5}}),Dm=new ci({style:"solid"});function zn(e){return e.type==="flow"}function Hd(e){return e.type==="vector-field"}function Bd(e){return e.type==="raster-colormap"}function Wd(e){return e.type==="raster-stretch"}function Ud(e){return e.type==="raster-shaded-relief"}function qi(e){return e.declaredClass==="esri.renderers.SimpleRenderer"}function ui(e){return e.declaredClass==="esri.renderers.ClassBreaksRenderer"}function ks(e){return e.declaredClass==="esri.renderers.UniqueValueRenderer"}function Gd(e){return e.declaredClass==="esri.renderers.HeatmapRenderer"}function Vm(e){return Fn(e)||On(e)||Nn(e)||Am(e)}function Am(e){return e.declaredClass==="esri.renderers.PointCloudRGBRenderer"}function Fn(e){return e.declaredClass==="esri.renderers.PointCloudClassBreaksRenderer"}function On(e){return e.declaredClass==="esri.renderers.PointCloudStretchRenderer"}function Nn(e){return e.declaredClass==="esri.renderers.PointCloudUniqueValueRenderer"}function Zd(e){return e.declaredClass==="esri.renderers.DotDensityRenderer"}function qd(e){return e.declaredClass==="esri.renderers.PieChartRenderer"}function zm(e,t){return qi(e)||ui(e)||ks(e)||Gd(e)||Zd(e)||qd(e)?t.type==="2d"||Ad(e):Wd(e)||Bd(e)||Ud(e)||Fn(e)||On(e)||Nn(e)||Hd(e)||zn(e)}function Fm(e){return e.declaredClass==="esri.layers.BuildingSceneLayer"}function Vn(e){return e.declaredClass==="esri.layers.SubtypeGroupLayer"}function Om(e){return e.declaredClass==="esri.layers.VoxelLayer"}function Nm(e){return e.declaredClass==="esri.layers.WMSLayer"}function $m(e){return e.declaredClass==="esri.layers.WMTSLayer"}function An(e){return e.declaredClass==="esri.layers.MapImageLayer"}function Nd(e){return e.declaredClass==="esri.layers.TileLayer"}function Gi(e){return e.declaredClass===Em}function Ao(e){return e.declaredClass===Pm}function Hm(e){return e.declaredClass===km}function Bm(e){return e.type==="stretch-ramp"}function Wm(e){return("authoringInfo"in e?e?.authoringInfo:null)?.type==="univariate-color-size"}function Um(e){let t="authoringInfo"in e?e?.authoringInfo:null;return t?.type==="univariate-color-size"&&t?.univariateTheme==="above-and-below"}function $d(e){return"sublayers"in e}function It(e,t){return v(this,null,function*(){let i=yield io("esri/widgets/Legend/t9n/Legend");return e!=="previewTemplateAriaLabel"||t||(e="previewAriaLabel"),ni(i[e],{label:t})})}var Gm=new Ni({style:"path",path:"M10,5 L5,0 0,5 M5,0 L5,15",size:15,outline:{width:1,color:[85,85,85,1]}}),Zi={},pe=class extends C{constructor(e){super(e),this._hasColorRamp=!1,this._hasOpacityRamp=!1,this._hasSizeRamp=!1,this._webStyleSymbolCache=new Map,this._dotDensityUrlCache=new Map,this._scaleDrivenSizeVariable=null,this._hasClusterSizeVariable=!1,this._layerDefinitionExpressionClause=null,this.children=new D,this.layerView=null,this.layer=null,this.legendElements=[],this.parent=null,this.hideLayersNotInCurrentView=!1,this.keepCacheOnDestroy=!1,this.respectLayerDefinitionExpression=!1,this.respectLayerVisibility=!0,this.sublayerIds=[],this.title=null,this.view=null}initialize(){let e=()=>this.notifyChange("ready");this.addHandles([fe(()=>this.children,"change",t=>{let{added:i,removed:s}=t;i.forEach(o=>{let r=`activeLayerInfo-ready-watcher-${o.layer.uid}`;this.addHandles(_(()=>o.ready,e,O),r)}),s.forEach(o=>this.removeHandles(o.layer.uid)),e()})]),this.keepCacheOnDestroy||(Zi={})}destroy(){this._webStyleSymbolCache=null,this._dotDensityUrlCache=null,this._scaleDrivenSizeVariable=null,this.keepCacheOnDestroy||(Zi=null),this._layerDefinitionExpressionClause=null}get effectList(){let e=this.layer,t=null;return"effect"in e&&e.effect&&(t=new cc,t.effect=e.effect,t.endTransitions(),t.scale=this.scale),t}get opacity(){let e=this.layer.opacity,t=this.parent?.opacity,i=this.layer.parent,s=i&&"uid"in i?this._getParentLayerOpacity(i):null;return t!=null?t*e:s!=null?s*e:e}get ready(){return this.layer===null||(this.children.length>0?this._isGroupActive():this.legendElements.length>0)}get scale(){return this.view?.scale??0}get isScaleDriven(){let e=this.layer;if(e===null)return!1;if("effect"in e&&e.effect&&Array.isArray(e.effect))return!0;if("featureReduction"in e&&e.featureReduction){if(e.featureReduction.type==="cluster")return!0;if(e.featureReduction.type==="binning"&&"renderer"in e.featureReduction&&e.featureReduction.renderer)return this._isRendererScaleDriven(e.featureReduction.renderer)}return"renderer"in e&&e.renderer?this._isRendererScaleDriven(e.renderer):this._isLayerScaleDriven(this.layer)}get version(){return this._get("version")+1}buildLegendElementsForFeatureCollections(e){return v(this,null,function*(){if(!(!this.hideLayersNotInCurrentView||(yield this._isLayerInCurrentView())))return this.legendElements=[],void this.notifyChange("ready");let t=Array.from(e,i=>{if(tp(i))return this._getRendererLegendElements(i.renderer,{title:i.title});if(i.featureSet?.features.length){let s=i.layerDefinition,o=s?.drawingInfo,r=o&&qp(o.renderer),n=Rm.read(s.geometryType);return r?this._getRendererLegendElements(r,{title:i.name,geometryType:n}):(P.getLogger(this).warn("drawingInfo not available!"),null)}return null});try{let i=[],s=yield Promise.allSettled(t);for(let o of s)if(o.status==="fulfilled")for(let r of o.value??[])i.push(r);this.legendElements=i,this.notifyChange("ready")}catch(i){P.getLogger(this).warn("error while building legend for layer!",i)}})}buildLegendElementsForRenderer(e){return v(this,null,function*(){try{let t=!this.hideLayersNotInCurrentView||(yield this._isLayerInCurrentView());this.legendElements=t?yield this._getRendererLegendElements(e):[],this.notifyChange("ready")}catch(t){P.getLogger(this).warn("error while building legend for layer!",t)}})}buildLegendElementsForFeatureReduction(e){return v(this,null,function*(){try{let t=!this.hideLayersNotInCurrentView||(yield this._isLayerInCurrentView());this.legendElements=t?yield this._getLegendElementsForFeatureReduction(e):[],this.notifyChange("ready")}catch(t){P.getLogger(this).warn("error while building legend for layer!",t)}})}buildLegendElementsForTools(){return v(this,null,function*(){let e=this.layer;if(Om(e))this._constructLegendElementsForVoxelLayer();else if($m(e))this._constructLegendElementsForWMTSlayer();else if(Nm(e))yield this._constructLegendElementsForWMSSublayers();else if(Fm(e))yield this._constructLegendElementsForBuildingSceneLayer();else if(An(e)||Nd(e)||Vn(e))yield this._constructLegendElementsForSublayers();else{this.removeHandles("imageryLayers-watcher");let t="default";if(Gi(e)&&(t=(e?.rasterFunction?.functionName||"default")+"_"+(e.bandIds?.length?e.bandIds.join(""):"###")),Ao(e))return;yield this._getLegendLayers(`${e.uid}-${t}`).then(i=>v(this,null,function*(){this.legendElements=[],this.notifyChange("ready");let s=i.map(o=>v(this,null,function*(){if(Gi(e)){let n=_(()=>["renderingRule"in e&&e.rasterFunction,e.bandIds],()=>al(()=>v(this,null,function*(){Zi.default=null,e.renderer?yield this.buildLegendElementsForRenderer(e.renderer):yield this.buildLegendElementsForTools()}))());this.addHandles(n,"imageryLayers-watcher")}let r=this._generateSymbolTableElementForLegendLayer(o);r?.infos.length&&(Gi(e)&&(r.title=e.title),this.legendElements.push(r)),this.notifyChange("ready")}));yield Promise.allSettled(s)})).catch(i=>{P.getLogger(this).warn("Request to server for legend has failed!",i)})}})}_isLayerInCurrentView(){return v(this,null,function*(){let e=this.layer,t=this.layerView,i=t&&"createQuery"in t&&"queryFeatureCount"in t;if(!i&&!(t&&"createQuery"in e&&"queryFeatureCount"in e))return!0;yield nt(()=>!t.updating);let s=i?"createQuery"in t&&t.createQuery():"createQuery"in e&&e.createQuery();return s?(s.geometry=this.view.extent,(i?"queryFeatureCount"in t&&(yield t.queryFeatureCount(s)):"queryFeatureCount"in e&&(yield e.queryFeatureCount(s)))!==0):!0})}_getParentLayerOpacity(e){let t=1,i=e.parent;return i&&"uid"in i&&(t=this._getParentLayerOpacity(i)),e.opacity*t}_isGroupActive(){return this.children.some(e=>e.ready)}_isRendererScaleDriven(e){if(e.type==="dot-density")return!0;let t="valueExpression"in e?e.valueExpression:null;return Do.test(t)?!0:!!("visualVariables"in e?e.visualVariables:null)?.some(s=>this._isScaleDrivenSizeVariable(s))||this._hasScaleDrivenSymbols(e)}_hasScaleDrivenSymbols(e){switch(e.type){case"simple":return this._isScaleDrivenSymbol(e.symbol);case"class-breaks":return this._isScaleDrivenSymbol(e.defaultSymbol)||e.classBreakInfos.some(t=>this._isScaleDrivenSymbol(t.symbol));case"unique-value":return this._isScaleDrivenSymbol(e.defaultSymbol)||!!e.uniqueValueInfos?.some(t=>this._isScaleDrivenSymbol(t.symbol))}return!1}_isScaleDrivenSymbol(e){if(e?.type==="cim"){let{primitiveOverrides:t,minScale:i,maxScale:s}=e.data,o=t?.some(r=>/\$view\.scale/.test(r.valueExpressionInfo?.expression||""))??!1;return i!=null||s!=null||o}return!1}_isScaleDrivenSizeVariable(e){if(e&&e.type!=="size")return!1;let t=e,i=t.minSize,s=t.maxSize;return!(typeof i!="object"||!i||!this._isScaleDrivenSizeVariable(i))||!(typeof s!="object"||!s||!this._isScaleDrivenSizeVariable(s))||Do.test(t.valueExpression)}_isLayerScaleDriven(e){if("minScale"in e&&e.minScale>0||"maxScale"in e&&e.maxScale>0)return!0;if("sublayers"in e&&e.sublayers)return e.sublayers.some(i=>this._isLayerScaleDriven(i));let t=e.parent;if(e.loaded===!1&&t&&An(t)&&"source"in e&&e.source&&e.source.type==="map-layer"){for(let i of t.sourceJSON.layers??[])if(i.id===e.source.mapLayerId&&(i.minScale>0||i.maxScale>0))return!0}return!1}_constructLegendElementsForVoxelLayer(){return v(this,null,function*(){this.legendElements=[],this.removeHandles("voxel-style-watcher"),this.removeHandles("voxel-current-variable");let e=this.layer;this.addHandles(_(()=>e.currentVariableId,()=>this._constructLegendElementsForVoxelLayer()),"voxel-current-variable"),this.addHandles(_(()=>e.getVariableStyles(),()=>this._constructLegendElementsForVoxelLayer()),"voxel-style-watcher");let t=e.getVariableStyle(null),i=[];if(t){if(t.uniqueValues?.length){let r=[];t.uniqueValues.forEach(n=>{n.enabled&&r.push({label:n.label||`${n.value}`,value:n.value,symbol:new ci({color:n.color,outline:null})})}),r.length&&i.push({type:"symbol-table",title:t.label,infos:r})}else if(t.transferFunction){let{colorStops:r,stretchRange:n}=t.transferFunction,p=r.toArray().reverse(),c=n.map((h,m)=>`${m===0?yc:vc} ${Fd(h)}`).reverse(),d=p.map(h=>({color:h.color,value:null,label:null}));d[0].label=c[0],d[d.length-1].label=c[1],i.push({type:"color-ramp",title:t.label,infos:d,preview:St(p.map(h=>h.color),{ariaLabel:yield It("previewColorRampAriaLabel")})})}}let s=e.opacity,o=i.reduce((r,n)=>[...r,...this._getAllInfos(n)],[]).filter(r=>!!r?.symbol).map(r=>this._getSymbolPreview(r,s));yield Promise.allSettled(o),this.legendElements=i,this.notifyChange("ready")})}_constructLegendElementsForWMTSlayer(){this.legendElements=[],this.removeHandles("wmts-activeLayer-watcher");let e=this.layer.activeLayer;this.addHandles(_(()=>{let{layer:i}=this;return i&&"activeLayer"in i&&i.activeLayer},()=>this._constructLegendElementsForWMTSlayer()),"wmts-activeLayer-watcher");let t=e.styleId?e.styles?.find(({id:i})=>i===e.styleId)?.legendUrl:void 0;t&&(this.legendElements=[{type:"symbol-table",title:e.title,infos:[{src:t,opacity:this.opacity}]}]),this.notifyChange("ready")}_constructLegendElementsForWMSSublayers(){return v(this,null,function*(){this.legendElements=[],this.removeHandles("wms-sublayers-watcher");let e=this.layer,t=null;(e.customParameters||e.customLayerParameters)&&(t=A(A({},e.customParameters),e.customLayerParameters)),this.addHandles(_(()=>{let{layer:i}=this;return i&&"sublayers"in i&&i.sublayers},()=>this._constructLegendElementsForWMSSublayers()),"wms-sublayers-watcher"),this.legendElements=yield this._generateLegendElementsForWMSSublayers(e.sublayers,t),this.notifyChange("ready")})}_generateLegendElementsForWMSSublayers(e,t){return v(this,null,function*(){let i=this.layer,s=[];this.addHandles(e.on("change",()=>this._constructLegendElementsForWMSSublayers()),"wms-sublayers-watcher");let o=this.sublayerIds?.map(n=>i.findSublayerById(n))?.filter(we)??[],r=o.length?o:e.toArray();for(let n of r){let p=_(()=>[n.title,n.visible,n.legendEnabled],()=>this._constructLegendElementsForWMSSublayers());if(this.addHandles(p,"wms-sublayers-watcher"),!this.respectLayerVisibility||n.visible&&n.legendEnabled){let c=yield this._generateSymbolTableElementForWMSSublayer(n,t);c?.infos.length&&s.unshift(c)}}return s})}_generateSymbolTableElementForWMSSublayer(e,t){return v(this,null,function*(){if(!e.legendUrl&&e.sublayers){let i=(yield this._generateLegendElementsForWMSSublayers(e.sublayers,t)).filter(s=>s);return{type:"symbol-table",title:e.title,infos:i}}return this._generateSymbolTableElementForLegendUrl(e,t)})}_generateSymbolTableElementForLegendUrl(e,t){return v(this,null,function*(){let i=e.legendUrl;if(!i)return;let s={type:"symbol-table",title:e.title||e.name||String(e.id??""),infos:[]};t&&(i=fl(i,t));let o=null,r=e.layer?.opacity;try{o=(yield qr(i,{responseType:"image"})).data,o&&(o.style.opacity=r)}catch{}return s.infos.push({src:i,preview:o,opacity:r}),s})}_getLegendLayers(e,t){let i=Zi&&Zi[e];return i?Promise.resolve(i):this._legendRequest(t).then(s=>{let o=s.layers;return Zi[e]=o,o})}_legendRequest(e){let t=this.layer,i={f:"json",dynamicLayers:e};if(Gi(t)){let o=t.exportImageServiceParameters.rasterFunction;if(o&&(i.renderingRule=JSON.stringify(o.functionDefinition?.toJSON()||o.toJSON())),t.bandIds&&(i.bandIds=t.bandIds.join()),t.raster||t.viewId||t.customParameters){let{raster:r,viewId:n,customParameters:p}=t;i=A(A({raster:r,viewId:n},i),p)}}let s=t.url.replace(/(\/)+$/,"");if("version"in t&&+t.version>=10.01){let o=s.indexOf("?");o>-1?s=s.substring(0,o)+"/legend"+s.substring(o):s+="/legend"}else{let o=s.toLowerCase().indexOf("/rest/"),r=s.substring(0,o)+s.substring(o+5,s.length);s=Im+"?soapUrl="+encodeURI(r)+"&returnbytes=true"}return qr(s,{query:i}).then(o=>o.data)}_constructLegendElementsForBuildingSceneLayer(){return v(this,null,function*(){this.legendElements=[],this.removeHandles("sublayers-watcher");let e=this.layer;this.addHandles(_(()=>e.sublayers,()=>this._constructLegendElementsForBuildingSceneLayer()),"sublayers-watcher");try{this.legendElements=yield this._generateLegendElementsForBuildingSublayers(e.sublayers,this.opacity),this.notifyChange("ready")}catch(t){P.getLogger(this).warn("Request to server for legend has failed!",t)}})}_generateLegendElementsForBuildingSublayers(e,t){return v(this,null,function*(){let i=[];this.addHandles(e.on("change",()=>this._constructLegendElementsForBuildingSceneLayer()),"sublayers-watcher");let s=e.toArray();for(let o of s){let r=_(()=>["renderer"in o&&o.renderer,o.opacity,o.title,o.visible],()=>this._constructLegendElementsForBuildingSceneLayer());if(this.addHandles(r,"sublayers-watcher"),!this.respectLayerVisibility||o.visible){let n=o?.opacity!=null?o.opacity:null,p=n!=null?n*t:t;if(o.type==="building-group"){let c={type:"symbol-table",title:o.title,infos:[]},d=yield this._generateLegendElementsForBuildingSublayers(o.sublayers,p);c.infos.push(...d),i=[c,...i]}else o.renderer&&(i=[...yield this._getRendererLegendElements(o.renderer,{title:o.title,opacity:p,sublayer:o}),...i])}}return i.filter(o=>!!o&&(!("infos"in o)||!o.infos||o.infos.length>0))})}_constructLegendElementsForSublayers(){return v(this,null,function*(){this.legendElements=[],this.removeHandles("sublayers-watcher");let e=this.layer;if(An(e)||Nd(e)||Vn(e)){this.addHandles(_(()=>e.sublayers,()=>this._constructLegendElementsForSublayers),"sublayers-watcher");try{this.legendElements=yield this._generateLegendElementsForSublayers(e.sublayers,this.opacity),this.notifyChange("ready")}catch(t){P.getLogger(this).warn("Request to server for legend has failed!",t)}}})}_generateLegendElementsForSublayers(e,t,i){return v(this,null,function*(){let s=this.layer,o=[];this.addHandles(e.on("change",()=>this._constructLegendElementsForSublayers()),"sublayers-watcher");let r=e.toArray();!i&&this.sublayerIds&&this.sublayerIds.length&&(r=Vn(s)?this.sublayerIds.map(n=>s.findSublayerForSubtypeCode(n)).filter(we):this.sublayerIds.map(n=>s.findSublayerById(n)).filter(we));for(let n of r){let p=_(()=>[n.renderer,n.opacity,n.title,n.visible,n.legendEnabled],()=>this._constructLegendElementsForSublayers());if(this.addHandles(p,"sublayers-watcher"),!this.respectLayerVisibility||n.visible&&n.legendEnabled&&this._isSublayerInScale(n)){let c=n?.opacity!=null?n.opacity:null,d=c!=null?c*t:t,h=!$d(n)||n.originIdOf("renderer")>Ii.SERVICE&&!n.sublayers;if(n.renderer&&h)yield n.load(),o=[...yield this._getRendererLegendElements(n.renderer,{title:n.title,opacity:d,sublayer:n}),...o];else if($d(n)){let m=yield this._generateSymbolTableElementForSublayer(n,d,i);m&&o.unshift(m)}}}return o.filter(n=>!!n&&(!("infos"in n)||!n.infos||n.infos.length>0))})}_generateSymbolTableElementForSublayer(e,t,i){return v(this,null,function*(){if(!i){i=new Map;let o=this.layer,r=e.source,n=null;if(!(!r||r.type==="map-layer"&&r.mapLayerId===e.id&&(!r.gdbVersion||r.gdbVersion===("gdbVersion"in o&&o.gdbVersion)))||e.originIdOf("renderer")>Ii.SERVICE||e.originIdOf("labelingInfo")>Ii.SERVICE||e.originIdOf("labelsVisible")>Ii.SERVICE){let c=new sc({layer:this.layer});n=c.hasDynamicLayers?c.dynamicLayers:null,c.destroy()}let p=n||`${o.uid}-default`;(yield this._getLegendLayers(p,n)).forEach(c=>i.set(c.layerId,c))}let s=i.get(e.id);if((!s||s?.subLayerIds&&s.defaultVisibility)&&e.sublayers){let o=yield this._generateLegendElementsForSublayers(e.sublayers,t,i);return{type:"symbol-table",title:e.title,infos:o}}return this._generateSymbolTableElementForLegendLayer(s,e,t)})}_generateSymbolTableElementForLegendLayer(e,t,i){if(!e?.legend||this.respectLayerVisibility&&!this._isLegendLayerInScale(e,t))return null;let s=t?.renderer,o=t?.title||e.layerName;if(s&&(!t||t?.originIdOf("renderer")>Ii.SERVICE)){let p=t?.title||this._getRendererTitle(s,t);p&&(o&&typeof p!="string"&&"title"in p&&(p.title=o),o=p)}let r={type:"symbol-table",title:o,legendType:e.legendType||null,infos:[]},n=t?this._sanitizeLegendForSublayer(e.legend.slice(),t):e.legend;return e.legendGroups&&e.legendGroups.length>0?e.legendGroups.forEach(p=>{let c={type:"symbol-table",title:p.heading,legendType:e.legendType||null,infos:this._generateSymbolTableElementInfosForLegendLayer(n.filter(d=>d.groupId===p.id),e.layerId,i)};c.infos?.length>0&&r.infos.push(c)}):r.infos=this._generateSymbolTableElementInfosForLegendLayer(n,e.layerId,i),r.infos.length>0?r:null}_generateSymbolTableElementInfosForLegendLayer(e,t,i){return e.map(s=>{let o=s.url;if(s.imageData&&s.imageData.length>0)o=`data:image/png;base64,${s.imageData}`;else{if(o.indexOf("http")===0)return null;o=gl(`${this.layer.url}/${t}/images/${o}`)}return{label:s.label,src:o,opacity:i??this.opacity,width:s.width,height:s.height}}).filter(we)}_isSublayerInScale(e){let t=e.minScale||0,i=e.maxScale||0;return!(t>0&&t<this.scale||i>this.scale)}_isLegendLayerInScale(e,t){let i=t||this.layer,s=null,o=null,r=!0;return!i.minScale&&i.minScale!==0||!i.maxScale&&i.maxScale!==0?(e.minScale===0&&i.tileInfo&&(s=i.tileInfo.lods[0].scale),e.maxScale===0&&i.tileInfo&&(o=i.tileInfo.lods[i.tileInfo.lods.length-1].scale)):(s=Math.min(i.minScale,e.minScale)||i.minScale||e.minScale,o=Math.max(i.maxScale,e.maxScale)),(s>0&&s<this.scale||o>this.scale)&&(r=!1),r}_sanitizeLegendForSublayer(e,t){if("version"in this.layer&&+this.layer.version<10.1||e.length===0)return e;let i=t.renderer,s=e.some(n=>n.values),o=0,r=null;return s&&e.some((n,p)=>(n.values||(o=p,r=n,r.label||(r.label="others")),r!=null)),i?i.type==="unique-value"?r&&(e.splice(o,1),e.push(r)):i.type==="class-breaks"&&(r&&e.splice(o,1),e.reverse(),r&&e.push(r)):r&&(e.splice(o,1),e.push(r)),e}_getRendererLegendElements(i){return v(this,arguments,function*(e,t={}){if(!zm(e,this.view))return P.getLogger(this).warn(`Renderer of type '${e.type}' not supported!`),[];if(Vm(e))return this._constructPointCloudRendererLegendElements(e,t);if(Zd(e))return this._constructDotDensityRendererLegendElements(e);let s=yield this._loadRenderer(e);return qd(s)?this._constructPieChartRendererLegendElements(s):this._constructRendererLegendElements(s,t)})}_getLegendElementsForFeatureReduction(e){return v(this,null,function*(){let t=null;return e.type==="binning"?t=e.renderer:e.type==="cluster"&&(t=this._getClusterRenderer(e)),t?this._getRendererLegendElements(t):[]})}_getPointCloudRendererTitle(e){return(e.legendOptions?.title||e.field)??""}_constructPointCloudRendererLegendElements(i){return v(this,arguments,function*(e,t={}){let s=t.title,o=[],r=null,n=null;if(Fn(e))r={type:"symbol-table",title:s||this._getPointCloudRendererTitle(e),infos:[]},e.colorClassBreakInfos.forEach(c=>{r.infos.unshift({label:c.label||c.minValue+" - "+c.maxValue,value:[c.minValue,c.maxValue],symbol:this._getAppliedCloneSymbol(Vo,c.color)})});else if(On(e)){let c=e.stops,d=null;if(c?.length&&(c.length===1&&(d=c[0].color),!d)){let m=c[0].value,f=c[c.length-1].value;m!=null&&f!=null&&(d=xc(m+(f-m)/2,c))}r={type:"symbol-table",title:null,infos:[{label:null,value:null,symbol:this._getAppliedCloneSymbol(Vo,d||Vo.color)}]};let h=Sc(e.stops??[])??[];n={type:"color-ramp",title:s||this._getPointCloudRendererTitle(e),infos:h,preview:St(h.map(m=>m.color),{ariaLabel:yield It("previewColorRampAriaLabel")})}}else Nn(e)&&(r={type:"symbol-table",title:s||this._getPointCloudRendererTitle(e),infos:[]},e.colorUniqueValueInfos?.forEach(c=>{r.infos.push({label:c.label||c.values.join(", "),value:c.values.join(", "),symbol:this._getAppliedCloneSymbol(Vo,c.color)})}));r?.infos.length&&o.push(r),n?.infos.length&&o.push(n);let p=o.reduce((c,d)=>[...c,...d.infos??[]],[]).filter(c=>!!c.symbol).map(c=>this._getSymbolPreview(c,this.opacity,{symbolConfig:{applyColorModulation:!!e.colorModulation}}));return yield Promise.allSettled(p),o})}_getElementInfoForDotDensity(e,t){return v(this,null,function*(){let{color:i,label:s,valueExpressionTitle:o}=t,{backgroundColor:r,outline:n,dotSize:p}=e,c=this.effectList,d=c?.effects.map(b=>b.toJSON()),h=pp(d),m=yield It("previewTemplateAriaLabel",s||o),f=p+"-"+i+"-"+r+"-"+(n&&JSON.stringify(n.toJSON()))+"-"+h,w=this._dotDensityUrlCache,S=w.has(f)?w.get(f):Ic(e,i,{ariaLabel:m});w.set(f,S);let T={shape:{type:"image",x:0,y:0,width:S.width,height:S.height,src:S.src},fill:null,stroke:null,offset:[0,0]},F=mc([[T]],[S.width,S.height],{effectView:this.effectList,ariaLabel:m});return{opacity:1,src:S.src,preview:F,width:S.width,height:S.height}})}_constructDotDensityRendererLegendElements(e){return v(this,null,function*(){let t=e.calculateDotValue(this.view.scale),i=e.legendOptions?.unit,s={type:"symbol-table",title:{value:t&&Math.round(t),unit:i||""},infos:[]};for(let o of e.attributes){let r=yield this._getElementInfoForDotDensity(e,o);r.label=o.label||o.valueExpressionTitle||o.field,s.infos.push(r)}return[s]})}_constructPieChartRendererLegendElements(e){return v(this,null,function*(){let t=this.layer.opacity,i=[],s=null,o=e.outline;e.attributes.forEach(c=>{let d=new Ni({color:c.color,outline:o}),h=c.label||c.valueExpressionTitle||c.field;i.push({label:h,symbol:d})});let r=i.length?[...i]:[];if(e.othersCategory?.color&&e.othersCategory?.threshold!==0){let c=new Ni({color:e.othersCategory.color,outline:o});s=e.othersCategory.label||"Other",i.push({label:s,symbol:c})}if(e.defaultColor?.a){let c=new Ni({color:e.defaultColor,outline:o});i.push({label:e.defaultLabel,symbol:c})}let n=(yield this._getVisualVariableLegendElements(e,this.layer))||[];if(i.length){n.unshift({type:"symbol-table",title:null,infos:i});let c=r.filter(h=>h.label!==s).map(h=>h.symbol.color).filter(Boolean),d=Ec(c,{holePercentage:e.holePercentage,backgroundColor:e.backgroundFillSymbol?.color,effectList:this.effectList,outline:o,ariaLabel:yield It("previewPieChartAriaLabel")});n.unshift({type:"pie-chart-ramp",title:this._getRendererTitle(e,this.layer),infos:i,preview:d})}let p=n.reduce((c,d)=>[...c,...this._getAllInfos(d)],[]).filter(c=>!!c?.symbol&&!c?.preview).map(c=>this._getSymbolPreview(c,t,{effectList:this.effectList}));return yield Promise.allSettled(p),n})}_constructRendererLegendElements(i){return v(this,arguments,function*(e,t={}){let{title:s,sublayer:o}=t,r=o||this.layer,n=vn(e);"definitionExpression"in r&&r.definitionExpression&&!this._layerDefinitionExpressionClause&&this.respectLayerDefinitionExpression&&(this._layerDefinitionExpressionClause=yield cp(r.definitionExpression,r.fieldsIndex)),this._hasColorRamp=!1,this._hasOpacityRamp=!1,this._hasSizeRamp=!1,this._scaleDrivenSizeVariable=null;let p=(yield this._getVisualVariableLegendElements(e,r))||[],c={type:"symbol-table",title:s||this._getRendererTitle(e,r),infos:[]},d=null,h=!1,m=new Set;if(zn(e)&&!this._hasSizeRamp){let b=yield _c(e);c.infos.push({label:null,symbol:b})}else if(Wm(e)){let b=s,L=Um(e)?"univariate-above-and-below-ramp":"univariate-color-size-ramp",g=p.findIndex(it=>it.type==="color-ramp"),M=g!==-1?p.splice(g,1)[0]:null,k=p.findIndex(it=>it.type==="size-ramp"),H=k!==-1?p.splice(k,1)[0]:null,G=[];M&&(b=M.title,G.push(M)),H&&(b=H.title,G.push(H)),G.length>0&&p.push({type:L,title:b,infos:G})}else if(Gd(e)){let b=kc(e);p.push({type:"heatmap-ramp",title:s||this._getRendererTitle(e,r),infos:b,preview:St(b.map(L=>L.color),{effectList:this.effectList,ariaLabel:yield It("previewColorRampAriaLabel")})})}else if(ks(e)){let b=e&&e.authoringInfo;if(b&&b.type==="relationship"){let{numClasses:L,field1:g,field2:M}=b,k=b.focus;if(L&&g&&M){let H=[g,M],G=gc(k)||0;for(let Fe of H){let{field:$t,normalizationField:Li,label:Ks}=Fe,Ys=Ks||{field:this._getFieldAlias($t,r),normField:Li&&this._getFieldAlias(Li,r)},ys=Gm.clone();ys.angle=G,c.infos.push({label:Ys,symbol:ys}),m.add(ys),G+=90}let it=fc({focus:k,numClasses:L,infos:e.uniqueValueInfos??[]});p.unshift(it)}}else if(Gi(this.layer)||Ao(this.layer)){let{field:L,field2:g}=e;e.uniqueValueInfos?.forEach(M=>{M.symbol&&(L&&this._checkDefinitionExpression(L,M.value)||g)&&c.infos.push({label:M.label||M.value,value:M.value,symbol:M.symbol})})}else{let{field:L,field2:g,field3:M,fieldDelimiter:k,valueExpression:H,defaultSymbol:G}=e,it=!(!L&&!H||!g&&!M),Fe=[];if(e.uniqueValueGroups?.forEach($t=>{let Li={type:"symbol-table",title:$t.heading,infos:[]};$t.classes?.forEach(Ks=>{let{symbol:Ys,values:ys}=Ks;if(Ys){let Ga=[],Za=[];for(let Qs of ys??[]){let{value:qa,value2:ja,value3:Ka}=Qs,vs=[],Xs=[];(L||H)&&(vs.push(qa),Xs.push(this._getDomainName(L,qa,r))),g&&(vs.push(ja),Xs.push(this._getDomainName(g,ja,r))),M&&(vs.push(Ka),Xs.push(this._getDomainName(M,Ka,r))),Ga.push(it?vs.join(k||""):vs[0]),Za.push(Xs.join(" - "))}let Vr=Ga.join(", "),Ar=Ks.label;if(!Ar){let Qs=Za.filter(Boolean);Ar=Qs.length?Qs.join(", "):Vr}let zr=Ys.clone();zr.type==="cim"&&n&&dc(zr,{innerDotSize:.5*Od,outerRingSize:Od}),(this._checkDefinitionExpression(L,Vr)||g)&&Li.infos.push({label:Ar,value:Vr,symbol:zr})}}),Li.infos.length&&Fe.push(Li)}),Fe.length){let $t=Fe[0];Fe.length===1&&"title"in $t&&!$t.title?c.infos.push(...$t.infos??[]):(G&&(Fe.push({type:"symbol-table",infos:[{label:e.defaultLabel||"others",symbol:G}]}),h=!0),c.infos.push(...Fe)),s||e.legendOptions?.title||e.valueExpressionTitle||(c.title=null)}}e.defaultSymbol&&!h&&(c.infos.push({label:e.defaultLabel||"others",symbol:e.defaultSymbol}),h=!0)}else if(ui(e)){if(!n){if(d=this._isUnclassedRenderer(e),!d||!this._hasSizeRamp){let b=e.classBreakInfos.filter(({symbol:L})=>L);for(let{label:L,minValue:g,maxValue:M,symbol:k}of b)c.infos.unshift({label:L||(d?null:`${g} - ${M}`),value:[g,M],symbol:k});d&&(c.title=null),this._updateInfosForClassedSizeRenderer(e,c.infos)}e.defaultSymbol&&!d&&(c.infos.push({label:e.defaultLabel||"others",symbol:e.defaultSymbol}),h=!0)}}else if(Wd(e))if(Ao(this.layer)||Hm(this.layer)){let b=yield this._constructTileImageryStretchRendererElements(e);Bm(b)?p.push(b):c.infos=b}else{let b=this.layer,L,g;if(e.statistics?.length){let G=e.statistics[0];yn(G)?(L=G.min,g=G.max):[L,g]=G}let M=[],k=b.serviceRasterInfo;if(b.rasterFunction)try{k=yield b.generateRasterInfo(b.rasterFunction)}catch{}let H=cn(k.pixelType);if(k.bandCount===1){let G=b.bandIds?.[0]||0;L=L??(k.statistics?k.statistics[G].min:H[0]),g=g??(k.statistics?k.statistics[G].max:H[1]),L||g?p.push(yield this._getStretchLegendElements(e,{min:L,max:g})):this._getServerSideLegend()}else if(b.bandIds&&b.bandIds.length===1)L=L??(k.statistics?k.statistics[b.bandIds[0]].min:H[0]),g=g??(k.statistics?k.statistics[b.bandIds[0]].max:H[1]),L||g?p.push(yield this._getStretchLegendElements(e,{min:L,max:g})):this._getServerSideLegend();else if(k.bandCount>=3){let{bandInfos:G}=k,{bandIds:it}=b;G.length>=k.bandCount?it?.length===3?(M=it.map(Fe=>G[Fe].name),c.infos=this._createSymbolTableElementMultiBand(M)):b.format==="lerc"?(M=[0,1,2].map(Fe=>G[Fe].name),c.infos=this._createSymbolTableElementMultiBand(M)):this._getServerSideLegend():b.format==="lerc"?(M=["band1","band2","band3"],c.infos=this._createSymbolTableElementMultiBand(M)):this._getServerSideLegend()}else this._getServerSideLegend()}else if(Bd(e))e.colormapInfos.forEach(b=>{c.infos.push({label:b.label,value:b.value,symbol:this._getAppliedCloneSymbol(Dm,b.color)})});else if(qi(e)){let b=e.symbol;switch(t.geometryType){case"point":b="pointSymbol"in r?r.pointSymbol:null;break;case"polyline":b="lineSymbol"in r?r.lineSymbol:null;break;case"polygon":b="polygonSymbol"in r?r.polygonSymbol:null}let L=this._hasClusterSizeVariable&&this._getClusterSymbol()||!this._hasSizeRamp;e.symbol&&L&&c.infos.push({label:e.label,symbol:b})}else if(Hd(e)){e.outputUnit&&(this.title="("+e.toJSON().outputUnit+")"),c.title=e.attributeField;let b=e.getClassBreakInfos();b?.length?b.forEach(L=>{c.infos.push({label:L.minValue+" - "+L.maxValue,symbol:L.symbol})}):c.infos.push({label:e.attributeField,symbol:e.getDefaultSymbol()})}else Ud(e)&&p.push(yield this._getStretchLegendElements(e,{min:0,max:255}));let f=e.defaultSymbol;!f||h||qi(e)||d&&!this._hasColorRamp&&!this._hasSizeRamp&&!this._hasOpacityRamp||p.push({type:"symbol-table",infos:[{label:e.defaultLabel||"others",symbol:f}]}),c.infos.length&&p.unshift(c);let w=t.opacity==null?this.opacity:t.opacity,S=this._isTallSymbol("visualVariables"in e?e.visualVariables:null),T=Gi(this.layer)||Ao(this.layer),F=p.reduce((b,L)=>[...b,...this._getAllInfos(L)],[]).filter(b=>!!b?.symbol).filter(b=>{if(b.symbol.type==="cim"){let{minScale:L,maxScale:g}=b.symbol.data;if(L&&L<this.scale||g&&g>this.scale)return!1}return!0}).map(b=>this._getSymbolPreview(b,w,{isDefault:b.symbol===f,applyScaleDrivenSize:!m.has(b.symbol),symbolConfig:{isTall:S,isSquareFill:T},effectList:m.has(b.symbol)?null:this.effectList}));return e=null,yield Promise.allSettled(F),p})}_checkDefinitionExpression(e,t){return!e||typeof e!="string"||!this._layerDefinitionExpressionClause||this._layerDefinitionExpressionClause.testFeature({[e]:t})}_getServerSideLegend(){setTimeout(()=>this.buildLegendElementsForTools(),0)}_getAllInfos(e){let t=e?.infos;return t?t.reduce((i,s)=>i.concat(this._getAllInfos(s)),[]):[e]}_constructTileImageryStretchRendererElements(e){return v(this,null,function*(){let t=this.layer,i=t.symbolizer.rasterInfo??t.raster.rasterInfo,s,o,r=e?.statistics?.length?e.statistics:i?.statistics;if(r){let p=r[0];yn(p)?(s=p.min,o=p.max):[s,o]=p}else{let p=cn(i.pixelType);s=p[0],o=p[1]}if(t.hasStandardTime()&&(s=t.getStandardTimeValue(s),o=t.getStandardTimeValue(o)),i.bandCount===1||t.bandIds?.length===1)return this._getStretchLegendElements(e,{min:s,max:o});let n=(t?.bandIds?.length?t.bandIds:Array.from(Array(Math.min(i.bandCount,3)).keys())).map(p=>i.bandInfos[p].name);return n.length<3?n.push(n[1]):n.length>3&&n.splice(3),this._createSymbolTableElementMultiBand(n)})}_getStretchLegendElements(e,t){return v(this,null,function*(){let i=e.colorRamp,s=Cc(i,t);return{type:"stretch-ramp",title:"",infos:s,preview:St(s.map(o=>o.color),{ariaLabel:yield It("previewColorRampAriaLabel")})}})}_getClusterSymbol(){let e=this.layer,t="featureReduction"in e&&e.featureReduction,i=t&&"symbol"in t&&t.renderer;return i&&i?.authoringInfo?.isAutoGenerated!==!0?null:t&&"symbol"in t?t.symbol:null}_getSizeLegendElement(e,t,i,s){return v(this,null,function*(){return{type:"size-ramp",title:this._hasClusterSizeVariable?this._getClusterTitle(t):e,infos:yield Mc(i,t,yield gn(i),this.scale,this.view,s,this._hasClusterSizeVariable?this._getClusterSymbol():null)}})}_createSymbolTableElementMultiBand(e){let t=[],i=["red","green","blue"];return e.forEach((s,o)=>{t.push({label:{colorName:i[o],bandName:s},src:wc[o],opacity:this.opacity??1})}),t}_updateInfosForClassedSizeRenderer(e,t){let i=e.authoringInfo&&e.authoringInfo.type==="class-breaks-size",s=e.classBreakInfos.some(o=>ic(o.symbol));if(i&&s){let o=Tc,r=Lc,n=e.classBreakInfos.length,p=(o-r)/(n>1?n-1:n);t.forEach((c,d)=>{c.size=o-p*d})}}_isTallSymbol(e){let t=!1,i=!1;if(e)for(let s=0;s<e.length&&(!t||!i);s++){let o=e[s];o.type==="size"&&(o.axis==="height"&&(t=!0),o.axis==="width-and-depth"&&(i=!0))}return t&&i}_getSymbolPreview(e,t,i){return v(this,null,function*(){let s=!i?.isDefault&&e.size==null&&this._hasSizeRamp?lp(hc.size):e.size;if(this._scaleDrivenSizeVariable&&i?.applyScaleDrivenSize){let{getSize:r}=yield import("./chunk-VXKLTDGB.js");s=r(this._scaleDrivenSizeVariable,null,{view:this.view.type,scale:this.scale,shape:e.symbol.type==="simple-marker"?e.symbol.style:null})}let o=!i?.isDefault&&this._hasSizeRamp||!(!this._scaleDrivenSizeVariable||!i?.applyScaleDrivenSize);return Pc(e.symbol,{size:s,opacity:t,scale:!1,symbolConfig:i?.symbolConfig,effectView:i?.effectList,style:"legend",cimOptions:{allowScalingUp:o,viewParams:this.isScaleDriven?{viewingMode:this.view?.type==="2d"?"map":this.view?.viewingMode,scale:this.view?.scale}:null},ariaLabel:e.label&&typeof e.label!="string"?null:yield It("previewTemplateAriaLabel",e.label)}).then(r=>(e.preview=r,e)).catch(()=>(e.preview=null,e))})}_getClusterRenderer(e){this._hasClusterSizeVariable=!1;let t="renderer"in this.layer?this.layer.renderer:null,i=e.renderer?.clone()||t?.clone(),s=zd(e,this.layerView,this.view);if(s&&i!=null&&"visualVariables"in i&&!i.visualVariables?.some(r=>r.type==="size"&&r.target!=="outline"&&!Do.test(r.valueExpression))){if("clusterMinSize"in e&&"clusterMaxSize"in e){let{clusterMinSize:n,clusterMaxSize:p}=e;s.legendOptions=new Zp({showLegend:n!==p})}let r=i.visualVariables||[];i.visualVariables=r.concat([s]),this._hasClusterSizeVariable=!0}return i}_loadRenderer(e){return v(this,null,function*(){let t=[],i=e.clone(),s=yield gn(i);if(ui(i)||ks(i)){let o=(i.classBreakInfos||i.uniqueValueInfos).map(r=>this._fetchSymbol(r.symbol,s).then(n=>{r.symbol=n}).catch(()=>{r.symbol=null}));Array.prototype.push.apply(t,o)}return t.push(this._fetchSymbol(i.symbol||i.defaultSymbol,i.defaultSymbol?null:s).then(o=>{this._applySymbolToRenderer(i,o,qi(i))}).catch(()=>{this._applySymbolToRenderer(i,null,qi(i))})),yield Promise.allSettled(t),i})}_applySymbolToRenderer(e,t,i){i?e.symbol=t:e.defaultSymbol=t}_fetchSymbol(e,t){return v(this,null,function*(){if(!e)throw new Error;if(e.type==="web-style"){let i=this._webStyleSymbolCache;try{let s=yield this.view.type==="2d"?e.fetchCIMSymbol({cache:i}):e.fetchSymbol({cache:i});return this._getAppliedCloneSymbol(s,t)}catch{throw P.getLogger(this).warn("Fetching web-style failed!"),new Error}}return this._getAppliedCloneSymbol(e,t)})}_getAppliedCloneSymbol(e,t){if(!e||!t)return e;let i=e.clone(),s=t&&t.toRgba();return i.type.includes("3d")?this._applyColorTo3dSymbol(i,s):i.type==="cim"?tc(i,t):i.color&&(i.color=new ye(s||i.color)),i}_applyColorTo3dSymbol(e,t){t&&e.symbolLayers.forEach(i=>{i&&(i.material||(i.material={}),i.material.color=new ye(t))})}_getVisualVariableLegendElements(e,t){return v(this,null,function*(){if(!("visualVariables"in e)||e.type==="vector-field")return null;let i=e.visualVariables??[],s=[],o=[],r=[],n=vn(e);if(n?.sizeStops?.length===2&&(ui(e)||ks(e))){let[m,f]=n.sizeStops;o.push(new Ms({field:n.field??void 0,normalizationField:n.normalizationField,minSize:m.size,maxSize:f.size,minDataValue:m.value,maxDataValue:f.value}))}for(let m of i)m.type==="color"?s.push(m):m.type==="size"?o.push(m):m.type==="opacity"&&r.push(m);let p=[...s,...o,...r],c,d;if(s.length===0&&ui(e)&&e.classBreakInfos&&e.classBreakInfos.length===1){let m=e.classBreakInfos[0];c=m&&m.symbol}if(s.length===0&&qi(e)&&(c=e.symbol),c)if(c.type.includes("3d")){let m=c.symbolLayers.at(0);m.type==="water"?m.color!=null&&(d=m.color):m.material?.color!=null&&(d=m.material.color)}else c.url||(d=c.color);let h=this.effectList;return(yield Promise.all(p.map(m=>v(this,null,function*(){if(!m.legendOptions||m.legendOptions.showLegend!==!1){let f=zn(e)?m.field:this._getRampTitle(m,t),w=null,S=bc(t,m,this.view.timeZone);if(m.type==="color"){let T=(yield wn(m,null,S))??[];w={type:"color-ramp",title:f,infos:T,preview:St(T.map(F=>F.color),{effectList:h,ariaLabel:yield It("previewColorRampAriaLabel")})},this._hasColorRamp||(this._hasColorRamp=T.length>0)}else if(m.type==="size"&&m.target!=="outline")Do.test(m.valueExpression)?this._hasClusterSizeVariable||(this._scaleDrivenSizeVariable=m):(w=yield this._getSizeLegendElement(f,m,e,S),this._hasSizeRamp||(this._hasSizeRamp=!(w.infos==null||!w.infos.length)));else if(m.type==="opacity"){let T=(yield wn(m,d,S))??[];w={type:"opacity-ramp",title:f,infos:T,preview:St(T.map(F=>F.color),{effectList:h,ariaLabel:yield It("previewColorRampAriaLabel")})},this._hasOpacityRamp||(this._hasOpacityRamp=T.length>0)}return w?.infos?w:null}})))).filter(we)})}_getDomainName(e,t,i){if(e&&typeof e!="function"){let s="getField"in i&&i.getField?.(e),o=s&&"getFieldDomain"in i&&i.getFieldDomain?i.getFieldDomain(s.name):null;return o?.type==="coded-value"?o.getName(t):null}return null}_getClusterTitle(e){let t=this.layer,i=e.field;if("featureReduction"in t&&t.featureReduction&&t.featureReduction.type==="cluster"){let s=t.featureReduction,o="popupTemplate"in s&&s.popupTemplate,r=o&&o.fieldInfos;if(r){for(let n of r)if(n.fieldName===i)return i==="cluster_count"?n.label||{showCount:!0}:n.label}}return{showCount:!0}}_getRampTitle(e,t){let i=e.field,s=e.normalizationField,o=!1,r=!1,n=!1,p=null;i=typeof i=="function"?null:i,s=typeof s=="function"?null:s;let c=e.legendOptions?.title;if(c!=null)p=c;else if(e.valueExpressionTitle)p=e.valueExpressionTitle;else{if("renderer"in t&&t.renderer&&"authoringInfo"in t.renderer&&t.renderer.authoringInfo?.visualVariables){let d=t.renderer.authoringInfo.visualVariables;for(let h=0;h<d.length;h++){let m=d[h];if(m.type==="color"){if(m.style==="ratio"){o=!0;break}if(m.style==="percent"){r=!0;break}if(m.style==="percent-of-total"){n=!0;break}}}}p={field:i&&this._getFieldAlias(i,t),normField:s&&this._getFieldAlias(s,t),ratio:o,ratioPercent:r,ratioPercentTotal:n}}return p}_getRendererTitle(e,t){let i=e;if(i.legendOptions?.title)return i.legendOptions.title;if(i.valueExpressionTitle)return i.valueExpressionTitle;let s=i.field,o=null,r=null;if(ui(i)&&(o=i.normalizationField,r=i.normalizationType==="percent-of-total"),s=typeof s=="function"?null:s,o=typeof o=="function"?null:o,ks(i)){let{field2:p,field3:c,fieldDelimiter:d}=i,h=s&&this._getFieldAlias(s,t);return p&&(h=`<${h}>${d}<${this._getFieldAlias(p,t)}>`,c&&(h=`${h}${d}<${this._getFieldAlias(c,t)}>`)),h}let n=null;return(s||o)&&(n={field:s&&this._getFieldAlias(s,t),normField:o&&this._getFieldAlias(o,t),normByPct:r}),n}_getFieldAlias(e,t){let o=("popupTemplate"in t?t.popupTemplate:null)?.fieldInfos?.find(h=>e===h.fieldName),r=null;"getField"in t&&t.getField?r=t.getField(e):"fieldsIndex"in t&&t.fieldsIndex&&(r=t.fieldsIndex.get(e));let n=null,p="featureReduction"in t&&t.featureReduction;p&&(o??="popupTemplate"in p?p.popupTemplate?.fieldInfos?.find(h=>e?.toLowerCase()===h.fieldName?.toLowerCase()):void 0,"fields"in p&&p.fields&&(n=p.fields.find(h=>h.name?.toLowerCase()===e?.toLowerCase())));let c=o||r||n,d=null;return c&&(d=o?.label||r?.alias||n?.alias||"name"in c&&c.name||"fieldName"in c&&c.fieldName||null),d}_isUnclassedRenderer(e){let t=e.visualVariables,i=!1;return ui(e)&&e.classBreakInfos&&e.classBreakInfos.length===1&&t&&(i=e.field?t.some(s=>!(!s||e.field!==s.field||(e.normalizationField||s.normalizationField)&&e.normalizationField!==s.normalizationField)):!!t.length),i}};a([l()],pe.prototype,"children",void 0),a([l({readOnly:!0})],pe.prototype,"effectList",null),a([l()],pe.prototype,"layerView",void 0),a([l()],pe.prototype,"layer",void 0),a([l()],pe.prototype,"legendElements",void 0),a([l({readOnly:!0})],pe.prototype,"opacity",null),a([l()],pe.prototype,"parent",void 0),a([l({readOnly:!0,dependsOn:[]})],pe.prototype,"ready",null),a([l()],pe.prototype,"hideLayersNotInCurrentView",void 0),a([l()],pe.prototype,"keepCacheOnDestroy",void 0),a([l()],pe.prototype,"respectLayerDefinitionExpression",void 0),a([l()],pe.prototype,"respectLayerVisibility",void 0),a([l({readOnly:!0})],pe.prototype,"scale",null),a([l()],pe.prototype,"sublayerIds",void 0),a([l({readOnly:!0})],pe.prototype,"isScaleDriven",null),a([l()],pe.prototype,"title",void 0),a([l({readOnly:!0,dependsOn:["ready"],value:0})],pe.prototype,"version",null),a([l()],pe.prototype,"view",void 0),pe=a([y("esri.widgets.Legend.support.ActiveLayerInfo")],pe);var $n=pe;var mi={state:"state",view:"view",allLayerViews:"all-layer-views",legendProperties:"legend-properties"},jd=D.ofType($n),Zm=new Set(["esri.layers.BuildingSceneLayer","esri.layers.CatalogLayer","esri.layers.CSVLayer","esri.layers.FeatureLayer","esri.layers.GeoJSONLayer","esri.layers.GeoRSSLayer","esri.layers.GroupLayer","esri.layers.HeatmapLayer","esri.layers.ImageryLayer","esri.layers.ImageryTileLayer","esri.layers.MapImageLayer","esri.layers.OGCFeatureLayer","esri.layers.OrientedImageryLayer","esri.layers.PointCloudLayer","esri.layers.StreamLayer","esri.layers.SceneLayer","esri.layers.SubtypeGroupLayer","esri.layers.TileLayer","esri.layers.VoxelLayer","esri.layers.WFSLayer","esri.layers.WMSLayer","esri.layers.WMTSLayer","esri.layers.WCSLayer","esri.layers.LinkChartLayer","esri.layers.catalog.CatalogFootprintLayer","esri.layers.catalog.CatalogDynamicGroupLayer","esri.layers.knowledgeGraph.KnowledgeGraphSublayer"]),Kd="view.basemapView.baseLayerViews",Yd="view.groundView.layerViews",Qd="view.basemapView.referenceLayerViews",qm=[Kd,Yd,"view.layerViews",Qd],Ae=class extends C{constructor(e){super(e),this._layerViewByLayerId={},this._layerInfosByLayerViewId={},this._activeLayerInfosByLayerViewId={},this._activeLayerInfosWithNoParent=new D,this.activeLayerInfos=new jd,this.basemapLegendVisible=!1,this.groundLegendVisible=!1,this.hideLayersNotInCurrentView=!1,this.keepCacheOnDestroy=!1,this.respectLayerDefinitionExpression=!1,this.respectLayerVisibility=!0,this.layerInfos=[],this.view=null}initialize(){this.addHandles(_(()=>this.view,()=>this._viewHandles(),O),mi.view),this.addHandles(Pi(()=>this._refresh()))}destroy(){this._destroyViewActiveLayerInfos(),this.view=null}get state(){return this.view?.ready?"ready":"disabled"}_viewHandles(){this.removeHandles(mi.state),this.view&&this.addHandles(_(()=>this.state,()=>this._stateHandles(),O),mi.state)}_stateHandles(){this._resetAll(),this.state==="ready"&&this._watchPropertiesAndAllLayerViews()}_resetAll(){this.removeHandles([mi.allLayerViews,mi.legendProperties]),this._destroyViewActiveLayerInfos(),this.activeLayerInfos.removeAll()}_destroyViewActiveLayerInfos(){Object.keys(this._activeLayerInfosByLayerViewId).forEach(this._destroyViewActiveLayerInfo,this)}_destroyViewActiveLayerInfo(e){this.removeHandles(e);let t=this._activeLayerInfosByLayerViewId[e];delete this._activeLayerInfosByLayerViewId[e],t?.parent&&t.parent.children.remove(t)}_watchPropertiesAndAllLayerViews(){let{view:e}=this;if(!e)return;let{allLayerViews:t}=e;t.length&&this._refresh(),this.addHandles(t.on("change",i=>this._propertiesChangeHandle()),mi.allLayerViews),this.addHandles(_(()=>[this.layerInfos,this.basemapLegendVisible,this.groundLegendVisible],()=>this._propertiesChangeHandle()),mi.legendProperties)}_propertiesChangeHandle(){this._destroyViewActiveLayerInfos(),this._refresh()}_refresh(){this._layerInfosByLayerViewId={},this.activeLayerInfos.removeAll(),this._generateLayerViews().filter(this._filterLayerViewsByLayerInfos,this).filter(this._isLayerViewSupported,this).forEach(this._generateActiveLayerInfo,this),this._sortActiveLayerInfos(this.activeLayerInfos)}_sortActiveLayerInfos(e){let t=this.view;if(e.length<2||!t)return;let i=[];e.forEach(o=>{if(!o.parent){let r=o.layer.parent,n=r&&"uid"in r&&this._layerViewByLayerId[r.uid],p=n&&this._activeLayerInfosByLayerViewId[n.uid];p&&e.includes(p)&&(i.push(o),o.parent=p,p.children.add(o),this._sortActiveLayerInfos(p.children))}}),e.removeMany(i);let s={};t.allLayerViews.forEach((o,r)=>s[o.layer.uid]=r),e.sort((o,r)=>{let n=s[o.layer.uid]||0;return(s[r.layer.uid]||0)-n})}_generateLayerViews(){let e=[];return qm.filter(this._filterLayerViews,this).map(t=>Mi(this,t)).filter(t=>t!=null).forEach(this._collectLayerViews("layerViews",e)),e}_filterLayerViews(e){let t=!this.basemapLegendVisible&&(e===Kd||e===Qd),i=!this.groundLegendVisible&&e===Yd;return!t&&!i}_collectLayerViews(e,t){let i=s=>(s&&s.forEach(o=>{t.push(o),i(o[e])}),t);return i}_filterLayerViewsByLayerInfos(e){let t=this.layerInfos;return!t||!t.length||t.some(i=>this._hasLayerInfo(i,e))}_hasLayerInfo(e,t){let i=this._isLayerUIDMatching(e.layer,t.layer.uid);return i&&(this._layerInfosByLayerViewId[t.uid]=e),i}_isLayerUIDMatching(e,t){return e&&(e.uid===t||this._hasLayerUID(e.layers,t))}_hasLayerUID(e,t){return e&&e.some(i=>this._isLayerUIDMatching(i,t))}_isLayerViewSupported(e){return!!Zm.has(e.layer.declaredClass)&&(this._layerViewByLayerId[e.layer.uid]=e,!0)}_generateActiveLayerInfo(e){this._isLayerActive(e)?this._buildActiveLayerInfo(e):(this.removeHandles(e.uid),this.addHandles(_(()=>[e.legendEnabled,e.layer?.legendEnabled],()=>this._layerActiveHandle(e)),e.uid))}_layerActiveHandle(e){this._isLayerActive(e)&&(this.removeHandles(e.uid),this._buildActiveLayerInfo(e))}_isLayerActive(e){return!this.respectLayerVisibility||e.legendEnabled&&e.layer?.legendEnabled}_buildActiveLayerInfo(e){let t=e.layer,i=e.uid,s=this._layerInfosByLayerViewId[i],o=this._activeLayerInfosByLayerViewId[i];if(!o){let n=s?.title!==void 0&&s.layer.uid===t.uid;o=new $n({layer:t,layerView:e,title:n?s.title:t.title,view:this.view??void 0,respectLayerDefinitionExpression:this.respectLayerDefinitionExpression,respectLayerVisibility:this.respectLayerVisibility,hideLayersNotInCurrentView:this.hideLayersNotInCurrentView,keepCacheOnDestroy:this.keepCacheOnDestroy,sublayerIds:s?.sublayerIds||[]}),this._activeLayerInfosByLayerViewId[i]=o}let r=t.parent&&"uid"in t.parent?this._layerViewByLayerId[t.parent?.uid]:null;if(o.parent=this._activeLayerInfosByLayerViewId[r?.uid],!this.hasHandles(i)){let n=[_(()=>t.title,p=>this._titleHandle(p,o)),_(()=>[t.opacity,"renderer"in t&&t.renderer,"pointSymbol"in t&&t.pointSymbol,"lineSymbol"in t&&t.lineSymbol,"polygonSymbol"in t&&t.polygonSymbol],()=>this._constructLegendElements(o)),le(()=>this.view?.stationary===!0,()=>this._scaleHandle(o),O),_(()=>e.layer?fn(e.layer,e.view):null,()=>this._constructLegendElements(o)),_(()=>e.updating,()=>{e.layer!=null&&fn(e.layer,e.view)!=null&&this._constructLegendElements(o)}),_(()=>"effect"in t&&t.effect,()=>this._constructLegendElements(o)),le(()=>this.view?.timeZone,()=>this._constructLegendElements(o),O)];if(this.respectLayerVisibility){let p=_(()=>e.legendEnabled,d=>this._legendEnabledHandle(d,o)),c=_(()=>t.legendEnabled,d=>this._legendEnabledHandle(d,o));n.push(p,c)}this.addHandles(n,i)}o.isScaleDriven||this._constructLegendElements(o),this._addActiveLayerInfo(o)}_titleHandle(e,t){t.title=e,this._constructLegendElements(t)}_legendEnabledHandle(e,t){e?this._addActiveLayerInfo(t):this._removeActiveLayerInfo(t)}_scaleHandle(e){(e.isScaleDriven||e.hideLayersNotInCurrentView)&&this._constructLegendElements(e)}_addActiveLayerInfo(e){let{layerView:t,layer:i}=e;if(this._isLayerActive(t)&&!this.activeLayerInfos.includes(e)){let s=e.parent;if(s)s.children.includes(e)||s.children.push(e),this._sortActiveLayerInfos(s.children);else{let o=this.layerInfos?.some(r=>r.layer.uid===i.uid);i.parent&&"uid"in i.parent&&!o?this._activeLayerInfosWithNoParent.add(e):(this.activeLayerInfos.add(e),this._sortActiveLayerInfos(this.activeLayerInfos))}if(this._activeLayerInfosWithNoParent.length){let o=[];this._activeLayerInfosWithNoParent.forEach(r=>{let n=r.layer.parent,p=n&&"uid"in n?this._layerViewByLayerId[n?.uid]:null,c=this._activeLayerInfosByLayerViewId[p?.uid];c&&(o.push(r),r.parent=c)}),o.length&&(this._activeLayerInfosWithNoParent.removeMany(o),o.forEach(r=>this._addActiveLayerInfo(r)))}}}_removeActiveLayerInfo(e){let t=e.parent;t?t.children.remove(e):this.activeLayerInfos.remove(e)}_constructLegendElements(e){let t=e.layer;"featureCollections"in t&&t.featureCollections?e.buildLegendElementsForFeatureCollections(t.featureCollections):"featureReduction"in t&&t.featureReduction&&"renderer"in t.featureReduction&&(t.featureReduction.type==="binning"||t.featureReduction.type==="cluster")&&(!this.view||t.featureReduction.maxScale<=this.view.scale)?e.buildLegendElementsForFeatureReduction(t.featureReduction):"renderer"in t&&t.renderer&&!("sublayers"in t)?e.buildLegendElementsForRenderer(t.renderer):"url"in t&&t.url&&t.type!=="catalog"?e.buildLegendElementsForTools():e.children.forEach(i=>this._constructLegendElements(i))}};a([l({type:jd})],Ae.prototype,"activeLayerInfos",void 0),a([l()],Ae.prototype,"basemapLegendVisible",void 0),a([l()],Ae.prototype,"groundLegendVisible",void 0),a([l()],Ae.prototype,"hideLayersNotInCurrentView",void 0),a([l()],Ae.prototype,"keepCacheOnDestroy",void 0),a([l()],Ae.prototype,"respectLayerDefinitionExpression",void 0),a([l()],Ae.prototype,"respectLayerVisibility",void 0),a([l()],Ae.prototype,"layerInfos",void 0),a([l({readOnly:!0})],Ae.prototype,"state",null),a([l()],Ae.prototype,"view",void 0),Ae=a([y("esri.widgets.Legend.LegendViewModel")],Ae);var Xd=Ae;var W="esri-legend--card",ji="esri-legend",I={activated:`${W}__carousel-indicator--activated`,base:W,stacked:`${ji}--stacked`,carouselTitle:`${W}__carousel-title`,indicator:`${W}__carousel-indicator`,intervalSeparator:`${W}__interval-separator`,imageryLayerStretchedImage:`${W}__imagery-layer-image--stretched`,imageLabel:`${W}__image-label`,layerCaption:`${W}__layer-caption`,labelElement:`${W}__label-element`,layerRow:`${W}__layer-row`,labelCell:`${W}__label-cell`,message:`${W}__message`,rampLabel:`${W}__ramp-label`,section:`${W}__section`,relationshipSection:`${W}__relationship-section`,serviceCaptionText:`${W}__service-caption-text`,serviceContent:`${W}__service-content`,service:`${W}__service`,groupLayer:`${W}__group-layer`,groupLayerChild:`${W}__group-layer-child`,symbol:`${W}__symbol`,sizeRampRow:`${W}__size-ramp-row`,symbolRow:`${W}__symbol-row`,symbolCell:`${W}__symbol-cell`,indicatorContainer:`${W}__carousel-indicator-container`,intervalSeparatorsContainer:`${W}__interval-separators-container`,relationshipLabelContainer:`${W}__relationship-label-container`,labelContainer:`${W}__label-container`,serviceCaptionContainer:`${W}__service-caption-container`,symbolContainer:`${W}__symbol-container`,sizeRampContainer:`${W}__size-ramp-container`,sizeRampPreview:`${W}__size-ramp-preview`,pieChartRampPreview:`${W}__pie-chart-ramp-preview`,rampContainer:`${ji}__ramps`,sizeRampHorizontal:`${ji}__size-ramp--horizontal`,rampLabelsContainer:`${ji}__ramp-labels`,layerInfo:`${ji}__layer-cell ${ji}__layer-cell--info`,univariateAboveAndBelowColorRamp:"esri-univariate-above-and-below-ramp__color--card"};var jm=Ss(),Jd=10,Hn=20,zo=10,Bn=20,Wn={univariateAboveAndBelowSymbol:"esri-univariate-above-and-below-ramp__symbol",colorRamp:"esri-legend__color-ramp"};function Km(e="vertical"){let t="stroke:rgb(200, 200, 200);stroke-width:1";return e==="vertical"?u("svg",{height:"4",width:"10"},u("line",{style:t,x1:"0",x2:"10",y1:"2",y2:"2"})):u("svg",{height:"10",width:"10"},u("line",{style:t,x1:"5",x2:"5",y1:"0",y2:"10"}))}function Ym(e,t="vertical"){let i=document.createElement("div");return i.style.height=`${Hn}px`,i.className=Wn.univariateAboveAndBelowSymbol,e!=null&&(i.style.opacity=e.toString()),jm.append(i,Km.bind(null,t)),i}function eh(e,t,i="vertical",s){e.infos.forEach((o,r)=>{if(s&&r===2)o.preview=Ym(t,i);else{let n=lt(o.size)+(i==="horizontal"?Bn:zo),p=o.preview,c=p?.tagName.toLowerCase()==="div",d=c?p:document.createElement("div");d.className=Wn.univariateAboveAndBelowSymbol,i==="horizontal"?d.style.width=`${n}px`:d.style.height=`${n}px`,!c&&p&&d.appendChild(p),o.preview=d}})}function Ki(e,t="classic"){let i=e.infos;return t==="classic"?(lt(i[0].size)+zo)/2:(lt(i[0].size)-lt(i[i.length-1].size))/2}function Yt(e,t){if(!e)return null;let i=e.infos.map(o=>o.color),s=St(t.type==="full"?i:t.type==="above"?i.slice(0,3):i.slice(2,5),{width:t.width,height:t.height,align:t.rampAlignment,effectList:t.effectList,ariaLabel:t.ariaLabel});return s.className=Wn.colorRamp,t.opacity!=null&&(s.style.opacity=t.opacity.toString()),s}function Fo(e,t,i,s="vertical"){let o=0,r=e.infos,n=Math.floor(r.length/2),p=t==="full"||t==="above"?0:n,c=t==="full"||t==="below"?r.length-1:n;for(let d=p;d<=c;d++)i&&d===n?o+=s==="horizontal"?Jd:Hn:o+=lt(r[d].size)+(s==="horizontal"?Bn:zo);return Math.round(o)}function Qt(e,t,i,s="vertical"){let o=Fo(e,t,i,s),r=e.infos,n=Math.floor(r.length/2),p=t==="full"||t==="above"?0:n,c=t==="full"||t==="below"?r.length-1:n,d=t==="full"?r[p].size+r[c].size:t==="above"?r[p].size:r[c].size,h=i?s==="vertical"?Hn:Jd:0,m=s==="vertical"?zo*(t==="full"?2:1):Bn*(t==="full"?2:1);return Math.round(o-(lt(d)/2+h/2+m/2))}function Oo(e,t,i="vertical"){let s=e.infos,o=s.find(({type:n})=>n==="size-ramp"),r=s.find(({type:n})=>n==="color-ramp");return o&&(o=A({},o),o.infos=[...o.infos],eh(o,t,i,!0)),r&&(r=A({},r),r.infos=[...r.infos]),i==="horizontal"&&(o?.infos.reverse(),r?.infos.reverse()),{sizeRampElement:o,colorRampElement:r}}function No(e,t="vertical"){let i=e.infos,s=i.find(({type:r})=>r==="size-ramp"),o=i.find(({type:r})=>r==="color-ramp");return s&&(s=A({},s),s.infos=[...s.infos],eh(s,null,t,!1)),o&&(o=A({},o),o.infos=[...o.infos]),t==="horizontal"&&(s?.infos.reverse(),o?.infos.reverse()),{sizeRampElement:s,colorRampElement:o}}function Qm(e,t){return t}function ce(e){let t=this;e.appendChild(t)}function ft(e,t,i){if(!t)return;if(typeof t=="number")return t;if(typeof t=="string")return Qa(t);if("value"in t||"unit"in t)return ni(e.dotValue,t);if("colorName"in t&&"bandName"in t)return e[t.colorName]+": "+(e[t.bandName]||t.bandName);if("showCount"in t)return t.showCount?e.clusterCountTitle:void 0;let s=null;return Qm(t,i)?s=t.ratioPercentTotal?"showRatioPercentTotal":t.ratioPercent?"showRatioPercent":t.ratio?"showRatio":t.normField?"showNormField":t.field?"showField":null:Un(t,i)&&(s=t.normField?"showNormField":t.normByPct?"showNormPct":t.field?"showField":null),s?ni(s==="showField"?"{field}":e[s],{field:t.field,normField:t.normField}):void 0}function Un(e,t){return!t}function $o(e,t){return!!(t&&t==="Stretched"&&e.version>=10.3&&e.declaredClass==="esri.layers.ImageryLayer")}function Ho(e,t){return e.label?t[e.label]+": "+(typeof e.value=="string"?e.value:to(e.value??0,{style:"decimal",notation:e.value?.toString().toLowerCase().includes("e")?"scientific":"standard"})):""}var Xm=25,Jm=25,ef=768,tf=100,sf="#ddd",Yi=window.devicePixelRatio;function of(e){if(e){if(e.type.includes("3d")){let t=e.symbolLayers?.length;if(!t)return;let i=e.symbolLayers.at(t-1),s=i.resource?.primitive;return s==="circle"||s==="cross"||s==="kite"||s==="sphere"||s==="cube"||s==="diamond"}{let t=e.style;return t==="circle"||t==="diamond"||t==="cross"}}}function rf(e){if(e){if(e.type.includes("3d")){let t=e.symbolLayers?.length;if(!t)return;let i=e.symbolLayers.at(t-1).get("resource.primitive");return i==="triangle"||i==="cone"||i==="tetrahedron"}return e.style==="triangle"}}var Qe=class extends re{constructor(e,t){super(e,t),this._hasIndicators=!1,this._selectedSectionName=null,this._sectionNames=[],this._sectionMap=new Map,this.activeLayerInfos=null,this.headingLevel=3,this.layout="stack",this.messages=null,this.messagesCommon=null,this.type="card",this.view=null}initialize(){this.addHandles(_(()=>this.activeLayerInfos,e=>{this.removeAllHandles(),this._watchForSectionChanges(e)}))}render(){let{view:e}=this;this._hasIndicators=this.layout==="auto"&&e&&e.container.clientWidth<=ef||this.layout==="stack";let t=this.activeLayerInfos,i=t?.toArray().map(c=>this._renderLegendForLayer(c)).filter(c=>!!c);this._hasIndicators?this._selectedSectionName&&this._sectionNames.includes(this._selectedSectionName)||(this._selectedSectionName=this._sectionNames&&this._sectionNames[0]):this._selectedSectionName=null;let s=this._sectionNames.length,o=this._sectionNames.map((c,d)=>{let h=ni(this.messagesCommon.pagination.pageText,{index:d+1,total:s});return u("div",{"aria-controls":`${c}-panel`,"aria-label":h,"aria-selected":(this._selectedSectionName===c).toString(),bind:this,class:this.classes(I.indicator,{[I.activated]:this._selectedSectionName===c}),"data-section-name":c,id:c,key:c,onclick:this._selectSection,onkeydown:this._focusSection,role:"tab",tabIndex:this._selectedSectionName===c?0:-1,title:h})}),r=this._hasIndicators&&s>1?u("div",{class:I.indicatorContainer,key:"carousel-navigation",role:"tablist"},o):null,n=this._hasIndicators?this._sectionMap.get(this._selectedSectionName):i?.length?i:null,p={[I.stacked]:this._hasIndicators};return u("div",{class:this.classes(I.base,p)},n||u("div",{class:I.message},this.messages.noLegend),r)}_selectSection(e){let t=e.target.getAttribute("data-section-name");t&&(this._selectedSectionName=t)}_focusSection(e){switch(e.key){case"ArrowLeft":case"ArrowRight":this._switchSectionOnArrowPress(e);break;case"Enter":case" ":this._selectSection(e)}}_switchSectionOnArrowPress(e){let t=e.key,i=t==="ArrowLeft"?-1:1,s=e.target.getAttribute("data-section-name"),o=this._sectionNames.indexOf(s),r=this._sectionNames,n=null;o!==-1&&(r[o+i]?n=document.getElementById(r[o+i]):t==="ArrowLeft"?n=document.getElementById(r[r.length-1]):t==="ArrowRight"&&(n=document.getElementById(r[0])),n?.focus())}_watchForSectionChanges(e){if(this._generateSectionNames(),e){e.forEach(i=>{let s=`activeLayerInfo-${i.layer.uid}-version-change`;this.removeHandles(s),this._watchForSectionChanges(i.children),this.addHandles(_(()=>i.version,()=>this._generateSectionNames()),s)});let t="activeLayerInfos-collection-change";this.removeHandles(t),this.addHandles(e.on("change",()=>this._watchForSectionChanges(e)),t)}}_generateSectionNames(){this._sectionNames.length=0,this._selectedSectionName=null,this.activeLayerInfos&&this.activeLayerInfos.forEach(this._generateSectionNamesForActiveLayerInfo,this)}_getSectionName(e,t,i){return`${this.id}${e.uid}-type-${t.type}-${i}`}_generateSectionNamesForActiveLayerInfo(e){e.children.forEach(this._generateSectionNamesForActiveLayerInfo,this),e.legendElements&&e.legendElements.forEach((t,i)=>{this._sectionNames.push(this._getSectionName(e.layer,t,i))})}_renderLegendForLayer(e){if(!e.ready)return null;if(e.children.length){let t=e.children.map(i=>this._renderLegendForLayer(i)).toArray();return u("div",{class:this.classes(I.service,I.groupLayer),key:e.layer.uid},u("div",{class:I.serviceCaptionContainer},e.title),t)}{let t=e.legendElements;if(t&&!t.length)return null;let i=t.some(r=>r.type==="relationship-ramp"),s=t.map((r,n)=>this._renderLegendForElement(r,e,n,i)).filter(r=>!!r);if(!s.length)return null;let o={[I.groupLayerChild]:!!e.parent};return u("div",{class:this.classes(I.service,o),key:e.layer.uid},u("div",{class:I.serviceCaptionContainer},u("div",{class:I.serviceCaptionText},e.title)),u("div",{class:I.serviceContent},s))}}_renderLegendForElement(e,t,i,s=!1,o=!1){let r=e.type==="color-ramp",n=e.type==="opacity-ramp",p=t.layer,c=null;if(typeof e.title=="string")c=e.title;else if(e.title){let S=e.title,T=ft(this.messages,S,r||n);c=S.title?`${S.title} (${T})`:T}let d=this._getSectionName(p,e,i),h=this._hasIndicators&&!o?u("div",null,u(Ke,{class:I.carouselTitle,level:this.headingLevel},t.title),u(Ke,{class:I.layerCaption,level:nc(this.headingLevel)},c)):c?u(Ke,{class:I.layerCaption,level:this.headingLevel},c):null,m=t.effectList,f=null;switch(e.type){case"symbol-table":{let S=e.infos.map((T,F)=>this._renderLegendForElementInfo(T,t,e.legendType,F)).filter(T=>!!T);if(S.length){let T=S[0].properties.classes?.[I.symbolRow],F={[I.labelContainer]:!T&&!s,[I.relationshipLabelContainer]:s};f=u("div",{class:this.classes(F)},S)}break}case"color-ramp":case"opacity-ramp":case"heatmap-ramp":case"stretch-ramp":f=this._renderLegendForRamp(e,p.opacity,m);break;case"size-ramp":f=this._renderSizeRamp(e,p.opacity);break;case"pie-chart-ramp":f=this._renderPieChartRamp(e);break;case"relationship-ramp":f=So(e,this.id,{opacity:p.opacity,effectList:m,ariaLabel:this.messages.previewRelationshipRampAriaLabel});break;case"univariate-above-and-below-ramp":f=this._renderUnivariateAboveAndBelowRamp(e,p.opacity,m);break;case"univariate-color-size-ramp":f=this._renderUnivariateColorSizeRamp(e,p.opacity,m)}if(!f)return null;let w=u("div",{"aria-labelledby":d,class:I.section,id:`${d}-panel`,key:d,role:"tabpanel",tabIndex:0},[h,f]);return o||this._sectionMap.set(d,w),w}_renderPieChartRamp(e){return u("div",{afterCreate:ce,bind:e.preview,class:I.pieChartRampPreview})}_renderUnivariateAboveAndBelowRamp(e,t,i){let{sizeRampElement:s,colorRampElement:o}=Oo(e,t,"horizontal");if(!s)return null;let r=Fo(s,"full",!0,"horizontal"),n=Qt(s,"above",!0,"horizontal"),p=Qt(s,"below",!0,"horizontal"),c=12,d=this.messages?.previewColorRampAriaLabel,h=Yt(o,{width:n,height:c,rampAlignment:"horizontal",opacity:t,type:"above",effectList:i,ariaLabel:d}),m=Yt(o,{width:p,height:c,rampAlignment:"horizontal",opacity:t,type:"below",effectList:i,ariaLabel:d}),f=Ki(s,"card"),w=s.infos.map(M=>M.label),S=w.length-1,T=w.map((M,k)=>k===0||k===S?u("div",{key:k},M):null),F={display:"flex",flexDirection:"column"},b={display:"flex",flexDirection:"row"},L={marginTop:"3px",display:"flex"};Bt(this.container)?L.marginRight=`${f}px`:L.marginLeft=`${f}px`;let g={width:`${r}px`,display:"flex",flexDirection:"row",justifyContent:"space-between"};return u("div",{class:I.layerRow,key:"size-ramp-preview",styles:F},u("div",{class:this.classes(I.symbolContainer,I.sizeRampHorizontal),styles:b},s.infos.map((M,k)=>u("div",{afterCreate:ce,bind:M.preview,class:I.symbol,key:k}))),h?u("div",{class:I.univariateAboveAndBelowColorRamp,key:"color-ramp-preview",styles:L},u("div",{afterCreate:ce,bind:h}),u("div",{afterCreate:ce,bind:m})):null,u("div",{class:I.layerInfo},u("div",{class:I.rampLabelsContainer,styles:g},T)))}_renderUnivariateColorSizeRamp(e,t,i){let{sizeRampElement:s,colorRampElement:o}=No(e,"horizontal");if(!s)return null;let r=Fo(s,"full",!1,"horizontal"),n=Qt(s,"full",!1,"horizontal"),p=Yt(o,{width:n,height:12,rampAlignment:"horizontal",opacity:t,type:"full",effectList:i,ariaLabel:this.messages?.previewColorRampAriaLabel}),c=Ki(s,"card"),d=s.infos.length-1,h=s.infos.map((T,F)=>F===0||F===d?u("div",{key:F},T.label):null),m={display:"flex",flexDirection:"column"},f={display:"flex",flexDirection:"row"},w={marginTop:"3px",display:"flex"};Bt(this.container)?w.marginRight=`${c}px`:w.marginLeft=`${c}px`;let S={width:`${r}px`,display:"flex",flexDirection:"row",justifyContent:"space-between"};return u("div",{class:I.layerRow,key:"size-ramp-preview",styles:m},u("div",{class:this.classes(I.symbolContainer,I.sizeRampHorizontal),styles:f},s.infos.map((T,F)=>u("div",{afterCreate:ce,bind:T.preview,class:I.symbol,key:F}))),u("div",{class:I.univariateAboveAndBelowColorRamp,key:"color-ramp-preview",styles:w},u("div",{afterCreate:ce,bind:p})),u("div",{class:I.layerInfo},u("div",{class:I.rampLabelsContainer,styles:S},h)))}_renderLegendForElementInfo(e,t,i,s){let o=t.layer;if(e.type)return this._renderLegendForElement(e,t,s,!1,!0);let r=$o(o,i),n=ft(this.messages,e.label,!1)??"";if(e.preview){if(!e.symbol?.type.includes("simple-fill")){if(!e.label)return u("div",{afterCreate:ce,bind:e.preview,key:s});let M={[I.symbolCell]:this._hasIndicators};return u("div",{class:this.classes(I.layerRow,{[I.symbolRow]:this._hasIndicators}),key:s},u("div",{afterCreate:ce,bind:e.preview,class:this.classes(M)}),u("div",{class:this.classes(I.imageLabel,{[I.labelCell]:this._hasIndicators})},n))}let p=255,c=255,d=255,h=0,m=255,f=255,w=255,S=0,T=e.symbol.color?.a,F=e.symbol.outline?.color?.a;T&&(p=e.symbol.color.r,c=e.symbol.color.g,d=e.symbol.color.b,h=e.symbol.color.a*o.opacity),F&&(m=e.symbol.outline.color.r,f=e.symbol.outline.color.g,w=e.symbol.outline.color.b,S=e.symbol.outline.color.a*o.opacity);let b=e.symbol.color?.isBright??!0,L=b?"rgba(255, 255, 255, .6)":"rgba(0, 0, 0, .6)",g={background:T?`rgba(${p}, ${c}, ${d}, ${h})`:"none",color:b?"black":"white",textShadow:`-1px -1px 0 ${L},
                                              1px -1px 0 ${L},
                                              -1px 1px 0 ${L},
                                              1px 1px 0 ${L}`,border:F?`1px solid rgba(${m}, ${f}, ${w}, ${S})`:"none",filter:dn(t.effectList)??void 0};return u("div",{class:I.layerRow,key:s},u("div",{class:I.labelElement,styles:g},n))}if(e.src){let p=this._renderImage(e,o,r);return u("div",{class:I.layerRow,key:s},p,u("div",{class:I.imageLabel},n))}}_renderImage(e,t,i){let{label:s,src:o,opacity:r}=e,n={[I.imageryLayerStretchedImage]:i,[I.symbol]:!i},p={opacity:`${r??t.opacity}`};return u("img",{alt:ft(this.messages,s,!1),"aria-label":ft(this.messages,s,!1),border:0,class:this.classes(n),height:e.height,src:o,styles:p,width:e.width})}_renderSizeRampLines(e){let t=e.infos,i=t[0],s=t[t.length-1],o=i.symbol,r=this._hasIndicators,n=lt(i.size+i.outlineSize)*Yi,p=lt(s.size+s.outlineSize)*Yi,c=r?n:n+50*Yi,d=r?n/2+50*Yi:n,h=rf(o),m=of(o),f=document.createElement("canvas");f.width=c,f.height=d,f.style.width=f.width/Yi+"px",f.style.height=f.height/Yi+"px";let w=f.getContext("2d");if(r){w.beginPath();let S=0,T=0,F=c/2-p/2,b=d;w.moveTo(S,T),w.lineTo(F,b);let L=c,g=0,M=c/2+p/2,k=d;w.moveTo(L,g),w.lineTo(M,k)}else{w.beginPath();let S=0,T=d/2-p/2,F=c;w.moveTo(S,T),w.lineTo(F,0);let L=0,g=d/2+p/2,M=c,k=d;w.moveTo(L,g),w.lineTo(M,k)}return w.strokeStyle=sf,w.stroke(),u("div",{afterCreate:ce,bind:f,styles:r?{display:"flex",marginTop:`-${h?0:m?n/2:0}px`,marginBottom:`-${h?p:m?p/2:0}px`}:{display:"flex",marginRight:`-${h?0:m?n/2:0}px`,marginLeft:`-${h?0:m?p/2:0}px`}})}_renderSizeRamp(e,t){let i=e.infos,s=i[0].label,o=i[i.length-1].label,r=i[0].preview,n=i[i.length-1].preview,p=this._hasIndicators,c={"flex-direction":p?"column":"row-reverse"};r&&(r=r.cloneNode(!0),r.style.display="flex"),n&&(n=n.cloneNode(!0),n.style.display="flex");let d={opacity:t!=null?`${t}`:""};return u("div",{class:this.classes(I.layerRow,{[I.sizeRampRow]:p})},u("div",{class:I.rampLabel},p?s:o),u("div",{class:I.sizeRampContainer,styles:c},u("div",{afterCreate:ce,bind:r,class:I.sizeRampPreview,styles:d}),this._renderSizeRampLines(e),u("div",{afterCreate:ce,bind:n,class:I.sizeRampContainer,styles:d})),u("div",{class:I.rampLabel},p?o:s))}_getRampStopLabel(e,t){switch(t){case"heatmap-ramp":return this.messages[e.label];case"stretch-ramp":return Ho(e,this.messages);default:return e.label}}_renderLegendForRamp(e,t,i){let s=e.infos,o=e.type,r=o==="heatmap-ramp",n=s.length-1,p=Jm,c=n>2&&!r?Xm*n:tf,d=c+20,h=10,m=s.slice(0).reverse(),f=m.length-1,w=m.length%2!=0?m[m.length/2|0]:null,S=w&&u("div",{class:I.intervalSeparatorsContainer},u("div",{class:I.intervalSeparator},"|"),u("div",{class:I.rampLabel},this._getRampStopLabel(w,o))),T=[[{shape:{type:"path",path:`M0 ${p/2} L${h} 0 L${h} ${p} Z`},fill:m[0].color,stroke:{width:0}},{shape:{type:"rect",x:h,y:0,width:c,height:p},fill:{type:"linear",x1:h,y1:0,x2:c+h,y2:0,colors:m.map((g,M)=>({color:g.color,offset:r&&"ratio"in g?g.ratio:M/n}))},stroke:{width:0}},{shape:{type:"path",path:`M${c+h} 0 L${d} ${p/2} L${c+h} ${p} Z`},fill:m[f].color,stroke:{width:0}}]],F=uc(T,d,p),b={filter:dn(i)??void 0,opacity:t==null?void 0:`${t}`},L={justifyContent:"center"};return u("div",{class:I.layerRow,styles:L},u("div",{class:I.rampLabel},this._getRampStopLabel(m[0],o)),u("div",{class:I.symbolContainer},u("div",{styles:b},F),S),u("div",{class:I.rampLabel},this._getRampStopLabel(m[f],o)))}};a([l()],Qe.prototype,"activeLayerInfos",void 0),a([l()],Qe.prototype,"headingLevel",void 0),a([l()],Qe.prototype,"layout",void 0),a([l(),Q("esri/widgets/Legend/t9n/Legend")],Qe.prototype,"messages",void 0),a([l(),Q("esri/t9n/common")],Qe.prototype,"messagesCommon",void 0),a([l({readOnly:!0})],Qe.prototype,"type",void 0),a([l()],Qe.prototype,"view",void 0),a([Ee()],Qe.prototype,"_selectSection",null),Qe=a([y("esri.widgets.Legend.styles.Card")],Qe);var Bo=Qe;var U="esri-legend",R={service:`${U}__service`,label:`${U}__service-label`,layer:`${U}__layer`,groupLayer:`${U}__group-layer`,groupLayerChild:`${U}__group-layer-child`,layerTable:`${U}__layer-table`,layerTableSizeRamp:`${U}__layer-table--size-ramp`,layerChildTable:`${U}__layer-child-table`,layerCaption:`${U}__layer-caption`,layerBody:`${U}__layer-body`,layerRow:`${U}__layer-row`,layerCell:`${U}__layer-cell`,layerInfo:`${U}__layer-cell ${U}__layer-cell--info`,imageryLayerStretchedImage:`${U}__imagery-layer-image--stretched`,imageryLayerCellStretched:`${U}__imagery-layer-cell--stretched`,imageryLayerInfoStretched:`${U}__imagery-layer-info--stretched`,symbolContainer:`${U}__layer-cell ${U}__layer-cell--symbols`,symbol:`${U}__symbol`,rampContainer:`${U}__ramps`,sizeRamp:`${U}__size-ramp`,colorRamp:`${U}__color-ramp`,opacityRamp:`${U}__opacity-ramp`,borderlessRamp:`${U}__borderless-ramp`,rampTick:`${U}__ramp-tick`,rampFirstTick:`${U}__ramp-tick-first`,rampLastTick:`${U}__ramp-tick-last`,rampLabelsContainer:`${U}__ramp-labels`,rampLabel:`${U}__ramp-label`,message:`${U}__message`,univariateAboveAndBelowLabel:"esri-univariate-above-and-below-ramp__label"};var nf=`${U}__`,af=24,th={display:"flex",alignItems:"flex-start"},Gn={marginLeft:"3px"},Qi={display:"table-cell",verticalAlign:"middle"},fi=class extends re{constructor(e,t){super(e,t),this.activeLayerInfos=null,this.headingLevel=3,this.messages=null,this.type="classic"}render(){let e=this.activeLayerInfos,t=e?.toArray().map(i=>this._renderLegendForLayer(i)).filter(i=>!!i);return u("div",null,t?.length?t:u("div",{class:R.message},this.messages.noLegend))}_renderLegendForLayer(e){if(!e.ready)return null;let t=!!e.children.length,i=`${nf}${e.layer.uid}-version-${e.version}`,s=e.title?Ke({level:this.headingLevel,class:this.classes($.heading,R.label)},e.title):null;if(t){let o=e.children.map(r=>this._renderLegendForLayer(r)).toArray();return u("div",{class:this.classes(R.service,R.groupLayer),key:i},s,o)}{let o=e.legendElements;if(o&&!o.length)return null;let r=o.map(p=>this._renderLegendForElement(p,e.layer,e.effectList)).filter(p=>!!p);if(!r.length)return null;let n={[R.groupLayerChild]:!!e.parent};return u("div",{class:this.classes(R.service,n),key:i},s,u("div",{class:R.layer},r))}}_renderLegendForElement(e,t,i,s){let o=e.type==="color-ramp",r=e.type==="opacity-ramp",n=e.type==="size-ramp",p=null;if(e.type==="symbol-table"||n){let w=e.infos.map(S=>this._renderLegendForElementInfo(S,t,i,n,e.legendType)).filter(S=>!!S);w.length&&(p=u("div",{class:R.layerBody},w))}else e.type==="color-ramp"||e.type==="opacity-ramp"||e.type==="heatmap-ramp"||e.type==="stretch-ramp"?p=this._renderLegendForRamp(e,t.opacity):e.type==="relationship-ramp"?p=So(e,this.id,{opacity:t.opacity,effectList:i,ariaLabel:this.messages.previewRelationshipRampAriaLabel}):e.type==="pie-chart-ramp"?p=this._renderPieChartRamp(e):e.type==="univariate-above-and-below-ramp"?p=this._renderUnivariateAboveAndBelowRamp(e,t.opacity,i):e.type==="univariate-color-size-ramp"&&(p=this._renderUnivariateColorSizeRamp(e,t.opacity,i));if(!p)return null;let c=e.title,d=null;if(typeof c=="string")d=c;else if(c){let w=ft(this.messages,c,o||r);d=Un(c,o||r)&&c.title?`${c.title} (${w})`:w}let h=s?R.layerChildTable:R.layerTable,m=d?u("div",{class:R.layerCaption},d):null,f={[R.layerTableSizeRamp]:n||!s};return u("div",{class:this.classes(h,f)},m,p)}_renderPieChartRamp(e){return u("div",{afterCreate:ce,bind:e.preview})}_renderUnivariateAboveAndBelowRamp(e,t,i){let{sizeRampElement:s,colorRampElement:o}=Oo(e,t);if(!s)return null;let r=this.messages?.previewColorRampAriaLabel,n=Qt(s,"above",!0),p=Qt(s,"below",!0),c=12,d=Yt(o,{width:c,height:n,rampAlignment:"vertical",opacity:t,type:"above",effectList:i,ariaLabel:r}),h=Yt(o,{width:c,height:p,rampAlignment:"vertical",opacity:t,type:"below",effectList:i,ariaLabel:r}),m=Ki(s),f=s.infos.map(k=>k.label),w=f.map((k,H)=>H===0?u("div",{class:k?d?R.univariateAboveAndBelowLabel:R.rampLabel:void 0,key:H},k):H===2?u("div",null):null),S=f.length-1,T=Math.floor(f.length/2),F=f.map((k,H)=>H===T||H===S?u("div",{class:k?d?R.univariateAboveAndBelowLabel:R.rampLabel:void 0,key:H},k):null),b={display:"table-cell",verticalAlign:"middle"},L={marginTop:`${m}px`},g={height:`${n}px`},M={height:`${p}px`};return u("div",{key:"univariate-above-and-below-ramp-preview",styles:th},u("div",{class:R.layerBody},s.infos.map((k,H)=>u("div",{class:this.classes(R.layerRow,R.sizeRamp)},u("div",{afterCreate:ce,bind:k.preview,class:R.symbol,styles:b}),d||H%2!=0?null:u("div",{class:R.layerInfo},f[H])))),d?u("div",{key:"color-ramp-preview",styles:L},u("div",{styles:Gn},u("div",{styles:Qi},u("div",{afterCreate:ce,bind:d,class:R.rampContainer})),u("div",{styles:Qi},u("div",{class:R.rampLabelsContainer,styles:g},w))),u("div",{styles:Gn},u("div",{styles:Qi},u("div",{afterCreate:ce,bind:h,class:R.rampContainer})),u("div",{styles:Qi},u("div",{class:R.rampLabelsContainer,styles:M},F)))):null)}_renderUnivariateColorSizeRamp(e,t,i){let{sizeRampElement:s,colorRampElement:o}=No(e);if(!s)return null;let r=Ki(s),n=12,p=Qt(s,"full",!1),c=Yt(o,{width:n,height:p,rampAlignment:"vertical",opacity:t,type:"full",effectList:i,ariaLabel:this.messages?.previewColorRampAriaLabel}),d=s.infos.length-1,h=s.infos.map((S,T)=>T===0||T===d?u("div",{class:S.label?o?R.univariateAboveAndBelowLabel:R.rampLabel:void 0,key:T},S.label):null),m={display:"table-cell",verticalAlign:"middle"},f={marginTop:`${r}px`},w={height:`${p}px`};return u("div",{key:"univariate-above-and-below-ramp-preview",styles:th},u("div",{class:R.layerBody},s.infos.map(S=>u("div",{class:this.classes(R.layerRow,R.sizeRamp)},u("div",{afterCreate:ce,bind:S.preview,class:R.symbol,styles:m})))),u("div",{key:"color-ramp-preview",styles:f},u("div",{styles:Gn},u("div",{styles:Qi},u("div",{afterCreate:ce,bind:c,class:R.rampContainer})),u("div",{styles:Qi},u("div",{class:R.rampLabelsContainer,styles:w},h)))))}_renderLegendForRamp(e,t){let i=e.infos,s=e.type==="opacity-ramp",o=e.type==="heatmap-ramp",r=e.type==="stretch-ramp",n=e.preview,p=s?R.opacityRamp:"";n.className=`${R.colorRamp} ${p}`,t!=null&&(n.style.opacity=t.toString());let c=i.map(m=>u("div",{class:m.label?R.rampLabel:void 0},o?this.messages[m.label]||m.label:r?Ho(m,this.messages):m.label)),d={width:`${af}px`},h={height:n.style.height};return u("div",{class:R.layerRow},u("div",{class:R.symbolContainer,styles:d},u("div",{afterCreate:ce,bind:n,class:R.rampContainer})),u("div",{class:R.layerInfo},u("div",{class:R.rampLabelsContainer,styles:h},c)))}_renderLegendForElementInfo(e,t,i,s,o){if(e.type)return this._renderLegendForElement(e,t,i,!0);let r=null,n=$o(t,o);if(e.preview?r=u("div",{afterCreate:ce,bind:e.preview,class:R.symbol}):e.src&&(r=this._renderImage(e,t,n)),!r)return null;let p={[R.imageryLayerInfoStretched]:n},c={[R.imageryLayerInfoStretched]:n,[R.sizeRamp]:!n&&s};return u("div",{class:R.layerRow},u("div",{class:this.classes(R.symbolContainer,c)},r),u("div",{class:this.classes(R.layerInfo,p)},ft(this.messages,e.label,!1)||""))}_renderImage(e,t,i){let{label:s,src:o,opacity:r}=e,n={[R.imageryLayerStretchedImage]:i,[R.symbol]:!i},p={opacity:`${r??t.opacity}`};return u("img",{alt:ft(this.messages,s,!1),"aria-label":ft(this.messages,s,!1),border:0,class:this.classes(n),height:e.height,src:o,styles:p,width:e.width})}};a([l()],fi.prototype,"activeLayerInfos",void 0),a([l()],fi.prototype,"headingLevel",void 0),a([l(),Q("esri/widgets/Legend/t9n/Legend")],fi.prototype,"messages",void 0),a([l({readOnly:!0})],fi.prototype,"type",void 0),fi=a([y("esri.widgets.Legend.styles.Classic")],fi);var gi=fi;var lf={base:"esri-legend"},me=class extends re{constructor(e,t){super(e,t),this.headingLevel=3,this.messages=null,this.style=new gi,this.viewModel=new Xd}initialize(){this.addHandles([fe(()=>this.view,"resize",()=>this.scheduleRender()),fe(()=>this.activeLayerInfos,"change",()=>this._refreshActiveLayerInfos(this.activeLayerInfos)),_(()=>this.headingLevel,e=>{let{style:t}=this;t&&(t.headingLevel=e)}),_(()=>this.style,(e,t)=>{t&&e!==t&&t.destroy(),e&&(e.activeLayerInfos=this.activeLayerInfos,e.type==="card"&&(e.view=this.view),e.headingLevel=this.headingLevel)},O)])}get activeLayerInfos(){return this.viewModel.activeLayerInfos}set activeLayerInfos(e){this.viewModel.activeLayerInfos=e}get basemapLegendVisible(){return this.viewModel.basemapLegendVisible}set basemapLegendVisible(e){this.viewModel.basemapLegendVisible=e}get groundLegendVisible(){return this.viewModel.groundLegendVisible}set groundLegendVisible(e){this.viewModel.groundLegendVisible=e}get hideLayersNotInCurrentView(){return this.viewModel.hideLayersNotInCurrentView}set hideLayersNotInCurrentView(e){this.viewModel.hideLayersNotInCurrentView=e}get keepCacheOnDestroy(){return this.viewModel.keepCacheOnDestroy}set keepCacheOnDestroy(e){this.viewModel.keepCacheOnDestroy=e}get respectLayerDefinitionExpression(){return this.viewModel.respectLayerDefinitionExpression}set respectLayerDefinitionExpression(e){this.viewModel.respectLayerDefinitionExpression=e}get respectLayerVisibility(){return this.viewModel.respectLayerVisibility}set respectLayerVisibility(e){this.viewModel.respectLayerVisibility=e}get icon(){return"legend"}set icon(e){this._overrideIfSome("icon",e)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get layerInfos(){return this.viewModel.layerInfos}set layerInfos(e){this.viewModel.layerInfos=e}castStyle(e){if(e instanceof Bo||e instanceof gi)return e;if(typeof e=="string")return e==="card"?new Bo:new gi;if(e&&typeof e.type=="string"){let t=A({},e);return delete t.type,new(e.type==="card"?Bo:gi)(t)}return new gi}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}render(){return u("div",{class:this.classes(lf.base,$.widget,this.style instanceof gi?$.panel:null)},this.style.render())}_refreshActiveLayerInfos(e){e.forEach(t=>{this.removeHandles(`version_${t.layer.uid}`),this._renderOnActiveLayerInfoChange(t)}),this.scheduleRender()}_renderOnActiveLayerInfoChange(e){let t=_(()=>e.version,()=>this.scheduleRender());this.addHandles(t,`version_${e.layer.uid}`);let i=fe(()=>e.children,"change",()=>e.children.forEach(s=>this._renderOnActiveLayerInfoChange(s)),O);this.addHandles(i,`version_${e.layer.uid}`),e.children.forEach(s=>this._renderOnActiveLayerInfoChange(s))}};a([l()],me.prototype,"activeLayerInfos",null),a([l()],me.prototype,"basemapLegendVisible",null),a([l()],me.prototype,"groundLegendVisible",null),a([l()],me.prototype,"headingLevel",void 0),a([l()],me.prototype,"hideLayersNotInCurrentView",null),a([l()],me.prototype,"keepCacheOnDestroy",null),a([l()],me.prototype,"respectLayerDefinitionExpression",null),a([l()],me.prototype,"respectLayerVisibility",null),a([l()],me.prototype,"icon",null),a([l()],me.prototype,"label",null),a([l()],me.prototype,"layerInfos",null),a([l(),Q("esri/widgets/Legend/t9n/Legend")],me.prototype,"messages",void 0),a([l()],me.prototype,"style",void 0),a([ge("style")],me.prototype,"castStyle",null),a([l()],me.prototype,"view",null),a([l()],me.prototype,"viewModel",void 0),me=a([y("esri.widgets.Legend")],me);var ih=me;var Zn,Rs=Zn=class extends Ei{constructor(e){super(e),this.type="none"}clone(){return new Zn({type:this.type})}};a([dp({none:"none",stayAbove:"stay-above"})],Rs.prototype,"type",void 0),Rs=Zn=a([y("esri.ground.NavigationConstraint")],Rs);var qn,Et=qn=class extends ml(at){constructor(e){super(e),this.opacity=1,this.surfaceColor=null,this.navigationConstraint=null,this.layers=new D;let t=s=>{s.parent&&s.parent!==this&&"remove"in s.parent&&s.parent.remove(s),s.parent=this,s.type!=="elevation"&&s.type!=="base-elevation"&&P.getLogger(this).error(`Layer '${s.title}, id:${s.id}' of type '${s.type}' is not supported as a ground layer and will therefore be ignored. Only layers of type 'elevation' are supported.`)},i=s=>{s.parent=null};this.addHandles([this.layers.on("after-add",s=>t(s.item)),this.layers.on("after-remove",s=>i(s.item))])}initialize(){this.when().catch(e=>{rt(e)||P.getLogger(this).error("#load()","Failed to load ground",e)}),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){let e=this.layers.removeAll();for(let t of e)oe(t);this.layers.destroy()}normalizeCtorArgs(e){return e&&"resourceInfo"in e&&(this._set("resourceInfo",e.resourceInfo),delete(e=A({},e)).resourceInfo),e}set layers(e){this._set("layers",ao(e,this._get("layers")))}writeLayers(e,t,i,s){let o=[];e&&(s=he(A({},s),{layerContainerType:"ground"}),e.forEach(r=>{if("write"in r){let n={};Rp(r)().write(n,s)&&o.push(n)}else s?.messages&&s.messages.push(new x("layer:unsupported",`Layers (${r.title}, ${r.id}) of type '${r.declaredClass}' cannot be persisted in the ground`,{layer:r}))})),t.layers=o}load(e){return this.addResolvingPromise(this._loadFromSource(e)),Promise.resolve(this)}loadAll(){return Tl(this,e=>{e(this.layers)})}queryElevation(e,t){return v(this,null,function*(){yield this.load({signal:t?.signal});let{ElevationQuery:i}=yield import("./chunk-III37627.js");ae(t);let s=new i,o=this.layers.filter(sh).toArray();return s.queryAll(o,e,t)})}createElevationSampler(e,t){return v(this,null,function*(){yield this.load({signal:t?.signal});let{ElevationQuery:i}=yield import("./chunk-III37627.js");ae(t);let s=new i,o=this.layers.filter(sh).toArray();return s.createSamplerAll(o,e,t)})}clone(){let e={opacity:this.opacity,surfaceColor:ws(this.surfaceColor),navigationConstraint:ws(this.navigationConstraint),layers:this.layers.slice()};return this.loaded&&(e.loadStatus="loaded"),new qn({resourceInfo:this.resourceInfo}).set(e)}read(e,t){this.resourceInfo||this._set("resourceInfo",{data:e,context:t}),super.read(e,t)}_loadFromSource(e){let t=this.resourceInfo;return t?this._loadLayersFromJSON(t.data,t.context,e):Promise.resolve()}_loadLayersFromJSON(e,t,i){return v(this,null,function*(){let s=t?.origin||"web-scene",o=t?.portal||null,r=t?.url||null,{populateOperationalLayers:n}=yield import("./chunk-RZ7CY2WV.js");ae(i);let p=[];if(e.layers&&Array.isArray(e.layers)){let c={context:{origin:s,url:r,portal:o,layerContainerType:"ground"},defaultLayerType:"ArcGISTiledElevationServiceLayer"};p.push(n(this.layers,e.layers,c))}yield Promise.allSettled(p)})}};function pf(e){return e&&"createElevationSampler"in e}function sh(e){return e.type==="elevation"||pf(e)}a([l({json:{read:!1}})],Et.prototype,"layers",null),a([Ll("layers")],Et.prototype,"writeLayers",null),a([l({readOnly:!0})],Et.prototype,"resourceInfo",void 0),a([l({type:Number,nonNullable:!0,range:{min:0,max:1},json:{type:Br,read:{reader:Up,source:"transparency"},write:{writer:(e,t)=>{t.transparency=Wp(e)},target:"transparency"}}})],Et.prototype,"opacity",void 0),a([l({type:ye,json:{type:[Br],write:(e,t)=>{t.surfaceColor=e.toJSON().slice(0,3)}}})],Et.prototype,"surfaceColor",void 0),a([l({type:Rs,json:{write:!0}})],Et.prototype,"navigationConstraint",void 0),Et=qn=a([y("esri.Ground")],Et);var Xi=Et;var Wo=new WeakMap;function jn(e){return!e.destroyed&&(Wo.has(e)||e.addHandles([_(()=>{let t=e.parent;return!(!t||!("type"in t))&&(t.type==="catalog-dynamic-group"||jn(t))},t=>Wo.set(e,t),Me),st(()=>Wo.delete(e))]),Wo.get(e))}function cf(e){return typeof e=="object"&&e!=null&&"loaded"in e&&e.loaded===!0&&"type"in e}function oh(e){return!(!cf(e)||!np(e)?.operations?.supportsEditing||"editingEnabled"in e&&!ap(e)||jn(e))}var rh={"world-elevation":{id:"worldElevation",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/Terrain3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"},"world-topobathymetry":{id:"worldTopoBathymetry",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/TopoBathy3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"}};function nh(e){let t=null;if(typeof e=="string")if(e in rh){let i=rh[e];t=new Xi({resourceInfo:{data:{layers:[i]}}})}else P.getLogger("esri.support.groundUtils").warn(`Unable to find ground definition for: ${e}. Try "world-elevation"`);else t=ul(Xi,e);return t}var Xe=class extends Jp(Xp(Le.EventedMixin(C))){constructor(e){super(e),this.allLayers=new di({getCollections:()=>[this.basemap?.baseLayers,this.ground?.layers,this.layers,this.basemap?.referenceLayers],getChildrenFunction:t=>"layers"in t?t.layers:null}),this.allTables=Qp(this),this.basemap=null,this.editableLayers=new di({getCollections:()=>[this.allLayers],itemFilterFunction:oh}),this.ground=new Xi,this._basemapCache=mp()}destroy(){fp(this._basemapCache),this._basemapCache=null,this.allLayers.destroy(),this.allTables.destroy(),this.editableLayers.destroy(),this.basemap=oe(this.basemap),oe(this.ground),this._set("ground",null)}castBasemap(e){return gp(e,this._basemapCache)}castGround(e){return nh(e)??this._get("ground")}findLayerById(e){return this.allLayers.find(t=>t.id===e)}findTableById(e){return this.allTables.find(t=>t.id===e)}};a([l({readOnly:!0,dependsOn:[]})],Xe.prototype,"allLayers",void 0),a([l({readOnly:!0})],Xe.prototype,"allTables",void 0),a([l({type:Zt,json:{read:{source:"baseMap"},write:{target:"baseMap"}}})],Xe.prototype,"basemap",void 0),a([ge("basemap")],Xe.prototype,"castBasemap",null),a([l({readOnly:!0})],Xe.prototype,"editableLayers",void 0),a([l({type:Xi,nonNullable:!0})],Xe.prototype,"ground",void 0),a([ge("ground")],Xe.prototype,"castGround",null),a([l()],Xe.prototype,"undoRedo",void 0),Xe=a([y("esri.Map")],Xe);var Uo=Xe;var Go={widthBreakpoint:{getValue(e){let t=e.viewSize[0],i=e.breakpoints,s=this.values;return t<=i.xsmall?s.xsmall:t<=i.small?s.small:t<=i.medium?s.medium:t<=i.large?s.large:s.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-width-xsmall esri-view-width-less-than-small esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",small:"esri-view-width-small esri-view-width-greater-than-xsmall esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",medium:"esri-view-width-medium esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-less-than-large esri-view-width-less-than-xlarge",large:"esri-view-width-large esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-less-than-xlarge",xlarge:"esri-view-width-xlarge esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-greater-than-large"}},heightBreakpoint:{getValue(e){let t=e.viewSize[1],i=e.breakpoints,s=this.values;return t<=i.xsmall?s.xsmall:t<=i.small?s.small:t<=i.medium?s.medium:t<=i.large?s.large:s.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-height-xsmall esri-view-height-less-than-small esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",small:"esri-view-height-small esri-view-height-greater-than-xsmall esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",medium:"esri-view-height-medium esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-less-than-large esri-view-height-less-than-xlarge",large:"esri-view-height-large esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-less-than-xlarge",xlarge:"esri-view-height-xlarge esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-greater-than-large"}},orientation:{getValue(e){let t=e.viewSize,i=t[0],s=t[1],o=this.values;return s>=i?o.portrait:o.landscape},values:{portrait:"portrait",landscape:"landscape"},valueToClassName:{portrait:"esri-view-orientation-portrait",landscape:"esri-view-orientation-landscape"}}},Kn={xsmall:544,small:768,medium:992,large:1200};function df(e){let t=e;return t&&t.xsmall<t.small&&t.small<t.medium&&t.medium<t.large}function Yn(e,t){return t?Go[e].valueToClassName[t].split(" "):[]}var ah=e=>{let t=class extends e{constructor(...i){super(...i),this.orientation=null,this.widthBreakpoint=null,this.heightBreakpoint=null,this.breakpoints=Kn}initialize(){this.addHandles(_(()=>[this.breakpoints,this.size],()=>this._updateClassNames(),O))}destroy(){this.destroyed||this._removeActiveClassNames()}set breakpoints(i){if(i!==this._get("breakpoints")){if(!df(i)){let s=JSON.stringify(Kn,null,2);console.warn("provided breakpoints are not valid, using defaults:"+s),i=Kn}this._set("breakpoints",A({},i))}}_updateClassNames(){if(!this.container)return;let i=bs.acquire(),s=bs.acquire(),o,r=!1;for(o in Go){let n=this[o],p=Go[o].getValue({viewSize:this.size,breakpoints:this.breakpoints});n!==p&&(r=!0,this[o]=p,Yn(o,n).forEach(c=>s.push(c)),Yn(o,p).forEach(c=>i.push(c)))}r&&(this._applyClassNameChanges(i,s),bs.release(i),bs.release(s))}_applyClassNameChanges(i,s){let o=this.container;o&&(s.forEach(r=>o.classList.remove(r)),i.forEach(r=>o.classList.add(r)))}_removeActiveClassNames(){let i=this.container;if(!i)return;let s;for(s in Go)Yn(s,this[s]).forEach(o=>i.classList.remove(o))}};return a([l()],t.prototype,"breakpoints",null),a([l()],t.prototype,"orientation",void 0),a([l()],t.prototype,"widthBreakpoint",void 0),a([l()],t.prototype,"heightBreakpoint",void 0),t=a([y("esri.views.BreakpointsOwner")],t),t};var Xt=class extends C{constructor(){super(...arguments),this.items=new D,this._watchUpdatingTracking=new Ut,this._callbacks=new Map,this._projector=Ss(),this._hiddenProjector=Ss()}get needsRender(){return this.items.length>0}get updating(){return this._watchUpdatingTracking?.updating??!1}initialize(){let e=document.createElement("div");e.className="esri-overlay-surface",this._set("surface",e),this._hiddenSurface=document.createElement("div"),this._hiddenSurface.setAttribute("style","visibility: hidden;"),e.appendChild(this._hiddenSurface),this._watchUpdatingTracking.addOnCollectionChange(()=>this.items,t=>{for(let i of t.added){let s=()=>i.render();this._callbacks.set(i,s),this._projector.append(this.surface,s)}for(let i of t.removed){let s=this._projector.detach(this._callbacks.get(i));this.surface.removeChild(s.domNode),this._callbacks.delete(i)}})}addItem(e){this.items.add(e)}removeItem(e){this.items.remove(e)}destroy(){this.items.removeAll(),this._callbacks.forEach(e=>this._projector.detach(e)),this._callbacks=null,this._projector=null,this._watchUpdatingTracking.destroy()}render(){this._projector.renderNow()}computeBoundingRect(e){let t=this._hiddenSurface,i=this._hiddenProjector,s,o=()=>(s=e.render(),s);i.append(t,o),i.renderNow();let r={left:0,top:0,right:0,bottom:0};if(s?.domNode){let n=s.domNode.getBoundingClientRect();r.left=n.left,r.top=n.top,r.right=n.right,r.bottom=n.bottom}for(i.detach(o);t.firstChild;)t.removeChild(t.firstChild);return r}overlaps(e,t){let i=this.computeBoundingRect(e),s=this.computeBoundingRect(t);return Math.max(i.left,s.left)<=Math.min(i.right,s.right)&&Math.max(i.top,s.top)<=Math.min(i.bottom,s.bottom)}get hasVisibleItems(){return this.items.some(e=>e.visible)}prepare(){return v(this,null,function*(){yield document.fonts.load(this._fontString()).catch(()=>{})})}renderCanvas(e,t){let i=!!t?.disableDecorations;if(!this.items.some(o=>o.visible&&!(i&&o.isDecoration)))return;let s=e.getContext("2d");s.save(),s.font=this._fontString(),this.items.forEach(o=>{i&&o.isDecoration||(s.save(),o.renderCanvas(s),s.restore())}),s.restore()}_fontString(){return`10px ${getComputedStyle(this.surface).fontFamily}`}};a([l({readOnly:!0})],Xt.prototype,"surface",void 0),a([l({readOnly:!0})],Xt.prototype,"items",void 0),a([l({readOnly:!0})],Xt.prototype,"needsRender",null),a([l({readOnly:!0})],Xt.prototype,"_watchUpdatingTracking",void 0),a([l({readOnly:!0})],Xt.prototype,"updating",null),Xt=a([y("esri.views.overlay.ViewOverlay")],Xt);var Qn=Xt;var Xn=[0,0];function hf(e){let t=(e.ownerDocument||window.document).defaultView,i=e.getBoundingClientRect();return Xn[0]=i.left+(t?.pageXOffset??0),Xn[1]=i.top+(t?.pageYOffset??0),Xn}function lh(e){e&&(ro(e),e.parentNode&&e.parentNode.removeChild(e))}function uf(e){let t=document.createElement("div");return e.appendChild(t),t}var Ds=16,Zo=750,mf=512,ff=2,ph=e=>{let t=class extends e{constructor(...i){super(...i),this._freqInfo={freq:Ds,time:Zo},this._overlayRenderTaskHandle=null,this.height=0,this.messagesCommon=null,this.overlay=null,this.position=null,this.resizing=!1,this.root=null,this.surface=null,this.suspended=!0,this.ui=null,this.userContent=null,this.width=0,this.widthBreakpoint=null,this.addHandles([_(()=>this.cursor,s=>{let{surface:o}=this;o&&o.setAttribute("data-cursor",s)}),_(()=>this.navigating,s=>{let{surface:o}=this;o&&o.setAttribute("data-navigating",s.toString())})])}initialize(){this.addHandles([_(()=>this.ui,(i,s)=>this._handleUIChange(i,s),O),this.on("focus",()=>this.notifyChange("focused")),this.on("blur",()=>this.notifyChange("focused"))])}destroy(){this.destroyed||(this.ui=oe(this.ui),this.container=null)}get container(){return this._get("container")??null}set container(i){let s=this._get("container"),o=oo(i);if(o||typeof i!="string"||P.getLogger(this).error("#container",`element with id '${i}' not found`),s===o)return;if(this._stopMeasuring(),s&&(s.classList.remove("esri-view"),this._overlayRenderTaskHandle&&(this._overlayRenderTaskHandle.remove(),this._overlayRenderTaskHandle=null),this.overlay&&(this.overlay.destroy(),this._set("overlay",null)),this.root&&(lh(this.root),this._set("root",null)),this.userContent&&(Zr(this.userContent,s),lh(this.userContent),this._set("userContent",null))),!o)return this._set("width",0),this._set("height",0),this._set("position",null),this._set("suspended",!0),this._set("surface",null),void this._set("container",null);o.classList.add("esri-view");let r=document.createElement("div");r.className="esri-view-user-storage",Zr(o,r),o.appendChild(r),this._set("userContent",r);let n=document.createElement("div");n.className="esri-view-root",o.insertBefore(n,o.firstChild),this._set("root",n);let p=document.createElement("div");p.className="esri-view-surface",p.setAttribute("role","application"),p.tabIndex=0,n.appendChild(p),this._set("surface",p);let c=new Qn;n.appendChild(c.surface),this._set("overlay",c),this.addHandles(_(()=>c.needsRender,d=>{d&&!this._overlayRenderTaskHandle?this._overlayRenderTaskHandle=qe({render:()=>this.overlay?.render()}):this._overlayRenderTaskHandle=ue(this._overlayRenderTaskHandle)})),this.forceDOMReadyCycle(),this._set("container",o),this._startMeasuring()}get focused(){let i=document.activeElement===this.surface;return document.hasFocus()&&i}get size(){return[this.width,this.height]}blur(){this.surface?.blur()}focus(){this.surface?.focus()}pageToContainer(i,s,o){let r=this.position;return i-=r?r[0]:0,s-=r?r[1]:0,o?(o[0]=i,o[1]=s):o=[i,s],o}containerToPage(i,s,o){let r=this.position;return i+=r?r[0]:0,s+=r?r[1]:0,o?(o[0]=i,o[1]=s):o=[i,s],o}_handleUIChange(i,s){this.removeHandles("ui"),s&&s!==i&&s.destroy(),i&&(i.view=this,this.addHandles(_(()=>this.root,o=>{i.container=o?uf(o):null},O),"ui")),this._set("ui",i)}_stopMeasuring(){this.removeHandles("measuring"),this._get("resizing")&&this._set("resizing",!1)}_startMeasuring(){let i=this._freqInfo;i.freq=Ds,i.time=Zo,this.addHandles([el(window,"resize",()=>{i.freq=Ds,i.time=Zo}),qe({prepare:s=>{let o=this._measure(),r=this._freqInfo;if(r.time+=s.deltaTime,o&&(r.freq=Ds,this._get("resizing")||this._set("resizing",!0)),r.time<r.freq)return;r.time=0;let n=this._position();r.freq=n||o?Ds:Math.min(Zo,r.freq*ff),!o&&r.freq>=mf&&this._get("resizing")&&this._set("resizing",!1)}})],"measuring"),this._measure(),this._position()}_measure(){let i=this.container,s=i?i.clientWidth:0,o=i?i.clientHeight:0;if(s===0||o===0)return this.suspended||this._set("suspended",!0),!1;let r=this.width,n=this.height;return s===r&&o===n?(this.suspended&&this._set("suspended",!1),!1):(this._set("width",s),this._set("height",o),this.suspended&&this._set("suspended",!1),this.emit("resize",{oldWidth:r,oldHeight:n,width:s,height:o}),!0)}_position(){let i=this.container,s=this.position,o=i&&hf(i);return!!o&&(!s||o[0]!==s[0]||o[1]!==s[1])&&(this._set("position",[o[0],o[1]]),!0)}forceDOMReadyCycle(){}};return a([l()],t.prototype,"container",null),a([l({readOnly:!0})],t.prototype,"focused",null),a([l({readOnly:!0})],t.prototype,"height",void 0),a([l()],t.prototype,"messagesCommon",void 0),a([l({type:Qn})],t.prototype,"overlay",void 0),a([l({readOnly:!0})],t.prototype,"position",void 0),a([l({readOnly:!0})],t.prototype,"resizing",void 0),a([l({readOnly:!0})],t.prototype,"root",void 0),a([l({value:null,readOnly:!0})],t.prototype,"size",null),a([l({readOnly:!0})],t.prototype,"surface",void 0),a([l({readOnly:!0})],t.prototype,"suspended",void 0),a([l()],t.prototype,"ui",void 0),a([l({readOnly:!0})],t.prototype,"userContent",void 0),a([l({readOnly:!0})],t.prototype,"width",void 0),a([l()],t.prototype,"widthBreakpoint",void 0),t=a([y("esri.views.DOMContainer")],t),t};function Pt(e){return e!=null&&"open"in e&&"declaredClass"in e}function ch(e){return e!=null&&"declaredClass"in e&&"dockOptions"in e}var dh=e=>{let t=class extends e{constructor(){super(...arguments),this._popupSetupTask=null,this.popup={},this.popupEnabled=!0}initialize(){this.addHandles([_(()=>[this.ui,this.popup],([i,s],o)=>{let r="popup",n="manual";if(o){let[p,c]=o;p&&Pt(c)&&(c.view=null,ch(c)&&p.remove(c,r))}i&&Pt(s)&&(s.view=this,ch(s)&&i.add(s,{key:r,position:n,internal:!0}))},O),this.on("click",i=>{this.popup&&this.popupEnabled&&(i.pointerType!=="mouse"||i.button===0)&&(Pt(this.popup)?this.popup.viewModel.handleViewClick(i):i.async(()=>v(this,null,function*(){yield this.setupPopup(),Pt(this.popup)&&!this.destroyed&&this.ready&&this.popupEnabled&&this.popup.viewModel.handleViewClick(i)})))},xt.WIDGET)]),nt(()=>this.ready&&this.popupEnabled&&!this.updating).then(()=>{import("./chunk-RFWY66IO.js")})}destroy(){this.destroyed||this.closePopup()}openPopup(i){return v(this,null,function*(){if(Pt(this.popup))return this.popup.open(i);try{if(yield this.setupPopup(),!this.popup)return void P.getLogger(this).error(new x("view:null-popup","Popup is null and can't be opened"));this.popup.open(i)}catch{}})}closePopup(){this._popupSetupTask?.abort(),Pt(this.popup)&&this.popup.close()}fetchPopupFeatures(i,s){return v(this,null,function*(){return yield this.when(),this._popupHitsToFeatures(yield this._getPopupHits(i,s),s)})}setupPopup(){return v(this,null,function*(){if(this._popupSetupTask?.abort(),this.popup&&!Pt(this.popup))return this._popupSetupTask=ki(i=>v(this,null,function*(){let{default:s}=yield import("./chunk-RFWY66IO.js");if(ae(i),!this.popup||Pt(this.popup))return;let o=this.popup;delete o.open,delete o.close,this.popup=new s(o)})),this._popupSetupTask.promise})}_popupHitsToFeatures(r,n){return v(this,arguments,function*({location:i,hits:s},o){let p=[],c=[],d=!1,h=rl(o,ie("popup-view-fetch-timeout")??gf),m=S=>{let T=new Jn(S);return c.push(T),p.push(T.promise),T},f=S=>{let T=c.at(-1);return T&&T.layerView===S&&!d?T:m(S)};for(let S of s)"graphic"in S?(f(S.layerView).graphics.push(S.graphic),d=!1):(p.push(S.layerView.fetchPopupFeaturesAtLocation(S.mapPoint,h)),d=!0);c.map(S=>S.resolve(h));let w=sl(p).then(S=>S.filter(T=>!!T).flat());return{pendingFeatures:p,allGraphicsPromise:w,location:i}})}_getPopupHits(i,s){return v(this,null,function*(){let{hits:o,location:r}=yield this.popupHitTest(i);ae(s);let n=[];for(let p of o)if("graphic"in p){if(this._isValidPopupGraphic(p.graphic,s)){let c=this._isValidPopupGraphicsLayerView(p.layerView)?p.layerView:void 0;n.push({graphic:p.graphic,layerView:c})}}else this._isValidPopupLocationLayerView(p.layerView)&&n.push({mapPoint:p.mapPoint,layerView:p.layerView});return{hits:n,location:r}})}_isValidPopupGraphic(i,s){return i&&!!i.getEffectivePopupTemplate(s?.defaultPopupTemplateEnabled)}_isValidPopupGraphicsLayerView(i){return!i||(!("layer"in i)||!i.suspended)&&"fetchPopupFeaturesFromGraphics"in i}_isValidPopupLocationLayerView(i){return(!("layer"in i)||!i.suspended)&&"fetchPopupFeaturesAtLocation"in i}};return a([l({cast(i){return!i||Pt(i)||typeof i=="object"&&(i.open=s=>(Or(P.getLogger(this),"view.popup is no longer created by default. view.popup.open() will stop working when the popup isn't created",{replacement:"Use view.openPopup() instead.",version:"4.27"}),this.openPopup(s)),i.close=()=>(Or(P.getLogger(this),"view.popup is no longer created by default. view.popup.close() will stop working when the popup isn't created",{replacement:"Use view.closePopup() instead.",version:"4.27"}),this.closePopup())),i}})],t.prototype,"popup",void 0),a([l()],t.prototype,"popupEnabled",void 0),t=a([y("esri.views.PopupView")],t),t},Jn=class{constructor(t){this.layerView=t,this._resolver=oi(),this.graphics=[]}get promise(){return this._resolver.promise}resolve(t){let{layerView:i,graphics:s,_resolver:o}=this;if(!i)return o.resolve(s),o.promise;let r;return i.fetchPopupFeaturesFromGraphics(s,t).catch(n=>(r=n,null)).then(n=>{n?o.resolve(n):o.reject(r)}),o.promise}},gf=5e3;var Vs=class extends oc{constructor(e){super(e),this.addHandles(this.on("before-add",t=>{t.item!=null&&t.item.parent===this.owner&&(P.getLogger(this).warn("Analysis inside the collection must be unique. Not adding this element again."),t.preventDefault())}))}_own(e){e.parent=this.owner}_release(e){e.parent=null}};Vs=a([y("esri.support.AnalysesCollection")],Vs);var kt=class extends C{constructor(e){super(e),this.view=null,this.baseLayerViews=new D,this.referenceLayerViews=new D,this._loadingHandle=_(()=>this.view?.map?.basemap,t=>{t&&t.load().catch(()=>{})},O)}destroy(){this._set("view",null),this._loadingHandle&&(this._loadingHandle.remove(),this._loadingHandle=null);for(let e of this.baseLayerViews)e.destroy();this.baseLayerViews.length=0;for(let e of this.referenceLayerViews)e.destroy();this.referenceLayerViews.length=0}get suspended(){return!this.view||this.view.suspended}get updating(){if(this.view?.suspended)return!1;let e=this.view?.map?.basemap;return!!e&&!!e.loaded&&(this.baseLayerViews.some(t=>t.updating)||this.referenceLayerViews.some(t=>t.updating))}};a([l({constructOnly:!0})],kt.prototype,"view",void 0),a([l({readOnly:!0})],kt.prototype,"baseLayerViews",void 0),a([l({readOnly:!0})],kt.prototype,"referenceLayerViews",void 0),a([l({readOnly:!0})],kt.prototype,"suspended",null),a([l({type:Boolean,readOnly:!0})],kt.prototype,"updating",null),kt=a([y("esri.views.BasemapView")],kt);function yf(e){return"tryRecycleWith"in e}function vf(e){return e!=null&&typeof e=="object"&&"layerViews"in e}var ea=class{constructor(t,i,s){this.layer=t,this.view=i,this.layerViewImporter=s,this._controller=new AbortController,this._deferred=oi(),this._started=!1,this.done=!1,this.promise=this._deferred.promise,eo(this._controller.signal,()=>{let o=new x("cancelled:layerview-create","layerview creation cancelled",{layer:t});this._deferred.reject(o)})}tryRecycle(t){if(!this.done||!this.layerView||!yf(this.layerView))return null;let i=this.layer.type,s=this._controller.signal;for(let o=0;o<t.length;o++){let r=t[o];if(r.type!==i)continue;let n=this.layerView.tryRecycleWith(r,{signal:s});if(n){t.splice(o,1),this.layer=r;let p=this.layerView,c=p.view;return this.promise=Promise.race([n.then(()=>(ae(this._controller.signal),r.emit("layerview-destroy",{view:c,layerView:p}),c.emit("layerview-destroy",{view:c,layerView:p}),r.emit("layerview-create",{view:c,layerView:p}),c.emit("layerview-create",{view:c,layerView:p}),p)),new Promise((d,h)=>eo(this._controller.signal,()=>h($r())))]),this.promise}}return null}destroy(){this._controller.abort();let{layerView:t}=this;if(t){let{layer:i,view:s}=this;i.emit("layerview-destroy",{view:s,layerView:t}),s.emit("layerview-destroy",{layer:i,layerView:t})}this.done=!0,this.layer=null,this.layerView=null,this.view=null,this.layerViewImporter=null,this._map=null}start(){return v(this,null,function*(){if(this._started)return;this._started=!0;let{_controller:{signal:t},layer:i,view:s}=this;this._map=s.map;try{let o,r;if(yield i.load({signal:t}),i.prefetchResources&&(yield i.prefetchResources({signal:t})),wf(i))o=yield i.createLayerView(s,{signal:t});else{if(!this.layerViewImporter.hasLayerViewModule(i))throw new x("layer:view-not-supported","No layerview implementation was found");let c=yield this.layerViewImporter.importLayerView(i);ae(t),o="default"in c?new c.default({layer:i,view:s}):new c({layer:i,view:s})}let n=()=>{r=ue(r),o.destroyed||o.destroy(),o.layer=null,o.parent=null,o.view=null,this.done=!0};r=eo(t,n),ae(t);try{yield o.when()}catch(c){throw n(),c}if(!this._map?.allLayers?.includes(i))return n(),void this._deferred.reject(new x("view:no-layerview-for-layer","The layer has been removed from the map",{layer:i}));this.layerView=o,i.emit("layerview-create",{view:s,layerView:o}),s.emit("layerview-create",{layer:i,layerView:o}),this.done=!0,this._deferred.resolve(o)}catch(o){i.emit("layerview-create-error",{view:s,error:o}),s.emit("layerview-create-error",{layer:i,error:o}),this.done=!0,this._deferred.reject(new x("layerview:create-error","layerview creation failed",{layer:i,error:o}))}})}},Ue=class extends C{constructor(e){super(e),this._layerLayerViewInfoMap=new Map,this._recyclingInfoMap=new Map,this._watchUpdatingTracking=new Ut,this.supportsGround=!0,this._preloadLayerViewModules=()=>{let t=this.view.map?.allLayers;if(t)for(let i of t)this.layerViewImporter.hasLayerViewModule(i)&&this.layerViewImporter.importLayerView(i)},this._reschedule=()=>this.destroyed?Promise.reject():(this._workPromise==null&&(this._workPromise=oi(),this._workPromise.promise.catch(()=>{})),this.removeHandles("reschedule"),this.addHandles(pl(this._doWork),"reschedule"),this._workPromise.promise),this._doWork=()=>{if(this.destroyed)return;let t=this.view.map;if(this._map!==t&&(this.clear(),this._map=t),this._workPromise==null)return void this.notifyChange("updating");this.removeHandles("reschedule"),this.removeHandles("collection-change");let i=new Set,s=[],o=this.view.ready,r=p=>{if(p!=null){for(let c of p)if(c){i.add(c);let d=this._layerLayerViewInfoMap.get(c);d&&o?d.start():d||this._recyclingInfoMap.has(c)||s.push(c),"layers"in c&&c.layers&&r(c.layers)}}};for(let p of this._rootCollectionNames)r(Mi(this,p));for(let[p,c]of this._layerLayerViewInfoMap)if(!i.has(p)){this._layerLayerViewInfoMap.delete(c.layer);let d=c.tryRecycle(s);d?(this.notifyChange("updating"),this._recyclingInfoMap.set(c.layer,c),d.then(()=>{this.notifyChange("updating"),this._recyclingInfoMap.delete(c.layer),this._layerLayerViewInfoMap.set(c.layer,c),this._reschedule()}).catch(()=>{this.notifyChange("updating"),this._recyclingInfoMap.delete(c.layer),c.destroy(),this._reschedule()})):c.destroy()}for(let[p,c]of this._recyclingInfoMap)i.has(p)||(this.notifyChange("updating"),this._recyclingInfoMap.delete(c.layer),c.destroy());for(let p of s)this._createLayerView(p);this._refreshCollections();let n=[t?.ground?.layers,t?.basemap?.baseLayers,t?.basemap?.referenceLayers,t?.layers].filter(p=>!!p);i.forEach(p=>"layers"in p&&n.push(p.layers)),this.addHandles(n.map(p=>this._watchUpdatingTracking.addOnCollectionChange(()=>p,this._reschedule)),"collection-change"),this._workPromise.resolve(),this._workPromise=null}}initialize(){this.addHandles([fe(()=>this.view?.map?.allLayers,"change",this._preloadLayerViewModules,{onListenerAdd:this._preloadLayerViewModules}),_(()=>{let e=this.view,t=e?.map;return[t?.basemap,t?.ground,t?.layers,e?.ready]},()=>this._reschedule(),Me)]),this._preloadLayerViewModules(),this._reschedule()}destroy(){this.clear(),_o(this._recyclingInfoMap),_o(this._layerLayerViewInfoMap),this._watchUpdatingTracking.destroy(),this._map=null,this._workPromise!=null&&(this._workPromise.reject($r()),this._workPromise=null)}get _layersToLayerViews(){let e=[["view.map.basemap.baseLayers","view.basemapView.baseLayerViews"],["view.map.layers","view.layerViews"],["view.map.basemap.referenceLayers","view.basemapView.referenceLayerViews"]];return this.supportsGround&&e.push(["view.map.ground.layers","view.groundView.layerViews"]),new Map(e)}get _rootCollectionNames(){return Array.from(this._layersToLayerViews.keys())}get updating(){return this._workPromise!=null||this._watchUpdatingTracking.updating||Ht(this._layerLayerViewInfoMap,e=>!e.done)||this._recyclingInfoMap.size>0}get updatingRemaining(){let e=0;for(let t of this._layerLayerViewInfoMap.values())t.done||++e;return e}clear(){this.destroyed||(_o(this._layerLayerViewInfoMap),this._refreshCollections())}whenLayerView(e){return v(this,null,function*(){if(yield this._reschedule(),!this._layerLayerViewInfoMap.has(e)){if(this._recyclingInfoMap.has(e))return this._recyclingInfoMap.get(e).promise;throw new x("view:no-layerview-for-layer","No layerview has been found for the layer",{layer:e})}return this._layerLayerViewInfoMap.get(e).promise})}isCreatingLayerViewsForLayer(e,t){this.commitProperty("updatingRemaining");let i=this._layerLayerViewInfoMap.get(e);if(!i?.done)return!0;let s=i.layerView;return!(!s||!t||s.parent===t)||!!(i.done&&s&&"layers"in e&&e.layers?.length)&&e.layers.some(o=>this.isCreatingLayerViewsForLayer(o,s))}_refreshCollections(){for(let[e,t]of this._layersToLayerViews)this._populateLayerViewsOwners(Mi(this,e),Mi(this,t),this.view);this.notifyChange("updating"),this.notifyChange("updatingRemaining")}_populateLayerViewsOwners(e,t,i){if(!e||!t)return void(t&&t.removeAll());let s=0;for(let o of e){let r=this._layerLayerViewInfoMap.get(o);if(!r?.layerView)continue;let n=r.layerView;n.layer=o,n.parent=i,t.at(s)!==n&&t.splice(s,0,n),"layers"in o&&vf(n)&&this._populateLayerViewsOwners(o.layers,n.layerViews,n),s+=1}s<t.length&&t.splice(s,t.length)}_createLayerView(e){e.load().catch(()=>{}),this.layerViewImporter.hasLayerViewModule(e)&&this.layerViewImporter.importLayerView(e);let t=new ea(e,this.view,this.layerViewImporter);t.promise.then(()=>this._refreshCollections(),i=>{i&&(rt(i)||i.name==="cancelled:layerview-create")||P.getLogger(this).error(`Failed to create layerview for layer title:'${e.title??"no title"}', id:'${e.id??"no id"}' of type '${e.type}'.`,{layer:e,error:i}),this._refreshCollections()}),this._layerLayerViewInfoMap.set(e,t),this.view.ready&&t.start(),this.notifyChange("updating"),this.notifyChange("updatingRemaining")}};a([l()],Ue.prototype,"_workPromise",void 0),a([l({readOnly:!0})],Ue.prototype,"_watchUpdatingTracking",void 0),a([l({readOnly:!0})],Ue.prototype,"_layersToLayerViews",null),a([l({readOnly:!0})],Ue.prototype,"_rootCollectionNames",null),a([l()],Ue.prototype,"layerViewImporter",void 0),a([l()],Ue.prototype,"supportsGround",void 0),a([l({readOnly:!0})],Ue.prototype,"updating",null),a([l({readOnly:!0})],Ue.prototype,"updatingRemaining",null),a([l({constructOnly:!0})],Ue.prototype,"view",void 0),Ue=a([y("esri.views.LayerViewManager")],Ue);var hh=Ue;function wf(e){return"createLayerView"in e&&e.createLayerView!=null}var ze=class extends C{constructor(e){super(e),this.factor=1.5,this.offset=X(0,0),this.position=null,this.size=120,this.maskUrl=null,this.maskEnabled=!0,this.overlayUrl=null,this.overlayEnabled=!0,this.visible=!0}get version(){return this.commitProperty("factor"),this.commitProperty("offset"),this.commitProperty("position"),this.commitProperty("visible"),this.commitProperty("size"),this.commitProperty("maskUrl"),this.commitProperty("maskEnabled"),this.commitProperty("overlayUrl"),this.commitProperty("overlayEnabled"),(this._get("version")||0)+1}};a([l({type:Number})],ze.prototype,"factor",void 0),a([l({nonNullable:!0})],ze.prototype,"offset",void 0),a([l()],ze.prototype,"position",void 0),a([l({type:Number,range:{min:0}})],ze.prototype,"size",void 0),a([l()],ze.prototype,"maskUrl",void 0),a([l()],ze.prototype,"maskEnabled",void 0),a([l()],ze.prototype,"overlayUrl",void 0),a([l()],ze.prototype,"overlayEnabled",void 0),a([l({readOnly:!0})],ze.prototype,"version",null),a([l({type:Boolean})],ze.prototype,"visible",void 0),ze=a([y("esri.views.Magnifier")],ze);var ta=ze;function As(e){return!!(e!=null&&typeof e=="object"&&"createQuery"in e&&e.createQuery&&"on"in e&&e.on)}var Rt=class extends Le.EventedAccessor{constructor(e){super(e),this._selectionMap=new zp,this._sources=new D,this._trashCan=[],this._layerEditHandles=new D,this._vizTaskId=0,this.showHighlight=!0}initialize(){this.addHandles([_(()=>[this.view,this.showHighlight],()=>this._refreshVisualization()),fe(()=>this.sources,"change",t=>{let i=this._selectionMap;for(let s of t.removed)i.delete(s);this._refreshListeners(),this._refreshVisualization()},{onListenerAdd:()=>this._refreshListeners()})]);let e=new D;this.view.when().then(()=>{this.view.map&&(this.view.map.allLayers.flatten(t=>"sublayers"in t&&t.sublayers?t.sublayers:null).forEach(t=>{(As(t)&&!ip(t)||Wt(t))&&e.add(t)}),this.sources=e)})}destroy(){this._layerEditHandles.drain(ue)}get selections(){return Array.from(this._selectionMap.entries()).map(e=>{let[t,i]=e;return{layer:t,selection:[...i.selection]}})}get count(){let e=0;for(let t of this._selectionMap.values())e+=t.selection.length;return e}get hasSelection(){return this.count>0}get sources(){return this._sources}set sources(e){ao(e,this._sources)}getSelectedFeatures(s){return v(this,arguments,function*(e,t={},i="layerView"){let{view:o,selections:r}=this,n=(e!==void 0?r.filter(p=>e.includes(p.layer)):r).filter(p=>p.selection.length>0).map(p=>v(this,null,function*(){let{layer:c,selection:d}=p,h=Wt(c)?c.parent:c;if(h==null||!mh(h))return null;if(i==="layer")return fh(h,d,t);if(uh(h))return null;let m=yield o.whenLayerView(h).catch(()=>null);return m?fh(m,d,t):null}));return(yield Promise.all(n)).filter(p=>p!=null)})}updateSelection(e){let t=new Map;for(let[o,r]of this._selectionMap)t.set(o,[...r.selection]);let i=!1,s=e.current.concat(e.added);for(let o of s){let r=o.sourceLayer,n=o.getObjectId();if(this.sources.includes(r)&&(As(r)||Wt(r))&&n!==null){let p=dl(t,r,()=>[]);p.includes(n)||(p.push(n),i=!0)}}for(let o of e.removed){let r=o.sourceLayer,n=o.getObjectId();if(this.sources.includes(r)&&(As(r)||Wt(r))&&n!==null){let p=t.get(r),c=p?.indexOf(n);c!==void 0&&c>=0&&(p?.splice(c,1),i=!0)}}if(i){let{_selectionMap:o,_trashCan:r}=this,n=[];for(let[p,c]of t){let d=o.get(p);d!==void 0&&r.push(d),o.set(p,{selection:c}),n.push(A({layer:p,selection:c},Fr(d!==void 0?d.selection:[],c)))}this._onSelectionChange(n)}}setSelection(e,t){this._setSelection(e,t)}getSelection(e){return this._selectionMap.get(e)?.selection}appendToSelection(e,t){let i=this._selectionMap.get(e),s=i!==void 0?[...i.selection]:[];for(let o of t)s.includes(o)||s.push(o);this._setSelection(e,s)}removeFromSelection(e,t){let i=this._selectionMap.get(e);if(!i)return;let s=[];for(let o of i.selection)t.includes(o)||s.push(o);this._setSelection(e,s)}toggleInSelection(e,t){let i=this._selectionMap.get(e);if(!i||i.selection.length===0)return void this._setSelection(e,t);let s=new Set(i.selection),o=new Set(t),r=cl(s,o);this._setSelection(e,Array.from(r))}clear(){let e=this._selectionMap.values();this._trashCan.push(...e);let t=[];for(let[i,s]of this._selectionMap.entries())t.push({layer:i,added:[],removed:[...s.selection],selection:[]});this._selectionMap.clear(),this._onSelectionChange(t)}_onSelectionChange(e){this._refreshVisualization(),this.emit("selection-change",{view:this.view,changes:e})}_refreshVisualization(){if(this.view==null||this.sources==null)return;for(this._vizTaskId++;this._trashCan.length>0;)this._trashCan.pop()?.highlightHandle?.remove();let{sources:e,view:t,_selectionMap:i,showHighlight:s}=this,o=this._vizTaskId;for(let r of e){let n=i.get(r),p=Wt(r)?r.parent:r;if(p!=null&&mh(p)){if(uh(p))continue;t.whenLayerView(p).then(c=>{n?.highlightHandle?.remove(),n!=null&&s&&o===this._vizTaskId&&"highlight"in c&&typeof c.highlight=="function"&&n.selection.length>0&&(n.highlightHandle=c.highlight(n.selection,"selection"))}).catch(()=>{n?.highlightHandle?.remove()})}}}_refreshListeners(){this._layerEditHandles.drain(ue);for(let e of this.sources){let t=Wt(e)?e.parent:e;if(t!=null&&As(t)){let i=t.on("edits",s=>{this._handleEditChanges(s,e)});this._layerEditHandles.push(i)}}}_handleEditChanges(e,t){if(e.deletedFeatures!==void 0&&e.deletedFeatures.length>0&&this._selectionMap.has(t)){let i=e.deletedFeatures.filter(s=>s.error==null).map(s=>s.objectId).filter(we);this.removeFromSelection(t,i)}}_setSelection(e,t){if(!this.sources.includes(e))throw new Error(`Cannot set selection on layer ${e.title} because it is not in 'sources'`);let i=this._selectionMap.get(e);if(i===void 0||!bf(i,{selection:t})){i!==void 0&&this._trashCan.push(i),this._selectionMap.set(e,{selection:[...t]});let s=A({layer:e,selection:[...t]},Fr(i!==void 0?i.selection:[],t));this._onSelectionChange([s])}}};a([l({readOnly:!0,nonNullable:!0})],Rt.prototype,"selections",null),a([l({readOnly:!0,nonNullable:!0})],Rt.prototype,"count",null),a([l({constructOnly:!0,nonNullable:!0})],Rt.prototype,"view",void 0),a([l({readOnly:!0,nonNullable:!0})],Rt.prototype,"hasSelection",null),a([l()],Rt.prototype,"showHighlight",void 0),a([l()],Rt.prototype,"sources",null),Rt=a([y("esri.views.SelectionManager")],Rt);var uh=e=>Wt(e)?e.parent?.isTable===!0:e.isTable,_f=e=>e.layer!==void 0,mh=e=>e?.when!==void 0,bf=(e,t)=>{if(e==null&&t==null)return!0;if(e!=null&&t==null||e==null&&t!=null)return!1;if(e!=null&&t!=null&&e.selection!=null&&t.selection!=null){let i=[...e.selection],s=[...t.selection];if(i.length!==s.length)return!1;i.sort(),s.sort();for(let o=0;o<i.length;o++)if(i[o]!==s[o])return!1}return!0},fh=(s,o,...r)=>v(void 0,[s,o,...r],function*(e,t,i={}){let n;if(_f(e)){let p=e;n=p===void 0?null:yield p.queryFeatures(new rn(he(A({},i),{objectIds:t}))).then(c=>({data:c,layer:e.layer}))}else{let p=e;n=p===void 0?null:yield p.queryFeatures(new rn(he(A({},i),{objectIds:t}))).then(c=>({data:c,layer:p}))}return n}),gh=Rt;var zs=class extends Mp(C){constructor(e){super(e),this.accentColor=new ye([255,127,0]),this.textColor=new ye([255,255,255])}};a([l({type:ye,nonNullable:!0})],zs.prototype,"accentColor",void 0),a([l({type:ye,nonNullable:!0})],zs.prototype,"textColor",void 0),zs=a([y("esri.views.Theme")],zs);var qo=zs;var ia;(function(e){e[e.Left=0]="Left",e[e.Middle=1]="Middle",e[e.Right=2]="Right"})(ia||(ia={}));var oa=["click","double-click","immediate-click","immediate-double-click","hold","drag","key-down","key-up","pointer-down","pointer-move","pointer-up","pointer-drag","mouse-wheel","pointer-enter","pointer-leave","gamepad","focus","blur"],yh={};function vh(e){return!!yh[e]}function Sf(e){for(let t of e)if(!vh(t))return!1;return!0}oa.forEach(e=>{yh[e]=!0});var jo=class{constructor(t){this._handlers=new Map,this._counter=0,this._handlerCounts=new Map,this.view=t,this.inputManager=null}connect(t){t&&this.disconnect(),this.inputManager=t,this._handlers.forEach(({handler:i,priority:s},o)=>this.inputManager?.installHandlers(o,[i],s))}disconnect(){this.inputManager&&this._handlers.forEach((t,i)=>this.inputManager?.uninstallHandlers(i)),this.inputManager=null}destroy(){this.disconnect(),this._handlers.clear(),this.view=null}on(t,i,s,o){let r=Array.isArray(t)?t:t.split(",");if(!Sf(r))return r.some(vh)&&console.error("Error: registering input events and other events on the view at the same time is not supported."),null;let n,p;Array.isArray(i)?p=i:(n=i,p=[]),typeof s=="function"?n=s:o=s,o=o??xt.DEFAULT;let c=this._createUniqueGroupName(),d=new sa(this.view,r,p,n);this._handlers.set(c,{handler:d,priority:o});for(let h of r){let m=this._handlerCounts.get(h)||0;this._handlerCounts.set(h,m+1)}return this.inputManager&&this.inputManager.installHandlers(c,[d],o),st(()=>this._removeHandler(c,r))}hasHandler(t){return!!this._handlerCounts.get(t)}_removeHandler(t,i){if(this._handlers.has(t)){this._handlers.delete(t);for(let s of i){let o=this._handlerCounts.get(s);o===void 0||(o===1?this._handlerCounts.delete(s):this._handlerCounts.set(s,o-1))}}this.inputManager&&this.inputManager.uninstallHandlers(t)}_createUniqueGroupName(){return this._counter+=1,`viewEvents_${this._counter}`}},sa=class extends B{constructor(t,i,s,o){super(!0),this._latestDragStart=void 0,this.view=t;for(let r of i)switch(r){case"click":this.registerIncoming("click",s,n=>o(Tf(t,n)));break;case"double-click":this.registerIncoming("double-click",s,n=>o(Lf(t,n)));break;case"immediate-click":this.registerIncoming("immediate-click",s,n=>o(Mf(t,n)));break;case"immediate-double-click":this.registerIncoming("immediate-double-click",s,n=>o(If(t,n)));break;case"hold":this.registerIncoming("hold",s,n=>o(Ef(t,n)));break;case"drag":this.registerIncoming("drag",s,n=>{let p=this._wrapDrag(n);p&&o(p)});break;case"key-down":this.registerIncoming("key-down",s,n=>o(Pf(n)));break;case"key-up":this.registerIncoming("key-up",s,n=>o(kf(n)));break;case"pointer-down":this.registerIncoming("pointer-down",s,n=>o(Fs(n,"pointer-down")));break;case"pointer-move":this.registerIncoming("pointer-move",s,n=>o(Fs(n,"pointer-move")));break;case"pointer-up":this.registerIncoming("pointer-up",s,n=>o(Fs(n,"pointer-up")));break;case"pointer-drag":this.registerIncoming("pointer-drag",s,n=>o(Rf(n)));break;case"mouse-wheel":this.registerIncoming("mouse-wheel",s,n=>o(Df(n)));break;case"pointer-enter":this.registerIncoming("pointer-enter",s,n=>o(Fs(n,"pointer-enter")));break;case"pointer-leave":this.registerIncoming("pointer-leave",s,n=>o(Fs(n,"pointer-leave")));break;case"gamepad":this.registerIncoming("gamepad",s,n=>{o(Vf(n))});break;case"focus":this.registerIncoming("focus",s,n=>{o(xf(n))});break;case"blur":this.registerIncoming("blur",s,n=>{o(Cf(n))})}}_wrapDrag(t){let i=t.data,{x:s,y:o}=i.center,{action:r,pointerType:n,button:p}=i;if(r==="start"&&(this._latestDragStart=i),!this._latestDragStart)return;let c=i.pointer.native,d=i.buttons,{cancelable:h,timestamp:m}=t,f={x:this._latestDragStart.center.x,y:this._latestDragStart.center.y};return r==="end"&&(this._latestDragStart=void 0),{type:"drag",action:r,x:s,y:o,origin:f,pointerType:n,button:p,buttons:d,radius:i.radius,angle:Hl(i.angle),native:c,timestamp:m,cancelable:h,stopPropagation:()=>t.stopPropagation(),async:w=>t.async(w),preventDefault:()=>t.preventDefault()}}};function xf(e){return{type:"focus",timestamp:e.timestamp,native:e.data.native,cancelable:e.cancelable,stopPropagation:()=>e.stopPropagation(),async:t=>e.async(t),preventDefault:()=>e.preventDefault()}}function Cf(e){return{type:"blur",timestamp:e.timestamp,native:e.data.native,cancelable:e.cancelable,stopPropagation:()=>e.stopPropagation(),async:t=>e.async(t),preventDefault:()=>e.preventDefault()}}function Tf(e,t){let{pointerType:i,button:s,buttons:o,x:r,y:n,native:p,eventId:c}=t.data,{cancelable:d,timestamp:h}=t;return{type:"click",pointerType:i,button:s,buttons:o,x:r,y:n,native:p,timestamp:h,screenPoint:X(r,n),mapPoint:Os(e,r,n),eventId:c,cancelable:d,stopPropagation:()=>t.stopPropagation(),async:m=>t.async(m),preventDefault:()=>t.preventDefault()}}function Lf(e,t){let{pointerType:i,button:s,buttons:o,x:r,y:n,native:p,eventId:c}=t.data,{cancelable:d,timestamp:h}=t;return{type:"double-click",pointerType:i,button:s,buttons:o,x:r,y:n,native:p,timestamp:h,mapPoint:Os(e,r,n),eventId:c,cancelable:d,stopPropagation:()=>t.stopPropagation(),async:m=>t.async(m),preventDefault:()=>t.preventDefault()}}function Mf(e,t){let{pointerType:i,button:s,buttons:o,x:r,y:n,native:p,eventId:c}=t.data,d=p.pointerId,{cancelable:h,timestamp:m}=t;return{type:"immediate-click",pointerId:d,pointerType:i,button:s,buttons:o,x:r,y:n,native:p,timestamp:m,mapPoint:Os(e,r,n),eventId:c,cancelable:h,stopPropagation:()=>t.stopPropagation(),async:f=>t.async(f),preventDefault:()=>t.preventDefault()}}function If(e,t){let{pointerType:i,button:s,buttons:o,x:r,y:n,native:p,eventId:c}=t.data,d=p.pointerId,{cancelable:h,timestamp:m}=t;return{type:"immediate-double-click",pointerId:d,pointerType:i,button:s,buttons:o,x:r,y:n,native:p,timestamp:m,mapPoint:Os(e,r,n),eventId:c,cancelable:h,stopPropagation:()=>t.stopPropagation(),async:f=>t.async(f),preventDefault:()=>t.preventDefault()}}function Ef(e,t){let{pointerType:i,button:s,buttons:o,x:r,y:n,native:p}=t.data,{cancelable:c,timestamp:d}=t;return{type:"hold",pointerType:i,button:s,buttons:o,x:r,y:n,native:p,timestamp:d,mapPoint:Os(e,r,n),cancelable:c,stopPropagation:()=>t.stopPropagation(),async:h=>t.async(h),preventDefault:()=>t.preventDefault()}}function Os(e,t,i){return e.toMap(X(t,i),{exclude:[]})}function Pf(e){let{key:t,repeat:i,native:s}=e.data,{cancelable:o,timestamp:r}=e;return{type:"key-down",key:t,repeat:i,native:s,timestamp:r,cancelable:o,stopPropagation:()=>e.stopPropagation(),async:n=>e.async(n),preventDefault:()=>e.preventDefault()}}function kf(e){let{key:t,native:i}=e.data,{cancelable:s,timestamp:o}=e;return{type:"key-up",key:t,native:i,timestamp:o,cancelable:s,stopPropagation:()=>e.stopPropagation(),async:r=>e.async(r),preventDefault:()=>e.preventDefault()}}function Fs(e,t){let{x:i,y:s,button:o,buttons:r,native:n,eventId:p}=e.data,c=n.pointerId,d=n.pointerType,{cancelable:h,timestamp:m}=e;return{type:t,x:i,y:s,pointerId:c,pointerType:d,button:o,buttons:r,native:n,timestamp:m,eventId:p,cancelable:h,stopPropagation:()=>e.stopPropagation(),async:f=>e.async(f),preventDefault:()=>e.preventDefault()}}function Rf(e){let{x:t,y:i,buttons:s,native:o,eventId:r}=e.data.currentEvent,{button:n}=e.data.startEvent,p=e.data.startEvent.native.pointerId,c=e.data.startEvent.native.pointerType,d=e.data.action,h={x:e.data.startEvent.x,y:e.data.startEvent.y},{cancelable:m,timestamp:f}=e;return{type:"pointer-drag",x:t,y:i,pointerId:p,pointerType:c,button:n,buttons:s,action:d,origin:h,native:o,timestamp:f,eventId:r,cancelable:m,stopPropagation:()=>e.stopPropagation(),async:w=>e.async(w),preventDefault:()=>e.preventDefault()}}function Df(e){let{cancelable:t,data:i,timestamp:s}=e,{x:o,y:r,deltaY:n,native:p}=i;return{type:"mouse-wheel",x:o,y:r,deltaY:n,native:p,timestamp:s,cancelable:t,stopPropagation:()=>e.stopPropagation(),async:c=>e.async(c),preventDefault:()=>e.preventDefault()}}function Vf(e){let{action:t,state:i,device:s}=e.data,{cancelable:o,timestamp:r}=e,{buttons:n,axes:p}=i;return{type:"gamepad",device:s,timestamp:r,action:t,buttons:n,axes:p,cancelable:o,stopPropagation:()=>e.stopPropagation(),async:c=>e.async(c),preventDefault:()=>e.preventDefault()}}var yi,wh,_h;(function(e){e[e.USER=0]="USER",e[e.MANAGER=1]="MANAGER"})(yi||(yi={})),function(e){e[e.None=0]="None",e[e.Unfocused=1]="Unfocused",e[e.Focused=2]="Focused",e[e.Unselected=4]="Unselected",e[e.Selected=8]="Selected",e[e.All=15]="All"}(wh||(wh={})),function(e){e[e.None=0]="None",e[e.Custom1=16]="Custom1",e[e.Custom2=32]="Custom2",e[e.Custom3=64]="Custom3",e[e.Custom4=128]="Custom4",e[e.Custom5=256]="Custom5",e[e.Custom6=512]="Custom6",e[e.Custom7=1024]="Custom7",e[e.Custom8=2048]="Custom8",e[e.Custom9=4096]="Custom9",e[e.Custom10=8192]="Custom10",e[e.Custom11=16384]="Custom11",e[e.Custom12=32768]="Custom12",e[e.All=65520]="All"}(_h||(_h={}));function bh(e){return[e.on("before-add",t=>{let i=t.item;if(i==null||e.includes(i))return P.getLogger("esri.views.interactive.interactiveToolUtils").warn("Tool is either already in the list of tools or tool is `null`. Not adding tool."),void t.preventDefault();i.onAdd()}),e.on("after-remove",t=>{let i=t.item;i.active&&(i.view.activeTool=null),i.destroy()})]}function Ns(e){return e.visible&&e.getEditableFlag!=null&&e.getEditableFlag(yi.USER)&&e.getEditableFlag(yi.MANAGER)}function Je(e){return X(e.x,e.y)}function ra(e,t){let i=(e instanceof HTMLElement?e:e.surface)?.getBoundingClientRect();return i?X(t.clientX-i.left,t.clientY-i.top):X(0,0)}function Ko(e,t){return t instanceof Event?ra(e,t):Je(t)}function Yo(e){if(e instanceof Event)return!0;if(typeof e=="object"&&"type"in e)switch(e.type){case"click":case"double-click":case"pointer-down":case"pointer-drag":case"pointer-enter":case"pointer-leave":case"pointer-up":case"pointer-move":case"immediate-click":case"immediate-double-click":case"hold":case"drag":case"mouse-wheel":return!0;default:return!1}return!1}var Qo=class{constructor(){this._pointerLocations=new Map,this._hoveredManipulators=new Map,this._grabbedManipulators=new Map,this._draggedManipulators=new Map,this._stopDrag=!1,this._revertToNullActiveTool=!1,this._cursor=null}get cursor(){return this._cursor}hasFocusedManipulators(){return this._grabbedManipulators.size>0||this._draggedManipulators.size>0}handleInputEvent(t,i){let s=()=>t.stopPropagation();switch(t.type){case"pointer-move":xh(t.pointerType)&&this._pointerLocations.set(t.pointerId,{x:t.x,y:t.y,pointerType:t.pointerType});break;case"drag":this._grabbedManipulators.size>0&&(this._stopDrag=!0),this._stopDrag&&(s(),t.action==="end"&&(this._stopDrag=!1));break;case"pointer-down":{if(!Ch(t))break;let o=Je(t),r=Ji(o,t.pointerType,i.forEachTool);if(r==null)break;let n=r.manipulator,p=r.tool;n==null||p==null||!n.interactive||n.grabbable&&n.grabbableForEvent(t)||!n.grabbing||n.dragging||this._releaseManipulatorBeforeDragging(n,t,i),n!=null&&p!=null&&n.interactive&&n.grabbable&&n.grabbableForEvent(t)&&!n.grabbing&&(this._grabbedManipulators.set(t.pointerId,{manipulator:n,tool:p,start:o,pointerType:t.pointerType}),this._grabbedManipulators.size===1&&i.activeTool==null&&(this._revertToNullActiveTool=!0,i.setActiveTool(r.tool)),n.grabbing=!0,n.events.emit("grab-changed",{action:"start",pointerType:t.pointerType,screenPoint:o}),s());break}case"pointer-up":this._draggedManipulators.has(t.pointerId)||this._handlePointerEnd(t,i);break;case"pointer-drag":{if(!Ch(t))break;let o=this._grabbedManipulators.get(t.pointerId),r=o?.manipulator,n=o?.tool;if(r==null||n==null)break;let p=Je(t);p.x=tn(p.x,0,i.view.width),p.y=tn(p.y,0,i.view.height);let c=o.start,d=this._draggedManipulators.get(t.pointerId);switch(t.action){case"start":case"update":t.action!=="update"&&this._grabbedManipulators.size!==1||(r.dragging=!0,d?r.events.emit("drag",{action:"update",start:c,screenPoint:p}):r.events.emit("drag",{action:"start",start:c,screenPoint:p,pointerType:t.pointerType}),this._draggedManipulators.set(t.pointerId,{tool:n,manipulator:r,start:c}));break;case"end":r.dragging=!1,d&&r.events.emit("drag",{action:"end",start:c,screenPoint:p}),this._draggedManipulators.delete(t.pointerId),this._handlePointerEnd(t,i)}s();break}case"immediate-click":{let o=Je(t),r=Ji(o,t.pointerType,i.forEachTool);if(Af(t)||i.forEachTool(d=>{if((r==null||r.tool!==d||d.automaticManipulatorSelection)&&d.manipulators){let h=!1;d.manipulators.forEach(({manipulator:m})=>{m.selected&&(m.selected=!1,h=!0)}),h&&d.onManipulatorSelectionChanged&&d.onManipulatorSelectionChanged()}}),r==null)break;let{manipulator:n,tool:p}=r;if(!n.interactive)break;n.selectable&&p.automaticManipulatorSelection&&(n.selected=!n.selected,p.onManipulatorSelectionChanged&&p.onManipulatorSelectionChanged());let c=t.native.shiftKey;n.events.emit("immediate-click",{screenPoint:o,button:t.button,pointerType:t.pointerType,shiftKey:c,stopPropagation:s}),na(n,s);break}case"click":{let o=Je(t),r=Ji(o,t.pointerType,i.forEachTool),n=r?.manipulator;if(n==null||!n.interactive)break;let p=t.native.shiftKey;n.events.emit(t.type,{screenPoint:o,button:t.button,pointerType:t.pointerType,shiftKey:p}),s();break}case"double-click":{let o=Je(t),r=Ji(o,t.pointerType,i.forEachTool),n=r!=null?r.manipulator:null;if(n==null||!n.interactive)break;let p=t.native.shiftKey;n.events.emit("double-click",{screenPoint:o,button:t.button,pointerType:t.pointerType,shiftKey:p,stopPropagation:s}),na(n,s);break}case"immediate-double-click":{let o=Je(t),r=Ji(o,t.pointerType,i.forEachTool),n=r!=null?r.manipulator:null;if(n==null||!n.interactive)break;let p=t.native.shiftKey;n.events.emit("immediate-double-click",{screenPoint:o,button:t.button,pointerType:t.pointerType,shiftKey:p,stopPropagation:s}),na(n,s);break}}this._onFocusChange(i.forEachTool)}_releaseManipulatorBeforeDragging(t,i,s){t.grabbing=!1,t.events.emit("grab-changed",{action:"end",pointerType:i.pointerType,screenPoint:Je(i)}),this._grabbedManipulators.forEach(({manipulator:o},r)=>{o===t&&this._grabbedManipulators.delete(r)}),this._afterManipulatorRelease(s.setActiveTool)}_handlePointerEnd(t,i){let s=this._grabbedManipulators.get(t.pointerId)?.manipulator;s!=null&&s.grabbing&&(s.grabbing=!1,s.events.emit("grab-changed",{action:"end",pointerType:t.pointerType,screenPoint:Je(t)}),this._grabbedManipulators.delete(t.pointerId),this._afterManipulatorRelease(i.setActiveTool))}_onFocusChange(t){this._updateCursor(),this._updateFocusedManipulatorTools(t)}_updateCursor(){this._grabbedManipulators.size>0?this._cursor=Sh(this._grabbedManipulators)||"grabbing":this._hoveredManipulators.size>0?this._cursor=Sh(this._hoveredManipulators)||"pointer":this._cursor=null}_updateFocusedManipulatorTools(t){let i=new Set,s=new Set;this._grabbedManipulators.forEach(({tool:o})=>{i.add(o)}),this._hoveredManipulators.forEach(({tool:o})=>{s.add(o)}),t(o=>{o.hasGrabbedManipulators=i.has(o),o.hasHoveredManipulators=s.has(o);let r=this._grabbedManipulators.values(),n=Xa(r,({tool:p})=>p===o);o.firstGrabbedManipulator=n!=null?n.manipulator:null})}clearPointers(t,{forEachTool:i,setActiveTool:s},o=!0,r){let n=(p,c)=>p===t&&(r==null||r===c);this._grabbedManipulators.forEach(({tool:p,manipulator:c,pointerType:d},h)=>{n(p,c)&&(this._grabbedManipulators.delete(h),c.grabbing=!1,c.events.emit("grab-changed",{action:"end",screenPoint:null,pointerType:d}))}),this._draggedManipulators.forEach(({tool:p,manipulator:c},d)=>{n(p,c)&&(this._draggedManipulators.delete(d),c.dragging=!1,c.events.emit("drag",{action:"cancel"}))}),o&&this._hoveredManipulators.forEach(({tool:p,manipulator:c},d)=>{n(p,c)&&(this._hoveredManipulators.delete(d),c.hovering=!1)}),this._afterManipulatorRelease(s),this._onFocusChange(i)}updateHoveredStateFromKnownPointers(t){this._pointerLocations.forEach((i,s)=>{this._updateHoveredStateForPointerAtScreenPosition(X(i.x,i.y),s,i.pointerType,t)})}handleHoverEvent(t,i){t.type!=="pointer-up"&&t.type!=="immediate-click"&&t.type!=="pointer-move"||!xh(t.pointerType)||this._updateHoveredStateForPointerAtScreenPosition(Je(t),t.pointerId,t.pointerType,i)}_updateHoveredStateForPointerAtScreenPosition(t,i,s,o){let r=Ji(t,s,o),n=this._hoveredManipulators.get(i)?.manipulator;r==null||r.manipulator.interactive||(r=null),r!=null&&n===r.manipulator||(n!=null&&(n.hovering=!1),r!=null?(r.manipulator.hovering=!0,this._hoveredManipulators.set(i,r)):this._hoveredManipulators.delete(i),this._onFocusChange(o))}_afterManipulatorRelease(t){this._grabbedManipulators.size===0&&this._revertToNullActiveTool&&(t(null),this._revertToNullActiveTool=!1)}};function Sh(e){let t=null;return Ht(e,({manipulator:i})=>!(i==null||!i.interactive)&&(i.grabbing&&i.grabCursor?(t=i.grabCursor,!0):!!i.cursor&&(t=i.cursor,!0))),t}function Ji(e,t,i){let s=null;return i(o=>{if(o.manipulators==null||!Ns(o))return!1;let r=o.manipulators.intersect(e,t);return r!=null&&(s={tool:o,manipulator:r},!0)}),s}function xh(e){return e==="mouse"}function Ch(e){return e.pointerType!=="mouse"||e.button===0}function Af(e){return!!e.native.shiftKey}function na(e,t){e?.consumesClicks&&t()}var Th="attached",aa="tools",zf=1e3,et=class extends C{constructor(e){super(e),this._updatingHandles=new Ut,this._clock=ot,this._manipulatorState=new Qo,this.tools=new D,this.cursor=null,this._interacting=!1,this._interactingTimeout=zf,this._interactingTimeoutHandle=null,this._forEachTool=t=>{for(let i of this.tools.items)if(t(i))return}}initialize(){this.addHandles([this.view.on(oa,e=>{this._handleInputEvent(e)},xt.TOOL),...bh(this.tools),this.tools.on("before-add",({item:e})=>{this._updateToolEditableFlag(e)}),this.tools.on("before-remove",({item:e})=>{this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs),this._updateCursor()}),this.tools.on("change",()=>{this._refreshToolWatchers()})])}destroy(){this.activeTool=null,this.tools.drain(e=>e.destroy()),this._clearInteractingTimeout(),this._interacting=!1,this._updatingHandles.destroy()}get _manipulatorStateEventArgs(){return{forEachTool:this._forEachTool,activeTool:this.activeTool,setActiveTool:e=>{this.activeTool=e},view:this.view}}set activeTool(e){if(e!=null&&!this.view.ready)return void P.getLogger(this).error("Cannot set active tool while view is not ready.");if(e===this.activeTool)return;let t=this.activeTool;this._set("activeTool",e),t?.deactivate(),e?.activate(),this._removeIncompleteTools(e);for(let i of this.tools){this._updateToolEditableFlag(i);let s=Ns(i);this.activeTool!=null&&s||this._manipulatorState.clearPointers(i,this._manipulatorStateEventArgs,!s)}this._updateCursor()}get updating(){return this._updatingHandles.updating||this.tools.some(e=>e.updating)}get interacting(){return this._interacting}_clearInteractingTimeout(){this._interactingTimeoutHandle=ue(this._interactingTimeoutHandle)}_startInteractingTimeout(){this._clearInteractingTimeout(),this._interactingTimeoutHandle=this._clock.setTimeout(()=>this._interacting=!1,this._interactingTimeout)}attach(){this.view.type==="3d"?this.addHandles([_(()=>{let{state:e}=this.view;return"camera"in e&&e.camera},()=>this._forEachManipulator(e=>e.onViewChange())),this.view.elevationProvider?.on("elevation-change",e=>this._forEachManipulator(t=>t.onElevationChange(e)))],Th):this.addHandles(_(()=>this.view.extent,()=>this._forEachManipulator(e=>e.onViewChange())))}detach(){this.activeTool=null,this.tools.removeAll(),this.removeHandles(Th),this._clearInteractingTimeout(),this._interacting=!1}_forEachManipulator(e){this._forEachTool(t=>{t.manipulators&&t.manipulators.forEach(({manipulator:i})=>e(i,t))})}_handleInputEvent(e){let t=!1,i=he(A({},e),{stopPropagation:()=>{t=!0,e.stopPropagation()}});this.activeTool!=null?this.activeTool.handleInputEvent&&this.activeTool.handleInputEvent(i):this._forEachTool(s=>{!t&&s.visible&&s.handleInputEvent(i)}),!t&&e.type==="key-down"&&e.key==="Escape"&&this.activeTool&&(e.stopPropagation(),this.activeTool=null),this._manipulatorState.handleInputEvent(i,this._manipulatorStateEventArgs),t||this.activeTool==null||this.activeTool.handleInputEventAfter(i),this._manipulatorState.handleHoverEvent(i,this._forEachTool),this._updateCursor(),e.type==="pointer-move"&&(this._manipulatorState.hasFocusedManipulators()||this.activeTool)&&(this._interacting=!0,this._startInteractingTimeout())}_refreshToolWatchers(){this.removeHandles(aa),this._forEachTool(e=>{if(e instanceof C){let t=_(()=>[e.cursor,e.visible,e.editable],()=>{Ns(e)||this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs),this._updateCursor()});this.addHandles(t,aa)}e.manipulators&&this.addHandles([e.manipulators.on("after-remove",t=>{this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs,!0,t.item.manipulator)}),e.manipulators.on("change",()=>{this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()})],aa)}),this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()}_updateToolEditableFlag(e){e.setEditableFlag?.(yi.MANAGER,this.activeTool==null||e===this.activeTool)}_updateCursor(){let e=this._manipulatorState.cursor;e==null&&this._forEachTool(t=>!(t.cursor==null||!t.visible)&&(e=t.cursor,!0)),this._get("cursor")!==e&&this._set("cursor",e)}_removeIncompleteTools(e){this.tools.filter(t=>(e==null||t!==e)&&!t.created&&t.removeIncompleteOnCancel).forEach(t=>{this.tools.remove(t)})}get test(){}};a([l({constructOnly:!0,nonNullable:!0})],et.prototype,"view",void 0),a([l({value:null})],et.prototype,"activeTool",null),a([l({readOnly:!0,type:D})],et.prototype,"tools",void 0),a([l({readOnly:!0})],et.prototype,"cursor",void 0),a([l({readOnly:!0})],et.prototype,"updating",null),a([l()],et.prototype,"_interacting",void 0),a([l({readOnly:!0})],et.prototype,"interacting",null),et=a([y("esri.views.ToolViewManager")],et);var es=class extends C{constructor(e){super(),this.nativeIndex=null,this._detectedDeviceType="unknown",e.mapping==="standard"?this._detectedDeviceType="standard":Ff.test(e.id)?this._detectedDeviceType="spacemouse":this._detectedDeviceType="unknown",this.nativeIndex=e.index}get native(){let e=navigator.getGamepads?navigator.getGamepads():[];return this.nativeIndex!=null&&this.nativeIndex<e.length?e[this.nativeIndex]:null}get deviceType(){return this._detectedDeviceType}get axisThreshold(){return Of[this.deviceType]}};a([l({nonNullable:!0,readOnly:!0})],es.prototype,"nativeIndex",void 0),a([l({type:String,readOnly:!0})],es.prototype,"deviceType",null),a([l({type:Number,readOnly:!0})],es.prototype,"axisThreshold",null),es=a([y("esri.views.input.gamepad.GamepadInputDevice")],es);var ts=es,Ff=new RegExp("^(3dconnexion|space(mouse|navigator|pilot|explorer))","i"),Of={standard:.15,spacemouse:.025,unknown:0};var $s=class extends C{constructor(...e){super(...e),this.devices=new D,this.enabledFocusMode="document"}};a([l({type:D.ofType(ts),readOnly:!0})],$s.prototype,"devices",void 0),a([l({type:["document","view","none"]})],$s.prototype,"enabledFocusMode",void 0),$s=a([y("esri.views.input.gamepad.GamepadSettings")],$s);var Lh=$s;var Xo=class extends C{constructor(){super(...arguments),this.gamepad=new Lh}};a([l({readOnly:!0})],Xo.prototype,"gamepad",void 0),Xo=a([y("esri.views.input.Input")],Xo);var Mh=Xo;var Jt=class extends C{constructor(e){super(e),this.enabled=!0,this.device=null,this.mode="pan",this.tiltDirection="forward-down",this.velocityFactor=1}};a([l({type:Boolean,nonNullable:!0})],Jt.prototype,"enabled",void 0),a([l({type:ts})],Jt.prototype,"device",void 0),a([l({type:["pan","zoom"],nonNullable:!0})],Jt.prototype,"mode",void 0),a([l({type:["forward-down","forward-up"],nonNullable:!0})],Jt.prototype,"tiltDirection",void 0),a([l({type:Number,nonNullable:!0})],Jt.prototype,"velocityFactor",void 0),Jt=a([y("esri.views.navigation.gamepad.GamepadSettings")],Jt);var la=Jt;var vi=class extends C{constructor(e){super(e),this.browserTouchPanEnabled=!0,this.gamepad=new la,this.momentumEnabled=!0,this.mouseWheelZoomEnabled=!0}get effectiveMomentumEnabled(){return this.momentumEnabled&&!xo()}};a([l({type:Boolean})],vi.prototype,"browserTouchPanEnabled",void 0),a([l({type:la,nonNullable:!0})],vi.prototype,"gamepad",void 0),a([l({type:Boolean})],vi.prototype,"momentumEnabled",void 0),a([l({type:Boolean})],vi.prototype,"mouseWheelZoomEnabled",void 0),vi=a([y("esri.views.navigation.Navigation")],vi);var pa=vi;var Ih;function Eh(e){if(e.type==="integrated-mesh-3dtiles")return null;let t=e.url?Jl(e.url):void 0;return!(e.spatialReference?.vcsWkid==null&&t!=null&&t.serverType==="ImageServer")&&Ph(e)&&e.heightModelInfo?e.heightModelInfo:Nf(e)?Cs.deriveUnitFromSR($f,e.spatialReference):null}function Ph(e){return"heightModelInfo"in e}function kh(e){if(e.type==="unknown"||!("capabilities"in e))return!1;switch(e.type){case"catalog":case"catalog-footprint":case"csv":case"feature":case"geojson":case"subtype-group":case"ogc-feature":case"oriented-imagery":case"wfs":case"knowledge-graph-sublayer":return!0;default:return!1}}function Nf(e){return kh(e)?!!(e.capabilities&&e.capabilities.data&&e.capabilities.data.supportsZ):Dh(e)}function Rh(e){return e.layers!=null||Dh(e)||kh(e)||Ph(e)}function Dh(e){switch(e.type){case"building-scene":case"elevation":case"integrated-mesh":case"integrated-mesh-3dtiles":case"point-cloud":case"scene":case"voxel":return!0;case"base-dynamic":case"base-elevation":case"base-tile":case"bing-maps":case"catalog":case"catalog-footprint":case"catalog-dynamic-group":case"csv":case"dimension":case"geojson":case"feature":case"subtype-group":case"geo-rss":case"graphics":case"group":case"imagery":case"imagery-tile":case"kml":case"knowledge-graph":case"link-chart":case"knowledge-graph-sublayer":case"line-of-sight":case"map-image":case"map-notes":case"media":case"ogc-feature":case"open-street-map":case"oriented-imagery":case"route":case"stream":case"tile":case"unknown":case"unsupported":case"vector-tile":case"video":case"wcs":case"web-tile":case"wfs":case"wms":case"wmts":case null:return!1}return!1}(function(e){e[e.Ok=0]="Ok",e[e.Units=1]="Units",e[e.HeightModel=2]="HeightModel",e[e.CRS=3]="CRS",e[e.Unsupported=4]="Unsupported"})(Ih||(Ih={}));var $f=new Cs({heightModel:"gravity-related-height"});var da,ca=null;function Hf(e){return v(this,null,function*(){ca||(ca=import("./chunk-WBKF4ERP.js").then(t=>da=t)),yield ca,ae(e)})}function ha(e,t,i,s){return v(this,null,function*(){if(!e)return null;let o=e.spatialReference;return Ai()||fo(o,t)?pt(e,t):da?da.projectGeometry(e,t,i,s):(yield Promise.race([Hf(s),zi(s)]),ha(e,t,i,s))})}var j=class extends C{constructor(e){super(e),this.required={tileInfo:!1,heightModelInfo:!1,extent:!1},this.defaultSpatialReference=null,this.userSpatialReference=null,this.sourcePreloadCount=10,this.priorityCollection=null,this.requiresExtentInSpatialReference=!0,this.suspended=!1,this._projectExtentTask={task:null,input:null,output:null,spatialReference:null}}destroy(){this._projectExtentTask.task&&(this._projectExtentTask.task=_s(this._projectExtentTask.task)),this._set("map",null)}get ready(){return!this._spatialReferenceTask.updating&&!this._tileInfoTask.updating&&!this._extentTask.updating}get heightModelInfoReady(){return!this._heightModelInfoTask.updating}get spatialReference(){return this.userSpatialReference??this._spatialReferenceTask.spatialReference}get extent(){return this._extentTask.extent}get heightModelInfo(){return this._heightModelInfoTask.heightModelInfo}get vcsWkid(){return this._heightModelInfoTask.vcsWkid}get latestVcsWkid(){return this._heightModelInfoTask.latestVcsWkid}get viewingMode(){return this.userSpatialReference==null||this.userSpatialReference.equals(this._spatialReferenceTask.spatialReference)?this._spatialReferenceTask.viewingMode:null}get tileInfo(){return this._tileInfoTask.tileInfo}get mapCollections(){let e=this.map?.(),t=[];return this.priorityCollection!=null&&t.push(this.priorityCollection),t.push({parent:e?.basemap,layers:e?.basemap?.baseLayers},{layers:e?.layers},{parent:e?.ground,layers:e?.ground?.layers},{parent:e?.basemap,layers:e?.basemap?.referenceLayers}),t}get _allLayers(){return this._collectLayers(this.mapCollections)}get _spatialReferenceTask(){if(this.suspended)return this._get("_spatialReferenceTask")??{updating:!1};let{layers:e,updating:t}=this._allLayers,i=null;for(let o of e){let r=this._getSupportedSpatialReferences(o);if(r.length>0){let n=this._narrowDownSpatialReferenceCandidates(i,r);n!=null&&(i=n)}if(i!=null&&i.length===1)break}if(t&&(i==null||i.length!==1))return{updating:!0};let s=this._pickSpatialReferenceCandidate(i);return{spatialReference:s?.spatialReference??null,viewingMode:s?.viewingMode??null,updating:!1}}get _tileInfoTask(){if(!this.required.tileInfo)return this._get("_tileInfoTask")??{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};let{layers:e,updating:t}=this._collectLayers([{parent:this.map?.()?.basemap,layers:this.map?.()?.basemap?.baseLayers},{layers:this.map?.()?.layers}]);if(e&&e.length>0&&"tileInfo"in e[0]){let i=e[0].tileInfo;return{tileInfo:i?.spatialReference.equals(this.spatialReference)?i:null,updating:!1}}return{updating:t}}get _heightModelInfoTask(){if(!this.required.heightModelInfo||this.suspended&&this._get("_heightModelInfoTask")?.heightModelInfo)return this._get("_heightModelInfoTask")??{updating:!1};let{layers:e,updating:t}=this._allLayers;for(let i of e)if(Rh(i)){let s=Eh(i);if(s)return{heightModelInfo:s,vcsWkid:i.spatialReference?.vcsWkid,latestVcsWkid:i.spatialReference?.latestVcsWkid,updating:!1}}return{updating:t}}get _extentCandidatesTask(){if(this.suspended||!this.required.extent)return this._get("_extentCandidatesTask")??{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};let e=this._allLayers,t=e.updating,i=[];for(let s of e.layers){let o="fullExtents"in s&&s.fullExtents||(s.fullExtent!=null?[s.fullExtent]:[]),r=this.requiresExtentInSpatialReference?null:o[0],n=o.find(p=>p.spatialReference.equals(this.spatialReference))??r;if(n)return{candidates:[{extent:n,layer:s}],updating:!1};if(this._getSupportedSpatialReferences(s).length>0)for(let p of o)i.push({extent:p,layer:s})}return{candidates:i,updating:t}}get _extentTask(){let{candidates:e,updating:t}=this._extentCandidatesTask;if(t)return{updating:t};if(e==null||e.length===0)return{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};let i=this._pickExtentCandidate(e),s=this.spatialReference;return i.extent.equals(this._projectExtentTask.input)&&s.equals(this._projectExtentTask.spatialReference)?{extent:this._projectExtentTask.output,updating:this._projectExtentTask.task!=null&&!this._projectExtentTask.task.finished}:(this._projectExtentTask.task!=null&&(this._projectExtentTask.task=_s(this._projectExtentTask.task)),this._projectExtentTask={input:i.extent.clone(),output:null,spatialReference:s.clone(),task:ki(o=>v(this,null,function*(){try{let r=yield ha(i.extent,s,"portalItem"in i.layer?i.layer.portalItem:void 0,o);this._projectExtentTask=he(A({},this._projectExtentTask),{task:null,output:r})}catch{if(tl(o))return;this._projectExtentTask=he(A({},this._projectExtentTask),{task:null})}}))},{updating:!0})}_narrowDownSpatialReferenceCandidates(e,t){if(e==null)return t;let i=new Array;for(let s of e)for(let o of t){if(!s.spatialReference.equals(o.spatialReference))continue;let r=Bf(s.viewingMode,o.viewingMode);if(r!==!1){i.push({spatialReference:s.spatialReference,viewingMode:r});break}}return i.length>0?i:null}_pickSpatialReferenceCandidate(e){let t=this.defaultSpatialReference;return e==null||e.length<1?t?{spatialReference:t,viewingMode:null}:null:(t!=null&&e.length>1&&e.some(({spatialReference:i})=>i.equals(t))&&(e=e.filter(({spatialReference:i})=>i.equals(t))),e.length>1&&e.some(({viewingMode:i})=>i!==ct.Local)&&(e=e.filter(({viewingMode:i})=>i!==ct.Local)),e[0])}_getSupportedSpatialReferences(e){let t="supportedSpatialReferences"in e&&e.supportedSpatialReferences||(e.spatialReference?[e.spatialReference]:[]);if(t.length===0)return[];let i=[];for(let s of t){let o=this.getSpatialReferenceSupport(s,e);if(o!=null){let r=o.constraints??[{spatialReference:s,viewingMode:null}];for(let{spatialReference:n,viewingMode:p}of r)this.requiresExtentInSpatialReference&&this.userSpatialReference!=null&&!n.equals(this.userSpatialReference)||i.push({spatialReference:n,viewingMode:p})}}return i}_pickExtentCandidate(e){let t=this.spatialReference;return e.find(({extent:i})=>t.equals(i.spatialReference))||e[0]}_collectLayers(e){if(this._loadMaybe(this.map?.())!=="loaded")return{layers:[],updating:!0};let t=new ua;for(let i of e)if(this._collectCollection(i,t),t.preloading===this.sourcePreloadCount)break;return{layers:t.layers,updating:t.updating}}_collectCollection(e,t){if(e.layers){switch(this._loadMaybe(e.parent)){case"loading":return t.updating=!0,void++t.preloading;case"failed":return}for(let i of e.layers){switch(this._loadMaybe(i)){case"failed":continue;case"loading":t.updating=!0,++t.preloading;break;case"loaded":t.updating||t.layers.push(i),"layers"in i&&this._collectCollection({layers:i.layers},t)}if(t.preloading===this.sourcePreloadCount)break}}}_loadMaybe(e){return e&&"loadStatus"in e&&e.loadStatus!=null?e.loadStatus==="not-loaded"?(e.load().catch(t=>{rt(t)||console.log(t)}),"loading"):e.loadStatus:"loaded"}};a([l()],j.prototype,"required",void 0),a([l({constructOnly:!0})],j.prototype,"map",void 0),a([l({constructOnly:!0})],j.prototype,"getSpatialReferenceSupport",void 0),a([l()],j.prototype,"defaultSpatialReference",void 0),a([l()],j.prototype,"userSpatialReference",void 0),a([l()],j.prototype,"sourcePreloadCount",void 0),a([l()],j.prototype,"priorityCollection",void 0),a([l()],j.prototype,"requiresExtentInSpatialReference",void 0),a([l()],j.prototype,"suspended",void 0),a([l({readOnly:!0})],j.prototype,"ready",null),a([l({readOnly:!0})],j.prototype,"heightModelInfoReady",null),a([l({readOnly:!0})],j.prototype,"spatialReference",null),a([l({readOnly:!0})],j.prototype,"extent",null),a([l({readOnly:!0})],j.prototype,"heightModelInfo",null),a([l({readOnly:!0})],j.prototype,"vcsWkid",null),a([l({readOnly:!0})],j.prototype,"latestVcsWkid",null),a([l({readOnly:!0})],j.prototype,"viewingMode",null),a([l({readOnly:!0})],j.prototype,"tileInfo",null),a([l({readOnly:!0})],j.prototype,"mapCollections",null),a([l({readOnly:!0})],j.prototype,"_allLayers",null),a([l({readOnly:!0})],j.prototype,"_spatialReferenceTask",null),a([l({readOnly:!0})],j.prototype,"_tileInfoTask",null),a([l({readOnly:!0})],j.prototype,"_heightModelInfoTask",null),a([l({readOnly:!0})],j.prototype,"_extentCandidatesTask",null),a([l()],j.prototype,"_extentTask",null),a([l()],j.prototype,"_projectExtentTask",void 0),j=a([y("esri.views.support.DefaultsFromMap")],j);var ua=class{constructor(){this.layers=new Array,this.preloading=-1,this.updating=!1}};function Bf(e,t){return e!=null?t!=null?e===t&&e:e:t}var Hs,E=Hs=class extends Le.EventedMixin(no(C)){constructor(e){super(e),this._userSpatialReference=null,this._cursor=null,this.handles=new Js,this.updatingHandles=new Ut,this.allLayerViews=new di({getCollections:()=>[this.basemapView?.baseLayerViews,this.groundView?.layerViews,this.layerViews,this.basemapView?.referenceLayerViews],getChildrenFunction:Wf}),this.groundView=null,this.basemapView=null,this.fatalError=null,this.graphics=new un,this.analyses=new Vs,this.typeSpecificPreconditionsReady=!0,this.layerViews=new D,this.magnifier=new ta,this.padding={left:0,top:0,right:0,bottom:0},this.ready=!1,this.spatialReferenceWarningDelay=1e3,this.supportsGround=!0,this.timeExtent=null,this.type=null,this.scale=null,this.updating=!1,this.initialExtentRequired=!0,this.input=new Mh,this.navigation=new pa,this.layerViewManager=null,this.analysisViewManager=null,this.isHeightModelInfoRequired=!1,this.width=null,this.height=null,this.resizing=!1,this.suspended=!1,this.viewEvents=new jo(this),this.persistableViewModels=new D,this._isValid=!1,this._readyCycleForced=!1,this._lockedSpatialReference=null,this._userTimeZone=null,this._lockedTimeZone=null,this.theme=null,this.handles.add(_(()=>this.preconditionsReady,t=>{let i=this.ready;if(t?(this._lockedSpatialReference=this.spatialReference,this._lockedTimeZone=this.timeZone,Hs.views.add(this)):(this._lockedSpatialReference=null,Hs.views.remove(this)),this.notifyChange("spatialReference"),!t&&i)this.toolViewManager?.detach(),this.analysisViewManager!=null&&this.analysisViewManager.detach(),this.layerViewManager?.clear(),this._teardown();else if(t&&!i){try{this._startup()}catch(s){return void queueMicrotask(()=>{this.fatalError=new x("startup-error",null,s)})}this.analysisViewManager!=null&&this.analysisViewManager.attach(),this.toolViewManager.attach()}},wt))}initialize(){this.addResolvingPromise(Promise.all([this.loadAsyncDependencies(),this.validate()]).then(()=>(this._isValid=!0,nt(()=>this.ready)))),this.basemapView=new kt({view:this}),this.layerViewManager=new hh({view:this,layerViewImporter:{importLayerView:e=>this.importLayerView(e),hasLayerViewModule:e=>this.hasLayerViewModule(e)},supportsGround:this.supportsGround}),this.toolViewManager=new et({view:this}),this._setupSpatialReferenceLogger(),this.selectionManager=new gh({view:this}),this.addHandles([_(()=>this.initialExtentRequired,e=>this.defaultsFromMap.required=he(A({},this.defaultsFromMap.required),{extent:e}),Me),_(()=>this.ready,e=>{this.defaultsFromMap&&(this.defaultsFromMap.suspended=e,this.defaultsFromMap.userSpatialReference=e?this.spatialReference:this._userSpatialReference)},wt),_(()=>this._userSpatialReference,e=>{this.defaultsFromMap&&(this.defaultsFromMap.userSpatialReference=e)},Me)])}_setupSpatialReferenceLogger(){let e=null;this.addHandles([_(()=>this.defaultsFromMap?.ready,t=>{let i=this.map?.allLayers.length>0;if(t&&!this.spatialReference&&i){if(e!=null)return;let s=st(()=>e=_s(e));e=ki(o=>v(this,null,function*(){try{yield ol(this.spatialReferenceWarningDelay,null,o)}catch{return}finally{e=null}P.getLogger(this).warn("#spatialReference","no spatial reference could be derived from the currently added map layers")})),this.addHandles(s,"spatial-reference-logger-task")}else this.removeHandles("spatial-reference-logger-task")},{sync:!0})])}destroy(){this.destroyed||(Hs.views.remove(this),this.viewEvents.destroy(),this.allLayerViews.destroy(),this.navigation&&(this.navigation.destroy(),this._set("navigation",null)),this.graphics=oe(this.graphics),this.analyses=oe(this.analyses),this.defaultsFromMap.destroy(),this._set("defaultsFromMap",null),oe(this.analysisViewManager),this.toolViewManager=oe(this.toolViewManager),this.layerViewManager=oe(this.layerViewManager),this.selectionManager=oe(this.selectionManager),this.basemapView=oe(this.basemapView),this.groundView?.destroy(),this.layerViews?.forEach(e=>e.destroy()),this.layerViews.length=0,this.invalidate(),this._emitter.clear(),this.handles.destroy(),this.map=oe(this.map),this.updatingHandles.destroy())}_startup(){this._set("ready",!0)}_teardown(){this._set("ready",!1)}whenReady(){return Promise.resolve(this)}toMap(){return P.getLogger(this).error("#toMap()","Not implemented on this instance of View"),null}get activeTool(){return this.toolViewManager?.activeTool}set activeTool(e){this.toolViewManager&&(this.toolViewManager.activeTool=e)}get animation(){return this._get("animation")}set animation(e){this._set("animation",e)}get center(){return null}get _defaultsFromMapSettings(){return{}}get defaultsFromMap(){return new j(A({required:{tileInfo:!1,heightModelInfo:!1,extent:!1},map:()=>this.map,getSpatialReferenceSupport:(e,t)=>this.getSpatialReferenceSupport(e,t)},this._defaultsFromMapSettings))}get extent(){return this._get("extent")}set extent(e){this._set("extent",e)}get heightModelInfo(){return this.getDefaultHeightModelInfo()}get interacting(){return this.navigating}get navigating(){return!1}get preconditionsReady(){return!(this.fatalError||!this._isValid||this._readyCycleForced||!this.map||at.isLoadable(this.map)&&!this.map.loaded||this.width===0||this.height===0||!this.spatialReference||!this._validateSpatialReference(this.spatialReference)||!this._lockedSpatialReference&&!this.defaultsFromMap?.ready||!this.typeSpecificPreconditionsReady)}get resolution(){return 0}set map(e){e!==this._get("map")&&(e?.destroyed&&(P.getLogger(this).warn("#map","The provided map is already destroyed",{map:e}),e=null),at.isLoadable(e)&&e.load().catch(()=>{}),this.constructed&&!this.destroyed&&(this.forceReadyCycle(),this._lockedSpatialReference=null),this._set("map",e))}get spatialReference(){let e=this._userSpatialReference||this._lockedSpatialReference||this.getDefaultSpatialReference()||null;if(e&&this.defaultsFromMap?.required?.heightModelInfo){let t=e.clone();return t.vcsWkid=this.defaultsFromMap.vcsWkid,t.latestVcsWkid=this.defaultsFromMap.latestVcsWkid,t}return e}set spatialReference(e){let t=!_t(e,this._get("spatialReference"));this._set("_userSpatialReference",e),t&&(this._set("spatialReference",e),this._spatialReferenceChanged(e))}_spatialReferenceChanged(e){}get stationary(){return!this.animation&&!this.navigating&&!this.resizing}get timeZone(){return this._userTimeZone??this._lockedTimeZone??this.getDefaultTimeZone()??Ur}set timeZone(e){let t=new Set(["etc/utc","etc/gmt","gmt"]),i=new Set(Intl.supportedValuesOf("timeZone").map(s=>s.toLowerCase()));this._userTimeZone=e,e===Ur||e===vl||t.has(e.toLowerCase())||i.has(e.toLowerCase())||P.getLogger(this).warn("#timeZone",`the parsed value '${e}' may not be a valid IANA time zone`)}get tools(){return this.toolViewManager?.tools}get initialExtent(){return this.defaultsFromMap?.extent}get cursor(){return this.toolViewManager?.cursor??this._cursor??"default"}set cursor(e){this._cursor=e,this.notifyChange("cursor")}get size(){return[this.width,this.height]}get effectiveTheme(){return this.theme??new qo}whenLayerView(e){return this.layerViewManager?.whenLayerView(e)??Promise.reject()}getDefaultSpatialReference(){return this.defaultsFromMap?.spatialReference}getDefaultHeightModelInfo(){return(this.map&&"heightModelInfo"in this.map?this.map.heightModelInfo:void 0)??this.defaultsFromMap?.heightModelInfo??null}getDefaultTimeZone(){return null}importLayerView(e){throw new x("importLayerView() not implemented")}hasLayerViewModule(e){return!1}validate(){return v(this,null,function*(){})}loadAsyncDependencies(){return v(this,null,function*(){})}invalidate(){this._isValid=!1}getSpatialReferenceSupport(){return{constraints:null}}_validateSpatialReference(e){return this.getSpatialReferenceSupport(e)!=null}when(e,t){return this.isResolved()&&!this.ready&&P.getLogger(this).warn("#when()","Calling view.when() while the view is no longer ready but was already resolved once will resolve immediately. Use reactiveUtils.whenOnce(() => view.ready).then(...) instead."),super.when(e,t)}forceReadyCycle(){this.ready&&(le(()=>this.destroyed||this.preconditionsReady===!1,()=>this._readyCycleForced=!1,{once:!0}),this._readyCycleForced=!0)}addAndActivateTool(e){this.toolViewManager.tools.add(e),this.activeTool=e}tryFatalErrorRecovery(){this.fatalError=null}};E.views=new D,a([l()],E.prototype,"_userSpatialReference",void 0),a([l()],E.prototype,"activeTool",null),a([l({readOnly:!0})],E.prototype,"allLayerViews",void 0),a([l()],E.prototype,"groundView",void 0),a([l()],E.prototype,"animation",null),a([l()],E.prototype,"basemapView",void 0),a([l()],E.prototype,"center",null),a([l({readOnly:!0})],E.prototype,"_defaultsFromMapSettings",null),a([l()],E.prototype,"defaultsFromMap",null),a([l()],E.prototype,"fatalError",void 0),a([l({type:Oe})],E.prototype,"extent",null),a([l(hn(un,"graphics"))],E.prototype,"graphics",void 0),a([l(hn(Vs,"analyses"))],E.prototype,"analyses",void 0),a([l({readOnly:!0,type:Cs})],E.prototype,"heightModelInfo",null),a([l({readOnly:!0})],E.prototype,"interacting",null),a([l({readOnly:!0})],E.prototype,"navigating",null),a([l({readOnly:!0,dependsOn:["fatalError","_isValid","_readyCycleForced","map","map.loaded?","width","height","spatialReference","_lockedSpatialReference","defaultsFromMap.ready","typeSpecificPreconditionsReady"]})],E.prototype,"preconditionsReady",null),a([l({readOnly:!0})],E.prototype,"typeSpecificPreconditionsReady",void 0),a([l({type:D,readOnly:!0})],E.prototype,"layerViews",void 0),a([l()],E.prototype,"resolution",null),a([l({type:ta})],E.prototype,"magnifier",void 0),a([l({value:null,type:Uo})],E.prototype,"map",null),a([l()],E.prototype,"padding",void 0),a([l({readOnly:!0})],E.prototype,"ready",void 0),a([l({type:se})],E.prototype,"spatialReference",null),a([l()],E.prototype,"spatialReferenceWarningDelay",void 0),a([l()],E.prototype,"stationary",null),a([l({readOnly:!0})],E.prototype,"supportsGround",void 0),a([l({type:Ql})],E.prototype,"timeExtent",void 0),a([l({type:String,nonNullable:!0})],E.prototype,"timeZone",null),a([l()],E.prototype,"tools",null),a([l()],E.prototype,"toolViewManager",void 0),a([l({readOnly:!0})],E.prototype,"type",void 0),a([l({type:Number})],E.prototype,"scale",void 0),a([l({readOnly:!0})],E.prototype,"updating",void 0),a([l({readOnly:!0})],E.prototype,"initialExtentRequired",void 0),a([l({readOnly:!0})],E.prototype,"initialExtent",null),a([l()],E.prototype,"cursor",null),a([l({readOnly:!0})],E.prototype,"input",void 0),a([l({type:pa,nonNullable:!0})],E.prototype,"navigation",void 0),a([l()],E.prototype,"layerViewManager",void 0),a([l()],E.prototype,"analysisViewManager",void 0),a([l()],E.prototype,"selectionManager",void 0),a([l()],E.prototype,"width",void 0),a([l()],E.prototype,"height",void 0),a([l({readOnly:!0})],E.prototype,"resizing",void 0),a([l({value:null,readOnly:!0})],E.prototype,"size",null),a([l({readOnly:!0})],E.prototype,"suspended",void 0),a([l({readOnly:!0})],E.prototype,"viewEvents",void 0),a([l({readOnly:!0})],E.prototype,"persistableViewModels",void 0),a([l()],E.prototype,"_isValid",void 0),a([l()],E.prototype,"_readyCycleForced",void 0),a([l()],E.prototype,"_lockedSpatialReference",void 0),a([l()],E.prototype,"_userTimeZone",void 0),a([l()],E.prototype,"_lockedTimeZone",void 0),a([l({type:qo})],E.prototype,"theme",void 0),a([l({readOnly:!0,type:qo})],E.prototype,"effectiveTheme",null),E=Hs=a([y("esri.views.View")],E);var Vh=E;function Wf(e){return e.layerViews}var ei=class extends wl{constructor(e){super(e),this.state="running",this.target=null,this._resolver=null}initialize(){this._resolver=oi(),this.addResolvingPromise(this._resolver.promise)}get done(){return this.state==="finished"||this.state==="stopped"}stop(){this.state!=="stopped"&&this.state!=="finished"&&(this._set("state","stopped"),this._resolver?.reject(new x("ViewAnimation stopped")))}finish(){this.state!=="stopped"&&this.state!=="finished"&&(this._set("state","finished"),this._resolver?.resolve())}update(e,t){t||(t=nl(e)?"waiting-for-target":"running"),this._set("target",e),this._set("state",t)}};a([l({readOnly:!0})],ei.prototype,"done",null),a([l({readOnly:!0,type:String})],ei.prototype,"state",void 0),a([l()],ei.prototype,"target",void 0),ei=a([y("esri.views.ViewAnimation")],ei),function(e){e.State={RUNNING:"running",STOPPED:"stopped",FINISHED:"finished",WAITING_FOR_TARGET:"waiting-for-target"}}(ei||(ei={}));var Bs=ei;function Uf(e){return e instanceof Float32Array&&e.length>=2}function Gf(e){return Array.isArray(e)&&e.length>=2}function Jo(e){return Uf(e)||Gf(e)}var ma,Dt=[0,0],ti=ma=class extends Ei{constructor(e){super(e),this._viewpoint2D={center:Oi(),rotation:0,scale:0,spatialReference:void 0},this.center=[0,0],this.extent=new Oe,this.id=0,this.inverseTransform=Co(),this.resolution=0,this.rotation=0,this.scale=0,this.transform=Co(),this.transformNoRotation=Co(),this.displayMat3=Lo(),this.displayViewMat3=Lo(),this.viewMat3=Lo(),this.viewMat2d=Hp(),this.worldScreenWidth=0,this.size=[0,0]}set pixelRatio(e){this._set("pixelRatio",e),this._update()}set size(e){this._set("size",e),this._update()}set viewpoint(e){if(e){let t=this._viewpoint2D,i=e.targetGeometry;t.center[0]=i.x,t.center[1]=i.y,t.rotation=e.rotation,t.scale=e.scale,t.spatialReference=i.spatialReference}this._update()}copy(e){let t=this.size,i=this.viewpoint;return i&&t?(this.viewpoint=$e(i,e.viewpoint),this._set("size",Fi(t,e.size))):(this.viewpoint=e.viewpoint.clone(),this._set("size",[e.size[0],e.size[1]])),this._set("pixelRatio",e.pixelRatio),this}clone(){return new ma({size:this.size,viewpoint:this.viewpoint.clone(),pixelRatio:this.pixelRatio})}toMap(e,t,i){return Jo(t)?pi(e,t,this.inverseTransform):(Dt[0]=t,Dt[1]=i,pi(e,Dt,this.inverseTransform))}toScreen(e,t,i){return Jo(t)?pi(e,t,this.transform):(Dt[0]=t,Dt[1]=i,pi(e,Dt,this.transform))}toScreenNoRotation(e,t,i){return Jo(t)?pi(e,t,this.transformNoRotation):(Dt[0]=t,Dt[1]=i,pi(e,Dt,this.transformNoRotation))}wrapMapCoordinate(e,t){Fi(e,t);let[i]=t,[s]=this.center,{extent:o,spatialReference:r}=this,{xmin:n,xmax:p}=o;if(r.isWrappable){let c=Hc(r)/2;n=Math.max(n,s-c),p=Math.min(p,s+c)}return(i<n||i>p)&&(e[0]=xp(i,s,r)),e}getScreenTransform(e,t){let{center:i}=this._viewpoint2D,s=this._get("pixelRatio")||1,o=this._get("size");return Oc(e,i,o,t,0,s),e}_update(){let{center:e,spatialReference:t,scale:i,rotation:s}=this._viewpoint2D,o=this._get("pixelRatio")||1,r=this._get("size"),n=new Se({targetGeometry:new N(e[0],e[1],t),scale:i,rotation:s});if(this._set("viewpoint",n),!r||!t||!i)return;this.resolution=zc(n),this.rotation=s,this.scale=i,this.spatialReference=t,Fi(this.center,e);let p=r[0]!==0?2/r[0]:0,c=r[1]!==0?-2/r[1]:0;Ip(this.displayMat3,p,0,0,0,c,0,-1,1,1);let d=Ep(this.viewMat3),h=nn(r[0]/2,r[1]/2),m=nn(-r[0]/2,-r[1]/2),f=Ol(s);on(d,d,h),kp(d,d,f),on(d,d,m),Pp(this.displayViewMat3,this.displayMat3,d);let w=$p(this.viewMat2d,h);return Op(w,w,f),Np(w,w,m),Vc(this.extent,n,r),Nc(this.transform,n,r,o),Fp(this.inverseTransform,this.transform),$c(this.transformNoRotation,n,r,o),this.worldScreenWidth=Bc(this.spatialReference,this.resolution),this._set("id",this.id+1),this}};a([l({readOnly:!0})],ti.prototype,"id",void 0),a([l({value:1,json:{write:!0}})],ti.prototype,"pixelRatio",null),a([l({json:{write:!0}})],ti.prototype,"size",null),a([l()],ti.prototype,"spatialReference",void 0),a([l({type:Se,json:{write:!0}})],ti.prototype,"viewpoint",null),ti=ma=a([y("esri.views.2d.ViewState")],ti);var fa=ti;var ga,ya,Vt=ga=class extends C{constructor(){super(...arguments),this.left=0,this.top=0,this.right=0,this.bottom=0}clone(){return new ga({left:this.left,top:this.top,right:this.right,bottom:this.bottom})}};a([l()],Vt.prototype,"left",void 0),a([l()],Vt.prototype,"top",void 0),a([l()],Vt.prototype,"right",void 0),a([l()],Vt.prototype,"bottom",void 0),Vt=ga=a([y("esri.views.2d.PaddedViewState.Padding")],Vt);var is=ya=class extends fa{constructor(...e){super(...e),this.paddedViewState=new fa,this._updateContent=(()=>{let t=Oi();return()=>{let i=this._get("size"),s=this._get("padding");if(!i||!s)return;let o=this.paddedViewState;Cp(t,s.left+s.right,s.top+s.bottom),Tp(t,i,t),Fi(o.size,t);let r=o.viewpoint;r&&(this.viewpoint=r)}})(),this.addHandles(_(()=>[this.size,this.padding],()=>this._updateContent(),wt)),this.padding=new Vt,this.size=[0,0]}set padding(e){this._set("padding",e||new Vt)}set viewpoint(e){if(e){this.paddedViewState.viewpoint=e;let t=this._viewpoint2D;if(this._get("padding")){let i=e.clone();Uc(i,e,this._get("size"),this._get("padding"));let s=i.targetGeometry;t.center[0]=s.x,t.center[1]=s.y,t.rotation=i.rotation,t.scale=i.scale,t.spatialReference=s.spatialReference}else{let i=e.targetGeometry;t.center[0]=i.x,t.center[1]=i.y,t.rotation=e.rotation,t.scale=e.scale,t.spatialReference=i.spatialReference}this._update()}}clone(){return new ya({padding:this.padding.clone(),size:this.size.slice(),viewpoint:this.paddedViewState.viewpoint.clone(),pixelRatio:this.pixelRatio})}};a([l()],is.prototype,"paddedViewState",void 0),a([l({type:Vt})],is.prototype,"padding",null),a([l()],is.prototype,"viewpoint",null),is=ya=a([y("esri.views.2d.PaddedViewState")],is);var ss=is;var Ws=class{constructor(t){this._view=t,this.viewpoint=new Se({targetGeometry:new N,scale:0,rotation:0})}get view(){return this._view}get size(){let[t,i]=this._view.size;return Math.sqrt(t*t+i*i)}get scale(){return this.viewpoint.scale}get rotation(){return this.viewpoint.rotation}get center(){return this.viewpoint.targetGeometry}get scaleToResolutionFactor(){return Fc(this.center.spatialReference)}pixelsPerPanAtZoom(t){return 1/(t*this.scaleToResolutionFactor)}zoomAtPixelsPerPan(t){return 1/(t*this.scaleToResolutionFactor)}pixelsPerRotateAtZoom(t){return this.size/2}compareTo(t,i){i.pan=Al(this.center,t.center);let s=Math.abs(t.rotation-this.rotation);s=s>=180?360-s:s,i.rotate=bt(s),i.sourceZoom=this.scale,i.targetZoom=t.scale}interpolate(t,i,s){let{pan:o,rotate:r,zoom:n,zoomOffset:p}=s,{center:c}=this;c.spatialReference=t.center.spatialReference,c.x=Ls(t.center.x,i.center.x,o),c.y=Ls(t.center.y,i.center.y,o),this.viewpoint.scale=Ls(t.scale,i.scale+p,n);let d=t.rotation,h=i.rotation;Math.abs(h-d)>=180&&(d+=360*(d<h?1:-1)),this.viewpoint.rotation=Ls(d,h,r)}copyFrom(t){$e(this.viewpoint,t.viewpoint),this._view=t.view}};var va=e=>e*e,Ah=e=>1-va(1-e);var Zf=e=>2**(10*(e-1)),zh=e=>1-Zf(1-e);function Ge(e){let t=2*(e-Math.sqrt((e-1)*e)),i=t/2/e;return s=>s<i?e*s*s:t*s-t+1}function Ze(e,t){return(i,s)=>i<t?t*e(i/t,s):1-e((1-i)/(1-t),s)*(1-t)}var Gk=Ze(Ge(1),1),Zk=Ze(Ge(1),0),wa=Ze(Ge(1),.5),qk=Ze(Ge(2),1),jk=Ze(Ge(2),0),Kk=Ze(Ge(2),.5),Yk=Ze(Ge(3),1),Qk=Ze(Ge(3),0),Xk=Ze(Ge(3),.5),Jk=Ze(Ge(4),1),eR=Ze(Ge(4),0),tR=Ze(Ge(4),.5);var er=class{constructor(){this.pan=0,this.rotate=0,this.fov=0,this.sourceZoom=0,this.targetZoom=0}};var wi={desiredScreenFlow:2,minDuration:500,maxDuration:8e3},_a=he(A({},wi),{maxDuration:4e3});var ir=class e{constructor(t){this._createCamera=t,this.compared=new er,this.segmentStart=0,this.segmentEnd=1,this.settings={desiredScreenFlow:wi.desiredScreenFlow},this.source=t(),this.target=t()}clone(){let t=new e(this._createCamera);return t.copyFrom(this),t}copyFrom(t){this.update(t.source,t.target,t.settings)}update(t,i,s){this.source!==t&&this.source.copyFrom(t),this.target!==i&&this.target.copyFrom(i),this.source.compareTo(this.target,this.compared),this.settings.desiredScreenFlow=s.desiredScreenFlow!=null?s.desiredScreenFlow:wi.desiredScreenFlow,this.desiredPixelFlow=this.settings.desiredScreenFlow*this.target.size,this.halfWindowSize=this.target.size/2}halfWindowPanAtZoom(t){let i=this.target.pixelsPerPanAtZoom(t);return this.halfWindowSize/i}get hasZoom(){return Math.abs(this.compared.sourceZoom-this.compared.targetZoom)>1e-5}get hasPan(){return this.compared.pan>co()}get hasFov(){return Math.abs(this.compared.fov)>co()}get hasRotate(){return this.compared.rotate>co()}};var sr=class{constructor(){this.pan=0,this.rotate=0,this.zoom=0,this.fov=0,this.zoomOffset=0}};var Oh=class{constructor(){this.segments=new Array}get time(){return this.segments.reduce((e,t)=>e+t.time,0)}interpolateComponentsAt(e,t){e=Math.min(Math.max(e,0),1),e*=this.time;let i=0,s=0,o=this.definition,r=this.segments.reduce((n,p)=>n||p.definition.hasZoom,!1);for(let n=0;n<this.segments.length;n++){let p=this.segments[n],c=p.definition;if(e<=p.time||n===this.segments.length-1){if(this.segmentInterpolateComponentsAt(p,p.time===0?0:e/p.time,t),o.hasPan&&!isNaN(t.pan)&&isFinite(o.compared.pan)?t.pan=(i+c.compared.pan*t.pan)/o.compared.pan:t.pan=1,o.hasRotate&&!isNaN(t.rotate)&&isFinite(o.compared.rotate)?t.rotate=(s+c.compared.rotate*t.rotate)/o.compared.rotate:t.rotate=1,r&&!isNaN(t.zoom)&&isFinite(c.compared.targetZoom)){let{sourceZoom:d,targetZoom:h}=c.compared,m=t.zoom*(h-d)+d,f=this.segments[0].definition.compared.sourceZoom,w=this.segments[this.segments.length-1].definition.compared.targetZoom,S=Math.abs(h-f)>Math.abs(d-f)?h:d;t.zoomOffset=S-w,t.zoom=(m-f)/(S-f)}else t.zoom=1;return t}e-=p.time,i+=c.compared.pan,s+=c.compared.rotate}}segmentInterpolateComponentsAt(e,t,i){e.interpolateComponentsAt(t,i)}};var os=class{get time(){return this._time}constructor(t){t&&this.update(t)}update(t){t&&(this.definition?this.definition.copyFrom(t):this.definition=t.clone()),this._updatePrecomputedVariables(),this._updatePixelFlow()}_updatePrecomputedVariables(){let t=this.definition,i=t.compared,s=i.sourceZoom,o=i.targetZoom;this._zoomSign=s>o?1:-1,this._panPixelsAtSource=i.pan*t.source.pixelsPerPanAtZoom(s);let r=(t.source.pixelsPerRotateAtZoom(s)+t.target.pixelsPerRotateAtZoom(o))/2;this._rotatePixels=i.rotate*r}_updatePixelFlow(){let t=this.definition.compared.sourceZoom,i=this.definition.compared.targetZoom,{hasZoom:s,hasPan:o,hasRotate:r}=this.definition,n=0,p=0;s&&(o&&(n=(i/t-1)/(-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2*this._panPixelsAtSource)),r&&(p=this._zoomSign*(Math.log(t/i)/Math.LN2)*this.definition.halfWindowSize/this._rotatePixels)),this._zoomPixelFlow=0,this._panPixelFlow=0,this._rotatePixelFlow=0;let c=this.definition.desiredPixelFlow;if(s&&o&&r){let d=n+p+n*p;this._zoomPixelFlow=n*p/d*c,this._panPixelFlow=p/d*c,this._rotatePixelFlow=n/d*c}else if(s&&o){let d=1+n;this._zoomPixelFlow=n/d*c,this._panPixelFlow=1/d*c}else if(s&&r){let d=1+p;this._zoomPixelFlow=p/d*c,this._rotatePixelFlow=1/d*c}else if(o&&r){let d=this._panPixelsAtSource/this._rotatePixels,h=1+d;this._panPixelFlow=d/h*c,this._rotatePixelFlow=1/h*c}else o?this._panPixelFlow=c:s?this._zoomPixelFlow=c:r&&(this._rotatePixelFlow=c);this._time=this.rotateTime??this.zoomTime??this.panTime??this.fovTime??0}get rotateTime(){return this.definition.hasRotate?this._rotatePixels/this._rotatePixelFlow:null}get zoomTime(){return this.definition.hasZoom?this._zoomSign*(Math.log(this.definition.compared.sourceZoom/this.definition.compared.targetZoom)/Math.LN2)*this.definition.halfWindowSize/this._zoomPixelFlow:null}get fovTime(){return this.definition.hasFov?Math.abs(this.definition.compared.fov)/qf:null}get panTime(){if(this.definition.hasPan){if(this.definition.hasZoom){let t=-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2,i=t*this._panPixelsAtSource;return Math.log(i*(this._zoomPixelFlow/this._panPixelFlow)+1)/(t*this._zoomPixelFlow)}return this._panPixelsAtSource/this._panPixelFlow}}_interpolateComponentsZoom(t){if(t===0||t===1)return t;if(this.definition.hasZoom){let i=this.definition.compared.sourceZoom,s=this.definition.compared.targetZoom;return(i*(i/s)**-t-i)/(s-i)}return t}_interpolateComponentsFov(t){if(t===0)return this.definition.segmentStart;if(t===1)return this.definition.segmentEnd;if(this.definition.hasFov){let{segmentStart:i,segmentEnd:s}=this.definition;return i+t*(s-i)}return this.definition.segmentStart}_interpolateComponentsPan(t){if(t===0||t===1)return t;if(this.definition.hasPan&&this.definition.hasZoom){let i=-1/(this._zoomSign*this.definition.halfWindowSize)*this._zoomPixelFlow;return 1/this._panPixelsAtSource*(this._panPixelFlow*(2**(i*t*this._time)-1))/(i*Math.LN2)}return t}_interpolateComponentsRotate(t){return t}interpolateComponentsAt(t,i){t=Math.min(Math.max(t,0),1),i.zoom=this._interpolateComponentsZoom(t),i.pan=this._interpolateComponentsPan(t),i.rotate=this._interpolateComponentsRotate(t),i.zoomOffset=0,i.fov=this._interpolateComponentsFov(t)}},qf=bt(90);function Nh(e,t,i){let s=t-e.compared.sourceZoom,o=e.halfWindowPanAtZoom(s);return-e.halfWindowSize*(i.ascensionFactor*Math.LN2*e.compared.pan+o)*Math.log(e.compared.sourceZoom/t)/(e.desiredPixelFlow*Math.LN2*o)}function $h(e,t,i){let s=1/t,o=Math.log(e.compared.sourceZoom*s),r=1/e.desiredPixelFlow,n=1/Math.LN2,p=t-e.compared.sourceZoom,c=1/p,d=(i.ascensionFactor*Math.LN2*e.compared.pan+e.halfWindowPanAtZoom(p))/e.halfWindowPanAtZoom(1);return e.halfWindowSize*s*r*n*c*d-e.halfWindowSize*o*r*n*c+e.halfWindowSize*o*r*n*d/(p*p)}function Hh(e,t,i){let s=t-e.compared.sourceZoom,o=1/s,r=1/t,n=Math.log(e.compared.sourceZoom*r),p=(i.ascensionFactor*Math.LN2*e.compared.pan+e.halfWindowPanAtZoom(s))/e.halfWindowPanAtZoom(1);return e.halfWindowSize*o*(-2*o*r*p+2*o*n+2*r-2*n*p/(s*s)-p/(t*t))/(e.desiredPixelFlow*Math.LN2)}function Bh(e,t){return-e.halfWindowSize*Math.log(e.compared.sourceZoom/t)/(e.desiredPixelFlow*Math.LN2)}function Wh(e,t){return e.halfWindowSize/(t*e.desiredPixelFlow*Math.LN2)}function Uh(e,t){return-e.halfWindowSize/(t*t*e.desiredPixelFlow*Math.LN2)}function Gh(e,t,i){return-e.compared.pan*e.halfWindowSize*(i.ascensionFactor+i.descensionFactor-1)/(e.desiredPixelFlow*e.halfWindowPanAtZoom(t))}function Zh(e,t,i){return e.compared.pan*e.halfWindowSize*(i.ascensionFactor+i.descensionFactor-1)/(e.desiredPixelFlow*e.halfWindowPanAtZoom(t*t))}function qh(e,t,i){return-2*e.compared.pan*e.halfWindowSize*(i.ascensionFactor+i.descensionFactor-1)/(e.desiredPixelFlow*e.halfWindowPanAtZoom(t*t*t))}function jh(e,t,i){return e.halfWindowSize*(-e.halfWindowPanAtZoom(t)-i.descensionFactor*Math.LN2*e.compared.pan+e.halfWindowPanAtZoom(e.compared.targetZoom))*Math.log(t/e.compared.targetZoom)/(e.desiredPixelFlow*Math.LN2*e.halfWindowPanAtZoom(-t+e.compared.targetZoom))}function Kh(e,t,i){let s=Math.log(t/e.compared.targetZoom),o=1/e.desiredPixelFlow,r=1/Math.LN2,n=-t+e.compared.targetZoom,p=1/n,c=(-e.halfWindowPanAtZoom(t)-i.descensionFactor*Math.LN2*e.compared.pan+e.halfWindowPanAtZoom(e.compared.targetZoom))/e.halfWindowPanAtZoom(1);return-e.halfWindowSize*s*o*r*p+e.halfWindowSize*s*o*r*c/(n*n)+e.halfWindowSize*o*r*p*c/t}function Yh(e,t,i){let s=t-e.compared.targetZoom,o=1/s,r=1/t,n=Math.log(t/e.compared.targetZoom),p=(e.halfWindowPanAtZoom(t)+i.descensionFactor*Math.LN2*e.compared.pan-e.halfWindowPanAtZoom(e.compared.targetZoom))/e.halfWindowPanAtZoom(1);return e.halfWindowSize*o*(-2*o*r*p-2*o*n+2*r+2*n*p/(s*s)-p/(t*t))/(e.desiredPixelFlow*Math.LN2)}function Qh(e,t){return e.halfWindowSize*Math.log(t/e.compared.targetZoom)/(e.desiredPixelFlow*Math.LN2)}function Xh(e,t){return e.halfWindowSize/(t*e.desiredPixelFlow*Math.LN2)}function Jh(e,t){return-e.halfWindowSize/(t*t*e.desiredPixelFlow*Math.LN2)}function eu(e){let t=e.compared.sourceZoom-e.compared.targetZoom;if(t===0)return e.compared.pan*e.halfWindowSize/(e.desiredPixelFlow*e.halfWindowPanAtZoom(e.compared.sourceZoom));let i=Math.LN2*e.compared.pan,s=t,o=e.halfWindowPanAtZoom(s),r=e.halfWindowSize*Math.log(e.compared.sourceZoom/e.compared.targetZoom)/(e.desiredPixelFlow*Math.LN2*o);return e.compared.sourceZoom<=e.compared.targetZoom?r*(i-o):r*(i+o)}function tu(e,t){let i=jf(e,t),s={ascensionFactor:t.ascensionFactor!=null?t.ascensionFactor:.5,descensionFactor:t.descensionFactor!=null?t.descensionFactor:.5},o=s.ascensionFactor===0,r=s.descensionFactor===0,n=o?Bh:Nh,p=o?Wh:$h,c=o?Uh:Hh,d=r?Qh:jh,h=r?Xh:Kh,m=r?Jh:Yh,f=M=>n(e,M,s)+Gh(e,M,s)+d(e,M,s),w=M=>p(e,M,s)+Zh(e,M,s)+h(e,M,s),S=M=>c(e,M,s)+qh(e,M,s)+m(e,M,s),T=f(i),F=eu(e),b,L=t.maximumIterations||20,g=t.maximumDistance!=null?t.maximumDistance:1/0;for(b=0;b<L;b++){let M=t.desiredSlope??1e-6,k=w(i);Math.abs(k)>M&&(k+=M);let H=k/S(i);if(isNaN(H)||i>=g&&H<0){if(!isFinite(g))return null;i=g,T=f(i);break}if(i-=H,i<e.compared.sourceZoom||i<e.compared.targetZoom)return null;let G=f(i);if(Math.abs(G-T)/T<=.005)break;T=G}return T>F*(1-.3)||i<e.compared.sourceZoom||i<e.compared.targetZoom?null:i}function jf(e,t){let i=Math.max(e.compared.sourceZoom,e.compared.targetZoom),s=e.source.zoomAtPixelsPerPan(e.desiredPixelFlow/e.compared.pan)/2;return s<i?t.maximumDistance!=null?i+(t.maximumDistance-i)/2:1.5*i:t.maximumDistance?Math.min(t.maximumDistance,s):s}var or=class extends Oh{constructor(t,i){super(),this._preallocSegments=[new os,new os,new os],this._ascensionSegment=null,this._descensionSegment=null,this.update(t,i)}update(t,i){if(!t)return;this.definition?this.definition.copyFrom(t):this.definition=t.clone();let s=i?.apex?tu(t,i.apex):null;this.segments.length=0,this._ascensionSegment=null,this._descensionSegment=null,s?this._updateWithApex(s,i?.apex):this._updateWithoutApex()}segmentInterpolateComponentsAt(t,i,s){t.interpolateComponentsAt(i,s),t===this._ascensionSegment?s.zoom=Ah(s.zoom):t===this._descensionSegment&&(s.zoom=va(s.zoom))}_updateWithApex(t,i){let[s,o,r]=this._preallocSegments,n=i?.ascensionFactor??.5,p=Math.min(1-n,i?.ascensionFactor!=null&&i.descensionFactor!=null?i.descensionFactor:.5),c=1-n-p;s.definition?s.definition.copyFrom(this.definition):s.definition=this.definition.clone(),s.definition.compared.targetZoom=t,s.definition.compared.pan=this.definition.compared.pan*n,s.definition.compared.rotate=this.definition.compared.rotate*n,s.definition.segmentEnd=n,s.update(),this._ascensionSegment=s,this.segments.push(s),c>0&&(o.definition?o.definition.copyFrom(this.definition):o.definition=this.definition.clone(),o.definition.copyFrom(this.definition),o.definition.compared.sourceZoom=t,o.definition.compared.targetZoom=t,o.definition.compared.pan=this.definition.compared.pan*c,o.definition.compared.rotate=this.definition.compared.rotate*c,o.definition.segmentStart=s.definition.segmentEnd,o.definition.segmentEnd=s.definition.segmentEnd+c,o.update(),this.segments.push(o)),r.definition?r.definition.copyFrom(this.definition):r.definition=this.definition.clone(),r.definition.compared.sourceZoom=t,r.definition.compared.pan=this.definition.compared.pan*p,r.definition.compared.rotate=this.definition.compared.rotate*p,r.definition.segmentStart=n+c,r.update(),this._descensionSegment=r,this.segments.push(r)}_updateWithoutApex(){let[t]=this._preallocSegments;t.update(this.definition),this.segments.push(t)}};var Kf=new sr,iu=class{get time(){return this._time}get isLinear(){return this.path.segments.length===1}constructor(e){this._time=0,this._easing=wa,this.definition=new ir(e),this.path=new or}update(e,t,i){this.definition.update(e,t,i),this.path.update(this.definition,i),this._time=this._applyTimeSettings(ll(isFinite(this.path.time)?this.path.time:0),i),this._easing=i.easing??(this._time>=1e3?wa:zh)}cameraAt(e,t){e=Math.min(Math.max(0,e),1),e=this._normalizedEasing(e);let i=this.path.interpolateComponentsAt(e,Kf);t.interpolate(this.definition.source,this.definition.target,i)}_normalizedEasing(e){let t=this._easing(0,this._time),i=this._easing(1,this._time);return(this._easing(e,this._time)-t)/(i-t)}_applyTimeSettings(e,t){let i=t.speedFactor!=null?t.speedFactor:1,s=t.minDuration??wi.minDuration/i,o=t.maxDuration??wi.maxDuration/i;return e=t.duration!=null?t.duration:Math.min(Math.max(e/i,s),o)}};var su=2e3,Yf=64,ba=class{constructor(t){this._view=t,this._animation=new iu(()=>new Ws(this._view)),this._current=new Ws(this._view)}get _source(){return this._animation.definition.source}get _target(){return this._animation.definition.target}get duration(){return this._animation.time}get animation(){return this._animation}update(t,i,s={}){$e(this._current.viewpoint,t),$e(this._source.viewpoint,t),$e(this._target.viewpoint,i),this._animation.update(this._source,this._target,s)}applyRatio(t,i){this._animation.cameraAt(i,this._current),$e(t,this._current.viewpoint)}},rs=class extends C{constructor(e){super(e),this._animation=null,this._destinationViewState=new ss,this.updateFunction=null,this.easing=jp.ease,this.viewpoint=new Se({targetGeometry:new N,scale:0,rotation:0}),this._updateTask=qe({postRender:this._postRender.bind(this)}),this._updateTask.pause(),this._transition=new ba(e.view)}destroy(){this._updateTask=ue(this._updateTask)}get animation(){return this._animation}set animation(e){this._animation=e,this.view.animation=e}animate(e,t,i){this.stop();let s=this.viewpoint;$e(s,t);let o=(typeof i?.easing=="string"?Kp(i.easing):i?.easing)||this.easing,r=e.target;this._transition.update(this.viewpoint,r,{apex:{maximumDistance:Math.min(Math.min(t.scale,r.scale)*Yf,this.view.constraints.effectiveMinScale),desiredSlope:5e-8},duration:i?.duration,maxDuration:i?.animationMode==="auto"?1/0:i?.maxDuration??_a.maxDuration,speedFactor:i?.speedFactor,easing:typeof o=="function"?p=>o(p):void 0}),i?.animationMode==="auto"&&(this._destinationViewState.copy(this.view.state),this._destinationViewState.viewpoint=r,Qf(this._transition.animation,i,this.view.state,this._destinationViewState)||this._transition.update(this.viewpoint,r,{duration:0}));let n=()=>{this.animation===e&&this._updateTask&&(e.state==="finished"&&(this._transition.applyRatio(this.viewpoint,1),this.view.state&&(this.view.state.viewpoint=this.viewpoint.clone())),this.animation=null,this.updateFunction=null)};return e.when(n,n),this._startTime=performance.now(),this._updateTask.resume(),this.animation=e,e}animateContinuous(e,t){this.stop(),this.updateFunction=t,this.viewpoint=e;let i=new Bs({target:e.clone()}),s=()=>{this.animation===i&&this._updateTask&&(this.animation=null,this.updateFunction=null)};return i.when(s,s),this._startTime=performance.now(),this._updateTask.resume(),this.animation=i,i}stop(){this.animation&&(this.animation.stop(),this.animation=null,this.updateFunction=null)}_postRender(e){let t=this.animation;if(t&&t.state!==Bs.State.STOPPED){if(this.updateFunction)this.updateFunction(this.viewpoint,e.deltaTime),this.animation?.update(this.viewpoint);else{let i=performance.now()-this._startTime,s=this._transition.duration,o=s>0?i/s:1,r=o>=1;this._transition.applyRatio(this.viewpoint,o),r&&this.animation?.finish()}this.view.state&&(this.view.state.viewpoint=this.viewpoint.clone())}else this._updateTask.pause()}};function Qf(e,t,i,s){if(t?.duration!=null)return!0;let{time:o,isLinear:r}=e,n=t?.speedFactor||1,p=t?.maxDuration??_a.maxDuration/n;if(ie("esri-goto-debug")&&(console.log("speed factor:",n),console.log("adjusted duration:		",o),console.log("adjusted max duration:	",p),console.log("is linear:",r)),o>p)return ie("esri-goto-debug")&&console.warn(`failed "auto" heuristic: animations must be shorter than ${p/1e3}s`),!1;if(r){let d=Oi(),h=X(...s.toScreen(d,...i.center)),m=X(...i.toScreen(d,...s.center)),f=m!=null&&m.x>-(1.5-.5)*i.size[0]&&m.x<(1.5+.5)*i.size[0]&&m.y>-(1.5-.5)*i.size[1]&&m.y<(1.5+.5)*i.size[1],w=h!=null&&h.x>-(1.5-.5)*s.size[0]&&h.x<(1.5+.5)*s.size[0]&&h.y>-(1.5-.5)*s.size[1]&&h.y<(1.5+.5)*s.size[1];if(ie("esri-goto-debug")&&(console.log(`dest is within ${1.5} screens at start view:`,f),console.log(`start is within ${1.5} screens at dest view:`,w)),o>su/n&&!f&&!w)return ie("esri-goto-debug")&&console.warn(`failed "auto" heuristic: linear animations must be...
  - shorter than ${su/1e3/n}s, or
  - shorter than ${p/1e3}s and the destination is close enough to the starting screen, or
  - shorter than ${p/1e3}s and the start point is close enough to the destination screen`),!1}return!0}a([l()],rs.prototype,"easing",void 0),a([l()],rs.prototype,"view",void 0),a([l()],rs.prototype,"viewpoint",void 0),rs=a([y("esri.views.2d.AnimationManager")],rs);var ou=rs;var rr=class{constructor(t){this.view=t,this._stationaryHandle=null,this._frameTaskHandle=null,this._updateParameters=null,this._updateRequested=!1,this.stationary=!0,this.animationInProgress=!1,this.prepare=()=>{this._updateParameters&&(this._updateParameters.state=this.view.state,this._updateParameters.stationary=this.view.stationary,this._updateParameters.pixelRatio=window.devicePixelRatio,this._updateParameters.renderingOptions=this.view.renderingOptions,this._updateParameters.targetState.copy(this.view.state),this.view.animation&&!("then"in this.view.animation.target)&&(this._updateParameters.targetState.viewpoint=this.view.animation.target))},this.update=()=>{if(this._updateRequested=!1,this.view?.destroyed)return;let{allLayerViews:i,graphicsView:s,labelManager:o,state:{id:r}}=this.view;i.forEach(this._updateLayerView,this),o!=null&&(o.lastUpdateId!==r&&(o.viewChange(),o.lastUpdateId=r),o.updateRequested&&o.processUpdate(this._updateParameters)),s!=null&&(s.lastUpdateId!==r&&(s.viewChange(),s.lastUpdateId=r),s.updateRequested&&s.processUpdate(this._updateParameters)),this.view.graphicsTileStore.setViewState(this._updateParameters.state),this.animationInProgress||this._updateRequested||this._frameTaskHandle?.pause()}}destroy(){this.stop()}start(){if(this._frameTaskHandle)return;let t=this.view;this.stationary=t.stationary,this._updateParameters={state:t.state,targetState:new ss,pixelRatio:window.devicePixelRatio,stationary:this.stationary,renderingOptions:t.renderingOptions},this._stationaryHandle=_(()=>t.stationary,i=>{this.stationary=i,this.requestFrame()}),this._frameTaskHandle=qe(this),this.requestUpdate()}stop(){this._frameTaskHandle&&(this._updateRequested=!1,this._stationaryHandle?.remove(),this._frameTaskHandle.remove(),this._updateParameters=this._stationaryHandle=this._frameTaskHandle=null,this.stationary=!0,this.animationInProgress=!1)}requestUpdate(){this._updateRequested||(this._updateRequested=!0,this.requestFrame())}requestFrame(){this._frameTaskHandle&&this._frameTaskHandle.resume()}_updateLayerView(t){if(!t.attached)return void this.requestUpdate();let i=this.view.state,s=t.lastUpdateId;s!=null&&(this.stationary||t.moving)||(t.moving=!0),s!==i.id&&t.viewChange(),this.stationary&&t.moving&&(t.moving=!1,t.moveEnd()),t.lastUpdateId=i.id,t.updateRequested&&t.processUpdate(this._updateParameters),"layerViews"in t&&t.layerViews?.forEach(this._updateLayerView,this)}};var Us=class extends C{constructor(e){super(e),this._gotoTask=null}destroy(){this._gotoTask=null}goTo(e,t){return v(this,null,function*(){if(!e)return void P.getLogger(this).error("#goTo()","target cannot be null or undefined");let i=new Bs;this.view.animation=i,yield nt(()=>this.view.ready,t);let s=he(A({},t),{animate:t?.animate??!xo(),animationMode:t?.animationMode??"auto"}),{extent:o,spatialReference:r,size:n,viewpoint:p,constraints:c,padding:d,allLayerViews:h}=this.view,m=Dc(e,{extent:o,spatialReference:r,size:n,viewpoint:p,constraints:c,padding:d,allLayerViews:h,pickClosestTarget:t?.pickClosestTarget??!0});return i?.update(m),this._gotoTask={},s.animate?this._gotoAnimated(m,s):this._gotoImmediate(m,s)})}_gotoImmediate(e,t){let i=this._gotoTask,s=this.view.animation,o=e.then(r=>{if(ae(t),i!==this._gotoTask)throw new x("view:goto-interrupted","Goto was interrupted");this.view.viewpoint=s.target=r,s.finish()});return this._cancellableGoTo(i,s,o,t)}_gotoAnimated(e,t){let i=this._gotoTask,s=this.view.animation;if(!s)return Promise.resolve();let o=e.then(r=>{if(ae(t),i!==this._gotoTask)throw new x("view:goto-interrupted","Goto was interrupted");return s.update(r),this.view.animationManager.animate(s,this.view.viewpoint,t),s.when().then(()=>{},()=>{})});return this._cancellableGoTo(i,s,o,t)}_cancellableGoTo(e,t,i,s){let o=()=>e===this._gotoTask;return il(i,s).finally(()=>{o()&&(t.done||t.stop())})}};a([l({constructOnly:!0})],Us.prototype,"view",void 0),Us=a([y("esri.views.2d.GoToManager")],Us);function J(){return Promise.all([import("./chunk-XZ3OEKNB.js"),import("./chunk-MCVYKCDR.js")])}var Gs=()=>J().then(()=>import("./chunk-KVFZ2LAJ.js")),ns=()=>J().then(()=>import("./chunk-JW3BPS42.js")),ru={"base-dynamic":()=>J().then(()=>import("./chunk-RWDISVDI.js")),"base-tile":Gs,"bing-maps":Gs,catalog:()=>J().then(()=>import("./chunk-NASLOLQO.js")),"catalog-dynamic-group":()=>J().then(()=>import("./chunk-ZM33HYTQ.js")),"catalog-footprint":()=>J().then(()=>import("./chunk-ALGFABAA.js")),csv:ns,"geo-rss":()=>J().then(()=>import("./chunk-665355TM.js")),feature:ns,geojson:ns,graphics:()=>J().then(()=>import("./chunk-FEZRZQNJ.js")),group:()=>J().then(()=>import("./chunk-H57TQC7P.js")),imagery:()=>J().then(()=>import("./chunk-KOEMPGLD.js")),"imagery-tile":()=>J().then(()=>import("./chunk-BD33LSZA.js")),kml:()=>J().then(()=>import("./chunk-BU3MS7T6.js")),"knowledge-graph":()=>J().then(()=>import("./chunk-26KJ62CY.js")),"link-chart":()=>J().then(()=>import("./chunk-26KJ62CY.js")),"knowledge-graph-sublayer":ns,"map-image":()=>J().then(()=>import("./chunk-OG2ZEXHF.js")),"map-notes":()=>J().then(()=>import("./chunk-KB6GIA4U.js")),media:()=>J().then(()=>import("./chunk-R7D3KTKB.js")),"ogc-feature":()=>J().then(()=>import("./chunk-FOKA36KM.js")),"open-street-map":Gs,"oriented-imagery":ns,route:()=>J().then(()=>import("./chunk-CMI2DIE4.js")),stream:()=>J().then(()=>import("./chunk-O67HNN4X.js")),"subtype-group":()=>J().then(()=>import("./chunk-7AREY3NR.js")),tile:Gs,"vector-tile":()=>J().then(()=>import("./chunk-SWMCTJ5Z.js")),video:()=>J().then(()=>import("./chunk-JFLNS6SC.js")),wcs:()=>J().then(()=>import("./chunk-BD33LSZA.js")),"web-tile":Gs,wfs:ns,wms:()=>J().then(()=>import("./chunk-HZCV2QOA.js")),wmts:()=>J().then(()=>import("./chunk-4LHJY477.js")),"line-of-sight":null,"base-elevation":null,"building-scene":null,dimension:null,elevation:null,"integrated-mesh":null,"integrated-mesh-3dtiles":null,"point-cloud":null,voxel:null,scene:null,unknown:null,unsupported:null};function Xf(e){let t=e.declaredClass?e.declaredClass.slice(e.declaredClass.lastIndexOf(".")+1):"Unknown",i=t.replaceAll(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();return new x(`${i}:view-not-supported`,`${t} is not supported in 2D`)}var Sa={hasLayerViewModule:e=>ru[e.type]!=null,importLayerView:e=>{let t=ru[e.type];if(t==null)throw Xf(e);return t(e)}};function nu(e,t){let{spatialReference:i}=t,s=[t.x,t.y],o=Number.POSITIVE_INFINITY,r=0,n=0,p=[0,0],c=e.type==="extent"?[[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]]:e.rings;for(let d of c)for(let h=0;h<d.length-1;h++){Fl(p,s,d,h);let m=Lp(s,p);m<o&&(o=m,r=p[0],n=p[1])}return{coordinate:new N({x:r,y:n,spatialReference:i}),distance:o}}var xa,ii=xa=class extends Vi(C){constructor(e){super(e),this.geometry=null,this.spatialReference=null}get normalizedGeometry(){if(this.geometry==null||!this.spatialReference)return null;if(!this.spatialReference.equals(this.geometry.spatialReference))try{return pt(this.geometry,this.spatialReference)}catch(e){return P.getLogger(this).error("#constraints.geometry","could not project the geometry to the view's spatial reference",{geometry:this.geometry,spatialReference:this.spatialReference,error:e}),null}return this.geometry}constrain(e,t){if(this.normalizedGeometry==null)return e;let i=e.targetGeometry;if(this.normalizedGeometry.type==="extent"?po(this.normalizedGeometry,i):zl(this.normalizedGeometry,i))return e;let{coordinate:s}=nu(this.normalizedGeometry,i);return s&&(e.targetGeometry=s),e}clone(){return new xa({geometry:this.geometry?.clone(),spatialReference:this.spatialReference?.clone()})}};a([l({constructOnly:!0})],ii.prototype,"geometry",void 0),a([l({readOnly:!0})],ii.prototype,"normalizedGeometry",null),a([l({constructOnly:!0})],ii.prototype,"spatialReference",void 0),ii=xa=a([y("esri.views.2d.constraints.GeometryConstraint")],ii);var Ca,Zs=Ca=class extends Vi(C){constructor(){super(...arguments),this.enabled=!0,this.rotationEnabled=!0}constrain(e,t){return this.enabled&&t&&(this.rotationEnabled||(e.rotation=t.rotation)),e}clone(){return new Ca({enabled:this.enabled,rotationEnabled:this.rotationEnabled})}};a([l()],Zs.prototype,"enabled",void 0),a([l()],Zs.prototype,"rotationEnabled",void 0),Zs=Ca=a([y("esri.views.2d.constraints.RotationConstraint")],Zs);var Ta=Zs;var La,ke=La=class extends Vi(C){constructor(e){super(e),this._lodByScale={},this._scales=[],this.effectiveLODs=null,this.effectiveMinZoom=-1,this.effectiveMaxZoom=-1,this.effectiveMinScale=0,this.effectiveMaxScale=0,this.lods=null,this.minZoom=-1,this.maxZoom=-1,this.minScale=0,this.maxScale=0,this.snapToZoom=!0}initialize(){let e,{lods:t,minScale:i,maxScale:s,minZoom:o,maxZoom:r}=this,n=-1,p=-1,c=!1,d=!1;if(i!==0&&s!==0&&i<s&&([i,s]=[s,i]),!t?.length)return this._set("effectiveMinScale",i),void this._set("effectiveMaxScale",s);t=t.map(h=>h.clone()),t.sort((h,m)=>m.scale-h.scale),t.forEach((h,m)=>h.level=m);for(let h of t)!c&&i>0&&i>=h.scale&&(n=h.level,c=!0),!d&&s>0&&s>=h.scale&&(p=e?e.level:-1,d=!0),e=h;o===-1&&(o=i===0?0:n),r===-1&&(r=s===0?t.length-1:p),o=Math.max(o,0),o=Math.min(o,t.length-1),r=Math.max(r,0),r=Math.min(r,t.length-1),o>r&&([o,r]=[r,o]),i=t[o].scale,s=t[r].scale,t.splice(0,o),t.splice(r-o+1,t.length),t.forEach((h,m)=>{this._lodByScale[h.scale]=h,this._scales[m]=h.scale}),this._set("effectiveLODs",t),this._set("effectiveMinZoom",o),this._set("effectiveMaxZoom",r),this._set("effectiveMinScale",i),this._set("effectiveMaxScale",s)}constrain(e,t){if(t&&e.scale===t.scale)return e;let i=this.effectiveMinScale,s=this.effectiveMaxScale,o=e.targetGeometry,r=t&&t.targetGeometry,n=s!==0&&e.scale<s,p=i!==0&&e.scale>i;if(n||p){let c=p?i:s;if(t&&r){let d=(c-t.scale)/(e.scale-t.scale);o.x=r.x+(o.x-r.x)*d,o.y=r.y+(o.y-r.y)*d}e.scale=c}return this.snapToZoom&&this.effectiveLODs&&(e.scale=this._getClosestScale(e.scale)),e}fit(e){if(!this.effectiveLODs||!this.snapToZoom)return this.constrain(e,null);let t=this.scaleToZoom(e.scale),i=Math.abs(t-Math.floor(t));return e.scale=this.zoomToScale(i>.99?Math.round(t):Math.floor(t)),e}zoomToScale(e){if(!this.effectiveLODs)return 0;e-=this.effectiveMinZoom,e=Math.max(0,e);let t=this._scales;if(e<=0)return t[0];if(e>=t.length)return t[t.length-1];let i=Math.floor(e),s=Math.ceil(e);return t[i]+(e-i)*(t[s]-t[i])}scaleToZoom(e){if(!this.effectiveLODs)return-1;let t=this._scales,i,s;if(e>=t[0])return this.effectiveMinZoom;if(e<=t[t.length-1])return this.effectiveMaxZoom;for(let o=0;o<t.length-1;o++){if(i=t[o],s=t[o+1],s===e)return o+this.effectiveMinZoom+1;if(i>e&&s<e)return o+this.effectiveMinZoom+1-(e-s)/(i-s)}return-1}snapToClosestScale(e){if(!this.effectiveLODs)return e;let t=this.scaleToZoom(e);return this.zoomToScale(Math.round(t))}snapToNextScale(e,t=.5){if(!this.effectiveLODs)return e*t;let i=Math.round(this.scaleToZoom(e));return this.zoomToScale(i+1)}snapToPreviousScale(e,t=2){if(!this.effectiveLODs)return e*t;let i=Math.round(this.scaleToZoom(e));return this.zoomToScale(i-1)}clone(){return new La({lods:this.lods,minZoom:this.minZoom,maxZoom:this.maxZoom,minScale:this.minScale,maxScale:this.maxScale})}_getClosestScale(e){return this._lodByScale[e]||(e=this._scales.reduce((t,i)=>Math.abs(i-e)<=Math.abs(t-e)?i:t,this._scales[0])),this._lodByScale[e].scale}};a([l({readOnly:!0})],ke.prototype,"effectiveLODs",void 0),a([l({readOnly:!0})],ke.prototype,"effectiveMinZoom",void 0),a([l({readOnly:!0})],ke.prototype,"effectiveMaxZoom",void 0),a([l({readOnly:!0})],ke.prototype,"effectiveMinScale",void 0),a([l({readOnly:!0})],ke.prototype,"effectiveMaxScale",void 0),a([l()],ke.prototype,"lods",void 0),a([l()],ke.prototype,"minZoom",void 0),a([l()],ke.prototype,"maxZoom",void 0),a([l()],ke.prototype,"minScale",void 0),a([l()],ke.prototype,"maxScale",void 0),a([l()],ke.prototype,"snapToZoom",void 0),ke=La=a([y("esri.views.2d.constraints.ZoomConstraint")],ke);var Ma=ke;var Jf={base:null,key:"type",typeMap:{extent:Oe,polygon:Yl}},ne=class extends C{constructor(e){super(e),this.lods=null,this.minScale=0,this.maxScale=0,this.minZoom=-1,this.maxZoom=-1,this.rotationEnabled=!0,this.snapToZoom=!0,this.customConstraints=new D}destroy(){this.view=null}get effectiveLODs(){return this._zoom.effectiveLODs}get effectiveMinScale(){return this._zoom.effectiveMinScale}get effectiveMaxScale(){return this._zoom.effectiveMaxScale}get effectiveMinZoom(){return this._zoom.effectiveMinZoom}get effectiveMaxZoom(){return this._zoom.effectiveMaxZoom}set geometry(e){e?this._set("geometry",e):this._set("geometry",null)}get version(){return`${this._zoom?.uid}/${this._rotation?.uid}/${this._geometry?.uid}`}get _geometry(){let e=this._get("_geometry");return e&&this.geometry===e.geometry&&this.view?.constraintsInfo.spatialReference===e.spatialReference?e:new ii({geometry:this.geometry,spatialReference:this.view?.constraintsInfo.spatialReference})}get _rotation(){return new Ta({rotationEnabled:this.rotationEnabled})}get _zoom(){let e=this._get("_zoom"),t=this.lods||this.view?.constraintsInfo.lods,i=this.minZoom,s=this.maxZoom,o=this.minScale,r=this.maxScale,n=this.snapToZoom;return e&&e.lods===t&&e.minZoom===i&&e.maxZoom===s&&e.minScale===o&&e.maxScale===r&&e.snapToZoom===n?e:new Ma({lods:t,minZoom:i,maxZoom:s,minScale:o,maxScale:r,snapToZoom:n})}canZoomInTo(e){let t=this.effectiveMaxScale;return t===0||e>=t}canZoomOutTo(e){let t=this.effectiveMinScale;return t===0||e<=t}constrain(e,t){return this._zoom.constrain(e,t),this._rotation.constrain(e,t),this._geometry.constrain(e,t),this.customConstraints.forEach(i=>i.constrain(e,t)),e}constrainByGeometry(e){return this._geometry.constrain(e),this.customConstraints.forEach(t=>t.applyPanConstraint?.(e)),e}fit(e){return this._zoom.fit(e)}zoomToScale(e){return this._zoom.zoomToScale(e)}scaleToZoom(e){return this._zoom.scaleToZoom(e)}snapScale(e){return this._zoom.snapToClosestScale(e)}snapToNextScale(e){return this._zoom.snapToNextScale(e)}snapToPreviousScale(e){return this._zoom.snapToPreviousScale(e)}};a([l({readOnly:!0})],ne.prototype,"effectiveLODs",null),a([l({readOnly:!0})],ne.prototype,"effectiveMinScale",null),a([l({readOnly:!0})],ne.prototype,"effectiveMaxScale",null),a([l({readOnly:!0})],ne.prototype,"effectiveMinZoom",null),a([l({readOnly:!0})],ne.prototype,"effectiveMaxZoom",null),a([l({types:Jf,value:null})],ne.prototype,"geometry",null),a([l({type:[ai]})],ne.prototype,"lods",void 0),a([l()],ne.prototype,"minScale",void 0),a([l()],ne.prototype,"maxScale",void 0),a([l()],ne.prototype,"minZoom",void 0),a([l()],ne.prototype,"maxZoom",void 0),a([l()],ne.prototype,"rotationEnabled",void 0),a([l()],ne.prototype,"snapToZoom",void 0),a([l({type:D})],ne.prototype,"customConstraints",void 0),a([l()],ne.prototype,"view",void 0),a([l({readOnly:!0})],ne.prototype,"version",null),a([l({type:ii,readOnly:!0})],ne.prototype,"_geometry",null),a([l({type:Ta})],ne.prototype,"_rotation",null),a([l({readOnly:!0,type:Ma})],ne.prototype,"_zoom",null),ne=a([y("esri.views.2d.MapViewConstraints")],ne);var Ia=ne;var be=class extends C{constructor(e){super(e),this.constraints=null,this.ready=!1,this.resizeAlign="center",this.addHandles([_(()=>this.constraints?.version,t=>{this.constraints&&t&&this.ready&&(this.state.viewpoint=this.constraints.fit(this.state.paddedViewState.viewpoint))},wt)])}get center(){if(!this.ready)return this._get("center");let{center:e,spatialReference:t}=this.state.paddedViewState;return this.state.commitProperty("id"),new N({x:e[0],y:e[1],spatialReference:t})}set center(e){if(e==null)return;if(!this.ready)return void this._set("center",e);let t;try{t=this._project(e,this.state.spatialReference)}catch(s){return void P.getLogger(this).error(new x("mapview:invalid-center","could not project the value in the view's spatial reference",{input:e,error:s}))}let i=this.viewpoint;_n(i,i,t),this.viewpoint=i}get extent(){return this.ready?(this.state.commitProperty("id"),this.state.paddedViewState.extent.clone()):this._get("extent")}set extent(e){if(e==null)return;if(!e.width||!e.height)return void P.getLogger(this).error(new x("mapview:invalid-extent","invalid extent size"));if(!this.ready)return this._set("extent",e),this._set("center",void 0),this._set("viewpoint",void 0),this._set("scale",void 0),void this._set("zoom",void 0);let t;try{t=this._project(e,this.state.spatialReference)}catch(s){return void P.getLogger(this).error(new x("mapview:invalid-extent","could not project the value in the view's spatial reference",{error:s}))}let i=this.viewpoint;Ac(i,i,t,this.state.size,{constraints:this.constraints}),this.viewpoint=i}get padding(){return this.ready?this.state.padding:this._get("padding")}set padding(e){this.ready?(this.state.padding=e,this._set("padding",this.state.padding)):this._set("padding",e)}get resolution(){return this.ready?(this.state.commitProperty("id"),this.state.resolution):0}get rotation(){return this.ready?(this.state.commitProperty("id"),this.state.rotation):this._get("rotation")}set rotation(e){if(isNaN(e))return;if(!this.ready)return void this._set("rotation",e);let t=this.viewpoint;Zc(t,t,e),this.viewpoint=t}get scale(){return this.ready?(this.state.commitProperty("id"),this.state.scale):this._get("scale")}set scale(e){if(!e||isNaN(e))return;if(!this.ready){this._set("scale",e),this._set("zoom",void 0);let i=this._get("extent");return void(i&&(this._set("extent",void 0),this._set("center",i.center)))}let t=this.viewpoint;bn(t,t,e),this.viewpoint=t}get viewpoint(){return this.ready?this.state.paddedViewState.viewpoint.clone():this._get("viewpoint")}set viewpoint(e){if(e==null)return;if(!this.ready)return this._set("viewpoint",e),this._set("extent",void 0),this._set("center",void 0),this._set("zoom",void 0),void this._set("scale",void 0);let t,i;try{t=this._project(e,this.state.spatialReference),!e.scale||isNaN(e.scale)?i=new x("mapview:invalid-viewpoint",`invalid scale value of ${e.scale}`):e.targetGeometry==null&&(i=new x("mapview:invalid-viewpoint","geometry not defined"))}catch(o){i=new x("mapview:invalid-viewpoint","could not project the value in the view's spatial reference",{error:o})}if(i)return void P.getLogger(this).error(i);this._scaleBeforeChangingSpatialReference=null;let s=new Se({targetGeometry:new N,scale:0,rotation:0});$e(s,t),this.constraints?.constrain(s,this.state.paddedViewState.viewpoint),this.state.viewpoint=s,this._set("viewpoint",s)}get zoom(){return this.ready?this.constraints?.scaleToZoom(this.scale)??-1:this._get("zoom")}set zoom(e){if(!(e>=0))return;if(!this.ready){this._set("zoom",e),this._set("scale",void 0);let s=this._get("extent");return void(s&&(this._set("extent",void 0),this._set("center",s.center)))}let t=this.constraints?.zoomToScale(e)??0;if(!t)return void this._set("zoom",-1);let i=this.viewpoint;bn(i,i,t),this.viewpoint=i,this._set("zoom",this.constraints?.scaleToZoom(this.scale)??-1)}getUserStartupOptions(e){if(!e[0]&&!e[1])return{center:void 0,rotation:void 0,scale:void 0};let{padding:t,constraints:i}=this,s=this._get("center"),o=this._get("extent"),r=this._get("scale"),n=this._get("rotation"),p=this._get("viewpoint"),c=this._get("zoom"),d=c!=null&&i!=null&&i.zoomToScale(c)||void 0,h,m,f,w=p?.rotation,S=p?.targetGeometry;S?.type==="extent"?h=S:S?.type==="point"&&(m=S,f=p?.scale);let T=o??h;return{center:s??m??T?.center,rotation:n??w,scale:(r??d??f??(T&&To(T,[e[0]-t.left-t.right,e[1]-t.top-t.bottom])))||void 0}}startup(e,t,i,s){let o=e.targetGeometry;try{this._project(e,i)}catch(r){P.getLogger(this).warn(new Wr("mapview:startup-projection-error","projection of initial viewpoint to the view's spatial reference, defaulting to the initial viewpoint.",{center:o.toJSON(),spatialReference:i,error:r})),e.targetGeometry=s||new N({x:0,y:0,spatialReference:i})}this.constraints?.fit(e),this._set("state",new ss({padding:this.padding,size:t,viewpoint:e})),this._set("ready",!0)}teardown(){this._set("ready",!1);let{center:[e,t],spatialReference:i,rotation:s,scale:o}=this.state.paddedViewState,r=new N({x:e,y:t,spatialReference:i});this._set("viewpoint",null),this._set("extent",null),this._set("center",r),this._set("zoom",-1),this._set("rotation",s),this._set("scale",o),this._set("state",null)}changeSpatialReference(e){let t=this.state.paddedViewState.clone();if(this._scaleBeforeChangingSpatialReference==null)this._scaleBeforeChangingSpatialReference=t.scale;else{let p=t.viewpoint.clone();p.scale=this._scaleBeforeChangingSpatialReference,t.viewpoint=p}let i=t.clone(),[s,o]=t.center,r=null;try{r=this._project(new N({x:s,y:o,spatialReference:t.spatialReference}),e)}catch(p){jr()||P.getLogger(this).warn(new Wr("mapview:spatial-reference-change","could not project the view's center to the new spatial reference",{center:r?.toJSON(),spatialReference:e,error:p}))}r||(r=new N({x:0,y:0,spatialReference:e}));let n=_n(new Se({targetGeometry:new N,scale:0,rotation:0}),t.viewpoint,r);i.viewpoint=n;try{let c=[t.size[0]/2,t.size[1]/2],d=[c[0]+20,c[1]],h=t.toMap([0,0],d),{x:m,y:f}=this._project(new N({x:h[0],y:h[1],spatialReference:t.spatialReference}),e);h[0]=m,h[1]=f,i.toScreen(h,h);let w=Wc(c,h,d),S=Math.hypot(h[0]-c[0],h[1]-c[1])/20;!Number.isFinite(S)||Math.abs(S)>4?(n.rotation=0,n.targetGeometry=new N({x:0,y:0,spatialReference:e})):(n.scale*=S,n.scale>ie("mapview-srswitch-adjust-rotation-scale-threshold")?n.rotation=0:n.rotation+=Number.isFinite(w)?w:0)}catch{}this._get("constraints")?.constrain(n,void 0),this._get("state").viewpoint=n}resize(e,t){if(!this.ready)return;let i=this.state,s=this.state.paddedViewState.viewpoint,o=this.state.paddedViewState.size.concat();i.size=[e,t],Gc(s,s,o,this.state.paddedViewState.size,this.resizeAlign),s=this.constraints?.constrain(s,void 0)??s,this.state.viewpoint=s}toMap(e){if(!this.ready)return null;let t=[0,0],[i,s]=this.state.toMap(t,[e.x,e.y]),o=this.state.spatialReference;return new N({x:i,y:s,spatialReference:o})}toScreen(e,t){if(!this.ready)return null;let i=this._project(e,this.state.spatialReference),s=[i.x,i.y];return t?.pickClosestTarget===!1||this.state.paddedViewState.wrapMapCoordinate(s,s),this.state.toScreen(s,s),X(s[0],s[1])}_project(e,t){let i=e?.targetGeometry||e;if(!t)return e;if(!i)return null;if(t.imageCoordinateSystem||i.spatialReference?.imageCoordinateSystem||_t(t,i.spatialReference))return e;let s=pt(i,t);if(!s)throw new x("mapview:projection-not-possible","projecting input geometry to target spatial reference returned a null value",{geometry:i,spatialReference:t});return eg(e)?(e.targetGeometry=s,e):s}};function eg(e){return e?.declaredClass==="esri.Viewpoint"}a([l({type:N})],be.prototype,"center",null),a([l()],be.prototype,"constraints",void 0),a([l({type:Oe})],be.prototype,"extent",null),a([l({value:{top:0,right:0,bottom:0,left:0},cast:e=>A({top:0,right:0,bottom:0,left:0},e)})],be.prototype,"padding",null),a([l()],be.prototype,"ready",void 0),a([l()],be.prototype,"resizeAlign",void 0),a([l({readOnly:!0})],be.prototype,"resolution",null),a([l({type:Number})],be.prototype,"rotation",null),a([l({type:Number})],be.prototype,"scale",null),a([l({readOnly:!0})],be.prototype,"state",void 0),a([l({type:Se})],be.prototype,"viewpoint",null),a([l()],be.prototype,"zoom",null),be=a([y("esri.views.2d.ViewStateManager")],be);function as(e,t){switch(t){case"primary":return e.pointerType==="touch"||e.button===0;case"secondary":return e.pointerType!=="touch"&&e.button===2;case"tertiary":return e.pointerType!=="touch"&&e.button===1}}var qs=class extends B{constructor(t,i){super(!0),this._view=t,this.registerIncoming("double-click",i,s=>this._handleDoubleClick(s,i))}_handleDoubleClick(t,i){as(t.data,"primary")&&(t.stopPropagation(),i?this._view.mapViewNavigation.zoomOut([t.data.x,t.data.y]):this._view.mapViewNavigation.zoomIn([t.data.x,t.data.y]))}};var nr=class extends B{constructor(t,i,s){super(!0),this.view=t,this.pointerType=i,this.registerIncoming("double-tap-drag",s,o=>this._handleDoubleTapDrag(o))}_handleDoubleTapDrag(t){let{data:i}=t,{pointerType:s}=i;if(s!==this.pointerType)return;t.stopPropagation();let{action:o,delta:r}=i,{view:n}=this,{mapViewNavigation:p}=n;switch(o){case"begin":{let{scale:c}=n;this._startScale=c,this._currentScale=c,this._previousDelta=r,p.begin();break}case"update":{if(this._previousDelta.y===r.y)return;this._previousDelta=r;let c=1.015**r.y,d=this._startScale*c,h=d/this._currentScale;p.setViewpointImmediate(h),this._currentScale=d;break}case"end":{let{constraints:c}=n,{effectiveLODs:d,snapToZoom:h}=c;if(!h||!d)return void p.end();let m=c.snapScale(this._currentScale),f=(r.y>0?Math.max(m,c.snapToPreviousScale(this._startScale)):Math.min(m,c.snapToNextScale(this._startScale)))/this._currentScale;p.zoom(f).then(()=>{p.end()});break}}}};var gt=class{constructor(t){this._callbacks=t,this._currentCount=0,this._callbacks.condition||(this._callbacks.condition=()=>!0)}handle(t){let i=t.data,s=i.pointers.size;switch(i.action){case"start":this._currentCount=s,this._emitStart(t);break;case"added":this._emitEnd(this._previousEvent),this._currentCount=s,this._emitStart(t);break;case"update":this._emitUpdate(t);break;case"removed":this._startEvent&&this._emitEnd(this._previousEvent),this._currentCount=s,this._emitStart(t);break;case"end":this._emitEnd(t),this._currentCount=0}this._previousEvent=t}_emitStart(t){this._startEvent=t,this._callbacks.condition?.(this._currentCount,t)&&this._callbacks.start(this._currentCount,t,this._startEvent)}_emitUpdate(t){this._callbacks.condition?.(this._currentCount,t)&&this._callbacks.update(this._currentCount,t,this._startEvent)}_emitEnd(t){this._callbacks.condition?.(this._currentCount,t)&&this._callbacks.end(this._currentCount,t,this._startEvent),this._startEvent=null}};var ar=class extends B{constructor(t,i,s){super(!0),this.view=t,this.pointerAction=i,this.registerIncoming("drag",s,o=>this._handleDrag(o)),this.registerIncoming("pointer-down",()=>this.stopMomentumNavigation())}onInstall(t){super.onInstall(t),this._dragEventSeparator=new gt({start:(i,s)=>{this.view.mapViewNavigation.pan.begin(this.view,s.data),s.stopPropagation()},update:(i,s)=>{this.view.mapViewNavigation.pan.update(this.view,s.data),s.stopPropagation()},end:(i,s)=>{this.view.mapViewNavigation.pan.end(this.view,s.data),s.stopPropagation()},condition:(i,s)=>i===1&&as(s.data,this.pointerAction)})}_handleDrag(t){let i=this.view.mapViewNavigation;i.pinch.zoomMomentum||i.pinch.rotateMomentum?this.stopMomentumNavigation():this._dragEventSeparator.handle(t)}stopMomentumNavigation(){this.view.mapViewNavigation.pan.stopMomentumNavigation()}};var lr=class extends B{constructor(t,i,s){super(!0),this._view=t,this.pointerAction=i;let o=this._view.mapViewNavigation;this._dragEventSeparator=new gt({start:(r,n)=>{o.rotate.begin(this._view,n.data),n.stopPropagation()},update:(r,n)=>{o.rotate.update(this._view,n.data),n.stopPropagation()},end:(r,n)=>{o.rotate.end(),n.stopPropagation()},condition:(r,n)=>r===1&&as(n.data,this.pointerAction)}),this.registerIncoming("drag",s,r=>this._dragEventSeparator.handle(r))}};function tt(e){let t=e*e;return e<0&&(t*=-1),t}function au(e){return e.translation[0]=0,e.translation[1]=0,e.translation[2]=0,e.heading=0,e.tilt=0,e}function lu(e,t,i){let s=i,o=e.state,r=e.device,n=t.tiltDirection==="forward-down"?1:-1,p=1;return r.deviceType==="standard"?(s.translation[0]=tt(o.axes[0]),s.translation[1]=tt(o.axes[1]),s.translation[2]=tt(o.buttons[7])-tt(o.buttons[6]),s.heading=tt(o.axes[2]),s.tilt=tt(o.axes[3])):r.deviceType==="spacemouse"&&(s.translation[0]=1.2*tt(o.axes[0]),s.translation[1]=1.2*tt(o.axes[1]),s.translation[2]=2*-tt(o.axes[2]),s.heading=1.2*tt(o.axes[5]),s.tilt=1.2*tt(o.axes[3])),s.tilt*=n,uo(s.translation,s.translation,p),s}function pu(e){return e.translation[0]===0&&e.translation[1]===0&&e.translation[2]===0&&e.heading===0&&e.tilt===0&&e.zoom===0}var pr=class extends B{constructor(t){super(!0),this._view=t,this._frameTask=null,this._watchHandles=new Js,this._currentDevice=null,this._transformation={translation:[0,0,0],heading:0,tilt:0,zoom:0},this._handle=this.registerIncoming("gamepad",i=>this._handleGamePadEvent(i)),this._handle.pause()}onInstall(t){super.onInstall(t),this._watchHandles.add([_(()=>this._view.navigation.gamepad?.enabled,i=>{i?(this._handle.resume(),this._frameTask||(this._frameTask=qe({update:s=>this._frameUpdate(s.deltaTime)}))):(this._handle.pause(),this._frameTask&&(this._frameTask.remove(),this._frameTask=null))},O)])}onUninstall(){this._watchHandles.removeAll(),this._frameTask&&(this._frameTask.remove(),this._frameTask=null),super.onUninstall()}_handleGamePadEvent(t){let i=this._view.navigation.gamepad.device;i&&t.data.device!==i||this._currentDevice&&this._currentDevice!==t.data.device||(t.data.action==="end"?(this._currentDevice=null,au(this._transformation)):(this._currentDevice=t.data.device,lu(t.data,this._view.navigation.gamepad,this._transformation)))}_frameUpdate(t){let i=this._transformation;if(pu(i))return;let s=this._view.viewpoint.clone(),o=this._view.navigation.gamepad.velocityFactor,r=ig*o*t;jc(s,s,[i.translation[0]*r,-i.translation[1]*r]);let n=1+i.translation[2]*sg*t,p=this._view.constraints.rotationEnabled?-i.heading*tg*t:0,c=this._view.size,d=[c[0]/2,c[1]];qc(s,s,n,p,d,c);let h=this._view.constraints.constrain(s,this._view.viewpoint);this._view.viewpoint=h}},tg=.06,ig=.7,sg=6e-4;function cr(e){let t=()=>e(document.visibilityState==="visible");return document.addEventListener("visibilitychange",t),st(()=>document.removeEventListener("visibilitychange",t))}var dr=class extends B{constructor(t,i,s){super(!0),this.view=t,this.keys=i,this._isSticky=!1,this._pressedKeys=new Set,this._timeout=void 0,this._currentDirection=void 0,this._stickyKeyDuration=200,this._handleKey=o=>{let r=this._keyMap[o.data.key];if(o.modifiers.has("Meta")||o.modifiers.has("Control"))return void this._stopMovement();if(r==null)return;o.stopPropagation(),o.preventDefault();let n=o.type==="key-down";if(this._pressedKeys[n?"add":"delete"](r),n){if(this._direction===r)return;this._direction=r,this._isSticky=!1,this._setTimeout(()=>{this._isSticky&&this._handlePopKey()})}else{let p=this._timeout===void 0,c=this._pressedKeys.size>0;p||c?this._handlePopKey():this._isSticky=!0}},this._handlePopKey=()=>{this._direction=Array.from(this._pressedKeys).pop(),this._direction==null&&this._stopMovement()},this._stopMovement=()=>{this._isSticky=!1,this._direction=void 0,this._pressedKeys.clear(),this._setTimeout(void 0)},this._keyMap={[i.left]:"left",[i.right]:"right",[i.up]:"up",[i.down]:"down"},this.registerIncoming("key-down",s,this._handleKey),this.registerIncoming("key-up",s,this._handleKey),this.registerIncoming("blur",s,this._stopMovement),this._visibilityHandle=cr(o=>o?null:this._stopMovement())}onUninstall(){this._stopMovement(),this._visibilityHandle?.remove()}get _direction(){return this._currentDirection}set _direction(t){let i=this._currentDirection!=null;if(t!=null){if(i||this.view.mapViewNavigation.begin(),this._currentDirection!==t)switch(t){case"left":this.view.mapViewNavigation.continuousPanLeft();break;case"right":this.view.mapViewNavigation.continuousPanRight();break;case"up":this.view.mapViewNavigation.continuousPanUp();break;case"down":this.view.mapViewNavigation.continuousPanDown()}}else i&&this.view.mapViewNavigation.stop();this._currentDirection=t}_setTimeout(t){clearTimeout(this._timeout),this._timeout=t===void 0?void 0:setTimeout(()=>{this._timeout=void 0,t()},this._stickyKeyDuration)}};var hr=class extends B{constructor(t,i,s){super(!0),this.view=t,this.keys=i,this._pressed=!1,this._keyToDirection={[i.clockwiseOption1]:"clockwise",[i.clockwiseOption2]:"clockwise",[i.counterClockwiseOption1]:"counterClockwise",[i.counterClockwiseOption2]:"counterClockwise",[i.resetOption1]:"reset",[i.resetOption2]:"reset"},this.registerIncoming("key-down",s,o=>this._handleKeyDown(o)),this.registerIncoming("key-up",s,o=>this._handleKeyUp(o)),this.registerIncoming("blur",s,()=>this._handleStop()),this._visibilityHandle=cr(o=>o?null:this._handleStop())}onUninstall(){this._visibilityHandle?.remove(),this._handleStop()}_handleKeyDown(t){t.data.repeat||this._handleKey(t,!0)}_handleKeyUp(t){this._handleKey(t,!1)}_handleStop(){this._pressed&&(this._pressed=!1,this.view.mapViewNavigation.stop())}_handleKey(t,i){let s=t.modifiers;if(s.size>0&&!s.has("Shift")||!this.view.constraints.rotationEnabled)return;let o=this._keyToDirection[t.data.key];if(this._pressed=o!=null,this._pressed){if(t.preventDefault(),i)switch(this.view.mapViewNavigation.begin(),o){case"clockwise":this.view.mapViewNavigation.continuousRotateClockwise();break;case"counterClockwise":this.view.mapViewNavigation.continuousRotateCounterclockwise();break;case"reset":this.view.mapViewNavigation.resetRotation()}else this._pressed=!1,this.view.mapViewNavigation.stop();t.stopPropagation()}}};var ls;(function(e){e[e.IN=0]="IN",e[e.OUT=1]="OUT"})(ls||(ls={}));var ur=class extends B{constructor(t,i,s){super(!0),this.view=t,this.keys=i,this._keysToZoomAction={},this.registerIncoming("key-down",s,o=>this._handleKeyDown(o)),i.zoomIn.forEach(o=>this._keysToZoomAction[o]=ls.IN),i.zoomOut.forEach(o=>this._keysToZoomAction[o]=ls.OUT)}_handleKeyDown(t){this._handleKey(t)}_handleKey(t){let i=t.modifiers;if(i.size>0&&!i.has("Shift"))return;let{key:s}=t.data;if(!(s in this._keysToZoomAction))return;let o=this._keysToZoomAction[s],{mapViewNavigation:r}=this.view,n=null;switch(o){case ls.IN:n=r.zoomIn();break;case ls.OUT:n=r.zoomOut();break;default:return}r.begin(),n.then(()=>r.end()),t.stopPropagation()}};var og=.6,mr=class extends B{constructor(t,i){super(!0),this._view=t,this._canZoom=!0,this.registerIncoming("mouse-wheel",i,s=>this._handleMouseWheel(s))}_handleMouseWheel(t){if(!this._view.navigation.mouseWheelZoomEnabled||(t.preventDefault(),t.stopPropagation(),!this._canZoom))return;let i=this._view.mapViewNavigation,{x:s,y:o,deltaY:r}=t.data,n=1/og**(1/60*r),p=i.zoom(n,[s,o]);p&&(this._canZoom=!1,p.catch(()=>{}).then(()=>{this._canZoom=!0,i.end()}))}};var fr=class extends B{constructor(t){super(!0),this.view=t,this.registerIncoming("drag",s=>this._handleDrag(s)),this.registerIncoming("pointer-down",()=>this._stopMomentumNavigation());let i=this.view.mapViewNavigation;this._dragEventSeparator=new gt({start:(s,o)=>{i.pinch.begin(this.view,o.data),o.stopPropagation()},update:(s,o)=>{i.pinch.update(this.view,o.data),o.stopPropagation()},end:(s,o)=>{i.pinch.end(this.view),o.stopPropagation()},condition:s=>s>=2})}_handleDrag(t){this._dragEventSeparator.handle(t)}_stopMomentumNavigation(){this.view.mapViewNavigation.pinch.stopMomentumNavigation()}};function Ea(e){let t=e.native;return t?{buttons:t.buttons.map(i=>i.pressed?i.value||1:0),axes:t.axes.map(i=>rg(i,e.axisThreshold))}:{buttons:[],axes:[]}}function cu(e,t){if(e.axes.length!==t.axes.length||e.buttons.length!==t.buttons.length)return!1;for(let i=0;i<e.axes.length;i++)if(e.axes[i]!==t.axes[i])return!1;for(let i=0;i<e.buttons.length;i++)if(e.buttons[i]!==t.buttons[i])return!1;return!0}function du(e){for(let t=0;t<e.axes.length;t++)if(e.axes[t]!==0)return!1;for(let t=0;t<e.buttons.length;t++)if(e.buttons[t]!==0)return!1;return!0}function rg(e,t){let i=Math.abs(e);return i<t?0:Math.sign(e)*(i-t)/(1-t)}var gr=class{constructor(t,i){this._element=t,this._input=i,this._hasEventListeners=!1,this._onConnectGamepad=r=>{this._connectGamepad(r.gamepad)},this._onDisconnectGamepad=r=>{let n=r.gamepad,p=n.index,c=this._inputDevices[p];c&&(this._emitGamepadEvent(n,Ea(c),!1),this._inputDevices.splice(p,1),this._latestUpdate.splice(p,1),this._input.gamepad.devices.remove(c),this.ensurePollingState())},this._frameTask=null,this._latestUpdate=new Array,this._inputDevices=new Array,this._callback=null;let s="getGamepads"in window.navigator,o=window.isSecureContext;this.supported=s&&o,this.supported&&(hu(r=>this._connectGamepad(r)),window.addEventListener("gamepadconnected",this._onConnectGamepad),window.addEventListener("gamepaddisconnected",this._onDisconnectGamepad),this.ensurePollingState())}destroy(){this.hasEventListeners=!1,this.supported&&(window.removeEventListener("gamepadconnected",this._onConnectGamepad),window.removeEventListener("gamepaddisconnected",this._onDisconnectGamepad))}set hasEventListeners(t){this._hasEventListeners!==t&&(this._hasEventListeners=t,this.ensurePollingState())}get _eventsEnabled(){return this.supported&&this._inputDevices.length>0&&this._hasEventListeners}set onEvent(t){this._callback=t}_connectGamepad(t){let i=new ts(t);i.deviceType!=="unknown"&&(this._inputDevices[t.index]=i,this._input.gamepad.devices.add(i)),this.ensurePollingState()}ensurePollingState(){this._eventsEnabled?this._startPolling():this._stopPolling()}_startPolling(){this._frameTask==null&&(this._frameTask=qe({update:()=>this._readGamepadState()}))}_stopPolling(){this._frameTask!=null&&(this._frameTask.remove(),this._frameTask=null,this._latestUpdate=new Array)}_readGamepadState(){let t=document.hasFocus(),i=this._element.contains(document.activeElement),s=this._input.gamepad.enabledFocusMode==="document"&&!t||this._input.gamepad.enabledFocusMode==="view"&&!i;hu(o=>{let r=this._inputDevices[o.index];if(!r)return;let n=this._latestUpdate[o.index],p=Ea(r),c=s||du(p);n&&(n.timestamp===o.timestamp||!n.active&&c||cu(n.state,p))||this._emitGamepadEvent(o,p,!c)})}_emitGamepadEvent(t,i,s){let o=this._latestUpdate[t.index],r=o&&o.active;if(!r&&!s)return;let n=!r&&s?"start":r&&s?"update":"end";this._latestUpdate[t.index]={timestamp:t.timestamp,state:i,active:s},this._callback&&this._callback({device:this._inputDevices[t.index],state:i,action:n})}};function ng(e){if(!e||!e.connected)return!1;for(let t=0;t<e.axes.length;t++)if(isNaN(e.axes[t]))return!1;return!0}function hu(e){let t=window.navigator.getGamepads();for(let i=0;i<t.length;i++){let s=t[i];ng(s)&&e(s)}}var uu=ie("edge"),ag=ie("chrome"),lg=ie("ff"),pg=ie("safari"),mu="esri-view-surface",ps={touchNone:`${mu}--touch-none`,touchPan:`${mu}--touch-pan`},fu=(()=>{class e{constructor(i,s){this._input=s,this._active={},this._callback=()=>{},this._activePointerCaptures=new Set,this._keyDownState=new Set,this._eventId=1,this._browserTouchPanningEnabled=!1,this._element=i,i.getAttribute("tabindex")||i.setAttribute("tabindex","0"),this._eventHandlers={"key-down":this._handleKey,"key-up":this._handleKey,"pointer-down":this._handlePointer,"pointer-move":this._handlePointerPreventDefault,"pointer-up":this._handlePointerPreventDefault,"pointer-enter":this._handlePointer,"pointer-leave":this._handlePointer,"pointer-cancel":this._handlePointer,"mouse-wheel":this._handleMouseWheel,"pointer-capture-lost":this._handlePointerCaptureLost},this._updateTouchAction(),this._element.addEventListener("keydown",this._preventAltKeyDefault),this._gamepadSource=new gr(i,this._input),this._gamepadSource.onEvent=o=>this._callback("gamepad",o)}destroy(){this._callback=()=>{},this.activeEvents=null,this._activePointerCaptures.forEach(i=>{this._releasePointerCaptureSafe(i)}),this._gamepadSource=oe(this._gamepadSource),this._activePointerCaptures=null,this._removeTouchAction(),this._element.removeEventListener("keydown",this._preventAltKeyDefault)}get browserTouchPanningEnabled(){return this._browserTouchPanningEnabled}set browserTouchPanningEnabled(i){this._browserTouchPanningEnabled=i,this._updateTouchAction(),this._updateTouchEventHandling()}set onEventReceived(i){this._callback=i}set activeEvents(i){for(let s in this._active)if(!i||!i.has(s)){let o=this._active[s];this._element.removeEventListener(Pa[s],o),delete this._active[s]}i&&i.forEach(s=>{if(!this._active[s]&&Pa[s]){let o=(this._eventHandlers[s]||this._handleDefault).bind(this,s);this._element.addEventListener(Pa[s],o),this._active[s]=o}}),this._gamepadSource.hasEventListeners=i?.has("gamepad")??!1}setPointerCapture(i,s){s?this._setPointerCatpureSafe(i.pointerId):(this._releasePointerCaptureSafe(i.pointerId),this._activePointerCaptures.delete(i.pointerId))}_updateTouchAction(){this._element.classList.remove(this._browserTouchPanningEnabled?ps.touchNone:ps.touchPan),this._element.classList.add(this._browserTouchPanningEnabled?ps.touchPan:ps.touchNone)}_updateTouchEventHandling(){this._browserTouchPanningEnabled?this._element.addEventListener("touchmove",this._preventMultiTouchPanning):this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_removeTouchAction(){this._element.classList.remove(ps.touchNone),this._element.classList.remove(ps.touchPan),this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_setPointerCatpureSafe(i){try{this._element.setPointerCapture(i),this._activePointerCaptures.add(i)}catch{}}_releasePointerCaptureSafe(i){try{if(this._element.hasPointerCapture&&!this._element.hasPointerCapture(i))return;this._element.releasePointerCapture(i)}catch{}}_updateNormalizedPointerLikeEvent(i,s){let o=ra(this._element,i);return e.test.disableSubpixelCoordinates&&(o.x=Math.round(o.x),o.y=Math.round(o.y)),s.x=o.x,s.y=o.y,s}_handleKey(i,s){let{key:o}=s;o&&i==="key-up"&&this._keyDownState.delete(o);let r={native:s,key:o,repeat:!!o&&this._keyDownState.has(o)};o&&i==="key-down"&&this._keyDownState.add(r.key),this._callback(i,r)}_handlePointer(i,s){let o=this._updateNormalizedPointerLikeEvent(s,{native:s,x:0,y:0,pointerType:s.pointerType,button:s.button,buttons:s.buttons,eventId:this._eventId++});this._callback(i,o)}_handlePointerPreventDefault(i,s){let o=this._updateNormalizedPointerLikeEvent(s,{native:s,x:0,y:0,pointerType:s.pointerType,button:s.button,buttons:s.buttons,eventId:this._eventId++});s.preventDefault(),this._callback(i,o)}_handleMouseWheel(i,s){let o=s.deltaY;switch(s.deltaMode){case 0:uu&&(o=o/document.documentElement.clientHeight*600);break;case 1:o*=30;break;case 2:o*=900}uu?o*=.7:ag||pg?o*=.6:lg&&(o*=1.375);let r=100,n=Math.abs(o);n>r&&(o=o/n*200/(1+Math.exp(-.02*(n-r))));let p=this._updateNormalizedPointerLikeEvent(s,{native:s,x:0,y:0,deltaY:o});this._callback(i,p)}_handlePointerCaptureLost(i,s){this._activePointerCaptures.delete(s.pointerId),this._handleDefault(i,s)}_handleDefault(i,s){let o={native:s};s.preventDefault(),this._callback(i,o)}_preventAltKeyDefault(i){i.key==="Alt"&&i.preventDefault()}_preventMultiTouchPanning(i){i.touches.length>1&&i.preventDefault()}}return e.test={disableSubpixelCoordinates:!1},e})(),Pa={"key-down":"keydown","key-up":"keyup","pointer-down":"pointerdown","pointer-up":"pointerup","pointer-move":"pointermove","mouse-wheel":"wheel","pointer-capture-got":"gotpointercapture","pointer-capture-lost":"lostpointercapture","context-menu":"contextmenu","pointer-enter":"pointerenter","pointer-leave":"pointerleave","pointer-cancel":"pointercancel",focus:"focus",blur:"blur"};var yr=class extends B{constructor(){super(!0),this.registerIncoming("context-menu",t=>{t.data.native.preventDefault()})}};var de={maximumClickDelay:300,movementUntilMouseDrag:1.5,movementUntilPenDrag:6,movementUntilTouchDrag:6,holdDelay:500,maximumDoubleClickDelay:250,maximumDoubleClickDistance:10,maximumDoubleTouchDelay:350,maximumDoubleTouchDistance:35};function _i(e,t){return Math.abs(t.x-e.x)+Math.abs(t.y-e.y)}function gu(e,t){let i=t.x-e.x,s=t.y-e.y;return Math.sqrt(i*i+s*s)}function yu(e,t){if(t?(t.radius=0,t.center.x=0,t.center.y=0):t={radius:0,center:X()},e.length===0)return t;if(e.length===1)return t.center.x=e[0].x,t.center.y=e[0].y,t;if(e.length===2){let[g,M]=e,[k,H]=[M.x-g.x,M.y-g.y];return t.radius=Math.sqrt(k*k+H*H)/2,t.center.x=(g.x+M.x)/2,t.center.y=(g.y+M.y)/2,t}let i=0,s=0;for(let g=0;g<e.length;g++)i+=e[g].x,s+=e[g].y;i/=e.length,s/=e.length;let o=e.map(g=>g.x-i),r=e.map(g=>g.y-s),n=0,p=0,c=0,d=0,h=0,m=0,f=0;for(let g=0;g<o.length;g++){let M=o[g],k=r[g],H=M*M,G=k*k;n+=H,p+=G,c+=M*k,d+=H*M,h+=G*k,m+=M*G,f+=k*H}let w=.5*(d+m),S=.5*(h+f),T=n*p-c*c,F=(w*p-S*c)/T,b=(n*S-c*w)/T,L=X(F+i,b+s);return{radius:Math.sqrt(F*F+b*b+(n+p)/e.length),center:L}}function yt(e){let{native:t}=e,{pointerId:i,button:s,pointerType:o}=t;return o==="mouse"?`${i}:${s}`:`${o}`}var vr=class extends B{constructor(t=de.maximumDoubleClickDelay,i=de.maximumDoubleClickDistance,s=de.maximumDoubleTouchDelay,o=de.maximumDoubleTouchDistance,r=ot){super(!1),this._maximumDoubleClickDelay=t,this._maximumDoubleClickDistance=i,this._maximumDoubleTouchDelay=s,this._maximumDoubleTouchDistance=o,this._clock=r,this._doubleTapDragReady=!1,this._doubleTapDragActive=!1,this._dragStartCenter=X(0,0),this._pointerState=new Map,this._doubleTapDrag=this.registerOutgoing("double-tap-drag"),this._dragEventSeparator=new gt({start:(n,p)=>this._dragStart(n,p),update:(n,p)=>this._dragUpdate(p),end:(n,p)=>this._dragEnd(p)}),this.registerIncoming("drag",n=>this._dragEventSeparator.handle(n)),this.registerIncoming("pointer-down",n=>this._handlePointerDown(n)),this.registerIncoming("pointer-up",()=>this._handlePointerUp())}onUninstall(){this._pointerState.forEach(t=>{t.doubleTapTimeout=ue(t.doubleTapTimeout)})}get hasPendingInputs(){return Ht(this._pointerState,t=>t.doubleTapTimeout!=null)}_clearPointerDown(t){let i=this._pointerState.get(t);i&&(i.doubleTapTimeout=ue(i.doubleTapTimeout),this._pointerState.delete(t),this.refreshHasPendingInputs())}_dragStart(t,i){if(!this._doubleTapDragReady||t!==1)return;this._doubleTapDragReady=!1,this._doubleTapDragActive=!0;let{data:s,modifiers:o}=i,{center:r}=s;this._dragStartCenter=r;let n=ka("begin",X(0,0),s);this._doubleTapDrag.emit(n,void 0,o),i.stopPropagation()}_dragUpdate(t){if(!this._doubleTapDragActive)return;let{data:i,modifiers:s}=t,{center:o}=i,r=ka("update",X(o.x-this._dragStartCenter.x,o.y-this._dragStartCenter.y),i);this._doubleTapDrag.emit(r,void 0,s),t.stopPropagation()}_dragEnd(t){if(!this._doubleTapDragActive)return;let{data:i,modifiers:s}=t,{center:o}=i,r=ka("end",X(o.x-this._dragStartCenter.x,o.y-this._dragStartCenter.y),i);this._doubleTapDrag.emit(r,void 0,s),this._doubleTapDragActive=!1,t.stopPropagation()}_handlePointerDown(t){let{data:i}=t,s=yt(i),o=this._pointerState.get(s),{pointerType:r}=i.native;if(o){let n=r==="touch"?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;this._clearPointerDown(s),_i(o.event.data,i)>n?this._storePointerDown(t):this._doubleTapDragReady=!0}else this._storePointerDown(t)}_handlePointerUp(){this._doubleTapDragReady=!1}_storePointerDown(t){let{data:i}=t,{pointerType:s}=i.native,o=yt(i),r=s==="touch"?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay,n=this._clock.setTimeout(()=>this._clearPointerDown(o),r);this._pointerState.set(o,{event:t,doubleTapTimeout:n}),this.refreshHasPendingInputs()}};function ka(e,t,i){let{button:s,buttons:o,pointer:r,pointers:n,pointerType:p,timestamp:c}=i;return{action:e,delta:t,button:s,buttons:o,pointer:r,pointers:n,pointerType:p,timestamp:c}}var br=class extends B{constructor(t){super(!1),this._navigationTouch=t,this._startStateModifiers=new Set,this._activePointerMap=new Map,this._isDragging=!1,this._isCurrentDragSuppressed=!1,this._drag=this.registerOutgoing("drag"),this.registerIncoming("pointer-drag",this._handlePointerDrag.bind(this)),this.registerIncoming("pointer-up",this._handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-capture-lost",this._handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-cancel",this._handlePointerUpAndPointerLost.bind(this))}_createPayload(t,i,s,o){return{action:t,pointerType:this._pointerType,button:this._mouseButton,buttons:i.buttons,timestamp:o,pointers:cg(this._activePointerMap),pointer:i,angle:s.angle,radius:s.radius,center:s.center}}_addPointer(t){let i=t.native.pointerId,s=wr(this._activePointerMap).angle,o={event:t,initialAngle:0,lastAngle:0};this._activePointerMap.set(i,o);let r=_r(o,wu(this._activePointerMap));o.initialAngle=r,o.lastAngle=r,this._updatePointerAngles(s)}_updatePointer(t){if(t&&t.x==null&&t.y==null)return;let i=t.native.pointerId,s=this._activePointerMap.get(i);s?s.event=t:this._addPointer(t)}_removePointer(t){let i=wr(this._activePointerMap).angle;this._activePointerMap.delete(t),this._updatePointerAngles(i)}_updatePointerAngles(t){let i=wr(this._activePointerMap);this._activePointerMap.forEach(s=>{s.initialAngle=_r(s,i)-t,s.lastAngle=_r(s,i)-t})}_emitEvent(t,i,s){let o=wr(this._activePointerMap);this._drag.emit(this._createPayload(t,i,o,s),void 0,this._startStateModifiers)}_handlePointerUpAndPointerLost(t){let i=t.data.native.pointerId,s=t.timestamp;this._activePointerMap.get(i)&&(this._activePointerMap.size===1?(this._updatePointer(t.data),!this._isCurrentDragSuppressed&&this._emitEvent("end",t.data,s),this._isDragging=!1,this._isCurrentDragSuppressed=!1,this._removePointer(i)):(this._removePointer(i),this._emitEvent("removed",t.data,t.timestamp)))}_handlePointerDrag(t){let i=t.data,s=i.currentEvent,o=t.timestamp;switch(i.action){case"start":case"update":this._isDragging?this._activePointerMap.has(s.native.pointerId)?(this._updatePointer(s),!this._isCurrentDragSuppressed&&this._emitEvent("update",s,o)):(this._addPointer(s),this._emitEvent("added",s,o),this._isCurrentDragSuppressed=this._isSuppressed):(this._updatePointer(s),this._pointerType=t.data.startEvent.pointerType,this._mouseButton=t.data.startEvent.button,this._startStateModifiers=t.modifiers,this._isDragging=!0,this._isCurrentDragSuppressed=this._isSuppressed,!this._isCurrentDragSuppressed&&this._emitEvent("start",s,o))}}get _isSuppressed(){return!!this._navigationTouch&&!this._navigationTouch.browserTouchPanEnabled&&this._pointerType==="touch"&&this._activePointerMap.size===1}};function wu(e){let t=[];return e.forEach(i=>{t.push(X(i.event.x,i.event.y))}),yu(t)}function wr(e){let t=wu(e),i=0;return e.forEach(s=>{let o=_r(s,t),r=o-s.lastAngle;for(;r>Math.PI;)r-=2*Math.PI;for(;r<-Math.PI;)r+=2*Math.PI;o=s.lastAngle+r,s.lastAngle=o;let n=o-s.initialAngle;i+=n}),i/=e.size||1,{angle:i,radius:t.radius,center:t.center}}function cg(e){let t=new Map;return e.forEach((i,s)=>t.set(s,i.event)),t}function _r(e,t){let i=e.event,s=i.x-t.center.x,o=i.y-t.center.y;return Math.atan2(o,s)}var vu;(function(e){e[e.Left=0]="Left",e[e.Middle=1]="Middle",e[e.Right=2]="Right",e[e.Back=3]="Back",e[e.Forward=4]="Forward",e[e.Undefined=-1]="Undefined"})(vu||(vu={}));var Sr=class extends B{constructor(t=de.maximumDoubleClickDelay,i=de.maximumDoubleClickDistance,s=de.maximumDoubleTouchDelay,o=de.maximumDoubleTouchDistance,r=ot){super(!1),this._maximumDoubleClickDelay=t,this._maximumDoubleClickDistance=i,this._maximumDoubleTouchDelay=s,this._maximumDoubleTouchDistance=o,this._clock=r,this._pointerState=new Map,this._immediateDoubleClick=this.registerOutgoing("immediate-double-click"),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this)),this.registerIncoming("pointer-up",this._handlePointerUp.bind(this))}onUninstall(){this._pointerState.forEach(t=>{t.immediateDoubleClick&&t.immediateDoubleClick.timeoutHandle.remove()}),super.onUninstall()}_handlePointerDown(t){let i=t.data,s=yt(i);if(!this._pointerState.has(s)){let o={downButton:i.native.button,x:i.x,y:i.y,immediateDoubleClick:null};this._pointerState.set(s,o),this.startCapturingPointer(i.native)}}_handlePointerUp(t){let i=t.data,s=yt(i),o=this._pointerState.get(s);if(o&&o.downButton===i.native.button){let r=o.immediateDoubleClick,n=t.data.native.pointerType==="touch"?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;r?(r.timeoutHandle.remove(),_i(r,t.data)>n?this._startImmediateDoubleClick(t,o):(this._immediateDoubleClick.emit(t.data,void 0,r.modifiers),this._removeState(i))):_i(o,t.data)>n?this._removeState(i):this._startImmediateDoubleClick(t,o)}}_startImmediateDoubleClick(t,i){let s=t.data.native.pointerType==="touch"?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay;i.immediateDoubleClick={x:t.data.x,y:t.data.y,modifiers:t.modifiers,timeoutHandle:this._clock.setTimeout(()=>this._removeState(t.data),s)}}_removeState(t){let i=yt(t);this._pointerState.delete(i),this.stopCapturingPointer(t.native),this.refreshHasPendingInputs()}};var Cr=class extends B{constructor(t=de.maximumClickDelay,i=de.movementUntilMouseDrag,s=de.movementUntilPenDrag,o=de.movementUntilTouchDrag,r=de.holdDelay,n=ot){super(!1),this._maximumClickDelay=t,this._movementUntilMouseDrag=i,this._movementUntilPenDrag=s,this._movementUntilTouchDrag=o,this._holdDelay=r,this._clock=n,this._pointerState=new Map,this._pointerDrag=this.registerOutgoing("pointer-drag"),this._immediateClick=this.registerOutgoing("immediate-click"),this._pointerHold=this.registerOutgoing("hold"),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this)),this.registerIncoming("pointer-up",p=>{this._handlePointerLoss(p,"pointer-up")}),this.registerIncoming("pointer-capture-lost",p=>{this._handlePointerLoss(p,"pointer-capture-lost")}),this.registerIncoming("pointer-cancel",p=>{this._handlePointerLoss(p,"pointer-cancel")}),this._moveHandle=this.registerIncoming("pointer-move",this._handlePointerMove.bind(this)),this._moveHandle.pause()}onUninstall(){this._pointerState.forEach(t=>{t.holdTimeout=ue(t.holdTimeout)}),super.onUninstall()}_handlePointerDown(t){let i=t.data,s=i.native.pointerId,o=null;this._pointerState.size===0&&(o=this._clock.setTimeout(()=>{let n=this._pointerState.get(s);if(n){if(!n.isDragging){let p=n.previousEvent;this._pointerHold.emit(p,void 0,t.modifiers),n.holdEmitted=!0}n.holdTimeout=null}},this._holdDelay));let r={startEvent:i,previousEvent:i,startTimestamp:t.timestamp,isDragging:!1,downButton:i.native.button,holdTimeout:o,modifiers:new Set};this._pointerState.set(s,r),this.startCapturingPointer(i.native),this._moveHandle.resume(),this._pointerState.size>1&&this._startDragging(t)}_handlePointerMove(t){let i=t.data,s=i.native.pointerId,o=this._pointerState.get(s);o&&(o.isDragging?this._pointerDrag.emit(xr("update",o,i),void 0,o.modifiers):gu(i,o.startEvent)>this._getDragThreshold(i.native.pointerType)&&this._startDragging(t),o.previousEvent=i)}_getDragThreshold(t){switch(t){case"touch":return this._movementUntilTouchDrag;case"pen":return this._movementUntilPenDrag;default:return this._movementUntilMouseDrag}}_startDragging(t){let i=t.data,s=i.native.pointerId;this._pointerState.forEach(o=>{o.holdTimeout!=null&&(o.holdTimeout.remove(),o.holdTimeout=null),o.isDragging||(o.modifiers=t.modifiers,o.isDragging=!0,s===o.startEvent.native.pointerId?this._pointerDrag.emit(xr("start",o,i)):this._pointerDrag.emit(xr("start",o,o.previousEvent),t.timestamp))})}_handlePointerLoss(t,i){let s=t.data,o=s.native.pointerId,r=this._pointerState.get(o);r&&(r.holdTimeout!=null&&(r.holdTimeout.remove(),r.holdTimeout=null),r.isDragging?this._pointerDrag.emit(xr("end",r,i==="pointer-up"?s:r.previousEvent),void 0,r.modifiers):i==="pointer-up"&&r.downButton===s.native.button&&t.timestamp-r.startTimestamp<=this._maximumClickDelay&&!r.holdEmitted&&this._immediateClick.emit(s),this._pointerState.delete(o),this.stopCapturingPointer(s.native),this._pointerState.size===0&&this._moveHandle.pause())}};function xr(e,t,i){return{action:e,startEvent:t.startEvent,previousEvent:t.previousEvent,currentEvent:i}}var Tr=class extends B{constructor(t=de.maximumDoubleClickDelay,i=de.maximumDoubleClickDistance,s=de.maximumDoubleTouchDelay,o=de.maximumDoubleTouchDistance,r=ot){super(!1),this._maximumDoubleClickDelay=t,this._maximumDoubleClickDistance=i,this._maximumDoubleTouchDelay=s,this._maximumDoubleTouchDistance=o,this._clock=r,this._pointerState=new Map,this._click=this.registerOutgoing("click"),this._doubleClick=this.registerOutgoing("double-click"),this.registerIncoming("immediate-click",this._handleImmediateClick.bind(this)),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this))}onUninstall(){this._pointerState.forEach(t=>t.doubleClickTimer=ue(t.doubleClickTimer))}get hasPendingInputs(){return Ht(this._pointerState,t=>t.doubleClickTimer!=null)}_clearDoubleClickTimer(t,i){let s=this._pointerState.get(t);s&&(s.doubleClickTimer=ue(s.doubleClickTimer),i&&this._click.emit(s.event.data,void 0,s.event.modifiers),this._pointerState.delete(t),this.refreshHasPendingInputs())}_doubleClickTimeoutExceeded(t){let i=this._pointerState.get(t);i.pointerDownCount===1&&this._click.emit(i.event.data,void 0,i.event.modifiers),i.doubleClickTimer=null,this._pointerState.delete(t),this.refreshHasPendingInputs()}_handleImmediateClick(t){let i=t.data,{pointerType:s}=i.native,o=dg(i);if(!this._pointerState.has(o))return void this._startClick(t);let r=this._pointerState.get(o),{data:n,modifiers:p}=r.event,c=s==="touch"?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;_i(n,i)>c?(this._clearDoubleClickTimer(o,!0),this._startClick(t)):(this._clearDoubleClickTimer(o,!1),r.pointerDownCount===2&&this._doubleClick.emit(n,void 0,p))}_handlePointerDown(t){let i=yt(t.data),s=this._pointerState.get(i);s&&(s.pointerDownCount+=1)}_startClick(t){let{data:i}=t,{native:{pointerType:s}}=i,o=yt(i),r=s==="touch"?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay,n=this._clock.setTimeout(()=>this._doubleClickTimeoutExceeded(o),r);this._pointerState.set(o,{event:t,doubleClickTimer:n,pointerDownCount:1}),this.refreshHasPendingInputs()}};function dg(e){let{pointerId:t,pointerType:i,button:s}=e.native;return i==="mouse"?`${t}:${s}`:`${i}`}var Lr={counter:"Control",pan:{left:"ArrowLeft",right:"ArrowRight",up:"ArrowUp",down:"ArrowDown"},zoom:{zoomIn:["=","+"],zoomOut:["-","_"]},rotate:{clockwiseOption1:"a",clockwiseOption2:"A",counterClockwiseOption1:"d",counterClockwiseOption2:"D",resetOption1:"n",resetOption2:"N"}},bi=class extends C{initialize(){let e=()=>this.view?.ready;this.addHandles([le(()=>!e(),()=>this._disconnect()),le(e,()=>this._connect())])}destroy(){this._disconnect()}get latestPointerType(){return this._inputManager?.latestPointerType}get latestPointerLocation(){return this._inputManager?.latestPointerLocation}get multiTouchActive(){return this._inputManager?.multiTouchActive??!1}isModifierKeyDown(e){return this._inputManager?.isModifierKeyDown(e)??!1}_disconnect(){this.view.viewEvents.disconnect(),this._inputManager=oe(this._inputManager)}_connect(){let e=this.view.surface,t=new fu(e,this.view.input),i=[new Sr,new Cr,new Tr,new br(this.view.navigation),new vr],s=new Rc({eventSource:t,recognizers:i});s.installHandlers("prevent-context-menu",[new yr],xt.INTERNAL),s.installHandlers("navigation",[new fr(this.view),new pr(this.view),new mr(this.view),new qs(this.view),new qs(this.view,[Lr.counter]),new ar(this.view,"primary"),new dr(this.view,Lr.pan),new ur(this.view,Lr.zoom),new hr(this.view,Lr.rotate),new lr(this.view,"secondary"),new nr(this.view,"touch")],xt.INTERNAL),this.view.viewEvents.connect(s),this._source=t,this._inputManager=s,_(()=>this.view?.navigation?.browserTouchPanEnabled,o=>{this._source&&(this._source.browserTouchPanningEnabled=!o)},O)}get test(){}};a([l()],bi.prototype,"view",void 0),a([l()],bi.prototype,"latestPointerType",null),a([l()],bi.prototype,"latestPointerLocation",null),a([l()],bi.prototype,"multiTouchActive",null),bi=a([y("esri.views.2d.input.MapViewInputManager")],bi);var _u=bi;var Si={added:[],removed:[]},Ra=new Set,hg=new Dp(0,0,0,0);function ug(e,t){let i=Il(t);if(!i)return null;let[s,o]=i.valid;return e[2]>o?[Ne([e[0],e[1],o,e[3]]),Ne([s,e[1],s+e[2]-o,e[3]])]:e[0]<s?[Ne([s,e[1],e[2],e[3]]),Ne([o-(s-e[0]),e[1],o,e[3]])]:null}var Mr=class extends Le{constructor(t){super(),this._tiles=new Map,this._index=Bp(9,ie("esri-csp-restrictions")?i=>({minX:i.bounds[0],minY:i.bounds[1],maxX:i.bounds[2],maxY:i.bounds[3]}):[".bounds[0]",".bounds[1]",".bounds[2]",".bounds[3]"]),this.tiles=[],this.tileScheme=t}destroy(){this.clear()}clear(){this.tiles.length=0,this._tiles.clear(),this._index.clear()}has(t){return this._tiles.has(t)}get(t){return this._tiles.get(t)}getIntersectingTiles(t){if(!t||Zl(t)===0||ql(t)===0)return[];let i=ug(t,this.tileScheme.spatialReference);return i!=null?[...new Set([...this.boundsIntersections(i[0]),...this.boundsIntersections(i[1])])]:this.boundsIntersections(t)}boundsIntersections(t){return this._index.search({minX:t[0],minY:t[1],maxX:t[2],maxY:t[3]})}updateTiles(t){let i={added:[],removed:[]};for(let s of t.added)if(!this.has(s)){let o=new ln(this.tileScheme,s);this._tiles.set(s,o),this._index.insert(o),i.added.push(o)}for(let s of t.removed)if(this.has(s)){let o=this.get(s);this._tiles.delete(s),this._index.remove(o),i.removed.push(o)}this.tiles.length=0,this._tiles.forEach(s=>this.tiles.push(s)),(i.added.length||i.removed.length)&&this.emit("update",i)}setViewState(t){let i=this.tileScheme.getTileCoverage(t,0);if(!i)return;let{spans:s,lodInfo:o}=i,{level:r}=o;if(s.length>0)for(let{row:n,colFrom:p,colTo:c}of s)for(let d=p;d<=c;d++){let h=hg.set(r,n,o.normalizeCol(d),o.getWorldForColumn(d)).id;if(Ra.add(h),!this.has(h)){let m=new ln(this.tileScheme,h);this._tiles.set(h,m),this._index.insert(m),this.tiles.push(m),Si.added.push(m)}}for(let n=this.tiles.length-1;n>=0;n--){let p=this.tiles[n];Ra.has(p.id)||(this._tiles.delete(p.id),this.tiles.splice(n,1),this._index.remove(p),Si.removed.push(p))}(Si.added.length||Si.removed.length)&&this.emit("update",Si),Vp.pool.release(i),Ra.clear(),Si.added.length=0,Si.removed.length=0}};function xu(e,t,i){return v(this,null,function*(){let s=Yo(t)?Ko(e,t):t;if(!e.ready||isNaN(s.x)||isNaN(s.y))return{screenPoint:s,results:[]};let o=new Set,r=new Set,n=!1,p=null,c=null;i?.include?Su(i.include,bu(e,f=>{o.add(f),Da(f,w=>r.add(w))},(f,w)=>{r.add(f),o.add(w)},f=>{p||(p=new Set),p.add(f)},f=>o.add(f),()=>n=!0)):(n=!0,o=new Set(e.allLayerViews),o.forEach(f=>{Da(f,w=>r.add(w))})),i?.exclude&&Su(i.exclude,bu(e,f=>{o.delete(f),Da(f,w=>r.delete(w))},f=>r.delete(f),f=>{c||(c=new Set),c.add(f)}));let d=e.toMap(s),h=e.allLayerViews.filter(f=>!f.suspended&&o.has(f)&&f.clips.every(w=>Jc(e,w,s,d))).reverse(),m=[...n?e.graphicsView.hitTest(d).map(f=>({type:"graphic",graphic:f,layer:null,mapPoint:d})):[],...yield Promise.all(h.map(f=>f.hitTest(d,s)).toArray())].filter(we).flat().filter(we);return m=m.filter(f=>f.type!=="graphic"||f.layer?.type!=="subtype-group"||r.has(f.graphic.layer)),p&&(m=m.filter(f=>!("graphic"in f)||!f.graphic||p?.has(Va(f.graphic)))),c&&(m=m.filter(f=>!("graphic"in f)||!f.graphic||!c?.has(Va(f.graphic)))),{screenPoint:s,results:m}})}function bu(e,t,i,s,o,r){return n=>{if(n instanceof yo){if(n.layer===e)r?.();else{let p=e.allLayerViews.find(c=>c.layer===n.layer);p&&o?.(p)}s(Va(n))}else if(!("layer"in n&&"element"in n))if(n.type==="subtype-sublayer"){let p=e.allLayerViews.find(c=>c.layer===n.parent);p&&i(n,p)}else{let p=e.allLayerViews.find(c=>c.layer===n);p&&t(p)}}}function Su(e,t){if(e)if(Nr(e))for(let i of e)if(Nr(i))for(let s of i)t(s);else t(i);else t(e)}function Va(e){let t=e.getObjectId();return t?`${e.layer?.uid??e.sourceLayer?.uid??"MapView"}/${t}`:`"MapView/${e.uid}`}function Da({layer:e},t){e?.type==="subtype-group"&&e.sublayers.forEach(i=>{t(i)})}var Cu={flipY:!0,premultipliedAlpha:!0};function Tu(e,t){return v(this,null,function*(){let i=yield Mu(e,t),{format:s,quality:o}=Qc(t?.format,t?.quality);return Kc(i,{format:s,quality:o,rotation:0,disableDecorations:!1},Cu)})}function Lu(e,t){return v(this,null,function*(){let i=yield Mu(e,t);return Yc(i,Cu)})}function Mu(e,t){let i=gg(t||{},fg(e.stage,e.size),e.size,e.padding),s=mg(t,e.allLayerViews);return e.stage.takeScreenshot(i,s,e.backgroundColor,t?.rotation)}function mg(e={},t){if(!e.layers)return;let i=[];return e.layers.forEach(s=>{let o=t.find(r=>r.layer.id===s.id);o?.container&&i.push(o.container)}),i}function fg(e,t){return Math.min(4,Xc(t,Math.min(4096,e.context.parameters.maxTextureSize)))}function gg(e,t,i,s){e.ignorePadding&&(s={left:0,right:0,top:0,bottom:0});let o=null;e.width!=null&&e.height!=null?o=[e.width,e.height]:e.width==null&&e.height!=null?o=[e.height,e.height]:e.width!=null&&e.height==null?o=[e.width,e.width]:e.width==null&&e.height==null&&(o=null);let r=i[0]-(s.left+s.right),n=i[1]-(s.top+s.bottom),p,c,d=e.area||{x:0,y:0,width:r,height:n};if(o){let h=r/n,m=o[0]/o[1];if(m>h){let f=d.width/m;d={x:d.x,y:Math.round(d.y+(d.height-f)/2),width:d.width,height:Math.round(f)}}else{let f=d.height*m;d={x:Math.round(d.x+(d.width-f)/2),y:d.y,width:Math.round(f),height:d.height}}}else o=[d.width,d.height];return o[0]>d.width?(p=Math.min(o[0]/d.width,t),c=o[0]/d.width/p):(p=1,c=o[0]/d.width),{cropArea:{x:Math.round((d.x+s.left)*p),y:Math.round((d.y+s.top)*p),width:Math.round(d.width*p),height:Math.round(d.height*p)},outputScale:c,resolutionScale:p}}var Iu=160,cs=class extends C{constructor(){super(...arguments),this._timer=void 0}get stationary(){return!this._timer}flip(){this._timestamp=performance.now(),this._timer==null&&(this._timer=setInterval(()=>{performance.now()-this._timestamp>=Iu&&this.clear()},Iu))}clear(){this._timer&&(clearInterval(this._timer),this._timer=void 0)}};a([l()],cs.prototype,"_timer",void 0),a([l()],cs.prototype,"stationary",null),cs=a([y("esri.views.2d.support.StationaryManager")],cs);function Eu(e){let t=rc();return t.available?e==="3d"&&t.majorPerformanceCaveat?new x("webgl:major-performance-caveat-detected","Your WebGL implementation doesn't seem to support hardware accelerated rendering. Check your browser settings or if your GPU is in a blocklist."):t.supportsHighPrecisionFragment?t.supportsVertexShaderSamplers?null:new x("webgl:vertex-shader-samplers-required","WebGL support for vertex shader samplers is required but not supported."):new x("webgl:high-precision-fragment-required","WebGL support for high precision fragment shaders is required but not supported."):new x("webgl:required","WebGL2 is required but not supported.",new Error().stack)}function yg(e){return e&&"nodeType"in e}function vg(e){return e&&typeof e.render=="function"}var Pu={component:"esri-component"},xi=class extends C{constructor(){super(...arguments),this.widget=null}destroy(){this.node=null,this.widget?.destroy()}get id(){return this._get("id")??this.widget?.id??this.node?.id}set id(e){this._set("id",e)}set node(e){let t=this._get("node");e!==t&&(e&&e.classList.add(Pu.component),t&&t.classList.remove(Pu.component),this._set("node",e))}castNode(e){return this.widget?.destroy(),e?typeof e=="string"||yg(e)?(this._set("widget",null),oo(e)):(vg(e)&&!e.domNode&&(e.domNode=document.createElement("div")),this._set("widget",e),e.domNode):(this._set("widget",null),null)}};a([l()],xi.prototype,"id",null),a([l()],xi.prototype,"node",null),a([ge("node")],xi.prototype,"castNode",null),a([l({readOnly:!0})],xi.prototype,"widget",void 0),xi=a([y("esri.views.ui.Component")],xi);var ds=xi;var wg={left:0,top:0,bottom:0,right:0},ku={bottom:30,top:15,right:15,left:15},At="esri-ui",Re={ui:At,corner:`${At}-corner`,innerContainer:`${At}-inner-container`,manualContainer:`${At}-manual-container`,cornerContainer:`${At}-corner-container`,topLeft:`${At}-top-left`,topRight:`${At}-top-right`,bottomLeft:`${At}-bottom-left`,bottomRight:`${At}-bottom-right`};function _g(e){return e&&!e._started&&typeof e.postMixInProperties=="function"&&typeof e.buildRendering=="function"&&typeof e.postCreate=="function"&&typeof e.startup=="function"}function Ir(e){return e===0?"0":`${e}px`}function Aa(e){let t=typeof e=="object"&&e!==null&&Object.getPrototypeOf(e);return(t===null||t===Object.prototype)&&("component"in e||"index"in e||"position"in e)?e:null}function za(e,{top:t,bottom:i,left:s,right:o}){e.style.top=t,e.style.bottom=i,e.style.left=s,e.style.right=o}var vt=class extends Le.EventedAccessor{constructor(e){super(e),this._cornerNameToContainerLookup={},this._positionNameToContainerLookup={},this._components=new Array,this._componentMap=new Map,this._removeWidgetHandleKey=Symbol("componentOnRemoveSymbol"),this._locale=ri(),this.view=null,this._applyViewPadding=()=>{let t=this.container;t&&za(t,this._toPixelPosition(this._getViewPadding()))},this._applyUIPadding=()=>{let t=this._innerContainer;t&&za(t,this._toPixelPosition(this.padding))},this._initContainers()}initialize(){this.addHandles([_(()=>[this.view?.padding,this.container],this._applyViewPadding,O),_(()=>this.padding,this._applyUIPadding,O),_(()=>[this.container,this._locale],([e,t])=>{e&&e.setAttribute("lang",t)},O),Pi(e=>{this._locale=e})])}destroy(){this.container=null;for(let e of this._components)e.destroy();this._components.length=0,this._componentMap.clear()}set container(e){let t=this._get("container");e!==t&&(e&&(e.classList.add(Re.ui),Cl(e),this._attachContainers(e)),t&&(t.classList.remove(Re.ui),za(t,{top:"",bottom:"",left:"",right:""}),ro(t)),this._set("container",e))}get height(){let e=this.view?.height??0;if(e===0)return e;let t=this._getViewPadding(),{top:i,bottom:s}=t;return Math.max(e-i-s,0)}get padding(){return this._get("padding")}set padding(e){this._overrideIfSome("padding",e)}castPadding(e){return typeof e=="number"?{bottom:e,top:e,right:e,left:e}:A(A({},ku),e)}get width(){let e=this.view?.width??0;if(e===0)return e;let t=this._getViewPadding(),{left:i,right:s}=t;return Math.max(e-i-s,0)}add(e,t){let i,s,o;if(Array.isArray(e))return void e.forEach(n=>this.add(n,t));let r=Aa(e);r&&({index:i,position:t,component:e,key:s}=r),t&&typeof t=="object"&&({index:i,key:s,position:t,internal:o}=t),!e||t&&!this._isValidPosition(t)||this._add(e,t,i,s,o)}remove(e,t){if(!e)return;if(Array.isArray(e))return e.map(s=>this.remove(s,t));let i=this._find(e);if(i){if(this._componentMap.has(i)&&this._componentMap.get(i)?.key!==t)return;let s=this._components.indexOf(i);return i.node.parentNode?.removeChild(i.node),this._componentMap.delete(i),i.widget?.removeHandlesReference(this._removeWidgetHandleKey),this._components.splice(s,1)[0]}}empty(e,t={removeInternal:!1}){if(Array.isArray(e)){for(let o of e)this.empty(o,t);return}let i=this._positionNameToContainerLookup[e??"manual"],s=Array.prototype.slice.call(i.children).map(o=>this._findByNode(o)).filter(o=>o==null?!1:!(this._componentMap.get(o)?.internal??!1)||t.removeInternal);for(let o of s)this.remove(o)}move(e,t){if(Array.isArray(e)&&e.forEach(r=>this.move(r,t)),!e)return;let i,s=Aa(e)||Aa(t);if(s&&(i=s.index,t=s.position,e=s.component||e),t&&!this._isValidPosition(t))return;let o=this.remove(e);o&&this.add(o,{position:t,index:i})}find(e){if(!e)return null;let t=this._findById(e);return t&&(t.widget||t.node)}getComponents(e,t={includeInternal:!1}){return e?Array.isArray(e)?e.flatMap(i=>this._getComponentsAtPosition(i,t)):this._getComponentsAtPosition(e,t):this._components.filter(i=>t.includeInternal||!this._componentMap.get(i)?.internal).map(({widget:i,node:s})=>i??s)}getPosition(e){for(let t in this._positionNameToContainerLookup)if(this._positionNameToContainerLookup[t].contains(e))return t;return null}_add(e,t,i,s,o){e instanceof ds||(e=new ds({node:e}));let{widget:r}=e;r!=null&&r instanceof C&&r.addHandles(st(()=>{queueMicrotask(()=>this.remove(e))}),this._removeWidgetHandleKey),this._place({component:e,position:t,index:i}),this._components.push(e),this._componentMap.set(e,{key:s,internal:o})}_find(e){return e?e instanceof ds?this._findByComponent(e):typeof e=="string"?this._findById(e):this._findByNode(e.domNode||e):null}_getViewPadding(){return this.view?.padding??wg}_attachContainers(e){e.appendChild(this._innerContainer),e.appendChild(this._manualContainer)}_initContainers(){let e=document.createElement("div");e.classList.add(Re.innerContainer,Re.cornerContainer);let t=document.createElement("div");t.classList.add(Re.innerContainer,Re.manualContainer);let i=document.createElement("div");i.classList.add(Re.topLeft,Re.corner),e.appendChild(i);let s=document.createElement("div");s.classList.add(Re.topRight,Re.corner),e.appendChild(s);let o=document.createElement("div");o.classList.add(Re.bottomLeft,Re.corner),e.appendChild(o);let r=document.createElement("div");r.classList.add(Re.bottomRight,Re.corner),e.appendChild(r),this._innerContainer=e,this._manualContainer=t;let n=Bt();this._cornerNameToContainerLookup={"top-left":i,"top-right":s,"bottom-left":o,"bottom-right":r,"top-leading":n?s:i,"top-trailing":n?i:s,"bottom-leading":n?r:o,"bottom-trailing":n?o:r},this._positionNameToContainerLookup=A({manual:t},this._cornerNameToContainerLookup)}_isValidPosition(e){return!!this._positionNameToContainerLookup[e]}_place(e){let t=e.position??"manual",{component:i,index:s}=e,o=this._positionNameToContainerLookup[t],r=s!=null&&s>-1;if(_g(i.widget)&&i.widget.startup(),!r)return void o.appendChild(i.node);let n=Array.from(o.children);if(s===0)return void(o.firstChild?Gr(i.node,o.firstChild):o.appendChild(i.node));s>=n.length?o.appendChild(i.node):Gr(i.node,n[s])}_toPixelPosition(e){return{top:Ir(e.top),left:Ir(e.left),right:Ir(e.right),bottom:Ir(e.bottom)}}_findByComponent(e){return this._components.find(t=>t===e)??null}_findById(e){return this._components.find(({id:t})=>t===e)??null}_findByNode(e){return this._components.find(({node:t})=>t===e)??null}_getComponentsAtPosition(e,t){let i=this._positionNameToContainerLookup[e];return Array.prototype.slice.call(i.children).map(s=>this._findByNode(s)).filter(we).filter(s=>t.includeInternal||!this._componentMap.get(s)?.internal).map(({widget:s,node:o})=>s??o)}};a([l()],vt.prototype,"_locale",void 0),a([l()],vt.prototype,"container",null),a([l()],vt.prototype,"height",null),a([l({value:ku})],vt.prototype,"padding",null),a([ge("padding")],vt.prototype,"castPadding",null),a([l()],vt.prototype,"view",void 0),a([l()],vt.prototype,"width",null),vt=a([y("esri.views.ui.UI")],vt);var Ru=vt;var bg=new Map;function Du(e){return bg.get(e)}function Vu(e,t){return e&&"copyright"in e&&(!t||typeof e.originOf=="function"&&e.originOf("copyright")==="user")}function Sg(e,t){return e.length!==t.length||e.some((i,s)=>i.text!==t[s].text)}function js(e,t,i){!i||!t||e.find(s=>s.layerView===t&&s.text===i)||e.push({text:i,layerView:t})}function xg(e){return e.type==="bing-maps"}var zt=[],hs=class extends C{constructor(e){super(e),this._clear=()=>{this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.removeHandles("suspension"),this.notifyChange("state")},this._pendingAttributions=new Set,this._fetchedAttributionData=new Map,this.items=new D,this.view=null,this._allLayerViewsChange=t=>{this.removeHandles("suspension"),this.removeHandles("visible-geometry-changed");let i=this.view?.allLayerViews;i&&(this.addHandles(i.map(s=>_(()=>[s.suspended,s.layer?.attributionVisible],()=>this._updateAttributionItems())).toArray(),"suspension"),i.forEach(s=>{s.declaredClass==="esri.views.3d.layers.Tiles3DLayerView3D"&&this.addHandles(s.on("visible-geometry-changed",()=>this._updateAttributionItems()),"visible-geometry-changed")})),t?.removed&&t.removed.forEach(s=>{this._pendingAttributions.delete(s),this._fetchedAttributionData.delete(s)}),this._updateAttributionItems()},this.addHandles([fe(()=>this.view?.allLayerViews,"change",t=>this._allLayerViewsChange(t),{onListenerAdd:()=>this._allLayerViewsChange(),onListenerRemove:this._clear}),le(()=>this.view?.stationary===!0,()=>this._updateAttributionItems())])}destroy(){this.view=null,this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.items.removeAll()}get state(){return this.view?.ready?this._pendingAttributions.size>0?"loading":"ready":"disabled"}_updateAttributionItems(){let e=this.view,t=e?.allLayerViews;if(zt.length=0,!e||!t)return void this._clear();t.forEach(s=>{if(s.suspended||!s.layer?.attributionVisible)return;let o=s.layer;if(Vu(o,"user"))return void js(zt,s,o.copyright);if(o.hasAttributionData){if(this._fetchedAttributionData.has(s)){let n=this._fetchedAttributionData.get(s);return void(n?js(zt,s,this._getDynamicAttribution(n,e,o)):Vu(o)&&js(zt,s,o.copyright))}return void this._fetchAttributionData(s)}let r="portalItem"in o?o.portalItem?.accessInformation:void 0;js(zt,s,r||o.copyright)});let i=t.find(s=>s.layer?.type==="integrated-mesh-3dtiles");if(this.view&&i){let s=Du(this.view);if(s){let o=s.getAttributionText();for(let r=0;r<o.length;++r)js(zt,i,o[r])}}Sg(this.items,zt)&&(this.items.removeAll(),this.items.addMany(zt)),zt.length=0,this.notifyChange("state")}_fetchAttributionData(e){return v(this,null,function*(){if(this._pendingAttributions.has(e))return;this._pendingAttributions.add(e);let t=yield _l(e.layer.fetchAttributionData());if(this._pendingAttributions.has(e)){let i=t.ok?this._createContributionIndex(t.value,xg(e.layer)):null;this._pendingAttributions.delete(e),this._fetchedAttributionData.set(e,i)}this._updateAttributionItems()})}_createContributionIndex(e,t){let i=e.contributors,s={};if(!i)return s;for(let o=0;o<i.length;o++){let r=i[o],n=r.coverageAreas;if(!n)return;for(let p of n){let c=p.bbox,d=p.zoomMin-(t&&p.zoomMin?1:0),h=p.zoomMax-(t&&p.zoomMax?1:0),m=new Oe({xmin:c[1],ymin:c[0],xmax:c[3],ymax:c[2],spatialReference:se.WGS84}),f={extent:Vl(m),attribution:r.attribution||"",score:p.score!=null?p.score:100,id:o};for(let w=d;w<=h;w++)s[w]??=[],s[w].push(f)}}return s.maxKey=Math.max.apply(null,Object.keys(s)),s}_getDynamicAttribution(e,t,i){let{extent:s,scale:o}=t,r=i.tileInfo?.scaleToZoom(o)??0;if(r=Math.min(e.maxKey??0,Math.round(r)),!s||r==null||r<=-1)return"";let n=e[r],p=lo(s.center.clone().normalize(),t.spatialReference),c=new Set;return n?n.filter(d=>{let h=d.id,m=!c.has(h)&&p&&d.extent&&po(d.extent,p);return m&&c.add(h),m}).sort((d,h)=>h.score-d.score||d.objectId-h.objectId).map(d=>d.attribution).join(", "):""}};a([l({readOnly:!0,type:D})],hs.prototype,"items",void 0),a([l({readOnly:!0})],hs.prototype,"state",null),a([l()],hs.prototype,"view",void 0),hs=a([y("esri.widgets.Attribution.AttributionViewModel")],hs);var Fa=hs;var us="esri-attribution",ms={base:us,poweredBy:`${us}__powered-by`,sources:`${us}__sources`,open:`${us}--open`,sourcesOpen:`${us}__sources--open`,link:`${us}__link`},Te=class extends re{constructor(e,t){super(e,t),this._isOpen=!1,this._attributionTextOverflowed=!1,this._prevSourceNodeHeight=0,this._resizeObserver=new ResizeObserver(i=>i.forEach(({target:s})=>this._checkSourceTextOverflow(s))),this.itemDelimiter=" | ",this.messages=null,this.viewModel=new Fa}initialize(){this.addHandles(fe(()=>this.viewModel?.items,"change",()=>this.scheduleRender()))}destroy(){this._resizeObserver?.disconnect()}get _isInteractive(){return this._isOpen||this._attributionTextOverflowed}get attributionText(){return this.viewModel.items.reduce((e,t)=>(e.includes(t.text)||e.push(t.text),e),[]).join(this.itemDelimiter)}get icon(){return"description"}set icon(e){this._overrideIfSome("icon",e)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}render(){let e={[ms.open]:this._isOpen};return u("div",{bind:this,class:this.classes(ms.base,$.widget,e),dir:"ltr",onclick:this._toggleState,onkeydown:this._toggleState},this._renderSourcesNode(),this._renderPoweredBy())}_renderPoweredBy(){return u("div",{class:ms.poweredBy},"Powered by"," ",u("a",{class:ms.link,href:"https://www.esri.com/",rel:"noreferrer",target:"_blank"},"Esri"))}_renderSourcesNode(){let e=this._isOpen,t=this._isInteractive,i=t?0:void 0,{attributionText:s}=this,o={[ms.sourcesOpen]:e,[$.interactive]:t};return u("div",{afterCreate:this._afterSourcesNodeCreate,bind:this,class:this.classes(ms.sources,o),innerHTML:s,tabIndex:i})}_afterSourcesNodeCreate(e){this._prevSourceNodeHeight=e.clientWidth,this._resizeObserver.observe(e)}_checkSourceTextOverflow(e){let t=!1,{clientHeight:i,clientWidth:s,scrollWidth:o}=e,r=o>s,n=this._attributionTextOverflowed!==r;if(this._attributionTextOverflowed=r,n&&(t=!0),this._isOpen){let p=i<this._prevSourceNodeHeight;this._prevSourceNodeHeight=i,p&&(this._isOpen=!1,t=!0)}t&&this.scheduleRender()}_toggleState(){this._isInteractive&&(this._isOpen=!this._isOpen)}};a([l()],Te.prototype,"_isOpen",void 0),a([l()],Te.prototype,"_isInteractive",null),a([l()],Te.prototype,"_attributionTextOverflowed",void 0),a([l()],Te.prototype,"_prevSourceNodeHeight",void 0),a([l({readOnly:!0,dependsOn:["viewModel.items.length","itemDelimiter"]})],Te.prototype,"attributionText",null),a([l()],Te.prototype,"icon",null),a([l()],Te.prototype,"itemDelimiter",void 0),a([l()],Te.prototype,"label",null),a([l(),Q("esri/widgets/Attribution/t9n/Attribution")],Te.prototype,"messages",void 0),a([l()],Te.prototype,"view",null),a([l({type:Fa})],Te.prototype,"viewModel",void 0),a([Ee()],Te.prototype,"_toggleState",null),Te=a([y("esri.widgets.Attribution")],Te);var Au=Te;function zu(e){return e?.spatialReference?.isWebMercator||e?.spatialReference?.isGeographic||!1}var Ci=class extends $i(C){constructor(e){super(e),this.orientation={x:0,y:0,z:0},this.view=null,this._updateForCamera=this._updateForCamera.bind(this),this._updateForRotation=this._updateForRotation.bind(this),this._updateRotationWatcher=this._updateRotationWatcher.bind(this)}initialize(){this.addHandles(_(()=>this.view,this._updateRotationWatcher,O))}destroy(){this.view=null}get canShowNorth(){return zu(this.view)}get state(){return!this.view?.ready||this.view.type==="2d"&&!this.view.constraints.rotationEnabled?"disabled":this.canShowNorth?"compass":"rotation"}reset(){this.view?.ready&&(this.view?.type==="2d"?this.callGoTo({target:{rotation:0},options:{animationMode:"always",duration:ie("mapview-essential-goto-duration")}}):this.callGoTo({target:{heading:0}}))}_updateForRotation(e){e!=null&&this._set("orientation",{z:e})}_updateForCamera(e){if(!e)return;let t=-e.heading;this._set("orientation",{x:0,y:0,z:t})}_updateRotationWatcher(e){this.removeAllHandles(),e&&this.addHandles(e.type==="2d"?_(()=>e?.rotation,this._updateForRotation,O):_(()=>e?.camera,this._updateForCamera,O))}};a([l({readOnly:!0})],Ci.prototype,"canShowNorth",null),a([l({readOnly:!0})],Ci.prototype,"orientation",void 0),a([l({readOnly:!0})],Ci.prototype,"state",null),a([l()],Ci.prototype,"view",void 0),Ci=a([y("esri.widgets.Compass.CompassViewModel")],Ci);var Oa=Ci;var Fu="esri-compass",Na={base:Fu,iconContainer:`${Fu}__icon-container`};var Ft=class extends re{constructor(e,t){super(e,t),this.messages=null,this.viewModel=new Oa,this._reset=()=>{this.viewModel.reset()},this._toRotationTransform=i=>({transform:`rotateZ(${i.z}deg)`})}loadDependencies(){return Ie({button:()=>import("./chunk-DLYYRWO3.js"),icon:()=>import("./chunk-WEV76HGW.js")})}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(e){this.viewModel.goToOverride=e}get icon(){return this.viewModel.state==="rotation"?"arrow-up":"compass-needle"}set icon(e){this._overrideIfSome("icon",e)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}reset(){return this.viewModel.reset()}render(){let{orientation:e,state:t}=this.viewModel,{messages:i}=this;return u("div",{class:this.classes(Na.base,$.widget)},u("calcite-button",{class:$.widgetButton,disabled:t==="disabled",kind:"neutral",label:i.reset,onclick:this._reset,round:!0,scale:"s",title:i.reset},u("div",{"aria-hidden":"true",class:Na.iconContainer,title:i.reset},u("calcite-icon",{icon:this.icon,styles:this._toRotationTransform(e)}))))}};a([l()],Ft.prototype,"goToOverride",null),a([l()],Ft.prototype,"icon",null),a([l()],Ft.prototype,"label",null),a([l(),Q("esri/widgets/Compass/t9n/Compass")],Ft.prototype,"messages",void 0),a([l()],Ft.prototype,"view",null),a([l({type:Oa})],Ft.prototype,"viewModel",void 0),Ft=a([y("esri.widgets.Compass")],Ft);var Ou=Ft;var Nu="esri-navigation-toggle",$a={base:Nu,isLayoutHorizontal:`${Nu}--horizontal`};var fs=class extends C{constructor(e){super(e),this._navigationMode="pan",this.view=null}initialize(){this.addHandles(le(()=>this.view?.inputManager,()=>this._setNavigationMode()))}destroy(){this.view=null}get state(){return this.view?.ready&&this.view?.type==="3d"?"ready":"disabled"}get navigationMode(){return this._navigationMode}set navigationMode(e){this._navigationMode=e,this._setNavigationMode()}toggle(){this.state!=="disabled"&&(this.navigationMode=this.navigationMode!=="pan"?"pan":"rotate")}_setNavigationMode(){let e=this.view?.inputManager;e&&(e.primaryDragAction=this._navigationMode==="pan"?"pan":"rotate")}};a([l({readOnly:!0})],fs.prototype,"state",null),a([l()],fs.prototype,"_navigationMode",void 0),a([l()],fs.prototype,"view",void 0),fs=a([y("esri.widgets.NavigationToggle.NavigationToggleViewModel")],fs);var Ha=fs;var Ot=class extends re{constructor(e,t){super(e,t),this.messages=null,this.viewModel=new Ha,this.toggle=()=>this.viewModel.toggle(),this._panButton=null,this._rotateButton=null,this._toggle=()=>{(this.viewModel?.navigationMode==="pan"?this._rotateButton:this._panButton)?.setFocus(),this.toggle()}}loadDependencies(){return Ie({button:()=>import("./chunk-DLYYRWO3.js")})}get icon(){return"move"}set icon(e){this._overrideIfSome("icon",e)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}set layout(e){e!=="horizontal"&&(e="vertical"),this._set("layout",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}render(){let e=this.viewModel?.state==="disabled",t=this.viewModel?.navigationMode==="pan",i=this.messages.toggle;return u("div",{class:this.classes($a.base,$.widget,{[$a.isLayoutHorizontal]:this.layout==="horizontal"})},u("calcite-button",{afterCreate:s=>{this._panButton=s},appearance:t?"outline-fill":"solid",class:$.widgetButton,disabled:e,iconStart:"move",kind:"neutral",label:i,onclick:this._toggle,tabIndex:t?void 0:-1,title:i}),u("calcite-button",{afterCreate:s=>{this._rotateButton=s},appearance:t?"solid":"outline-fill",class:$.widgetButton,disabled:e,iconStart:"rotate",kind:"neutral",label:i,onclick:this._toggle,tabIndex:t?-1:void 0,title:i}))}};a([l()],Ot.prototype,"icon",null),a([l()],Ot.prototype,"label",null),a([l({value:"vertical"})],Ot.prototype,"layout",null),a([l(),Q("esri/widgets/NavigationToggle/t9n/NavigationToggle")],Ot.prototype,"messages",void 0),a([l()],Ot.prototype,"view",null),a([l({type:Ha})],Ot.prototype,"viewModel",void 0),Ot=a([y("esri.widgets.NavigationToggle")],Ot);var $u=Ot;var Ti=class extends C{get canZoomIn(){if(!this.view?.ready)return!1;let t=this.view?.constraints?.effectiveMaxScale;return t===0||this._scale>t}get canZoomOut(){let{view:e}=this;if(!e?.ready)return!1;let i=e.constraints?.effectiveMinScale;return i===0||this._scale<i}get _scale(){let e=this.view?.animation?.target;return(e&&"then"in e?void 0:e?.scale)??this.view?.scale??0}};a([l({readOnly:!0})],Ti.prototype,"canZoomIn",null),a([l({readOnly:!0})],Ti.prototype,"canZoomOut",null),a([l()],Ti.prototype,"view",void 0),a([l()],Ti.prototype,"_scale",null),Ti=a([y("esri.widgets.Zoom.ZoomConditions2D")],Ti);var Hu=Ti;var gs=class extends C{get canZoomIn(){return!!this.view.ready}get canZoomOut(){return!!this.view.ready}};a([l({readOnly:!0})],gs.prototype,"canZoomIn",null),a([l({readOnly:!0})],gs.prototype,"canZoomOut",null),a([l()],gs.prototype,"view",void 0),gs=a([y("esri.widgets.Zoom.ZoomConditions3D")],gs);var Bu=gs;var si=class extends C{constructor(e){super(e)}destroy(){this.view=null}get canZoomIn(){return this._zoomConditions!=null&&this._zoomConditions.canZoomIn}get canZoomOut(){return this._zoomConditions!=null&&this._zoomConditions?.canZoomOut}get state(){return this.view?.ready?"ready":"disabled"}set view(e){e?e.type==="2d"?this._zoomConditions=new Hu({view:e}):e.type==="3d"&&(this._zoomConditions=new Bu({view:e})):this._zoomConditions=null,this._set("view",e)}zoomIn(){if(!this.canZoomIn)return;let e=this.view;e.type==="2d"?e.mapViewNavigation.zoomIn():Hr(e.goTo({zoomFactor:2}))}zoomOut(){if(!this.canZoomOut)return;let e=this.view;e.type==="2d"?e.mapViewNavigation.zoomOut():Hr(e.goTo({zoomFactor:.5}))}};a([l()],si.prototype,"_zoomConditions",void 0),a([l()],si.prototype,"canZoomIn",null),a([l()],si.prototype,"canZoomOut",null),a([l({readOnly:!0})],si.prototype,"state",null),a([l()],si.prototype,"view",null),si=a([y("esri.widgets.Zoom.ZoomViewModel")],si);var Ba=si;var Wu={base:"esri-zoom",horizontalLayout:"esri-zoom--horizontal"},Nt=class extends re{constructor(e,t){super(e,t),this.messages=null,this.viewModel=new Ba,this.zoomIn=()=>this.viewModel.zoomIn(),this.zoomOut=()=>this.viewModel.zoomOut()}loadDependencies(){return Ie({button:()=>import("./chunk-DLYYRWO3.js")})}get icon(){return"magnifying-glass-plus"}set icon(e){this._overrideIfSome("icon",e)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}set layout(e){e!=="horizontal"&&(e="vertical"),this._set("layout",e)}set view(e){this.viewModel.view=e}get view(){return this.viewModel.view}render(){let e={[Wu.horizontalLayout]:this.layout==="horizontal"},{canZoomIn:t,canZoomOut:i}=this.viewModel,{zoomIn:s,zoomOut:o}=this.messages;return u("div",{class:this.classes(Wu.base,$.widget,e)},u("calcite-button",{class:$.widgetButton,disabled:!t,iconStart:"plus",kind:"neutral",label:s,onclick:this.zoomIn,title:s}),u("calcite-button",{class:$.widgetButton,disabled:!i,iconStart:"minus",kind:"neutral",label:o,onclick:this.zoomOut,title:o}))}};a([l()],Nt.prototype,"icon",null),a([l()],Nt.prototype,"label",null),a([l({value:"vertical"})],Nt.prototype,"layout",null),a([l(),Q("esri/widgets/Zoom/t9n/Zoom")],Nt.prototype,"messages",void 0),a([l()],Nt.prototype,"view",null),a([l({type:Ba})],Nt.prototype,"viewModel",void 0),Nt=a([y("esri.widgets.Zoom")],Nt);var Er=Nt;function Cg(e){return e?.view!==void 0}var Pr=class extends Ru{constructor(e){super(e),this._defaultPositionLookup={attribution:"manual",compass:"top-left","navigation-toggle":"top-left",zoom:"top-left"},this.components=[],this._updateViewAwareWidgets=t=>{this.components.forEach(i=>{let s=this._find(i),o=s?.widget;Cg(o)&&(o.view=t)})},this._componentsWatcher=(t,i)=>{this._removeComponents(i),this._addComponents(t),this._adjustPadding(t)}}initialize(){this.addHandles([_(()=>this.components,this._componentsWatcher,O),_(()=>this.view,this._updateViewAwareWidgets,O)])}_add(e,t,i,s,o){let r=e;if(typeof e=="string"&&this._defaultPositionLookup[e]){if(this._find(e))return;r=this._createComponent(e)}super._add(r,t,i,s,o)}_removeComponents(e){e.forEach(t=>{let i=this._find(t);i&&(this.remove(i),i.destroy())})}_adjustPadding(e){if(!e.includes("attribution")&&!this._isOverridden("padding")){let{top:t}=this.padding;this.padding=t}}_addComponents(e){this.constructed&&e.forEach(t=>this.add(this._createComponent(t),this._defaultPositionLookup[t]))}_createComponent(e){let t=this._createWidget(e);return new ds({id:e,node:t})}_createWidget(e){let t=this.view;switch(e){case"attribution":return new Au({view:t});case"compass":return new Ou({view:t});case"navigation-toggle":return new $u({view:t});case"zoom":return new Er({view:t})}}};a([l()],Pr.prototype,"components",void 0),Pr=a([y("esri.views.ui.DefaultUI")],Pr);var kr=Pr;var Rr=class extends kr{constructor(e){super(e),this.components=["attribution","zoom"]}};a([l()],Rr.prototype,"components",void 0),Rr=a([y("esri.views.ui.2d.DefaultUI2D")],Rr);var Wa=Rr;var Ua,Dr=Ua=class extends Ei{constructor(e){super(e),this.color=new ye([0,0,0,1])}clone(){return new Ua(ws({color:this.color}))}};a([l({type:ye,json:{write:!0}})],Dr.prototype,"color",void 0),Dr=Ua=a([y("esri.webmap.background.ColorBackground")],Dr);var Uu=Dr;var Gu,Zu,qu,ju,Ku,Yu;function Tg(){return v(this,null,function*(){let[,{GraphicsView2D:e,GraphicContainer:t,LabelManager:i,MapViewNavigation:s,MagnifierView2D:o,Stage:r}]=yield Promise.all([import("./chunk-XZ3OEKNB.js"),import("./chunk-MCVYKCDR.js")]);Zu=e,qu=t,ju=i,Ku=s,Yu=o,Gu=r})}var V=class extends ah(dh(ph(Vh))){constructor(e){super(e),this._magnifierView=null,this.stage=null,this._resolveWhenReady=[],this.rootLayerViews=new di({getCollections:()=>[this.basemapView?.baseLayerViews,this.layerViews,this.basemapView?.referenceLayerViews],getChildrenFunction:()=>null}),this.featuresTilingScheme=null,this.fullOpacity=1,this.goToManager=new Us({view:this}),this.graphicsView=null,this.stateManager=new be({constraints:new Ia({view:this})}),this.stationaryManager=new cs,this.labelManager=null,this.mapViewNavigation=null,this.renderingOptions={samplingMode:"dynamic",edgeLabelsVisible:!0,labelsAnimationTime:125,labelCollisionsEnabled:!0},this.supersampleScreenshotsEnabled=!0,this.supportsGround=!1,this.frameTask=new rr(this),this.floors=new D,this.highlightOptions=new an,this.inputManager=new _u({view:this}),this.map=null,this.spatialReferenceLocked=!1,this.timeline=new Sn,this.type="2d",this.ui=new Wa,this.test={takeScreenshot:t=>v(this,null,function*(){return Lu(this._getScreenshotView(t),t)})},this.padding={top:0,right:0,bottom:0,left:0},this.addHandles([_(()=>this.viewpoint,()=>this.stationaryManager.flip(),wt),this.on("resize",t=>this.stateManager.resize(t.width,t.height))]),Yp()}destroy(){this.layerViewManager.clear(),this._set("preconditionsReady",!1),this.frameTask=oe(this.frameTask),this.goToManager.destroy(),this.rootLayerViews.destroy(),this.inputManager.destroy(),this._set("inputManager",null)}get graphicsTileStore(){return new Mr(this.featuresTilingScheme)}get constraintsInfo(){let e=this.defaultsFromMap?.tileInfo,t=this.spatialReference;return{lods:e?.spatialReference?.equals(t)?e.lods:null,spatialReference:t}}get state(){return this.stateManager.state}get initialExtentRequired(){if(!this.stateManager)return!1;let{scale:e,constraints:t,center:i,viewpoint:s,extent:o}=this,r=this.zoom;return!(this.map&&"initialViewProperties"in this.map&&this.map.initialViewProperties?.viewpoint)&&!o&&(t?.effectiveLODs||(r=-1),(!i||e===0&&r===-1)&&(s?.targetGeometry==null||s.targetGeometry.type!=="extent"&&!s.scale))}get _defaultsFromMapSettings(){return{required:{tileInfo:!0,heightModelInfo:!1,extent:!1},requiresExtentInSpatialReference:this.spatialReferenceLocked}}get typeSpecificPreconditionsReady(){let e=this._getDefaultViewpoint();if(!e)return!1;let t=e.targetGeometry,i=this.spatialReference;return Sp(t.spatialReference,i)}set animation(e){let t=this._get("animation");if(e===t)return;if(t&&t.stop(),e!==this.animationManager.animation&&this.animationManager.stop(),!e||e.isFulfilled())return this._set("animation",null),void(this.frameTask.animationInProgress=!1);this._set("animation",e),this.frameTask.animationInProgress=!0;let i=()=>{this.destroyed||(e===this._get("animation")&&(this._set("animation",null),this.frameTask?.requestFrame()),this.frameTask.animationInProgress=!1)};e.when(i,i)}get background(){return xn(this.map)?this.map.initialViewProperties.background:null}set background(e){this._override("background",e)}get center(){return this.stateManager?.center??null}set center(e){this.stateManager.center=e}get constraints(){return this.stateManager?.constraints}set constraints(e){e.view=this;let t=this.stateManager.constraints;this.stateManager.constraints=e,t?.destroy()}get extent(){return this.stateManager?.extent??null}set extent(e){this.stateManager.extent=e}get padding(){return this.stateManager?.padding}set padding(e){this.stateManager&&(this.stateManager.padding=e)}get rendering(){return this.stage?.renderRequested??!1}get resizeAlign(){return this.stateManager.resizeAlign}set resizeAlign(e){this.stateManager.resizeAlign=e}get resolution(){return this.stateManager.resolution??0}get rotation(){return this.stateManager.rotation??0}set rotation(e){let{rotationEnabled:t}=this.constraints;this.constraints.rotationEnabled=!0,this.stateManager.rotation=e,this.constraints.rotationEnabled=t}get scale(){return this.stateManager?.scale??0}set scale(e){this.stateManager&&(this.stateManager.scale=e)}get stationary(){return!this.animation&&!this.navigating&&!this.resizing&&this.stationaryManager.stationary}get tileInfo(){return this.featuresTilingScheme?.tileInfo}get updating(){let e=!(!this.magnifier.visible||this.magnifier.position===null||!this._magnifierView?.updatingHandles.updating),t=!this.destroyed&&(!this.layerViewManager||!this.labelManager||!this.graphicsView||this.layerViewManager.updating===!0||this.labelManager.updating===!0||this.graphicsView.updating===!0||this.allLayerViews.some(i=>!i.destroyed&&!("layerViews"in i)&&i.updating===!0)||e);if(ie("esri-2d-log-updating")){let i=this.allLayerViews.reduce((s,o)=>he(A({},s),{[`${o.layer.id}(${o.layer.type})`]:!o.destroyed&&!("layerViews"in o)&&o.updating}),{});console.log(`Updating MapView: ${t}
-> Null LayerViewManager: ${!this.layerViewManager}
-> Null LabelManager: ${!this.labelManager}
-> Null GraphicsView: ${!this.graphicsView}
-> layerViewManager.updating: ${this.layerViewManager?.updating}
-> labelManager.updating: ${this.labelManager?.updating}
-> graphicsView.updating: ${this.graphicsView?.updating}
-> allLayerViews: ${JSON.stringify(i)}
-> updatingMagnifier: ${e}
`)}return t}get viewpoint(){return this.stateManager.viewpoint??null}set viewpoint(e){this.stateManager.viewpoint=e,this.frameTask.requestFrame()}get zoom(){return this.stateManager.zoom??-1}set zoom(e){this.stateManager.zoom=e}get navigating(){return this.mapViewNavigation?.interacting??!1}goTo(e,t){return this.goToManager.goTo(e,t)}hitTest(e,t){return v(this,null,function*(){return xu(this,e,t)})}takeScreenshot(e){return v(this,null,function*(){return Tu(this._getScreenshotView(e),e)})}toMap(e){if(!this.ready)return null;let t=Yo(e)?Ko(this,e):e;return this.stateManager.toMap(t)}toScreen(e,t){return this.stateManager.toScreen(e,t)}on(e,t,i,s){return this.inputManager&&this.viewEvents.on(e,t,i,s)||super.on(e,t)}hasEventListener(e){return super.hasEventListener(e)||this.viewEvents.hasHandler(e)}whenLayerView(e){return super.whenLayerView(e)}graphicChanged(e){this.graphicsView&&this.graphicsView.graphicUpdateHandler(e)}whenReady(){return new Promise(e=>{this.ready?e(this):this._resolveWhenReady.push(e)})}forceDOMReadyCycle(){this.forceReadyCycle()}getDefaultSpatialReference(){return this.map&&"initialViewProperties"in this.map&&this.map?.initialViewProperties?.spatialReference||this.defaultsFromMap?.spatialReference||null}getDefaultTimeZone(){return xn(this.map)?this.map.initialViewProperties.timeZone:null}hasLayerViewModule(e){return Sa.hasLayerViewModule(e)}importLayerView(e){return Sa.importLayerView(e)}pixelSizeAt(){return this.ready?this.resolution:(P.getLogger(this).error("#pixelSizeAt()","Map view cannot be used before it is ready"),null)}popupHitTest(e){return v(this,null,function*(){let t=this.toMap(e),i=yield this.hitTest(e),s=this.allLayerViews.toArray().reverse(),o=new globalThis.Map(s.map(c=>[c.layer.uid,c])),r=[],n=0,p=0;for(;n<i.results.length||p<s.length;){let c=i.results.at(n);if(c&&c.type!=="graphic"){++n;continue}let d=o.get((c?.layer??c?.graphic.layer)?.uid);if((!c||d)&&p<s.length&&s.at(p)!==d){let h=s.at(p);"fetchPopupFeaturesAtLocation"in h&&r.push({mapPoint:t,layerView:h}),++p}else c&&(r.push({graphic:c.graphic,layerView:d}),++n)}return{hits:r,location:t}})}requestUpdate(){this.ready&&this.frameTask.requestUpdate()}validate(){return v(this,null,function*(){let e=Eu(this.type);if(ie("safari")&&ie("safari")<9&&(e=new x("mapview:browser-not-supported","This browser is not supported by MapView (Safari < 9)",{type:"safari",requiredVersion:9,detectedVersion:ie("safari")})),e!=null)throw P.getLogger(this).warn("#validate()",e.message),e})}loadAsyncDependencies(){return Tg()}_getDefaultViewpoint(){let{constraints:e,initialExtent:t,map:i,padding:s,size:o}=this;if(!e)return null;let r=i&&"initialViewProperties"in i?i.initialViewProperties:void 0,n=this.stateManager.getUserStartupOptions(this.size),p=r?.viewpoint,c=p?.targetGeometry?.extent??t,d=c?.center,h=p?.rotation??0,m=p?.scale||c&&To(c,[o[0]-s.left-s.right,o[1]-s.top-s.bottom]),f=n.center??d,w=n.rotation??h,S=n.scale??m;return f&&S?new Se({targetGeometry:f,scale:S,rotation:w}):null}_startup(){this.timeline.begin("MapView Startup");let e=this._getDefaultViewpoint();this.stateManager.startup(e,this.size,this.spatialReference,this.defaultsFromMap.extent?.center),this.graphics.owner=this;let t=new Gu(this.surface,{canvas:this.renderCanvas,contextOptions:{disabledExtensions:this.deactivatedWebGLExtensions,debugWebGLExtensions:this.debugWebGLExtensions},renderingOptions:this.renderingOptions,timeline:this.timeline});this.stage=t,this._magnifierView=new Yu,this._magnifierView.magnifier=this.magnifier;let i=new ju({view:this});this._set("labelManager",i);let s=new ou({view:this});this._set("animationManager",s);let o=new Ku({view:this,animationManager:s});this._set("mapViewNavigation",o),this._setupSpatialReferenceDependentProperties(),this.addHandles([this.rootLayerViews.on("change",()=>this._updateStageChildren()),t.on("webgl-error",n=>this.fatalError=n.error),_(()=>this.stationary,n=>t.stationary=n,Me),_(()=>this.background,n=>{t.backgroundColor=n?.color,this._magnifierView.backgroundColor=n?.color},Me),_(()=>this.magnifier,n=>this._magnifierView.magnifier=n,Me),_(()=>this.renderingOptions,n=>t.renderingOptions=n,Me),_(()=>this.highlightOptions,n=>t.highlightOptions=n,Me),_(()=>this.state.id,()=>t.state=this.state,Me)],"map-view"),this._updateStageChildren();let r=this._resolveWhenReady;this._resolveWhenReady=[],r.forEach(n=>n(this)),this.timeline.end("MapView Startup"),this.frameTask.start(),this._set("ready",!0)}_teardown(){this._destroySpatialReferenceDependentProperties(),this.removeHandles("map-view"),this.mapViewNavigation.destroy(),this._set("mapViewNavigation",null),this.animation=null,this.animationManager.destroy(),this._set("animationManager",null),this.layerViewManager.clear(),this.labelManager.destroy(),this._magnifierView.destroy(),this.stage.destroy(),this.stage=null,this._set("graphicsView",null),this._magnifierView=null,this._set("labelManager",null),this._set("mapViewNavigation",null),this.graphics.owner=null,this.frameTask.stop(),this.stationaryManager.clear(),this._set("ready",!1),this.stateManager.teardown()}_updateStageChildren(){this.stage.removeAllChildren(),this.rootLayerViews.forEach(t=>{this.stage.addChild(t.container)});let e=this.graphicsView;this.stage.addChild(e.container),this.stage.addChild(this._magnifierView)}_setupSpatialReferenceDependentProperties(){let e=new Ap(li.create({spatialReference:this.spatialReference,size:512,numLODs:36}));this._set("featuresTilingScheme",e);let t=new Zu({view:this,graphics:this.graphics,requestUpdateCallback:()=>this.requestUpdate(),container:new qu(e)});this._set("graphicsView",t)}_destroySpatialReferenceDependentProperties(){let e=this.graphicsView;this._set("graphicsView",null),e.destroy(),this._set("featuresTilingScheme",null)}_getScreenshotView(e){let{allLayerViews:t,padding:i,size:s,stage:o}=this;return{allLayerViews:t,backgroundColor:e?.ignoreBackground?null:this.background?.color,padding:i,size:s,stage:o}}_spatialReferenceChanged(e){if(this.ready){this.frameTask.stop();for(let t of this.allLayerViews)t.processDetach();this._destroySpatialReferenceDependentProperties(),this.stateManager.changeSpatialReference(e),this.stage.state=this.state,this._setupSpatialReferenceDependentProperties();for(let t of this.allLayerViews)t.processAttach();this.frameTask.requestFrame(),this.frameTask.start(),this._updateStageChildren()}}};V.type="2d",a([l({readOnly:!0})],V.prototype,"animationManager",void 0),a([l({constructOnly:!0})],V.prototype,"deactivatedWebGLExtensions",void 0),a([l({constructOnly:!0})],V.prototype,"debugWebGLExtensions",void 0),a([l({readOnly:!0})],V.prototype,"featuresTilingScheme",void 0),a([l({readOnly:!0})],V.prototype,"fullOpacity",void 0),a([l()],V.prototype,"goToManager",void 0),a([l({readOnly:!0})],V.prototype,"graphicsTileStore",null),a([l()],V.prototype,"graphicsView",void 0),a([l()],V.prototype,"stateManager",void 0),a([l()],V.prototype,"constraintsInfo",null),a([l({readOnly:!0})],V.prototype,"state",null),a([l()],V.prototype,"initialExtentRequired",null),a([l()],V.prototype,"labelManager",void 0),a([l({readOnly:!0})],V.prototype,"mapViewNavigation",void 0),a([l({constructOnly:!0})],V.prototype,"renderCanvas",void 0),a([l()],V.prototype,"renderingOptions",void 0),a([l({constructOnly:!0})],V.prototype,"supersampleScreenshotsEnabled",void 0),a([l({readOnly:!0})],V.prototype,"supportsGround",void 0),a([l()],V.prototype,"_defaultsFromMapSettings",null),a([l({readOnly:!0})],V.prototype,"typeSpecificPreconditionsReady",null),a([l()],V.prototype,"animation",null),a([l({type:Uu})],V.prototype,"background",null),a([l()],V.prototype,"center",null),a([l({type:Ia})],V.prototype,"constraints",null),a([l()],V.prototype,"extent",null),a([l()],V.prototype,"floors",void 0),a([l({type:an})],V.prototype,"highlightOptions",void 0),a([l({readOnly:!0})],V.prototype,"inputManager",void 0),a([l()],V.prototype,"map",void 0),a([l()],V.prototype,"padding",null),a([l({readOnly:!0})],V.prototype,"rendering",null),a([l()],V.prototype,"resizeAlign",null),a([l({readOnly:!0})],V.prototype,"resolution",null),a([l()],V.prototype,"rotation",null),a([l()],V.prototype,"scale",null),a([l({constructOnly:!0})],V.prototype,"spatialReferenceLocked",void 0),a([l()],V.prototype,"stationary",null),a([l({readOnly:!0})],V.prototype,"tileInfo",null),a([l({type:Sn,readOnly:!0})],V.prototype,"timeline",void 0),a([l({readOnly:!0})],V.prototype,"type",void 0),a([l({readOnly:!0})],V.prototype,"updating",null),a([l()],V.prototype,"viewpoint",null),a([l()],V.prototype,"zoom",null),a([l({readOnly:!0})],V.prototype,"navigating",null),a([l(),ge(e=>e instanceof kr?e:hl(Wa,e))],V.prototype,"ui",void 0),V=a([y("esri.views.MapView")],V);var Qu=V;var Lg=new ci({color:new ye([255,255,255,0]),outline:{color:new ye([0,0,0]),width:2}}),Mg=new ci({color:[0,0,0,0],outline:{color:[0,255,0],width:2}}),Ig=new ci({color:[0,0,0,0],outline:{color:[255,0,0],width:2}}),Eg=new vo({symbol:Lg}),Pg=new vo({symbol:Mg}),kg=new vo({symbol:Ig}),Rg=new go({title:"{NOMBDEP}",content:[{type:"fields",fieldInfos:[{fieldName:"CODDEP",label:"Codigo",visible:!0}]}]}),Dg=new go({title:"{NOMBPROV}",content:[{type:"fields",fieldInfos:[{fieldName:"CODPROV",label:"Codigo",visible:!0}]}]}),Vg=new go({title:"{NOMBDIST}",content:[{type:"fields",fieldInfos:[{fieldName:"CODDIST",label:"Codigo",visible:!0}]}]}),Ag=new wo({labelExpressionInfo:{expression:"$feature.NOMBDEP"},symbol:{type:"text",color:"black",haloColor:"white",haloSize:"1px",font:{size:10,family:"sans-serif",weight:"bold"}},labelPlacement:"always-horizontal",minScale:0,maxScale:0}),zg=new wo({labelExpressionInfo:{expression:"$feature.NOMBPROV"},symbol:{type:"text",color:[0,255,0],haloColor:"black",haloSize:"1px",font:{size:10,family:"sans-serif",weight:"bold"}},labelPlacement:"always-horizontal",minScale:0,maxScale:0}),Fg=new wo({labelExpressionInfo:{expression:"$feature.NOMBDIST"},symbol:{type:"text",color:"red",haloColor:"white",haloSize:"1px",font:{size:10,family:"sans-serif",weight:"bold"}},labelPlacement:"always-horizontal",minScale:0,maxScale:0}),P$=(()=>{let t=class t{constructor(){this.mapa=new Uo({basemap:"topo-vector"}),this.layerUrls={baseService:"https://winlmprap09.midagri.gob.pe/winlmprap14/rest/services/ideMidagri",limits:{departamentos:"Limites_Censales/MapServer/0",provincias:"Limites_Censales/MapServer/1",distritos:"Limites_Censales/MapServer/2"}},this.layers=[{title:"LIMITE DE DEPARTAMENTOS",url:`${this.layerUrls.baseService}/${this.layerUrls.limits.departamentos}`,labelingInfo:[Ag],popupTemplate:Rg,renderer:Eg,visible:!0,group:"L\xEDmites Censales"},{title:"LIMITE DE PROVINCIAS",url:`${this.layerUrls.baseService}/${this.layerUrls.limits.provincias}`,labelingInfo:[zg],popupTemplate:Dg,renderer:Pg,visible:!0,group:"L\xEDmites Censales"},{title:"LIMITE DE DISTRITOS",url:`${this.layerUrls.baseService}/${this.layerUrls.limits.distritos}`,labelingInfo:[Fg],popupTemplate:Vg,renderer:kg,visible:!0,group:"L\xEDmites Censales"}],this.lis=[],this.searchTerm="",this.filteredArray=[],this.gcsLongitude="--",this.gcsLatitude="--",this.utmZone="--",this.utmEast="--",this.utmNorth="--",this.scale="--",this.capas={}}initializeMap(s){let o=s.nativeElement;this.layers.forEach(n=>{let p;n.popupTemplate==null?p=new Gt({url:n.url,title:n.title,visible:n.visible,outFields:n.outFields}):n.popupTemplate&&n.renderer==null?p=new Gt({url:n.url,title:n.title,popupTemplate:n.popupTemplate,visible:n.visible}):n.popupTemplate&&n.renderer&&n.labelingInfo==null?p=new Gt({url:n.url,title:n.title,popupTemplate:n.popupTemplate,renderer:n.renderer,visible:n.visible}):p=new Gt({url:n.url,title:n.title,popupTemplate:n.popupTemplate,labelingInfo:n.labelingInfo,outFields:n.outFields,visible:n.visible,renderer:n.renderer,maxScale:n.maxScale,minScale:n.minScale}),this.mapa.add(p)});let r=new Qu({container:o,map:this.mapa,center:[-75.015152,-10.189967],zoom:5.8,rotation:0,constraints:{maxZoom:25,minZoom:1,snapToZoom:!1},padding:{top:0},ui:{components:[]}});return r.watch("scale",n=>{this.scale=this.formatScale(n)}),r.ui.add(new Vd({view:r}),{position:"top-right",index:0}),r.ui.add(new Er({view:r}),{position:"top-right",index:1}),r.ui.add(new Dd({view:r,expandTooltip:"Galeria de Mapas Base",content:new hd({view:r,icon:"move-to-basemap"})}),{position:"top-right",index:2}),this.legend=new ih({view:r,container:document.createElement("div")}),new Pd({view:r}),r.on("pointer-move",n=>{let p=this.view.toMap({x:n.x,y:n.y});this.updateCoordinates(p.latitude,p.longitude)}),this.view=r,this.view.when()}toggleLayerVisibility(s,o){let r=this.mapa.layers.find(n=>n.title===s);r&&(r.visible=o)}getLayerVisibility(s){let o=this.mapa.layers.find(r=>r.title===s);return o?o.visible:!1}getActiveLayers(){return Object.values(this.capas).filter(s=>s.visible)}updateCoordinates(s,o){this.gcsLongitude=o.toFixed(5),this.gcsLatitude=s.toFixed(5);let r=Math.floor((o+180)/6)+1,n=this.getUtmBand(s);this.utmZone=`${r} ${n}`;let p=new N({latitude:s,longitude:o,spatialReference:se.WGS84}),c=s>=0?32600+r:32700+r,h=pt(p,new se({wkid:c}));this.utmEast=`${h.x.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})} m`,this.utmNorth=`${h.y.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})} m`}getUtmBand(s){let o="CDEFGHJKLMNPQRSTUVWX",r=Math.floor((s+80)/8);return o.charAt(r)}formatScale(s){return s.toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:0})}getRegionFeature(){return this.regionFeature=new Gt({url:`${this.layerUrls.baseService}/${this.layerUrls.limits.departamentos}`,visible:!1}),this.regionFeature}getProvinciaFeature(){return this.provinciaFeature=new Gt({url:`${this.layerUrls.baseService}/${this.layerUrls.limits.provincias}`,visible:!1}),this.provinciaFeature}getDistritosFeature(){return this.distritosFeature=new Gt({url:`${this.layerUrls.baseService}/${this.layerUrls.limits.distritos}`,visible:!1}),this.distritosFeature}removeLayerFromGroup(s,o){return v(this,null,function*(){let r=this.mapa?.layers.find(n=>n instanceof ec&&n.id===s);if(r){let n=r.findLayerById(o);n&&r.remove(n)}})}};t.\u0275fac=function(o){return new(o||t)},t.\u0275prov=Ya({token:t,factory:t.\u0275fac,providedIn:"root"});let e=t;return e})();export{P$ as a};
