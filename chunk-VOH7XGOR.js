import{a as J}from"./chunk-Y6HWUWZ3.js";import{b as B}from"./chunk-DG5QI6E2.js";import{d as I}from"./chunk-QYC4ILGT.js";import{w as X}from"./chunk-Z5NXR7SL.js";import{i as P}from"./chunk-TZHKPIVH.js";import{h as H,i as Z,q as j,s as p}from"./chunk-BRWS572J.js";import{a as f,b as m,g as l}from"./chunk-JEGVIFEP.js";var Fe=()=>j.getLogger("esri.support.arcadeOnDemand"),_;function E(){return _||(_=l(this,null,function*(){let e=yield import("./chunk-ERLUB2VC.js");return{arcade:e.arcade,arcadeUtils:e,Dictionary:e.Dictionary,Feature:e.arcadeFeature}})),_}var ot=(e,t,n)=>w.create(e,t,n,null,["$feature","$view"],[]);var ut=(e,t,n,i)=>w.create(e,t,n,i,["$feature","$view"],[]),w=class e{constructor(t,n,i,r,a,u,o){this.services=null,this.script=t,this.evaluate=r;let D=Array.isArray(u)?u:u?.fields;this.fields=D??[],this._syntaxTree=i,this._arcade=n,this._arcadeFeature=a,this._spatialReference=o,this._referencesGeometry=n.scriptTouchesGeometry(this._syntaxTree),this._referencesScale=this._arcade.referencesMember(this._syntaxTree,"scale")}static create(t,n,i,r,a,u){return l(this,null,function*(){let{arcade:o,Feature:D,Dictionary:C}=yield E(),O=B.fromJSON(n),c;try{c=o.parseScript(t,u)}catch(s){return Fe().error(new p("arcade-bad-expression","Failed to parse arcade script",{script:t,error:s})),null}let U=a.reduce((s,V)=>m(f({},s),{[V]:null}),{}),F=null;r!=null&&(F=new C(r),F.immutable=!0,U.$config=null);let G=o.scriptUsesGeometryEngine(c),ce=G&&o.enableGeometrySupport(),de=o.scriptUsesFeatureSet(c)&&o.enableFeatureSetSupport(),k=o.scriptIsAsync(c),z=k&&o.enableAsyncSupport(),fe={vars:U,spatialReference:O,useAsync:!!z};yield Promise.all([ce,de,z]);let me=new Set;yield o.loadDependentModules(me,c,null,k,G);let T=new C;T.immutable=!1,T.setField("scale",0);let pe=o.compileScript(c,fe),ye=(s,V)=>{let ge=s.$view?.timeZone;return"$view"in s&&s.$view&&(T.setField("scale",typeof s.$view=="object"&&"scale"in s.$view?s.$view.scale:void 0),s.$view=T),F&&(s.$config=F),pe({vars:s,spatialReference:O,services:V,timeZone:ge})};return new e(t,o,c,ye,new D,i,O)})}repurposeFeature(t){return t.geometry&&!t.geometry.spatialReference&&(t.geometry.spatialReference=this._spatialReference),this._arcadeFeature.repurposeFromGraphicLikeObject(t.geometry,t.attributes,{fields:this.fields}),this._arcadeFeature}referencesGeometry(){return this._referencesGeometry}referencesScale(){return this._referencesScale}};function Te(e){return typeof e=="number"}function h(e){return typeof e=="string"||e instanceof String}var Ie="yyyy-MM-dd",we="TT",y;(function(e){e.HM="HH:mm",e.HMS="HH:mm:ss",e.HMS_MS="HH:mm:ss.SSS"})(y||(y={}));var he=[y.HMS_MS,y.HMS,y.HM,we];function A(e){if(!e||!h(e))return null;let t=I.fromFormat(e,Ie);return t.isValid?t:null}function M(e){return e&&h(e)?P(he,t=>{let n=I.fromFormat(e,t);return n.isValid?n:null})??null:null}function N(e){if(!e||!h(e))return null;let t=I.fromISO(e);return t.isValid?t:null}var d;(function(e){e.VALUE_OUT_OF_RANGE="domain-validation-error::value-out-of-range",e.INVALID_CODED_VALUE="domain-validation-error::invalid-coded-value"})(d||(d={}));var be=new Set(["integer","small-integer","big-integer","esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeBigInteger"]);function xe(e){return e!=null&&be.has(e.type)}function W(e){return e!=null&&(e.type==="date-only"||e.type==="esriFieldTypeDateOnly")}function q(e){return e!=null&&(e.type==="timestamp-offset"||e.type==="esriFieldTypeTimestampOffset")}function Y(e){return e!=null&&(e.type==="time-only"||e.type==="esriFieldTypeTimeOnly")}function K(e,t,n){let i=n??e?.domain;if(!i)return null;switch(i.type){case"range":{let{min:r,max:a}=Q(e,n);if(r!=null&&+t<r||a!=null&&+t>a)return d.VALUE_OUT_OF_RANGE;break}case"coded-value":case"codedValue":if(i.codedValues==null||i.codedValues.every(r=>r==null||r.code!==t))return d.INVALID_CODED_VALUE}return null}function Q(e,t){let n=t??e?.domain;if(!n||n.type!=="range")return;let i="range"in n?n.range[0]:n.minValue,r="range"in n?n.range[1]:n.maxValue,a=xe(e);return W(e)||Y(e)||q(e)?m(f({},Se(e,r,i)),{isInteger:a}):{min:i!=null&&typeof i=="number"?i:null,max:r!=null&&typeof r=="number"?r:null,rawMin:i,rawMax:r,isInteger:a}}function Se(e,t,n){return W(e)?{min:A(n)?.toMillis(),max:A(t)?.toMillis(),rawMin:n,rawMax:t}:Y(e)?{min:M(n)?.toMillis(),max:M(t)?.toMillis(),rawMin:n,rawMax:t}:q(e)?{min:N(n)?.toMillis(),max:N(t)?.toMillis(),rawMin:n,rawMax:t}:{max:null,min:null}}var ve=/^([0-9_])/,De=/[^a-z0-9_\u0080-\uffff]+/gi;function Zt(e){return e==null?null:e.trim().replaceAll(De,"_").replace(ve,"F$1")||null}var Oe=["field","field2","field3","normalizationField","rotationInfo.field","proportionalSymbolInfo.field","proportionalSymbolInfo.normalizationField","colorInfo.field","colorInfo.normalizationField"],Ve=["field","normalizationField"];function jt(e,t){if(e!=null&&t!=null){for(let n of Array.isArray(e)?e:[e])if(ee(Oe,n,t),"visualVariables"in n&&n.visualVariables)for(let i of n.visualVariables)ee(Ve,i,t)}}function ee(e,t,n){if(e)for(let i of e){let r=H(i,t),a=r&&typeof r!="function"&&n.get(r);a&&Z(i,a.name,t)}}function Pt(e,t){if(e!=null&&t?.fields?.length)if("startField"in e){let n=t.get(e.startField),i=t.get(e.endField);e.startField=n?.name??null,e.endField=i?.name??null}else{let n=t.get(e.startTimeField),i=t.get(e.endTimeField);e.startTimeField=n?.name??null,e.endTimeField=i?.name??null}}var $=new Set;function L(e,t){return e&&t?($.clear(),b($,e,t),Array.from($).sort()):[]}function b(e,t,n){if(n)if(t?.fields?.length)if(n.includes("*"))for(let{name:i}of t.fields)e.add(i);else for(let i of n)v(e,t,i);else{if(n.includes("*"))return e.clear(),void e.add("*");for(let i of n)i!=null&&e.add(i)}}function v(e,t,n){if(typeof n=="string")if(t){let i=t.get(n);i&&e.add(i.name)}else e.add(n)}function Xt(e,t){return t==null||e==null?[]:t.includes("*")?(e.fields??[]).map(n=>n.name):t}function Bt(e,t,n=1){if(!t||!e)return[];if(t.includes("*"))return["*"];let i=L(e,t);return i.length/e.fields.length>=n?["*"]:i}function g(e,t,n){return l(this,null,function*(){if(!n)return;let{arcadeUtils:i}=yield E(),r=i.extractFieldNames(n,t?.fields?.map(a=>a.name));for(let a of r)v(e,t,a)})}function te(e,t,n){return l(this,null,function*(){if(n&&n!=="1=1"){let i=yield J(n,t);if(!i.isStandardized)throw new p("fieldUtils:collectFilterFields","Where clause is not standardized",{where:n});b(e,t,i.fieldNames)}})}function Jt({displayField:e,fields:t}){return e||(t?.length?R(t,"name-or-title")||R(t,"unique-identifier")||R(t,"type-or-category")||_e(t):null)}function _e(e){for(let t of e){if(!t?.name)continue;let n=t.name.toLowerCase();if(n.includes("name")||n.includes("title"))return t.name}return null}function R(e,t){for(let n of e)if(n?.valueType&&n.valueType===t)return n.name;return null}function Wt(e,t){return l(this,null,function*(){if(!t)return;let n=t.elevationInfo?.featureExpressionInfo;return n?n.collectRequiredFields(e,t.fieldsIndex):void 0})}function Ee(e,t,n){n.onStatisticExpression?g(e,t,n.onStatisticExpression.expression):e.add(n.onStatisticField)}function qt(e,t,n){return l(this,null,function*(){if(!t||!n||!("fields"in n))return;let i=[],r=n.popupTemplate;i.push(Ae(e,t,r)),n.fields&&i.push(...n.fields.map(a=>l(this,null,function*(){return Ee(e,t.fieldsIndex,a)}))),yield Promise.all(i)})}function Ae(e,t,n){return l(this,null,function*(){let i=[];n?.expressionInfos&&i.push(...n.expressionInfos.map(a=>g(e,t.fieldsIndex,a.expression)));let r=n?.content;if(Array.isArray(r))for(let a of r)a.type==="expression"&&a.expressionInfo&&i.push(g(e,t.fieldsIndex,a.expressionInfo.expression));yield Promise.all(i)})}function Yt(e,t,n){return l(this,null,function*(){t&&(t.timeInfo&&n?.timeExtent&&b(e,t.fieldsIndex,[t.timeInfo.startField,t.timeInfo.endField]),t.floorInfo&&b(e,t.fieldsIndex,[t.floorInfo.floorField]),n?.where!=null&&(yield te(e,t.fieldsIndex,n.where)))})}function Kt(e,t,n){return l(this,null,function*(){t&&n&&(yield Promise.all(n.map(i=>Me(e,t,i))))})}function Me(e,t,n){return l(this,null,function*(){t&&n&&(n.valueExpression?yield g(e,t.fieldsIndex,n.valueExpression):n.field&&v(e,t.fieldsIndex,n.field))})}function Qt(e){return e?L(e.fieldsIndex,ne(e)):[]}function Ne(e){if(!e)return[];let t=e.geometryFieldsInfo;return t?L(e.fieldsIndex,[t.shapeAreaField,t.shapeLengthField]):[]}var $e=new Set(["oid","global-id","guid"]),Re=new Set(["oid","global-id"]),Le=[/^fnode_$/i,/^tnode_$/i,/^lpoly_$/i,/^rpoly_$/i,/^poly_$/i,/^shape$/i,/^shape_$/i,/^subclass$/i,/^subclass_$/i,/^rings_ok$/i,/^rings_nok$/i,/perimeter/i,/objectid/i,/_i$/i];function Ce(e){let t=new Set;ie(e).forEach(i=>t.add(i)),Ne(e).forEach(i=>t.add(i.toLowerCase()));let n=e&&"infoFor3D"in e?e.infoFor3D:void 0;return n&&(Object.values(n.assetMapFieldRoles).forEach(i=>t.add(i.toLowerCase())),Object.values(n.transformFieldRoles).forEach(i=>t.add(i.toLowerCase()))),Array.from(t)}function ne(e){if(!e)return[];let t="editFieldsInfo"in e&&e.editFieldsInfo;if(!t)return[];let{creationDateField:n,creatorField:i,editDateField:r,editorField:a}=t;return[n,i,r,a].filter(Boolean)}function ie(e){return ne(e).map(t=>t.toLowerCase())}function en(e,t){return e.editable&&!$e.has(e.type)&&!ie(t).includes(e.name?.toLowerCase()??"")}function tn(e,t){let n=e.name?.toLowerCase()??"";return!(t?.objectIdField!=null&&n===t.objectIdField.toLowerCase()||t?.globalIdField!=null&&n===t.globalIdField.toLowerCase()||Ce(t).includes(n)||Re.has(e.type)||Le.some(i=>i.test(n)))}function nn(e,t){return l(this,null,function*(){let{labelingInfo:n,fieldsIndex:i}=t;n?.length&&(yield Promise.all(n.map(r=>Ue(e,i,r))))})}function Ue(e,t,n){return l(this,null,function*(){if(!n)return;let i=n.getLabelExpression(),r=n.where;if(i.type==="arcade")yield g(e,t,i.expression);else{let a=i.expression.match(/{[^}]*}/g);a&&a.forEach(u=>{v(e,t,u.slice(1,-1))})}yield te(e,t,r)})}function rn(e){let t=e.defaultValue;return t!==void 0&&le(e,t)?t:e.nullable?null:void 0}function an(e){let t=typeof e=="string"?{type:e}:e;return We(t)?255:t.type==="esriFieldTypeDate"||t.type==="date"?8:void 0}function re(e){return typeof e=="number"&&!isNaN(e)&&isFinite(e)}function Ge(e){return e===null||re(e)}function ke(e){return e===null||Number.isInteger(e)}function ae(e){return e!=null&&typeof e=="string"}function ze(e){return e===null||ae(e)}function He(){return!0}function le(e,t){let n;switch(e.type){case"date":case"integer":case"long":case"small-integer":case"big-integer":case"esriFieldTypeDate":case"esriFieldTypeInteger":case"esriFieldTypeLong":case"esriFieldTypeSmallInteger":case"esriFieldTypeBigInteger":n=e.nullable?ke:Number.isInteger;break;case"double":case"single":case"esriFieldTypeSingle":case"esriFieldTypeDouble":n=e.nullable?Ge:re;break;case"string":case"esriFieldTypeString":n=e.nullable?ze:ae;break;default:n=He}return arguments.length===1?n:n(t)}var se=["integer","small-integer","big-integer"],oe=["single","double"],ln=[...se,...oe],Ze=["esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeBigInteger"],je=["esriFieldTypeSingle","esriFieldTypeDouble"],Pe=new Set([...se,...Ze]),Xe=new Set([...oe,...je]),Be=X(Pe,Xe);function Je(e){return e!=null&&Be.has(e.type)}function We(e){return e!=null&&(e.type==="string"||e.type==="esriFieldTypeString")}function sn(e){return e!=null&&(e.type==="date"||e.type==="esriFieldTypeDate")}function on(e){return e!=null&&(e.type==="date-only"||e.type==="esriFieldTypeDateOnly")}function un(e){return e!=null&&(e.type==="timestamp-offset"||e.type==="esriFieldTypeTimestampOffset")}function cn(e){return e!=null&&(e.type==="time-only"||e.type==="esriFieldTypeTimeOnly")}function dn(e){return e!=null&&(e.type==="oid"||e.type==="esriFieldTypeOID")}function fn(e){return e!=null&&(e.type==="global-id"||e.type==="esriFieldTypeGlobalID")}function mn(e,t){return qe(e,t)===null}var x,S;function pn(e){return e==null||typeof e=="number"&&isNaN(e)?null:e}function qe(e,t){return e==null||e.nullable&&t===null?null:Je(e)&&!Ye(e.type,Number(t))?x.OUT_OF_RANGE:le(e,t)?e.domain?K(e,t):null:S.INVALID_TYPE}function Ye(e,t){let n=typeof e=="string"?ue(e):e;if(!n)return!1;let i=n.min,r=n.max;return n.isInteger?Number.isInteger(t)&&t>=i&&t<=r:t>=i&&t<=r}function ue(e){switch(e){case"esriFieldTypeSmallInteger":case"small-integer":return Ke;case"esriFieldTypeInteger":case"integer":return Qe;case"esriFieldTypeBigInteger":case"big-integer":return et;case"esriFieldTypeSingle":case"single":return tt;case"esriFieldTypeDouble":case"double":return nt}}(function(e){e.OUT_OF_RANGE="numeric-range-validation-error::out-of-range"})(x||(x={})),function(e){e.INVALID_TYPE="type-validation-error::invalid-type"}(S||(S={}));var Ke={min:-32768,max:32767,isInteger:!0,rawMin:-32768,rawMax:32767},Qe={min:-2147483648,max:2147483647,isInteger:!0,rawMin:-2147483648,rawMax:2147483647},et={min:-Number.MAX_SAFE_INTEGER,max:Number.MAX_SAFE_INTEGER,isInteger:!0,rawMin:-Number.MAX_SAFE_INTEGER,rawMax:Number.MAX_SAFE_INTEGER},tt={min:-34e37,max:12e37,isInteger:!1,rawMin:-34e37,rawMax:12e37},nt={min:-Number.MAX_VALUE,max:Number.MAX_VALUE,isInteger:!1,rawMin:-Number.MAX_VALUE,rawMax:Number.MAX_VALUE};function yn(e,t,n){switch(e){case d.INVALID_CODED_VALUE:return`Value ${n} is not in the coded domain - field: ${t.name}, domain: ${JSON.stringify(t.domain)}`;case d.VALUE_OUT_OF_RANGE:return`Value ${n} is out of the range of valid values - field: ${t.name}, domain: ${JSON.stringify(t.domain)}`;case S.INVALID_TYPE:return`Value ${n} is not a valid value for the field type - field: ${t.name}, type: ${t.type}, nullable: ${t.nullable}`;case x.OUT_OF_RANGE:{let{min:i,max:r}=ue(t.type);return`Value ${n} is out of range for the number type - field: ${t.name}, type: ${t.type}, value range is ${i} to ${r}`}}}function gn(e,t){return!it(e,t,null)}function it(e,t,n){if(!t?.attributes||!e){if(n!=null)for(let a of e??[])n.add(a);return!0}let i=new Set(Object.keys(t.attributes)),r=!1;for(let a of e)if(!i.has(a)){if(r=!0,n==null)break;n.add(a)}return r}function Fn(e){return!!e&&["raster.itempixelvalue","raster.servicepixelvalue"].some(t=>e.toLowerCase().startsWith(t))}function Tn(e){let t=e?.match(/{[^}]+}/g);return t?t.map(n=>n.slice(1,-1).split(":")[0].trim()):[]}export{Te as a,Q as b,E as c,ot as d,ut as e,Zt as f,jt as g,Pt as h,L as i,b as j,v as k,Xt as l,Bt as m,g as n,Jt as o,Wt as p,qt as q,Yt as r,Kt as s,Qt as t,en as u,tn as v,nn as w,rn as x,an as y,Je as z,We as A,sn as B,on as C,un as D,cn as E,dn as F,fn as G,mn as H,pn as I,qe as J,yn as K,gn as L,Fn as M,Tn as N};
