import{a as E}from"./chunk-LK52GLIE.js";import{g as T,h as w}from"./chunk-7WFRJSY3.js";import{I as u,L as d}from"./chunk-Z5NXR7SL.js";import{S as y}from"./chunk-7JLWSSXP.js";import{a as l}from"./chunk-W3WDPWBE.js";import{b as _,q as g}from"./chunk-BRWS572J.js";import{a as m}from"./chunk-AKNRR36C.js";var p=-1,h=class extends d{constructor(t){super(t),this._from=null,this._to=null,this._final=null,this._current=[],this._time=0,this.duration=m("mapview-transitions-duration"),this.effects=[]}set effect(t){if(this._get("effect")!==(t=t||"")){this._set("effect",t);try{this._transitionTo(v(t))}catch(e){this._transitionTo([]),g.getLogger(this).warn("Invalid Effect",{effect:t,error:e})}}}get hasEffects(){return this.transitioning||!!this.effects.length}set scale(t){this._updateForScale(t)}get transitioning(){return this._to!==null}canTransitionTo(t){try{return this.scale>0&&S(this._current,v(t),this.scale)}catch{return!1}}transitionStep(t,e){this._applyTimeTransition(t),this._updateForScale(e)}endTransitions(){this._applyTimeTransition(this.duration)}_transitionTo(t){this.scale>0&&S(this._current,t,this.scale)?(this._final=t,this._to=_(t),F(this._current,this._to,this.scale),this._from=_(this._current),this._time=0):(this._from=this._to=this._final=null,this._current=t),this._set("effects",this._current[0]?_(this._current[0].effects):[])}_applyTimeTransition(t){if(!(this._to&&this._from&&this._current&&this._final))return;this._time+=t;let e=Math.min(1,this._time/this.duration);for(let n=0;n<this._current.length;n++){let o=this._current[n],i=this._from[n],f=this._to[n];o.scale=V(i.scale,f.scale,e);for(let r=0;r<o.effects.length;r++){let a=o.effects[r],s=i.effects[r],c=f.effects[r];a.interpolate(s,c,e)}}e===1&&(this._current=this._final,this._set("effects",this._current[0]?_(this._current[0].effects):[]),this._from=this._to=this._final=null)}_updateForScale(t){if(this._set("scale",t),this._current.length===0)return;let e=this._current,n=this._current.length-1,o,i,f=1;if(e.length===1||t>=e[0].scale)i=o=e[0].effects;else if(t<=e[n].scale)i=o=e[n].effects;else for(let r=0;r<n;r++){let a=e[r],s=e[r+1];if(a.scale>=t&&s.scale<=t){f=(t-a.scale)/(s.scale-a.scale),o=a.effects,i=s.effects;break}}for(let r=0;r<this.effects.length;r++)this.effects[r].interpolate(o[r],i[r],f)}};function v(t){let e=E(t)||[];return b(e)?[{scale:p,effects:e}]:e}function S(t,e,n){return!t[0]?.effects||!e[0]?.effects?!0:!((t[0]?.scale===p||e[0]?.scale===p)&&(t.length>1||e.length>1)&&n<=0)&&T(t[0].effects,e[0].effects)}function F(t,e,n){let o=t.length>e.length?t:e,i=t.length>e.length?e:t,f=i[i.length-1],r=f?.scale??n,a=f?.effects??[];for(let s=i.length;s<o.length;s++)i.push({scale:r,effects:[...a]});for(let s=0;s<o.length;s++)i[s].scale=i[s].scale===p?n:i[s].scale,o[s].scale=o[s].scale===p?n:o[s].scale,w(i[s].effects,o[s].effects)}function V(t,e,n){return t+(e-t)*n}function b(t){let e=t[0];return!!e&&"type"in e}l([u()],h.prototype,"_to",void 0),l([u()],h.prototype,"duration",void 0),l([u({value:""})],h.prototype,"effect",null),l([u({readOnly:!0})],h.prototype,"effects",void 0),l([u({readOnly:!0})],h.prototype,"hasEffects",null),l([u({value:0})],h.prototype,"scale",null),l([u({readOnly:!0})],h.prototype,"transitioning",null),h=l([y("esri.layers.effects.EffectView")],h);function O(){let t=new Float32Array(9);return t[0]=1,t[4]=1,t[8]=1,t}function A(t){let e=new Float32Array(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function x(t,e,n,o,i,f,r,a,s){let c=new Float32Array(9);return c[0]=t,c[1]=e,c[2]=n,c[3]=o,c[4]=i,c[5]=f,c[6]=r,c[7]=a,c[8]=s,c}function z(t,e){return new Float32Array(t,e,9)}var H=Object.freeze(Object.defineProperty({__proto__:null,clone:A,create:O,createView:z,fromValues:x},Symbol.toStringTag,{value:"Module"}));export{h as a,O as b,A as c};
