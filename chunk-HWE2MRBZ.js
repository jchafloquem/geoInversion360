import{i as Kr}from"./chunk-MODIWOII.js";import{c as Ie}from"./chunk-4INMWFSQ.js";import{e as qr}from"./chunk-IATQ4WNP.js";import{a as Gr}from"./chunk-4FSVG2A5.js";import{a as te}from"./chunk-RHABF3KL.js";import{a as Rr}from"./chunk-I46GU3Q4.js";import{a as Hr}from"./chunk-Y5GQJM6D.js";import{a as Lr}from"./chunk-2FYXACXP.js";import{I as Ye,L as Br}from"./chunk-Z5NXR7SL.js";import{S as Ar}from"./chunk-7JLWSSXP.js";import{a as o,b as v}from"./chunk-W3WDPWBE.js";import{h as zr,n as Ur,q as kt,s as Se}from"./chunk-BRWS572J.js";import{a as Ve}from"./chunk-AKNRR36C.js";import{a as V,b as Et}from"./chunk-JEGVIFEP.js";var jr;(function(e){e[e.Fill=0]="Fill",e[e.PatternFill=1]="PatternFill",e[e.ComplexFill=2]="ComplexFill",e[e.OutlineFill=3]="OutlineFill",e[e.PatternOutlineFill=4]="PatternOutlineFill",e[e.ComplexOutlineFill=5]="ComplexOutlineFill",e[e.Marker=6]="Marker",e[e.PieChart=7]="PieChart",e[e.Line=8]="Line",e[e.TexturedLine=9]="TexturedLine",e[e.Text=10]="Text",e[e.Label=11]="Label",e[e.Heatmap=12]="Heatmap",e[e.DotDensity=13]="DotDensity",e[e.Test=14]="Test"})(jr||(jr={}));var Wr;(function(e){e[e.Geographic=0]="Geographic",e[e.Arithmatic=1]="Arithmatic"})(Wr||(Wr={}));var Jn=3.14159265359/180,Zr=3.14159265359/128,Qn=180/3.141592654,ti=1/8;var ei=1,Xr=1.1,Yr=1,ri=1/4,ni=1/8;var ii=24,si=8;var Jr=1e-5,Je=.05;var Qr=1e-30;var tn=4;var en=0,rn=2,oi=2,ai=3,ui=0,li=3,nn=16777216;var Tn=()=>kt.getLogger("esri.views.3d.webgl-engine.core.shaderModules.shaderBuilder"),Fe=class{constructor(){this._includedModules=new Map}include(t,r){this._includedModules.has(t)?this._includedModules.get(t):(this._includedModules.set(t,r),t(this.builder,r))}},Te=class extends Fe{constructor(){super(...arguments),this.vertex=new _e,this.fragment=new _e,this.attributes=new er,this.varyings=new rr,this.extensions=new ee,this.constants=new $e}get fragmentUniforms(){return this.fragment.uniforms.entries}get builder(){return this}generate(t,r=!0){let n=this.extensions.generateSource(t),i=this.attributes.generateSource(t),s=this.varyings.generateSource(t),a=t==="vertex"?this.vertex:this.fragment,l=a.uniforms.generateSource(),p=a.code.generateSource(),c=t==="vertex"?$n:_n(r),m=this.constants.generateSource().concat(a.constants.generateSource());return`${r?"#version 300 es":""}
${n.join(`
`)}
${c}
${m.join(`
`)}
${l.join(`
`)}
${i.join(`
`)}
${s.join(`
`)}
${p.join(`
`)}`}generateBindPass(t){let r=new Map;this.vertex.uniforms.entries.forEach(s=>{let a=s.bind[te.Pass];a&&r.set(s.name,a)}),this.fragment.uniforms.entries.forEach(s=>{let a=s.bind[te.Pass];a&&r.set(s.name,a)});let n=Array.from(r.values()),i=n.length;return(s,a)=>{for(let l=0;l<i;++l)n[l](t,s,a)}}generateBindDraw(t){let r=new Map;this.vertex.uniforms.entries.forEach(s=>{let a=s.bind[te.Draw];a&&r.set(s.name,a)}),this.fragment.uniforms.entries.forEach(s=>{let a=s.bind[te.Draw];a&&r.set(s.name,a)});let n=Array.from(r.values()),i=n.length;return(s,a,l)=>{for(let p=0;p<i;++p)n[p](t,s,a,l)}}},Qe=class{constructor(){this._entries=new Map}add(...t){for(let r of t)this._add(r)}get(t){return this._entries.get(t)}_add(t){if(t!=null){if(this._entries.has(t.name)&&!this._entries.get(t.name).equals(t))throw new Se(`Duplicate uniform name ${t.name} for different uniform type`);this._entries.set(t.name,t)}else Tn().error(`Trying to add null Uniform from ${new Error().stack}.`)}generateSource(){return Array.from(this._entries.values()).map(t=>t.arraySize!=null?`uniform ${t.type} ${t.name}[${t.arraySize}];`:`uniform ${t.type} ${t.name};`)}get entries(){return Array.from(this._entries.values())}},tr=class{constructor(){this._entries=new Array}add(t){this._entries.push(t)}generateSource(){return this._entries}},_e=class extends Fe{constructor(){super(...arguments),this.uniforms=new Qe,this.code=new tr,this.constants=new $e}get builder(){return this}},er=class{constructor(){this._entries=new Array}add(t,r){this._entries.push([t,r])}generateSource(t){return t==="fragment"?[]:this._entries.map(r=>`in ${r[1]} ${r[0]};`)}},rr=class{constructor(){this._entries=new Map}add(t,r){this._entries.has(t)&&Rr(this._entries.get(t)===r),this._entries.set(t,r)}generateSource(t){let r=new Array;return this._entries.forEach((n,i)=>r.push(t==="vertex"?`out ${n} ${i};`:`in ${n} ${i};`)),r}},ee=class e{constructor(){this._entries=new Set}add(t){this._entries.add(t)}generateSource(t){let r=t==="vertex"?e.ALLOWLIST_VERTEX:e.ALLOWLIST_FRAGMENT;return Array.from(this._entries).filter(n=>r.includes(n)).map(n=>`#extension ${n} : enable`)}};ee.ALLOWLIST_FRAGMENT=["GL_EXT_shader_texture_lod","GL_OES_standard_derivatives"],ee.ALLOWLIST_VERTEX=[];var $e=class e{constructor(){this._entries=new Set}add(t,r,n){let i="ERROR_CONSTRUCTOR_STRING";switch(r){case"float":i=e._numberToFloatStr(n);break;case"int":i=e._numberToIntStr(n);break;case"bool":i=n.toString();break;case"vec2":i=`vec2(${e._numberToFloatStr(n[0])},                            ${e._numberToFloatStr(n[1])})`;break;case"vec3":i=`vec3(${e._numberToFloatStr(n[0])},                            ${e._numberToFloatStr(n[1])},                            ${e._numberToFloatStr(n[2])})`;break;case"vec4":i=`vec4(${e._numberToFloatStr(n[0])},                            ${e._numberToFloatStr(n[1])},                            ${e._numberToFloatStr(n[2])},                            ${e._numberToFloatStr(n[3])})`;break;case"ivec2":i=`ivec2(${e._numberToIntStr(n[0])},                             ${e._numberToIntStr(n[1])})`;break;case"ivec3":i=`ivec3(${e._numberToIntStr(n[0])},                             ${e._numberToIntStr(n[1])},                             ${e._numberToIntStr(n[2])})`;break;case"ivec4":i=`ivec4(${e._numberToIntStr(n[0])},                             ${e._numberToIntStr(n[1])},                             ${e._numberToIntStr(n[2])},                             ${e._numberToIntStr(n[3])})`;break;case"mat2":case"mat3":case"mat4":i=`${r}(${Array.prototype.map.call(n,s=>e._numberToFloatStr(s)).join(", ")})`}return this._entries.add(`const ${r} ${t} = ${i};`),this}static _numberToIntStr(t){return t.toFixed(0)}static _numberToFloatStr(t){return Number.isInteger(t)?t.toFixed(1):t.toString()}generateSource(){return Array.from(this._entries)}};function _n(e=!0){return`#ifdef GL_FRAGMENT_PRECISION_HIGH
  precision highp float;
  precision highp sampler2D;
#else
  precision mediump float;
  precision mediump sampler2D;
#endif
${e?"out vec4 fragColor;":""}
`}var $n=`precision highp float;
precision highp sampler2D;`;function Cn(e){return e.split(" ").map((t,r)=>r>0?t.charAt(0).toUpperCase()+t.slice(1):t).join("")}function sn(e,t){let r=[];for(r.push(t);r.length;){let n=r.pop();if(typeof n=="object"&&!e.has(n.uid)){e.add(n.uid);for(let i of n.children)r.push(i)}}}var dt=class e{constructor(){this.uid=e.NodeCount++,this._debugName=null,this._isMutable=!1,this.isImplicit=!1}get isMutable(){return this._isMutable}setMutable(){return this._isMutable=!0,this}setDebugName(t){return t=Cn(t),this._debugName=t,this.isImplicit&&this.children[0]instanceof e&&this.children[0].setDebugName(t),this}get debugInfo(){return{name:this._debugName??""}}cloneInto(t){t._debugName=this._debugName,t._isMutable=this._isMutable,t.isImplicit=this.isImplicit,t.uid=this.uid}};function d(e){return typeof e=="object"?e.clone():e}dt.NodeCount=0;var $=class extends dt{constructor(){super(...arguments),this.shaderType="primitive-node"}},Ce=class e extends dt{constructor(t){super(),this.child=t,this.shaderType="scope-node"}get children(){return[this.child]}clone(){let t=new e(d(this.child));return this.cloneInto(t),t}};var Oe=class e extends dt{constructor(t,r,n){super(),this.property=t,this.target=r,this.returnType=n,this.shaderType="property-access-node"}get children(){let t=[this.target];return typeof this.property!="string"&&t.push(this.property),t}clone(){let t=new e(this.property,d(this.target),this.returnType);return this.cloneInto(t),t}},Ne=class e extends dt{constructor(t,r,n){super(),this.condition=t,this.ifTrue=r,this.ifFalse=n,this.shaderType="condition-node"}get children(){return[this.condition,this.ifTrue,this.ifFalse]}clone(){let t=d(this.ifTrue),r=this.ifFalse?d(this.ifFalse):null,n=new e(this.condition,t,r);return this.cloneInto(n),n}},Pe=class e extends dt{constructor(t,r,n,i){super(),this.captureList=t,this.returnType=r,this.generator=i,this.shaderType="block-node",n&&(this.subgraph=new Ce(n))}get children(){return Object.keys(this.captureList).map(t=>this.captureList[t]).concat(this.subgraph??[])}clone(){let t={};for(let n in this.captureList)t[n]=d(this.captureList[n]);let r=new e(t,this.returnType,this.subgraph?d(this.subgraph.child):this.subgraph,this.generator);return this.cloneInto(r),r}},it=class e extends dt{constructor(t,r,n,i,s,a=!1){super(),this.token=t,this._children=r,this.isInfix=n,this.isPropertyAccess=i,this.returnType=s,this.isTernary=a,this.shaderType="function-node"}get children(){return this._children}clone(){let t=new e(this.token,this._children.map(d),this.isInfix,this.isPropertyAccess,this.returnType,this.isTernary);return this.cloneInto(t),t}};var re,nr,ir,sr,or,ar,ur,lr,cr,pr,dr,hr,mr,fr;function On(e){let t=[["float","vec2","vec3","vec4"],["int","ivec2","ivec3","ivec4"],["uint","uvec2","uvec3","uvec4"],["bool","bvec2","bvec3","bvec4"]];for(let r of t)if(r.includes(e))return r.map(n=>Mn[n]);throw new Error("Unable to find type family")}function on(e){return new Proxy(e,{get(t,r){if(r==="constructor")return new Proxy(t.constructor,{construct:(n,i,s)=>on(new n(...i))});if(r in t)return t[r];if(typeof r=="string"){let n=On(e.type);return U(e,r,n[r.length-1])}}})}function A(e){return new Proxy(e,{construct:(t,r,n)=>on(new t(...r))})}function Nn(e){return new Proxy(e,{get(t,r){if(r in t)return t[r];if(typeof r=="string"){let n=parseInt(r,10);if(!isNaN(n))return U(e,`[${n}]`,e.elementType.constructor)}}})}function Pn(e){return new Proxy(e,{construct:(t,r,n)=>Nn(new t(...r))})}var ne=class extends Error{},k=re=class extends ${constructor(e,t){super(),this.elementType=e,this.size=t,this.children=[],this.type="array"}clone(){let e=new re(this.elementType,this.size);return super.cloneInto(e),e}get(e){if(typeof e=="number"){let t=new gt(e);return t.isImplicit=!0,U(this,t,this.elementType.constructor)}return U(this,e,this.elementType.constructor)}last(){return this.get(this.size-1)}first(){return this.get(0)}findIndex(e,t,r){return Dn(this,e,t,r)}glslFindIndex(e,t,r){return En(this,e,t,r)}static ofType(e,t){let r={construct:(n,i)=>new re(new e,t)};return new Proxy(re,r)}};k.type="array",k=re=o([Pn],k);var st=(()=>{class e extends ${constructor(){super(...arguments),this.type="sampler2D",this.children=[]}clone(){let r=new e;return r.children=this.children.map(d),super.cloneInto(r),r}}return e.type="sampler2D",e})(),u=(()=>{class e extends ${constructor(r){super(),this.type="float",this.children=[r]}clone(){let r=new e(d(this.children[0]));return super.cloneInto(r),r}multiply(r){return bt(this,typeof r=="number"?C(r,e):r)}divide(r){return Ut(this,typeof r=="number"?C(r,e):r)}add(r){return At(this,typeof r=="number"?C(r,e):r)}subtract(r){return se(this,typeof r=="number"?C(r,e):r)}}return e.type="float",e})(),y=nr=class extends ${constructor(e,t){super(),this.type="vec2",this.children=[e,t].filter(r=>r!=null)}clone(){let e=new nr(d(this.children[0]),d(this.children[1]));return super.cloneInto(e),e}get 0(){return U(this,"[0]",u)}get 1(){return U(this,"[1]",u)}get 2(){throw new ne}get 3(){throw new ne}multiply(e){return bt(this,typeof e=="number"?C(e,u):e)}divide(e){return Ut(this,typeof e=="number"?C(e,u):e)}add(e){return At(this,typeof e=="number"?C(e,u):e)}subtract(e){return se(this,typeof e=="number"?C(e,u):e)}};y.type="vec2",y=nr=o([A],y);var I=ir=class extends ${constructor(e,t,r){super(),this.type="vec3",this.children=[e,t,r].filter(n=>n!=null)}get 0(){return U(this,"[0]",u)}get 1(){return U(this,"[1]",u)}get 2(){return U(this,"[2]",u)}get 3(){throw new ne}clone(){let e=new ir(d(this.children[0]),d(this.children[1]),d(this.children[2]));return super.cloneInto(e),e}multiply(e){return bt(this,typeof e=="number"?C(e,u):e)}divide(e){return Ut(this,typeof e=="number"?C(e,u):e)}add(e){return At(this,typeof e=="number"?C(e,u):e)}subtract(e){return se(this,typeof e=="number"?C(e,u):e)}};I.type="vec3",I=ir=o([A],I);var b=sr=class extends ${constructor(e,t,r,n){super(),this.type="vec4",this.children=[e,t,r,n].filter(i=>i!=null)}clone(){let e=new sr(d(this.children[0]),d(this.children[1]),d(this.children[2]),d(this.children[3]));return super.cloneInto(e),e}get 0(){return U(this,"[0]",u)}get 1(){return U(this,"[1]",u)}get 2(){return U(this,"[2]",u)}get 3(){return U(this,"[3]",u)}multiply(e){return bt(this,typeof e=="number"?C(e,u):e)}divide(e){return Ut(this,typeof e=="number"?C(e,u):e)}add(e){return At(this,typeof e=="number"?C(e,u):e)}subtract(e){return se(this,typeof e=="number"?C(e,u):e)}};b.type="vec4",b=sr=o([A],b);var Me=or=class extends ${constructor(e){super(),this.type="uint",this.children=[e]}clone(){let e=new or(d(this.children[0]));return super.cloneInto(e),e}};Me.type="uint",Me=or=o([A],Me);var De=ar=class extends ${constructor(e,t){super(),this.type="uvec2",this.children=[e,t].filter(r=>r!=null)}clone(){let e=new ar(d(this.children[0]),d(this.children[1]));return super.cloneInto(e),e}};De.type="uvec2",De=ar=o([A],De);var Ee=ur=class extends ${constructor(e,t,r){super(),this.type="uvec3",this.children=[e,t,r].filter(n=>n!=null)}clone(){let e=new ur(d(this.children[0]),d(this.children[1]),d(this.children[2]));return super.cloneInto(e),e}};Ee.type="uvec3",Ee=ur=o([A],Ee);var ke=lr=class extends ${constructor(e,t,r,n){super(),this.type="uvec4",this.children=[e,t,r,n].filter(i=>i!=null)}clone(){let e=new lr(d(this.children[0]),d(this.children[1]),d(this.children[2]),d(this.children[3]));return super.cloneInto(e),e}};ke.type="uvec4",ke=lr=o([A],ke);var K=(()=>{class e extends ${constructor(r){super(),this.type="bool",this.children=[r]}and(r){return He(this,r)}or(r){return br(this,r)}clone(){let r=new e(d(this.children[0]));return super.cloneInto(r),r}}return e.type="bool",e})(),ze=cr=class extends ${constructor(e,t){super(),this.type="bvec2",this.children=[e,t].filter(r=>r!=null)}all(){return vr(this)}any(){return xr(this)}clone(){let e=new cr(d(this.children[0]),d(this.children[1]));return super.cloneInto(e),e}};ze.type="bvec2",ze=cr=o([A],ze);var Ue=pr=class extends ${constructor(e,t,r){super(),this.type="bvec3",this.children=[e,t,r].filter(n=>n!=null)}all(){return vr(this)}any(){return xr(this)}clone(){let e=new pr(d(this.children[0]),d(this.children[1]),d(this.children[2]));return super.cloneInto(e),e}};function C(e,t){return typeof e=="number"?new t(e):e}Ue.type="bvec3",Ue=pr=o([A],Ue);var Ae=dr=class extends ${constructor(e,t,r,n){super(),this.type="bvec4",this.children=[e,t,r,n].filter(i=>i!=null)}all(){return vr(this)}any(){return xr(this)}clone(){let e=new dr(d(this.children[0]),d(this.children[1]),d(this.children[2]),d(this.children[3]));return super.cloneInto(e),e}};Ae.type="bvec4",Ae=dr=o([A],Ae);var gt=(()=>{class e extends ${constructor(r){super(),this.type="int",this.children=[r]}multiply(r){return bt(this,C(r,e))}add(r){return At(this,C(r,e))}subtract(r){return se(this,C(r,e))}divide(r){return Ut(this,C(r,e))}clone(){let r=new e(d(this.children[0]));return super.cloneInto(r),r}}return e.type="int",e})(),Be=hr=class extends ${constructor(e,t){super(),this.type="ivec2",this.children=[e,t].filter(r=>r!=null)}clone(){let e=new hr(d(this.children[0]),d(this.children[1]));return super.cloneInto(e),e}};Be.type="ivec2",Be=hr=o([A],Be);var Le=mr=class extends ${constructor(e,t,r){super(),this.type="ivec3",this.children=[e,t,r].filter(n=>n!=null)}clone(){let e=new mr(d(this.children[0]),d(this.children[1]),d(this.children[2]));return super.cloneInto(e),e}};Le.type="ivec3",Le=mr=o([A],Le);var Re=fr=class extends ${constructor(e,t,r,n){super(),this.type="ivec4",this.children=[e,t,r,n].filter(i=>i!=null)}clone(){let e=new fr(d(this.children[0]),d(this.children[1]),d(this.children[2]),d(this.children[3]));return super.cloneInto(e),e}};Re.type="ivec4",Re=fr=o([A],Re);var B=(()=>{class e extends ${static identity(){return new e(1,0,0,0,1,0,0,0,1)}static fromRotation(r){let n=ue(r),i=wr(r);return new e(i,n,0,zt(n),i,0,0,0,1)}constructor(r,n,i,s,a,l,p,c,m){super(),this.type="mat3",this.children=[r,n,i,s,a,l,p,c,m]}add(r){return At(this,r)}multiply(r){return bt(this,r)}clone(){let r=new e(d(this.children[0]),d(this.children[1]),d(this.children[2]),d(this.children[3]),d(this.children[4]),d(this.children[5]),d(this.children[6]),d(this.children[7]),d(this.children[8]));return super.cloneInto(r),r}}return e.type="mat3",e})(),xi=(()=>{class e extends ${static identity(){return new e(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)}constructor(r,n,i,s,a,l,p,c,m,g,T,N,M,pt,yt,_t){super(),this.type="mat4",this.children=[r,n,i,s,a,l,p,c,m,g,T,N,M,pt,yt,_t]}static fromColumns(r,n,i,s){return new e(r.x,r.y,r.z,r.w,n.x,n.y,n.z,n.w,i.x,i.y,i.z,i.w,s.x,s.y,s.z,s.w)}multiply(r){return bt(this,r)}clone(){let r=new e(d(this.children[0]),d(this.children[1]),d(this.children[2]),d(this.children[3]),d(this.children[4]),d(this.children[5]),d(this.children[6]),d(this.children[7]),d(this.children[8]),d(this.children[9]),d(this.children[10]),d(this.children[11]),d(this.children[12]),d(this.children[13]),d(this.children[14]),d(this.children[15]));return super.cloneInto(r),r}}return e.type="mat4",e})(),Mn={float:u,vec2:y,vec3:I,vec4:b,int:gt,ivec2:Be,ivec3:Le,ivec4:Re,uint:Me,uvec2:De,uvec3:Ee,uvec4:ke,bool:K,bvec2:ze,bvec3:Ue,bvec4:Ae},$t=(...e)=>new gt(...e),F=(...e)=>new u(...e),ie=(...e)=>new y(...e),an=(...e)=>new I(...e),un=(...e)=>new b(...e);var yr=(...e)=>new B(...e);function U(e,t,r){let n=new r(new Oe(t,e,r));return n.isImplicit=!0,n}function L(e,t,r,n=null){if(n){let s=new n,a=new n(new it(e,[t,r],!0,!1,s));return a.isImplicit=!0,a}if(t.type==="float"||t.type==="int"){let s=new r.constructor(new it(e,[t,r],!0,!1,r.constructor));return s.isImplicit=!0,s}if((t.type==="mat2"||t.type==="mat3"||t.type==="mat4")&&r.type!=="float"){let s=new r.constructor(new it(e,[t,r],!0,!1,r.constructor));return s.isImplicit=!0,s}let i=new t.constructor(new it(e,[t,r],!0,!1,t.constructor));return i.isImplicit=!0,i}function G(e,t,r=t.constructor){let n=new r(new it(e,[t],!1,!1,r));return n.isImplicit=!0,n}function Ct(e,t,r,n=t.constructor){let i=new n(new it(e,[t,r],!1,!1,n));return i.isImplicit=!0,i}function gr(e,t,r,n,i=t.constructor){let s=new i(new it(e,[t,r,n],!1,!1,i));return s.isImplicit=!0,s}function zt(e){return bt(e,F(-1))}function ln(e,t,r,n){return new t(new Pe(e,t,r,n))}function Dn(e,t,r=0,n=e.size){let i=new gt(r).setMutable().setDebugName("FindIndexIterator"),s=t(e.get(i)).setDebugName("FindIndexPredicate");return ln({iter:i},gt,s,({out:l,iter:p,subgraph:c})=>`
${l} = -1;

for (; ${p} < ${n}; ${p}++) {

${c.body}

  if (${c.varName}) {
    ${l} = ${p};
    break;
  }

}
`).setDebugName("FindIndexBlock")}function En(e,t,r=0,n=e.size){return ln({array:e},gt,null,({out:s,array:a})=>`
${s} = -1;
for (int i = ${r}; i < ${n}; i++) {
  bool condition;
  ${t({array:a,i:"i",out:"condition"})}
  if (condition) {
    ${s} = i;
    break;
  }
}
`).setDebugName("GlslFindIndexBlock")}function S(e,t,r){let n=typeof t=="function"?t():t,i=typeof r=="function"?r():r,s=new n.constructor(new Ne(e,n,i));return s.isImplicit=!0,s}function ot(...e){let t=e.map(([l,p])=>typeof p=="function"?[l,p()]:[l,p]),r=t[0][1].constructor,n=t.findIndex(l=>l[0]===!0);if(n===-1)throw new Error("A cond must have a fallthrough case with `true`/; ");let i=t.slice(0,n),s=t[n][1],a=new r(i.reduceRight((l,p)=>S(p[0],p[1],l),s));return a.isImplicit=!0,a}function bt(e,t){return L("*",e,t)}function Ut(e,t){return L("/",e,t)}function At(e,t){return L("+",e,t)}function se(e,t){return L("-",e,t)}function wi(e,t){return L(">>",e,t)}function Vi(e,t){return L("&",e,t)}function Bt(e,t){return L("==",e,t,K)}function cn(e,t){return L("<",e,t,K)}function vt(e,t){return L("<=",e,t,K)}function _(e,t){return L(">",e,t,K)}function xt(e,t){return L(">=",e,t,K)}function br(...e){return e.length<=1?e[0]:e.slice(1).reduce((t,r)=>kn(t,r),e[0])}function kn(e,t){return L("||",e,t,K)}function He(...e){return e.length<=1?e[0]:e.slice(1).reduce((t,r)=>zn(t,r),e[0])}function zn(e,t){return L("&&",e,t,K)}function pn(e){return G("abs",e)}function vr(e){return G("all",e,K)}function xr(e){return G("any",e,K)}function dn(e){return G("ceil",e)}function Lt(e,t,r){return gr("clamp",e,t,r,e.constructor)}function wr(e){return G("cos",e)}function Vr(e,t){return Ct("distance",e,t,u)}function oe(e,t){return Ct("dot",e,t,u)}function hn(e){return G("floor",e)}function Ge(e){return G("fract",e)}function Ke(e){return G("length",e,u)}function wt(e,t){return Ct("max",e,t)}function ae(e,t){return Ct("min",e,t)}function q(e,t,r){return gr("mix",e,t,r)}function J(e,t){return Ct("mod",e,t)}function mn(e){return G("normalize",e)}function fn(e){return e.type==="bool"?G("!",e):G("not",e)}function ue(e){return G("sin",e)}function Si(e,t,r){return gr("smoothstep",e,t,r)}function Q(e,t){return Ct("step",e,t,t.constructor)}function j(e,t){return Ct("texture2D",e,t,b)}function D(e,t,r){let n=t.split(`
`);for(let i of n)if(i.trim().length){{let s="";r!=null&&(s+=`/*id:${r??"000"}*/   `),e.body+=s.padEnd(14)}e.body+=" ".repeat(e.indent)+i+`
`}}var le=class{write(t){for(let r of t.rootOutputNodes())t.shouldPruneOutputNode(r)||(r.variableName=this._write(t,r.node));return t}_createVarName(t,r){let n="";return typeof r!="boolean"&&typeof r!="number"&&r.debugInfo.name&&(n=`${r.debugInfo.name}_`),`${n}v${t.varCount++}`}_write(t,r,n=!1){if(typeof r=="number"||typeof r=="boolean")return r.toString();let i=t.getEmit(r);if(i)return i;switch(r.shaderType){case"scope-node":i=this._writeScopeNode(t,r);break;case"primitive-node":i=this._writePrimitiveNode(t,r,n);break;case"function-node":i=this._writeFunctionNode(t,r);break;case"property-access-node":i=this._writePropertyAccessNode(t,r);break;case"text-node":i=r.text;break;case"block-node":i=this._writeBlockNode(t,r);break;case"condition-node":i=this._writeConditionNode(t,r)}return t.setEmit(r,i),i}_writeScopeNode(t,r){let n=new r.child.constructor;n.setDebugName(r.debugInfo.name);let i=this._write(t,n,!0);return D(t,`{ /*ScopeStart: ${r.uid} ${r.debugInfo.name}*/`),t.indent+=2,D(t,`${i} = ${this._write(t,r.child)};`),t.indent-=2,D(t,`} /*ScopeEnd: ${r.uid} ${r.debugInfo.name}*/`),i}_writeConditionNode(t,r){let n=new r.ifTrue.constructor,i=this._write(t,n,!0);D(t,`if (${this._write(t,r.condition)}) {`),t.indent+=2;let s=t.createSubgraphContext(),a=this._write(s,r.ifTrue);if(t.body+=s.body,a&&D(t,`${i} = ${a};`),t.indent-=2,D(t,"}"),r.ifFalse){D(t,"else {"),t.indent+=2;let l=t.createSubgraphContext(),p=this._write(l,r.ifFalse);t.body+=l.body,p&&D(t,`${i} = ${p};`),t.indent-=2,D(t,"}")}return i}_writeBlockNode(t,r){let{captureList:n,generator:i,returnType:s}=r,a={};for(let m in n){if(!n[m])continue;let g=this._write(t,n[m]);a[m]=g}let l=new s,p=this._write(t,l,!0);if(a.out=p,r.subgraph){let m=t.createSubgraphContext(),g=this._write(m,r.subgraph.child),T=m.body;a.subgraph={varName:g,body:T}}let c=i(a);return D(t,`{
`),t.indent+=2,D(t,c),t.indent-=2,D(t,`}
`),p}_writePropertyAccessNode(t,r){let n=this._write(t,r.target);return typeof r.property=="string"&&r.property.includes("[")?`${n}${r.property}`:typeof r.property!="string"?`${n}[${this._write(t,r.property)}]`:`${n}.${r.property}`}_writeFunctionNode(t,r){let n=r.returnType.type;if(r.isInfix){let[a,l]=r.children.map(c=>this._write(t,c)),p=this._createVarName(t,r);return D(t,`${n.padEnd(5)} ${p} = ${a} ${r.token} ${l};`,r.uid),p}let i=r.children.map(a=>this._write(t,a)).join(", "),s=this._createVarName(t,r);return D(t,`${n.padEnd(5)} ${s} = ${r.token}(${i});`,r.uid),s}_writePrimitiveNode(t,r,n=!1){let i=t.getInput(r);if(i)return i.isUsed=!0,i.variableName;let s=r.children.length===1&&r.children[0]?.type===r.type;if(r.isImplicit||s)return this._write(t,r.children[0]);let a=this._createVarName(t,r);if(n)return D(t,`${r.type.padEnd(5)} ${a};`,r.uid),a;let l=!r.debugInfo.name&&!r.isMutable;if(l&&r.type==="float"&&typeof r.children[0]=="number")return Number.isInteger(r.children[0])?r.children[0].toFixed(1):r.children[0].toString();if(l&&r.type==="int"&&typeof r.children[0]=="number"&&Number.isInteger(r.children[0]))return r.children[0].toString();let p=r.children.map(c=>this._write(t,c)).join(", ");return r.type==="array"?(D(t,`${r.type.padEnd(5)} ${a} = [${p}];`,r.uid),a):l?`${r.type}(${p})`:(D(t,`${r.type.padEnd(5)} ${a} = ${r.type}(${p});`,r.uid),a)}};var Vt=class e{constructor(t,r,n){this.variableName=t,this.variableInputType=r,this.node=n,this.type="shader-input",this.isUsed=!1}clone(){return new e(this.variableName,this.variableInputType,d(this.node))}},Ot=class e{constructor(t,r,n){this.outVariableName=t,this.outVariableType=r,this.node=n,this.type="shader-output"}clone(){let t=new e(this.outVariableName,this.outVariableType,d(this.node));return t.variableName=this.variableName,t}},ce=class e{static createVertex(t,r,n,i,s,a){let l=[];for(let c in t){let m=t[c],g=n.get(c);g?l.push(new Vt(g,"builtin",m)):l.push(new Vt("a_"+c,"attribute",m))}for(let c of i){let m=c.uniformHydrated;l.push(new Vt(c.uniformName,"uniform",m))}let p=[];for(let c in r){let m=r[c];c==="glPosition"?p.push(new Ot("gl_Position","builtin",m)):c==="glPointSize"?p.push(new Ot("gl_PointSize","builtin",m)):p.push(new Ot("v_"+c,"varying",m))}return new e(l,p,s,a)}static createFragment(t,r,n,i,s,a){let l=[],p=Array.from(s.rootOutputNodes());for(let m in t){let g=t[m],T=n.get(m);if(T){l.push(new Vt(T,"builtin",g));continue}let N=p.find(M=>M.node===g);N&&l.push(new Vt(N.outVariableName,N.outVariableType,g))}for(let m of i){let g=m.uniformHydrated;l.push(new Vt(m.uniformName,"uniform",g))}let c=[];for(let m in r){let g=r[m],T=n.get(m);if(m==="discard")c.push(new Ot(null,"discard",g));else{if(!T)throw new Error(`Member ${m} in shader fragment output shoule be tagged as builtin`);c.push(new Ot(T,"builtin",g))}}return new e(l,c,a)}constructor(t,r,n,i){this.type="shader-graph-context",this.indent=0,this.body="",this.varCount=0,this._inputShaderTypesByNodeUid=new Map,this._nodeEmitMap=new Map;for(let s of t)this._inputShaderTypesByNodeUid.set(s.node.uid,s);this._outputShaderTypes=r,this._transformFeedbackBindings=n,this._transformFeedbackNames=new Set(n.map(s=>"v_"+s.propertyKey)),this._usedInFragmentShader=i}shouldPruneOutputNode(t){return!!this._usedInFragmentShader&&t.outVariableType!=="builtin"&&!this._transformFeedbackNames.has(t.outVariableName)&&!this._usedInFragmentShader.has(t.node.uid)}setEmit(t,r){this._nodeEmitMap.set(t.uid,r)}getEmit(t){return this._nodeEmitMap.get(t.uid)}inputs(){return this._inputShaderTypesByNodeUid.values()}getInput(t){return this._inputShaderTypesByNodeUid.get(t.uid)}*rootOutputNodes(){for(let t of this._outputShaderTypes)yield t}*nodes(){let t=[];for(let r of this._outputShaderTypes.values())t.push(r.node);for(;t.length;){let r=t.pop();typeof r!="number"&&typeof r!="boolean"&&t.push(...r.children.filter(Boolean)),yield r}}*nodesOfTypeOrFunction(){for(let t of this.nodes())typeof t!="number"&&typeof t!="boolean"&&(yield t)}createSubgraphContext(){let t=this.clone();return t.body="",t.indent=this.indent+2,t._nodeEmitMap=new Map(this._nodeEmitMap),t}clone(){let t=new e([],this._outputShaderTypes,this._transformFeedbackBindings,this._usedInFragmentShader);return t._inputShaderTypesByNodeUid=this._inputShaderTypesByNodeUid,t.indent=this.indent,t.body=this.body,t.varCount=this.varCount,t._nodeEmitMap=this._nodeEmitMap,t}insertVertexShader(t){t.vertex.code.add(""),this._insertInputs(t,"vertex"),t.vertex.code.add(""),t.vertex.code.add("// OUTPUTS: "),t.vertex.code.add("// --------------------------------------------------------- ");for(let r of this.rootOutputNodes()){let n=r.outVariableType==="builtin";this.shouldPruneOutputNode(r)||(n?t.vertex.code.add(`// ${r.outVariableType.padEnd(7)} ${r.node.type.padEnd(9)} ${r.outVariableName};`):t.vertex.code.add(`${r.outVariableType.padEnd(10)} ${r.node.type.padEnd(9)} ${r.outVariableName};`))}t.vertex.code.add(""),t.vertex.code.add("void main() {"),t.vertex.code.add("  "+this.body.split(`
`).join(`
  `));for(let r of this.rootOutputNodes())this.shouldPruneOutputNode(r)||t.vertex.code.add(`  ${r.outVariableName} = ${r.variableName};`);t.vertex.code.add("}")}insertFragmentShader(t){this._insertInputs(t,"fragment"),t.fragment.code.add(""),t.fragment.code.add("void main() {"),t.fragment.code.add("  "+this.body.split(`
`).join(`
  `));for(let r of this.rootOutputNodes())r.outVariableType==="discard"?(t.fragment.code.add("  // TODO: Should ensure codegen for discard appears first in fragment shader"),t.fragment.code.add(`  if (${r.variableName}) {`),t.fragment.code.add("    discard;"),t.fragment.code.add("  }"),t.fragment.code.add("  ")):t.fragment.code.add(`  ${r.outVariableName} = ${r.variableName};`);t.fragment.code.add("}")}_insertInputs(t,r){t[r].code.add("// INPUTS: "),t[r].code.add("// --------------------------------------------------------- ");for(let n of this.inputs())n.isUsed&&n.variableInputType!=="builtin"&&(n.node.type==="array"?t[r].code.add(`${n.variableInputType.padEnd(10)} ${n.node.elementType.type.padEnd(9)} ${n.variableName}[${n.node.size}];`):t[r].code.add(`${n.variableInputType.padEnd(10)} ${n.node.type.padEnd(9)} ${n.variableName};`))}};var Un=()=>kt.getLogger("esri.views.2d.engine.webgl.shaderGraph.typed.TypedShaderProgram");function pe(e,t,r){let n=t.length;if(n!==r){let i=new Se("Invalid Uniform",`Invalid length, expected ${r} but got ${n}`,{uniformName:e,values:t});Un().errorOnce(i)}}var de=class{constructor(t,r,n,i,s,a){this._program=null,this._vao=null,this._temporaryTextures=[],this.vertexShader=t,this.fragmentShader=r,this._locations=n,this._locationInfo=i,this._uniformBindings=s,this._transformFeedbackBindings=a}destroy(){this._program&&this._program.dispose(),this.cleanupTemporaryTextures()}get locations(){return this._locations}get locationInfo(){return this._locationInfo}setUniforms(t){this._uniforms=t}cleanupTemporaryTextures(){for(let t of this._temporaryTextures)t.dispose();this._temporaryTextures=[]}bind(t){let r=this._uniforms;if(!this._program){let i=new Map;for(let[a,l]of this._locations)i.set(a,l);let s=[];for(let a of this._transformFeedbackBindings??[]){let{index:l,propertyKey:p}=a;s[l]=`v_${p}`}this._program=new qr(t,this.vertexShader,this.fragmentShader,i,new Map,s)}let n=this._program;t.useProgram(n);for(let i of this._uniformBindings){let{shaderModulePath:s,uniformName:a,uniformType:l,uniformArrayLength:p}=i,c=zr(s,r);if(c==null){if(l==="sampler2D")continue;throw new Error(`Failed to find uniform value for ${s}`)}switch(l==="array"?i.uniformArrayElementType:l){case"sampler2D":{let{unit:m,texture:g}=c;if(n.setUniform1i(a,m),"type"in g)t.bindTexture(g,m);else{let T=Kr(t,g.descriptor,g.data);t.bindTexture(T,m)}break}case"int":if(!p){n.setUniform1i(a,c);break}pe(i.uniformName,c,p),n.setUniform1iv(a,c);break;case"float":if(!p){n.setUniform1f(a,c);break}pe(i.uniformName,c,p),n.setUniform1fv(a,c);break;case"vec2":if(!p){n.setUniform2f(a,c[0],c[1]);break}pe(i.uniformName,c,p),n.setUniform2fv(a,c.flat());break;case"vec3":if(!p){n.setUniform3f(a,c[0],c[1],c[2]);break}pe(i.uniformName,c,p),n.setUniform3fv(a,c.flat());break;case"vec4":if(!p){n.setUniform4f(a,c[0],c[1],c[2],c[3]);break}pe(i.uniformName,c,p),n.setUniform4fv(a,c.flat());break;case"mat3":n.setUniformMatrix3fv(a,c.flat());break;case"mat4":n.setUniformMatrix4fv(a,c.flat());break;default:throw new Error(`Unable to set uniform for type ${l}`)}}}};function he(e){return new e}function Ht(e,t,r){let n=e.constructor[t]??[];e.constructor.hasOwnProperty(t)||Object.defineProperty(e.constructor,t,{value:n.slice()}),e.constructor[t].push(r)}function f(e,t){return(r,n)=>{Ht(r,"locations",{typeCtor:t,propertyKey:n,parameterIndex:null,index:e})}}var An=e=>(t,r)=>{Ht(t,"builtins",{builtin:e,propertyKey:r})},w=e=>(t,r,n)=>{Ht(t,"inputs",{inputCtor:e,propertyKey:r,parameterIndex:n})},h=e=>(t,r)=>{Ht(t,"uniforms",{typeCtor:e,propertyKey:r})},O=e=>(t,r)=>{Ht(t,"options",{typeCtor:e,propertyKey:r})},Ir=(e,t)=>{Ht(e,"defines",{propertyKey:t})};var Sr=(e,t)=>(r,n)=>{r.constructor.builtins.push({builtin:e,propertyKey:n,typeCtor:t})},Rt=class{};Rt.builtins=[],o([Sr("gl_VertexID",gt)],Rt.prototype,"glVertexID",void 0);var qe=class{},St=class{};St.builtins=[],o([Sr("gl_FragCoord",b)],St.prototype,"glFragCoord",void 0),o([Sr("gl_PointCoord",y)],St.prototype,"glPointCoord",void 0);var me=class{};o([An("gl_FragColor")],me.prototype,"glFragColor",void 0);var x=class{constructor(){this.type="uniform-group"}get _uniforms(){return this.constructor.uniforms??[]}},je=class{constructor(){this.logShader=!1,this.computeAttributes={}}get vertexInput(){let t=this._shaderModuleClass.inputs.findLast(r=>r.propertyKey==="vertex"&&r.parameterIndex===0);if(!t)throw new Error("Unable to find vertex input parameter");return t}get computeInput(){return this._shaderModuleClass.inputs.findLast(t=>t.propertyKey==="vertex"&&t.parameterIndex===1)}get fragmentInput(){let t=this._shaderModuleClass.inputs.findLast(r=>r.propertyKey==="fragment");if(!t)throw new Error("Unable to find fragment input parameter");return t}get transformFeedbackBindings(){return this.fragmentInput.inputCtor.transformFeedbackBindings??[]}get locations(){return[...this.vertexInput.inputCtor.locations,...this.computeInput?.inputCtor.locations??[]]}get locationsMap(){let t=new Map,r=new Set;for(let n of this.locations)r.has(n.index)?kt.getLogger("esri.views.2d.engine.webgl.shaderGraph.GraphShaderModule").warnOnce("mapview-rendering",`Unable to assigned attribute ${n.propertyKey} to ${n.index}. Index already in use`,{locationsMap:t}):(t.set(n.propertyKey,n.index),r.add(n.index));return t}get locationInfo(){if(!this._locationInfo){let t=this.locationsMap,r=Array.from(t.entries()).map(([s,a])=>`${s}.${a}`).join("."),n=Ur(r),i=this.computeAttributes;this._locationInfo={hash:n,locations:t,computeAttributeMap:i}}return this._locationInfo}get renamedLocationsMap(){let t=new Map;for(let r of this.locations)t.set("a_"+r.propertyKey,r.index);return t}get optionPropertyKeys(){if(!this._optionPropertyKeys){let t=new Set;for(let r of this._options)t.add(r.propertyKey);this._optionPropertyKeys=t}return this._optionPropertyKeys}get _shaderModuleClass(){return this.constructor}get _defines(){return this._shaderModuleClass.defines??[]}get _options(){return this._shaderModuleClass.options??[]}get _uniforms(){return this._shaderModuleClass.uniforms??[]}getProgram(t,r,n,i){try{let{vertex:s,fragment:a,uniformBindings:l}=this._generateShaders(t,r,n,i);return new de(s,a,this.renamedLocationsMap,this.locationInfo,l,this.transformFeedbackBindings)}catch{return new de("","",this.renamedLocationsMap,this.locationInfo,[],this.transformFeedbackBindings)}}getDebugUniformClassInfo(t){let r=this._options.find(i=>i.propertyKey===t);if(r)return{type:"option",className:r.typeCtor};let n=this._uniforms.find(i=>i.propertyKey===t);if(!n)throw new Error(`Unable to find uniform class type for property: ${t}`);return{type:"required",className:n.typeCtor}}getShaderKey(t,r,n,i){let s=Object.keys(t).map(c=>`${c}.${t[c]}`).join("."),a=Object.keys(n).map(c=>`${c}.${n[c]}`).join("."),l=Object.keys(i).map(c=>`${c}.${i[c]}`).join("."),p=Object.keys(r).filter(c=>this.optionPropertyKeys.has(c)&&r[c]).join(".");return`${this.constructor.name}.${s}.${a}.${l}.${p}`}_generateShaders(t,r,n,i){let s=[];this._setDefines(n),this._setOptionalUniforms(s,r),this._setRequiredUniforms(s);let a=this._hydrateVertexInput(i),l=this._injectPackPrecisionFactor(a,t),p=this._hydrateComputeInput(),c=p&&this._injectComputePackPrecisionFactor(p,t),m=this.vertex(l,c),g=this._hydrateFragmentInput(m),T=this.fragment(g),N=new Set;for(let In in T){let Fn=T[In];sn(N,Fn)}let M=this._getVertexInputBuiltins(),pt=ce.createVertex(V(V({},a),p),m,M,s,this.transformFeedbackBindings,N);new le().write(pt);let yt=this._getFragmentInputBuiltins(T);yt.set("glPointCoord","gl_PointCoord");let _t=ce.createFragment(g,T,yt,s,pt,this.transformFeedbackBindings);new le().write(_t);let we=this._createShaderBuilder(pt,_t),Er=we.generate("vertex",!1),kr=we.generate("fragment",!1);return this.logShader&&(console.log(Er),console.log(kr)),{vertex:Er,fragment:kr,uniformBindings:s}}_setDefines(t){for(let r in t)this[r]=t[r]}_setOptionalUniforms(t,r){for(let n of this._options)r[n.propertyKey]?this[n.propertyKey]=this._hydrateUniformGroup(t,n):this[n.propertyKey]=null}_setRequiredUniforms(t){for(let r of this._uniforms)this[r.propertyKey]=this._hydrateUniformGroup(t,r)}_hydrateUniformGroup(t,r){let n=new r.typeCtor;for(let i of n._uniforms??[]){let s=he(i.typeCtor),a=`u_${r.propertyKey}_${i.propertyKey}`,l=s.type,p=[r.propertyKey,i.propertyKey].join(".");if("type"in i.typeCtor&&i.typeCtor.type==="array"){let c=s;t.push({shaderModulePath:p,uniformName:a,uniformType:l,uniformArrayLength:c.size,uniformArrayElementType:c.elementType.type,uniformHydrated:s})}else t.push({shaderModulePath:p,uniformName:a,uniformType:l,uniformHydrated:s});n[i.propertyKey]=s}return n}_hydrateVertexInput(t){let r=this.vertexInput.inputCtor,n=r.locations.reduce((i,s)=>t[s.propertyKey]===!1?i:Et(V({},i),{[s.propertyKey]:he(s.typeCtor)}),{});for(let{propertyKey:i,typeCtor:s}of r.builtins){let a=he(s);n[i]=a}return n}_hydrateComputeInput(){return this.computeInput==null?null:this.computeInput.inputCtor.locations.reduce((t,r)=>Et(V({},t),{[r.propertyKey]:he(r.typeCtor)}),{})}_injectPackPrecisionFactor(t,r){let n={};for(let i in t){let s=t[i],a=r[i];if(a){if(s.type!=="float"&&s.type!=="vec2"&&s.type!=="vec3"&&s.type!=="vec4")throw new Error(`InternalError: packPrecisionFactor requires GenType, but found ${s.type}`);n[i]=s.divide(new u(a))}else n[i]=s}return n}_injectComputePackPrecisionFactor(t,r){let n={},i=new Map;for(let s in this.computeAttributes)for(let a of this.computeAttributes[s]??[])i.set(a,s);for(let s in t){let a=t[s],l=i.get(s);if(!l)continue;let p=r[l];if(p){if(a.type!=="float"&&a.type!=="vec2"&&a.type!=="vec3"&&a.type!=="vec4")throw new Error(`InternalError: packPrecisionFactor requires GenType, but found ${a.type}`);n[s]=a.divide(new u(p))}else n[s]=a}return n}_hydrateFragmentInput(t){let r={};for(let n in t)r[n]=t[n];for(let{propertyKey:n,typeCtor:i}of St.builtins){let s=he(i);r[n]=s}return r}_getVertexInputBuiltins(){let t=this.vertexInput.inputCtor,r=new Map;for(let{builtin:n,propertyKey:i}of t.builtins)r.set(i,n);return r}_getFragmentInputBuiltins(t){let r=t.constructor,n=new Map;for(let i of r.builtins??[])n.set(i.propertyKey,i.builtin);return n}_createShaderBuilder(t,r){let n=new Te;return this._insertDebugInfo(n),t.insertVertexShader(n),r.insertFragmentShader(n),n}_insertDebugInfo(t){t.vertex.code.add("// DEFINES: "),t.vertex.code.add("// --------------------------------------------------------- ");for(let r of this._defines)this[r.propertyKey]?t.vertex.code.add(`//   ${r.propertyKey}: true`):t.vertex.code.add(`//   ${r.propertyKey}: false`);t.vertex.code.add(""),t.vertex.code.add("// OPTIONS: "),t.vertex.code.add("// --------------------------------------------------------- ");for(let r of this._options)this[r.propertyKey]?t.vertex.code.add(`//   ${r.propertyKey}: true`):t.vertex.code.add(`//   ${r.propertyKey}: false`)}};function Fr(e){let t=F(12.9898),r=F(78.233),n=F(43758.5453),i=oe(e,ie(t,r)),s=J(i,F(3.14));return Ge(ue(s).multiply(n))}function R(e){return Bt(e,F(Qr))}function yn(e,t){return e.x.multiply(t.y).subtract(t.x.multiply(e.y))}function gn(e){return e.multiply(2).subtract(1)}function tt(e,t){let r=F(2**t);return J(hn(e.divide(r)),F(2))}function ys(e,t){return _(tt(e,t),F(.5))}function We(e,t){return tt(e,t+Ie.length)}function bn(e,t){return tt(e,t)}function vn(e){let t=tt(e.z,7),r=F(1).subtract(t),n=e.xyz.subtract(an(0,0,F(128)));return r.multiply(e).add(t.multiply(n))}function xn(e){let t=un(.99609375,.0038909912109375,1519918441772461e-20,59371814131736755e-24);return oe(e,t)}function gs(e){return wt(wt(wt(e.x,e.y),e.z),e.w)}var W=class extends x{getVisualVariableData(t){if(!this._vvData){let r=this.getAttributeDataCoords(t);this._vvData=j(this.visualVariableData,r).setDebugName("storage2")}return this._vvData}getAttributeDataCoords(t){if(!this._uv){let r=vn(t),n=this.size,i=$t(r.x),s=$t(r.y).multiply($t(256)),a=$t(r.z).multiply($t(256)).multiply($t(256)),l=F(i.add(s).add(a)),p=J(l,n),c=l.subtract(p).divide(n);this._uv=new y(p,c).add(.5).divide(n)}return this._uv}getFilterData(t){let r=this.getAttributeDataCoords(t);return j(this.filterFlags,r).setDebugName("storage0")}getAnimationData(t){let r=this.getAttributeDataCoords(t);return j(this.animation,r).setDebugName("storage1")}getVVData(t){return this.getVisualVariableData(t)}getDataDrivenData0(t){let r=this.getAttributeDataCoords(t);return j(this.dataDriven0,r).setDebugName("storage30")}getDataDrivenData1(t){let r=this.getAttributeDataCoords(t);return j(this.dataDriven1,r).setDebugName("storage31")}getDataDrivenData2(t){let r=this.getAttributeDataCoords(t);return j(this.dataDriven2,r).setDebugName("storage32")}getGPGPUData(t){let r=this.getAttributeDataCoords(t);return j(this.gpgpu,r).setDebugName("storage4")}getFilterFlags(t){return Ve("webgl-ignores-sampler-precision")?dn(this.getFilterData(t).x.multiply(F(255))):this.getFilterData(t).x.multiply(F(255))}getAnimationValue(t){return this.getAnimationData(t).x}getSizeValue(t){return this.getVisualVariableData(t).x}getColorValue(t){return this.getVisualVariableData(t).y}getOpacityValue(t){return this.getVisualVariableData(t).z}getRotationValue(t){return this.getVisualVariableData(t).w}};o([h(st)],W.prototype,"filterFlags",void 0),o([h(st)],W.prototype,"animation",void 0),o([h(st)],W.prototype,"gpgpu",void 0),o([h(st)],W.prototype,"visualVariableData",void 0),o([h(st)],W.prototype,"dataDriven0",void 0),o([h(st)],W.prototype,"dataDriven1",void 0),o([h(st)],W.prototype,"dataDriven2",void 0),o([h(u)],W.prototype,"size",void 0);var Gt=class extends x{};o([h(u)],Gt.prototype,"activeReasons",void 0),o([h(u)],Gt.prototype,"highlightAll",void 0);var It=class extends x{};o([h(y)],It.prototype,"position",void 0),o([h(u)],It.prototype,"distance",void 0),o([h(u)],It.prototype,"smallSymbolDistance",void 0),o([h(u)],It.prototype,"smallSymbolSizeThreshold",void 0);var E=class extends x{};o([h(B)],E.prototype,"displayViewScreenMat3",void 0),o([h(B)],E.prototype,"displayViewMat3",void 0),o([h(B)],E.prototype,"displayMat3",void 0),o([h(B)],E.prototype,"viewMat3",void 0),o([h(B)],E.prototype,"tileMat3",void 0),o([h(u)],E.prototype,"displayZoomFactor",void 0),o([h(u)],E.prototype,"requiredZoomFactor",void 0),o([h(y)],E.prototype,"tileOffset",void 0),o([h(u)],E.prototype,"currentScale",void 0),o([h(u)],E.prototype,"currentZoom",void 0),o([h(u)],E.prototype,"metersPerSRUnit",void 0),o([h(u)],E.prototype,"rotation",void 0),o([h(u)],E.prototype,"pixelRatio",void 0);var H=class extends Rt{};o([f(0,I)],H.prototype,"id",void 0),o([f(1,u)],H.prototype,"bitset",void 0),o([f(2,y)],H.prototype,"pos",void 0);var P=class extends qe{};o([f(14,y)],P.prototype,"nextPos1",void 0),o([f(15,y)],P.prototype,"nextPos2",void 0);var at=class extends St{},z=class extends je{clip(t,r){let n=new u(0),i=this.storage.getFilterFlags(t);if(n=n.add(F(2).multiply(F(1).subtract(We(i,0)))),this.inside?n=n.add(F(2).multiply(F(1).subtract(We(i,1)))):this.outside?n=n.add(F(2).multiply(We(i,1))):this.highlight&&(n=n.add(F(2).multiply(F(1).subtract(this._checkHighlight(i))))),r!=null){let s=new u(1).subtract(Q(r.x,this.view.currentZoom)),a=Q(r.y,this.view.currentZoom);n=n.add(new u(2).multiply(s.add(a)))}return n}getFragmentOutput(t,r,n=new u(1/255)){let i=new me;return i.glFragColor=this._maybeWriteHittest(r)??this._maybeHighlight(t,n)??t,i}_maybeHighlight(t,r){return this.highlight?new b(t.rgb,Q(r,t.a)):null}_checkHighlight(t){let r=this._checkHighlightBit(t,0);for(let n=1;n<Ie.length;n++)r=r.add(this._checkHighlightBit(t,n));return Q(new u(.1),r.add(this.highlight.highlightAll))}_checkHighlightBit(t,r){return bn(t,r).multiply(tt(this.highlight.activeReasons,r))}maybeRunHittest(t,r,n){if(this.hittestRequest==null)return null;let i=this.hittest(t,r,n),s=S(_(i,this.hittestRequest.distance),new u(2),new u(0)),a=this.storage.getAttributeDataCoords(t.id),l=gn(a);s=s.add(this.clip(t.id,t.zoomRange));let p=new b(new u(1/255),0,0,0);return{glPointSize:new u(1),glPosition:new b(l,s,1),color:p}}_maybeWriteHittest(t){return this.hittestRequest!=null?t.color:null}};o([Ir],z.prototype,"inside",void 0),o([Ir],z.prototype,"outside",void 0),o([O(Gt)],z.prototype,"highlight",void 0),o([h(W)],z.prototype,"storage",void 0),o([h(E)],z.prototype,"view",void 0),o([O(It)],z.prototype,"hittestRequest",void 0);function Bn(e,t){return oe(e,mn(t))}function Kt(e,t,r){let n=r.subtract(t),i=Bn(e.subtract(t),n),s=Lt(i.divide(Ke(n)),new u(0),new u(1));return Vr(e,t.add(s.multiply(r.subtract(t))))}function Ln(e){let t=pn(e);return Q(t.x.add(t.y).add(t.z),new u(1.05))}function Rn(e,t,r,n){let i=new B(r.x.multiply(n.y).subtract(n.x.multiply(r.y)),n.x.multiply(t.y).subtract(t.x.multiply(n.y)),t.x.multiply(r.y).subtract(r.x.multiply(t.y)),r.y.subtract(n.y),n.y.subtract(t.y),t.y.subtract(r.y),n.x.subtract(r.x),t.x.subtract(n.x),r.x.subtract(t.x)),s=t.x.multiply(r.y.subtract(n.y)),a=r.x.multiply(n.y.subtract(t.y)),l=n.x.multiply(t.y.subtract(r.y)),p=s.add(a).add(l);return new u(1).divide(p).multiply(i.multiply(new I(1,e)))}function Hn(e,t,r,n){return Bt(Ln(Rn(e,t,r,n)),new u(1))}function Gn(e,t,r,n){let i=r.subtract(t),s=n.subtract(t),a=yn(i,s),l=He(cn(a,new u(Je)),_(a,new u(-Je)));return ot([He(fn(l),Hn(e.xy,t,r,n)),new u(-1)],[!0,()=>{let p=Kt(e,t,r),c=Kt(e,r,n),m=Kt(e,n,t);return ae(ae(p,c),m)}])}function Ze(e){return e.distance.add(1)}function qt(e,t,r){let{viewMat3:n,tileMat3:i}=e.view,s=n.multiply(i),a=s.multiply(new I(t.pos,1)),l=s.multiply(new I(r.nextPos1,1)),p=s.multiply(new I(r.nextPos2,1));return Gn(e.hittestRequest.position,a.xy,l.xy,p.xy)}function Xs(e,t,r){return Vr(e,r).subtract(t)}var ut=class extends x{getColor(t,r,n){return ot([br(R(t),n),r],[vt(t,this.values.first()),this.colors.first()],[xt(t,this.values.last()),this.colors.last()],[!0,()=>{let i=this.values.findIndex(c=>_(c,t)),s=this.values.get(i),a=i.subtract(1),l=this.values.get(a),p=t.subtract(l).divide(s.subtract(l));return q(this.colors.get(a),this.colors.get(i),p)}])}};o([h(k.ofType(b,8))],ut.prototype,"colors",void 0),o([h(k.ofType(u,8))],ut.prototype,"values",void 0);var lt=class extends x{getOpacity(t){return ot([R(t),new u(1)],[vt(t,this.opacityValues.first()),this.opacities.first()],[xt(t,this.opacityValues.last()),this.opacities.last()],[!0,()=>{let r=this.opacityValues.findIndex(l=>_(l,t)),n=this.opacityValues.get(r),i=r.subtract(1),s=this.opacityValues.get(i),a=t.subtract(s).divide(n.subtract(s));return q(this.opacities.get(i),this.opacities.get(r),a)}])}};o([h(k.ofType(u,8))],lt.prototype,"opacities",void 0),o([h(k.ofType(u,8))],lt.prototype,"opacityValues",void 0);function Tr(e){return e.visualVariableSizeMinMaxValue!=null||e.visualVariableSizeScaleStops!=null||e.visualVariableSizeStops!=null||e.visualVariableSizeUnitValue!=null}function wn(e,t,r){if(Tr(e)){let n=e.storage.getSizeValue(t);return e.visualVariableSizeMinMaxValue?.getSize(n,r)??e.visualVariableSizeScaleStops?.getSizeForViewScale(e.view.currentScale)??e.visualVariableSizeStops?.getSize(n,r)??e.visualVariableSizeUnitValue?.getSize(n,r)}return r}function jt(e,t,r,n=new K(!1)){if(e.visualVariableColor==null)return r;let i=e.storage.getColorValue(t);return e.visualVariableColor.getColor(i,r,n)}function Wt(e,t){if(e.visualVariableOpacity==null)return new u(1);let r=e.storage.getOpacityValue(t);return e.visualVariableOpacity.getOpacity(r)}function lo(e,t){if(e.visualVariableRotation==null)return B.identity();let r=e.storage.getRotationValue(t);return e.visualVariableRotation.getVVRotationMat3(r)}var ht=class extends H{};o([f(3,b)],ht.prototype,"color",void 0),o([f(4,y)],ht.prototype,"zoomRange",void 0);var ct=class extends z{constructor(){super(...arguments),this.computeAttributes={pos:["nextPos1","nextPos2"]}}vertex(t,r){let n=Wt(this,t.id),i=jt(this,t.id,t.color).multiply(n),s=this.view.displayViewScreenMat3.multiply(new I(t.pos.xy,1)),a=this.clip(t.id,t.zoomRange);return V({glPosition:new b(s.xy,a,1),color:i},this.maybeRunHittest(t,r,null))}fragment(t){return this.getFragmentOutput(t.color,t,new u(0))}hittest(t,r){return qt(this,t,r)}};o([O(ut)],ct.prototype,"visualVariableColor",void 0),o([O(lt)],ct.prototype,"visualVariableOpacity",void 0),o([v(0,w(ht)),v(1,w(P))],ct.prototype,"vertex",null),o([v(0,w(at))],ct.prototype,"fragment",null);var Z=class extends x{getPatternOffsetAtTileOrigin(t,r=new u(0),n=new u(1)){let i=new y(nn).divide(t),s=t.multiply(Ge(this.maxIntsToLocalOrigin.multiply(i))).add(this.tileOffsetFromLocalOrigin).subtract(new u(.5).multiply(t));return s=new y(s.x.multiply(n).subtract(s.y.multiply(r)),s.x.multiply(r).add(s.y.multiply(n))),J(s,t)}};o([h(y)],Z.prototype,"tileOffsetFromLocalOrigin",void 0),o([h(y)],Z.prototype,"maxIntsToLocalOrigin",void 0);var X=class extends x{};o([h(y)],X.prototype,"size",void 0),o([h(st)],X.prototype,"texture",void 0);var mt=class extends ht{};o([f(5,b)],mt.prototype,"tlbr",void 0),o([f(6,u)],mt.prototype,"width",void 0),o([f(7,u)],mt.prototype,"height",void 0),o([f(8,y)],mt.prototype,"offset",void 0),o([f(9,y)],mt.prototype,"scale",void 0),o([f(10,u)],mt.prototype,"angle",void 0);var _r=class extends at{};function Kn(e,t,r,n,i){let s=Bt(tt(i,rn),F(1)),a=xn(new b(e,0));return S(s,yr(n.divide(t.x),r.divide(t.y),0,zt(r.divide(t.x)),n.divide(t.y),0,Fr(ie(a,0)),Fr(ie(0,a)),1),yr(n.divide(t.x),r.divide(t.y),0,zt(r.divide(t.x)),n.divide(t.y),0,0,0,1))}function $r(e,t){let r=e.view.requiredZoomFactor,n=new y(t.width,t.height),i=n.multiply(t.scale).multiply(r),s=t.angle.multiply(Zr),a=ue(s),l=wr(s),p=Kn(t.id,i,a,l,t.bitset),c=e.localTileOffset.getPatternOffsetAtTileOrigin(n,a,l),m=r.multiply(t.scale).multiply(t.offset.subtract(c)).divide(i),g=new I(t.pos,1),T=p.multiply(g).xy.subtract(m),N=t.tlbr.divide(e.mosaicInfo.size.xyxy),M=tt(t.bitset,tn);return e.visualVariableColor!=null&&(M=S(R(e.storage.getColorValue(t.id)),new u(0),M)),{tileTextureCoord:T,tlbr:N,sampleAlphaOnly:M}}function Cr(e,t){let r=J(t.tileTextureCoord,new u(1)),n=q(t.tlbr.xy,t.tlbr.zw,r),i=j(e.mosaicInfo.texture,n);return i=S(_(t.sampleAlphaOnly,new u(.5)),i.aaaa,i),t.color.multiply(i)}var Zt=class extends ct{vertex(t,r){return V(V({},super.vertex(t,r)),$r(this,t))}fragment(t){let r=Cr(this,t);return this.getFragmentOutput(r,t,new u(0))}};o([h(X)],Zt.prototype,"mosaicInfo",void 0),o([h(Z)],Zt.prototype,"localTileOffset",void 0),o([v(0,w(mt)),v(1,w(P))],Zt.prototype,"vertex",null),o([v(0,w(_r))],Zt.prototype,"fragment",null);var Nt=class extends x{getSize(t,r){let n=this.minMaxValueAndSize.xy,i=this.minMaxValueAndSize.zw;return S(R(t),r,()=>{let s=t.subtract(n.x).divide(n.y.subtract(n.x)),a=Lt(s,new u(0),new u(1));return i.x.add(a.multiply(i.y.subtract(i.x)))})}};o([h(b)],Nt.prototype,"minMaxValueAndSize",void 0);var Ft=class extends x{getSizeForViewScale(t){return ot([vt(t,this.values.first()),this.sizes.first()],[xt(t,this.values.last()),this.sizes.last()],[!0,()=>{let r=this.values.findIndex(l=>_(l,t)),n=this.values.get(r),i=r.subtract(1),s=this.values.get(i),a=t.subtract(s).divide(n.subtract(s));return q(this.sizes.get(i),this.sizes.get(r),a)}])}};o([h(k.ofType(u,8))],Ft.prototype,"sizes",void 0),o([h(k.ofType(u,8))],Ft.prototype,"values",void 0);var Tt=class extends x{getSize(t,r){let n=ot([R(t),r],[vt(t,this.values.first()),this.sizes.first()],[xt(t,this.values.last()),this.sizes.last()],[!0,()=>{let i=this.values.findIndex(c=>_(c,t)),s=this.values.get(i),a=i.subtract(1),l=this.values.get(a),p=t.subtract(l).divide(s.subtract(l));return q(this.sizes.get(a),this.sizes.get(i),p)}]);return S(R(n),r,n)}};o([h(k.ofType(u,8))],Tt.prototype,"sizes",void 0),o([h(k.ofType(u,8))],Tt.prototype,"values",void 0);var Pt=class extends x{getSize(t,r){return S(R(t),r,t.multiply(this.unitValueToPixelsRatio))}};o([h(u)],Pt.prototype,"unitValueToPixelsRatio",void 0);var ft=class extends H{};o([f(3,b)],ft.prototype,"color",void 0),o([f(4,y)],ft.prototype,"offset",void 0),o([f(5,y)],ft.prototype,"normal",void 0),o([f(6,u)],ft.prototype,"halfWidth",void 0),o([f(7,u)],ft.prototype,"referenceHalfWidth",void 0),o([f(8,y)],ft.prototype,"zoomRange",void 0);var fe=class extends at{},Mt=class extends x{};function Vn(e){return wt(new u(Xr).multiply(Q(e,new u(Yr))),new u(1))}function qn(e,t){let{halfWidth:r,normal:n}=e,i=Vn(r),s=Ke(n).multiply(r);return Lt(i.multiply(r.subtract(s)).divide(t.add(i).subtract(new u(1))),new u(0),new u(1))}function jn(e,t){let{id:r,halfWidth:n,referenceHalfWidth:i}=t;if(Tr(e)){let s=new u(2).multiply(i),a=wn(e,r,s);return new u(.5).multiply(n.divide(wt(i,new u(Jr)))).multiply(a)}return n}function Or(e,t){let{id:r,offset:n,pos:i,normal:s,zoomRange:a}=t,{displayViewScreenMat3:l,displayViewMat3:p}=e.view,c=jt(e,r,t.color),m=Wt(e,r),g=jn(e,t),T=new u(.5).multiply(e.antialiasingControls.antialiasing),N=wt(g.add(T),new u(.45)).add(new u(.1).multiply(T)),M=Vn(N).multiply(N).multiply(n),pt=p.multiply(new I(M,new u(0))),yt=l.multiply(new I(i,new u(1))).add(pt),_t=new u(2).multiply(Q(g,new u(0))).add(e.clip(r,a)),we=new b(yt.xy,_t,1);return{color:c,opacity:m,halfWidth:N,normal:s,scaledOffset:M,scaledHalfWidth:g,glPosition:new b(we.xy,_t,1)}}function Dt(e,t){let{opacity:r,color:n}=e,i=qn(e,t);return r.multiply(n).multiply(i)}o([h(u)],Mt.prototype,"antialiasing",void 0),o([h(u)],Mt.prototype,"blur",void 0);var et=class extends z{constructor(){super(...arguments),this.computeAttributes={pos:["nextPos1","nextPos2"]}}vertex(t,r){let n=Or(this,t);return V(V({},n),this.maybeRunHittest(t,r,n.halfWidth))}fragment(t){let r=Dt(t,this.antialiasingControls.blur);return this.getFragmentOutput(r,t)}hittest(t,r,n){let{viewMat3:i,tileMat3:s}=this.view,a=i.multiply(s),l=a.multiply(new I(t.pos,1)),p=a.multiply(new I(r.nextPos1,1)),c=a.multiply(new I(r.nextPos2,1)),{distance:m,smallSymbolDistance:g,smallSymbolSizeThreshold:T}=this.hittestRequest,N=Q(n,T.multiply(.5)).multiply(m.subtract(g)),M=this.hittestRequest.position;return ae(Kt(M,l.xy,p.xy),Kt(M,l.xy,c.xy)).subtract(n).add(N)}};o([h(Mt)],et.prototype,"antialiasingControls",void 0),o([O(ut)],et.prototype,"visualVariableColor",void 0),o([O(lt)],et.prototype,"visualVariableOpacity",void 0),o([O(Nt)],et.prototype,"visualVariableSizeMinMaxValue",void 0),o([O(Ft)],et.prototype,"visualVariableSizeScaleStops",void 0),o([O(Tt)],et.prototype,"visualVariableSizeStops",void 0),o([O(Pt)],et.prototype,"visualVariableSizeUnitValue",void 0),o([v(0,w(ft)),v(1,w(P))],et.prototype,"vertex",null),o([v(0,w(fe))],et.prototype,"fragment",null);var rt=class extends H{};o([f(3,y)],rt.prototype,"offset",void 0),o([f(4,b)],rt.prototype,"color",void 0),o([f(5,y)],rt.prototype,"normal",void 0),o([f(6,u)],rt.prototype,"halfWidth",void 0),o([f(7,u)],rt.prototype,"referenceHalfWidth",void 0),o([f(8,y)],rt.prototype,"zoomRange",void 0);var ye=class extends fe{};function ge(e,t,r){let{id:n,bitset:i}=t,s=tt(i,en),a=_(s,new u(.5)),l=Or(e,t),p=S(a,l.halfWidth,new u(0)),c=Wt(e,n),m=jt(e,n,t.color),g=S(a,t.color,m.multiply(c)),T=e.view.displayViewScreenMat3.multiply(new I(t.pos.xy,1)),N=e.clip(t.id),M=new b(T.xy,N,1),pt=S(a,l.glPosition,M),yt=r&&e.maybeRunHittest(t,r,a);return V({isOutline:s,color:g,opacity:new u(1),halfWidth:p,normal:l.normal,glPosition:pt},yt)}var Y=class extends z{constructor(){super(...arguments),this.computeAttributes={pos:["nextPos1","nextPos2"]}}};o([h(Mt)],Y.prototype,"antialiasingControls",void 0),o([O(ut)],Y.prototype,"visualVariableColor",void 0),o([O(lt)],Y.prototype,"visualVariableOpacity",void 0),o([O(Nt)],Y.prototype,"visualVariableSizeMinMaxValue",void 0),o([O(Ft)],Y.prototype,"visualVariableSizeScaleStops",void 0),o([O(Tt)],Y.prototype,"visualVariableSizeStops",void 0),o([O(Pt)],Y.prototype,"visualVariableSizeUnitValue",void 0);var Xt=class extends Y{vertex(t,r){return ge(this,t,r)}fragment(t){let{color:r,isOutline:n}=t,i=_(n,new u(.5)),s=Dt(t,this.antialiasingControls.blur),a=S(i,s,r),l=S(i,new u(1/255),new u(0));return this.getFragmentOutput(a,t,l)}hittest(t,r,n){return S(n,Ze(this.hittestRequest),qt(this,t,r))}};o([v(0,w(rt)),v(1,w(P))],Xt.prototype,"vertex",null),o([v(0,w(ye))],Xt.prototype,"fragment",null);var be=class extends ht{};o([f(5,b)],be.prototype,"tlbr",void 0),o([f(6,u)],be.prototype,"inverseRasterizationScale",void 0);var Nr=class extends at{};function Wn(e){let t=new u(1),r=new u(0);return new B(t.divide(e.x),r.divide(e.y),0,zt(r.divide(e.x)),t.divide(e.y),0,0,0,1)}function Pr(e,t){let r=t.tlbr.xy,n=t.tlbr.zw,i=n.x.subtract(r.x),s=r.y.subtract(n.y),a=new y(i,s).multiply(t.inverseRasterizationScale),l=a.multiply(e.view.requiredZoomFactor),p=Wn(l),c=e.localTileOffset.getPatternOffsetAtTileOrigin(a).divide(l),m=new I(t.pos,1);return{tileTextureCoord:p.multiply(m).xy.subtract(c),tlbr:t.tlbr.divide(e.mosaicInfo.size.xyxy)}}function Mr(e,t){let r=J(e.tileTextureCoord,new u(1)),n=q(e.tlbr.xy,e.tlbr.zw,r),i=j(t.texture,n);return e.color.multiply(i)}var Yt=class extends ct{vertex(t,r){return V(V({},super.vertex(t,r)),Pr(this,t))}fragment(t){let r=Mr(t,this.mosaicInfo);return this.getFragmentOutput(r,t,new u(0))}};o([h(X)],Yt.prototype,"mosaicInfo",void 0),o([h(Z)],Yt.prototype,"localTileOffset",void 0),o([v(0,w(be)),v(1,w(P))],Yt.prototype,"vertex",null),o([v(0,w(Nr))],Yt.prototype,"fragment",null);var ve=class extends rt{};o([f(9,b)],ve.prototype,"tlbr",void 0),o([f(10,u)],ve.prototype,"inverseRasterizationScale",void 0);var xe=class extends ye{},Jt=class extends Xt{vertex(t,r){return V(V({},ge(this,t,r)),Pr(this,t))}fragment(t){let{isOutline:r}=t,n=_(r,new u(.5)),i=Dt(t,this.antialiasingControls.blur),s=Mr(t,this.mosaicInfo),a=S(n,i,s),l=S(n,new u(1/255),new u(0));return this.getFragmentOutput(a,t,l)}};o([h(X)],Jt.prototype,"mosaicInfo",void 0),o([h(Z)],Jt.prototype,"localTileOffset",void 0),o([v(0,w(ve)),v(1,w(P))],Jt.prototype,"vertex",null),o([v(0,w(xe))],Jt.prototype,"fragment",null);var Zn=16,Sn=1/Zn,Xn=128,nt=class extends H{};o([f(3,b)],nt.prototype,"color",void 0),o([f(4,b)],nt.prototype,"tlbr",void 0),o([f(5,u)],nt.prototype,"angle",void 0),o([f(6,u)],nt.prototype,"aux1",void 0),o([f(7,u)],nt.prototype,"aux2",void 0),o([f(8,y)],nt.prototype,"aux3",void 0),o([f(9,y)],nt.prototype,"aux4",void 0),o([f(10,y)],nt.prototype,"zoomRange",void 0);var Dr=class extends xe{},Qt=class extends Y{vertex(t,r){let{aux1:n,aux2:i,aux3:s,aux4:a}=t,l=Et(V({},t),{width:n,height:i,offset:s,scale:a.multiply(Sn)}),p=Et(V({},t),{halfWidth:n,referenceHalfWidth:i,offset:s,normal:a.subtract(Xn).multiply(Sn)}),c=ge(this,p),m=$r(this,l),g=_(c.isOutline,new u(.5));return V(V(V({},c),m),this.maybeRunHittest(t,r,g))}fragment(t){let{isOutline:r}=t,n=_(r,new u(.5)),i=Dt(t,this.antialiasingControls.blur),s=Cr(this,t),a=S(n,i,s),l=S(n,new u(1/255),new u(0));return this.getFragmentOutput(a,t,l)}hittest(t,r,n){return S(n,Ze(this.hittestRequest),qt(this,t,r))}};o([h(X)],Qt.prototype,"mosaicInfo",void 0),o([h(Z)],Qt.prototype,"localTileOffset",void 0),o([v(0,w(nt)),v(1,w(P))],Qt.prototype,"vertex",null),o([v(0,w(Dr))],Qt.prototype,"fragment",null);var bu={bitset:{isSDF:0,isMapAligned:1,scaleSymbolsProportionally:2,overrideOutlineColor:3,colorLocked:4}};var Xe=class extends Br{constructor(e){super(e),this.debugName="",this._updatingHandles=new Hr,this._idToUpdatingState=new Gr}get updating(){let e=this._updatingHandles.updating||Array.from(this._idToUpdatingState.values()).some(t=>t);if(Ve("esri-2d-log-updating")){let t=Array.from(this._idToUpdatingState.entries()).map(([r,n])=>`-> ${r}: ${n}`).join(`
`);console.log(`${this.debugName}: Updating: ${e}
-> Handles: ${this._updatingHandles.updating}
${t}`)}return e}addUpdateTracking(e,t){let r=Lr(()=>t.updating,n=>this._idToUpdatingState.set(e,n),{sync:!0});this.addHandles(r)}addPromise(e){return this._updatingHandles.addPromise(e)}};o([Ye({constructOnly:!0})],Xe.prototype,"debugName",void 0),o([Ye({readOnly:!0})],Xe.prototype,"updating",null),Xe=o([Ar("esri.views.2d.layers.support.UpdateTracking2D")],Xe);var Pu=e=>e&8388607;function Mu(e,t){return((t?8388608:0)|e)>>>0}export{jr as a,Wr as b,Jn as c,Zr as d,ei as e,ii as f,si as g,Qr as h,tn as i,en as j,rn as k,oi as l,ai as m,ui as n,li as o,k as p,st as q,u as r,y as s,I as t,b as u,K as v,gt as w,B as x,xi as y,zt as z,S as A,wi as B,Vi as C,Bt as D,cn as E,_ as F,br as G,pn as H,Lt as I,wr as J,Vr as K,oe as L,hn as M,Ge as N,Ke as O,wt as P,ae as Q,q as R,ue as S,Si as T,Q as U,j as V,de as W,f as X,w as Y,h as Z,O as _,Ir as $,Rt as aa,qe as ba,St as ca,me as da,x as ea,je as fa,R as ga,tt as ha,ys as ia,xn as ja,gs as ka,E as la,H as ma,P as na,at as oa,z as pa,Ln as qa,Rn as ra,Gn as sa,Ze as ta,Xs as ua,ut as va,lt as wa,wn as xa,jt as ya,Wt as za,lo as Aa,ct as Ba,X as Ca,Zt as Da,Nt as Ea,Ft as Fa,Tt as Ga,Pt as Ha,ft as Ia,qn as Ja,Or as Ka,et as La,Xt as Ma,Yt as Na,Jt as Oa,Zn as Pa,Xn as Qa,Qt as Ra,Pu as Sa,Mu as Ta,bu as Ua,Xe as Va};
