import{b as v,c as I}from"./chunk-7BJKYFJJ.js";import{a as w}from"./chunk-ZACMHW2Q.js";import"./chunk-SYEZMZXW.js";import{a as f}from"./chunk-5YEZCTEQ.js";import{a as E}from"./chunk-O55LGAV2.js";import"./chunk-BKLTKOZS.js";import"./chunk-5NR3XNYP.js";import"./chunk-NH24IMWY.js";import"./chunk-OFUFLM2P.js";import{a as b}from"./chunk-5PZZG2QN.js";import{a as V}from"./chunk-U2VCUDNH.js";import"./chunk-K3RWZDS4.js";import{a as H}from"./chunk-IMAZWTYM.js";import"./chunk-MLIIG4W2.js";import"./chunk-A74TRSYK.js";import{b as x,c as _}from"./chunk-P3Z62US6.js";import"./chunk-EAOA3IP2.js";import"./chunk-4ZJCWL5T.js";import"./chunk-CKGQR2CH.js";import"./chunk-GFO5ECL6.js";import"./chunk-R4ZRZJFL.js";import"./chunk-L657QK52.js";import{a as c}from"./chunk-F2TG7X3S.js";import"./chunk-4Y7EKSO4.js";import"./chunk-Z5PRIZRU.js";import"./chunk-XJCAKA5Q.js";import{c as y}from"./chunk-NLPSVYXX.js";import"./chunk-JEECBMII.js";import"./chunk-GU2W3KD4.js";import"./chunk-4ZBUTOIE.js";import"./chunk-BYXBJQAS.js";import"./chunk-3WIR6N5K.js";import"./chunk-WNOBQY3K.js";import"./chunk-LK52GLIE.js";import"./chunk-MP46524Y.js";import"./chunk-RU5D3FPM.js";import"./chunk-MJN6ZDZD.js";import"./chunk-HWE2MRBZ.js";import"./chunk-BYXBJQAS.js";import"./chunk-HMLFVNCH.js";import"./chunk-MODIWOII.js";import"./chunk-4INMWFSQ.js";import"./chunk-I46ARENO.js";import"./chunk-IATQ4WNP.js";import"./chunk-SE7FIBEW.js";import"./chunk-NOUYXRP4.js";import"./chunk-GH3IUQVA.js";import"./chunk-AC7AQWXQ.js";import"./chunk-EZIYNRHJ.js";import"./chunk-J3VF5LTP.js";import"./chunk-37H4LYIE.js";import"./chunk-SRPI622Y.js";import"./chunk-4FSVG2A5.js";import"./chunk-RHABF3KL.js";import"./chunk-GHXDYQ3O.js";import"./chunk-ZOOQQO74.js";import"./chunk-P7VZMSEG.js";import"./chunk-B7IX6UFG.js";import"./chunk-HUYHDVA2.js";import"./chunk-4DVY2TZI.js";import"./chunk-BPPBSQ5N.js";import"./chunk-SYTNPSW4.js";import"./chunk-2AAD7VYB.js";import"./chunk-XAHD7XBV.js";import"./chunk-UZSTUBKI.js";import"./chunk-2UGJ72JG.js";import"./chunk-MAPO7YGF.js";import"./chunk-OLIJD5I4.js";import"./chunk-OOE2LCNP.js";import"./chunk-ESBNO4XM.js";import"./chunk-3A7OIH4J.js";import"./chunk-RMS5474O.js";import"./chunk-2SHNUN5D.js";import"./chunk-IFCRPPYQ.js";import"./chunk-I46GU3Q4.js";import"./chunk-W5OI4BJ2.js";import"./chunk-2EA2KAER.js";import"./chunk-ZAQLF7TN.js";import"./chunk-MJ4RSERD.js";import"./chunk-J57HR4DB.js";import"./chunk-Y5GQJM6D.js";import"./chunk-V34KIKJR.js";import"./chunk-V2JYXY4D.js";import"./chunk-MXSUS5HK.js";import"./chunk-EK4W5QYS.js";import"./chunk-DKSAM23M.js";import"./chunk-WMT47BMV.js";import"./chunk-PJQZD5QI.js";import"./chunk-IEUNGS56.js";import"./chunk-6KRFVLII.js";import"./chunk-M33MKV3S.js";import"./chunk-IEAJIOPI.js";import"./chunk-JHZRGEBS.js";import"./chunk-RQQJT345.js";import"./chunk-27SQOLVY.js";import"./chunk-6QNRNEQJ.js";import"./chunk-UHE637ZN.js";import"./chunk-7QY3BMVN.js";import"./chunk-NWPYI2UP.js";import"./chunk-TNPL7MIN.js";import"./chunk-UYBHUOFR.js";import"./chunk-BYQI7UDX.js";import"./chunk-A6I6D7FN.js";import"./chunk-U6WVZEYH.js";import"./chunk-IBDPR46F.js";import"./chunk-BES4JRIO.js";import"./chunk-7WFRJSY3.js";import"./chunk-PSQRUING.js";import"./chunk-DFTBSFIN.js";import"./chunk-FUBITVJ7.js";import"./chunk-VOH7XGOR.js";import"./chunk-Y6HWUWZ3.js";import"./chunk-AQ74ANSJ.js";import"./chunk-5UCI4TUX.js";import"./chunk-SAOUSUZE.js";import"./chunk-PPFMRTTD.js";import"./chunk-IWJQ3PU6.js";import"./chunk-Z5Q76SB7.js";import"./chunk-TTN7UOJS.js";import"./chunk-5QLB7ZJ7.js";import"./chunk-E5R4OI7X.js";import"./chunk-7S6PD5JC.js";import"./chunk-ZWI7LLTZ.js";import"./chunk-6NCXSKJD.js";import"./chunk-FYZRIMPP.js";import"./chunk-ATXTHXJA.js";import"./chunk-VFINLX57.js";import"./chunk-LM5MGO7W.js";import"./chunk-4HUAEW4D.js";import"./chunk-XWRPBDYS.js";import"./chunk-TCCAOREC.js";import"./chunk-BCREO4Q5.js";import"./chunk-SO6OJFOM.js";import"./chunk-DG5QI6E2.js";import"./chunk-TMZNSBQB.js";import"./chunk-ZGLJFDS6.js";import"./chunk-RSDQHAJX.js";import"./chunk-OFVMJORF.js";import{a as u}from"./chunk-2FYXACXP.js";import"./chunk-XGVKSCMM.js";import"./chunk-FX2VBPAM.js";import"./chunk-K4GPNFIS.js";import"./chunk-RP7XSKHE.js";import"./chunk-VV7MGXTC.js";import"./chunk-IXNVQC76.js";import"./chunk-LYPZUCFI.js";import"./chunk-QYC4ILGT.js";import"./chunk-HFQFGALU.js";import"./chunk-5TSEU5EE.js";import"./chunk-VC35VCVT.js";import"./chunk-MT7BXRRQ.js";import"./chunk-NNKLK2DS.js";import"./chunk-VU5W7W6Y.js";import"./chunk-BRGZVJPZ.js";import{I as r}from"./chunk-Z5NXR7SL.js";import{S as h}from"./chunk-7JLWSSXP.js";import{a as i}from"./chunk-W3WDPWBE.js";import{p as d}from"./chunk-JKP4I6UL.js";import"./chunk-TZHKPIVH.js";import"./chunk-JPDAKIWT.js";import"./chunk-W6LY37E4.js";import{q as g}from"./chunk-BRWS572J.js";import"./chunk-AKNRR36C.js";import{a as n,g as l}from"./chunk-JEGVIFEP.js";var P=t=>{let e=class extends t{initialize(){this.exportImageParameters=new c({layer:this.layer})}destroy(){this.exportImageParameters.destroy(),this.exportImageParameters=null}get floors(){return this.view?.floors??null}get exportImageVersion(){return this.exportImageParameters?.commitProperty("version"),this.commitProperty("timeExtent"),this.commitProperty("floors"),(this._get("exportImageVersion")||0)+1}get timeExtent(){return E(this.layer,this.view?.timeExtent,this._get("timeExtent"))}canResume(){return!!super.canResume()&&!this.timeExtent?.isEmpty}};return i([r()],e.prototype,"exportImageParameters",void 0),i([r({readOnly:!0})],e.prototype,"floors",null),i([r({readOnly:!0})],e.prototype,"exportImageVersion",null),i([r()],e.prototype,"layer",void 0),i([r()],e.prototype,"suspended",void 0),i([r({readOnly:!0})],e.prototype,"timeExtent",null),e=i([h("esri.views.layers.MapImageLayerView")],e),e};var o=class extends P(H(x(_))){constructor(){super(...arguments),this._highlightGraphics=new y,this._updateHash=""}fetchPopupFeaturesAtLocation(t,e){return this._popupHighlightHelper.fetchPopupFeaturesAtLocation(t,e)}update(t){let e=`${this.exportImageVersion}/${t.state.id}/${t.pixelRatio}/${t.stationary}`;this._updateHash!==e&&(this._updateHash=e,this.strategy.update(t).catch(a=>{d(a)||g.getLogger(this).error(a)}),t.stationary&&this._popupHighlightHelper.updateHighlightedFeatures(t.state.resolution)),this._highlightView.processUpdate(t)}attach(){let{imageMaxWidth:t,imageMaxHeight:e,version:a}=this.layer,s=a>=10.3,C=a>=10;this._bitmapContainer=new V,this.container.addChild(this._bitmapContainer),this._highlightView=new f({view:this.view,graphics:this._highlightGraphics,requestUpdateCallback:()=>this.requestUpdate(),container:new w(this.view.featuresTilingScheme),defaultPointSymbolEnabled:!1}),this.container.addChild(this._highlightView.container),this._popupHighlightHelper=new v({createFetchPopupFeaturesQueryGeometry:(p,m)=>I(p,m,this.view),highlightGraphics:this._highlightGraphics,highlightGraphicUpdated:(p,m)=>{this._highlightView.graphicUpdateHandler({graphic:p,property:m})},layerView:this,updatingHandles:this._updatingHandles}),this.strategy=new b({container:this._bitmapContainer,fetchSource:this.fetchImageBitmap.bind(this),requestUpdate:this.requestUpdate.bind(this),imageMaxWidth:t,imageMaxHeight:e,imageRotationSupported:s,imageNormalizationSupported:C,hidpi:!0}),this.addAttachHandles(u(()=>this.exportImageVersion,()=>this.requestUpdate())),this.requestUpdate()}detach(){this.strategy.destroy(),this.container.removeAllChildren(),this._bitmapContainer.removeAllChildren(),this._highlightView.destroy(),this._popupHighlightHelper.destroy()}viewChange(){}moveEnd(){this.requestUpdate()}supportsSpatialReference(t){return this.layer.serviceSupportsSpatialReference(t)}doRefresh(){return l(this,null,function*(){this._updateHash="",this.requestUpdate()})}isUpdating(){return this.strategy.updating||this.updateRequested}fetchImage(t,e,a,s){return this.layer.fetchImage(t,e,a,n({timeExtent:this.timeExtent,floors:this.floors},s))}fetchImageBitmap(t,e,a,s){return this.layer.fetchImageBitmap(t,e,a,n({timeExtent:this.timeExtent,floors:this.floors},s))}highlight(t){return this._popupHighlightHelper.highlight(t)}};i([r()],o.prototype,"strategy",void 0),i([r()],o.prototype,"updating",void 0),o=i([h("esri.views.2d.layers.MapImageLayerView2D")],o);var at=o;export{at as default};
