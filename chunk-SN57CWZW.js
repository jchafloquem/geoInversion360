import{a as M}from"./chunk-YWOXCT5Q.js";import{a as Ot}from"./chunk-W5OI4BJ2.js";import{a as c}from"./chunk-H5IJXG2U.js";import{a as At}from"./chunk-XNQ3DOLM.js";import{h as R}from"./chunk-ZAQLF7TN.js";import{b as Et,f as at,h as St}from"./chunk-TMZNSBQB.js";import{B as U,C as q,D as nt,J as It,a as I,k as rt,l as H,m as ht,n as st,w as Nt}from"./chunk-ZGLJFDS6.js";import{a as G}from"./chunk-W6LY37E4.js";import{b as gt}from"./chunk-AKNRR36C.js";function X(t,e=0){let r=t.stride;return Array.from(t.fields.keys()).map(s=>{let n=t.fields.get(s),u=n.constructor.ElementCount,p=bt(n.constructor.ElementType),d=n.offset,h=n.optional?.glNormalized??!1;return new Ot(s,u,p,d,r,h,e)})}function bt(t){let e=Pt[t];if(e)return e;throw new Error("BufferType not supported in WebGL")}var Pt={u8:R.UNSIGNED_BYTE,u16:R.UNSIGNED_SHORT,u32:R.UNSIGNED_INT,i8:R.BYTE,i16:R.SHORT,i32:R.INT,f32:R.FLOAT};var yt=M().vec3f(c.POSITION).u16(c.COMPONENTINDEX).freeze(),Dt=M().vec2u8(c.SIDENESS).freeze(),$t=X(Dt),K=M().vec3f(c.POSITION0).vec3f(c.POSITION1).vec2i16(c.NORMALCOMPRESSED).u16(c.COMPONENTINDEX).u8(c.VARIANTOFFSET,{glNormalized:!0}).u8(c.VARIANTSTROKE).u8(c.VARIANTEXTENSION,{glNormalized:!0}).freeze(),Y=M().vec3f(c.POSITION0).vec3f(c.POSITION1).vec2i16(c.NORMALCOMPRESSED).vec2i16(c.NORMAL2COMPRESSED).u16(c.COMPONENTINDEX).u8(c.VARIANTOFFSET,{glNormalized:!0}).u8(c.VARIANTSTROKE).u8(c.VARIANTEXTENSION,{glNormalized:!0}).freeze(),te=new Map([[c.POSITION0,0],[c.POSITION1,1],[c.COMPONENTINDEX,2],[c.VARIANTOFFSET,3],[c.VARIANTSTROKE,4],[c.VARIANTEXTENSION,5],[c.NORMALCOMPRESSED,6],[c.NORMAL2COMPRESSED,7],[c.SIDENESS,8]]);var j=class{constructor(){this.position0=I(),this.position1=I(),this.faceNormal0=I(),this.faceNormal1=I(),this.componentIndex=0,this.cosAngle=0}};var $=-1;function wt(t,e,r){let s=t.vertices.position,n=t.vertices.componentIndex,u=S.position0,p=S.position1,d=S.faceNormal0,h=S.faceNormal1,{edges:i,normals:m}=Wt(t),N=i.length/4,A=e.allocate(N),b=0,z=N,T=r?.allocate(z),k=0,o=0,a=0;J.length=0;for(let g=0;g<N;++g){let x=4*g;s.getVec(i.data[x],u),s.getVec(i.data[x+1],p);let D=J.pushNew();D.index=4*g,D.length=Nt(u,p)}J.sort((g,x)=>x.length-g.length);let l=new Array,f=new Array;J.forAll(({length:g,index:x})=>{let D=i.data[x],vt=i.data[x+1],mt=i.data[x+2],pt=i.data[x+3],dt=pt===$;if(s.getVec(D,u),s.getVec(vt,p),dt){let y=3*mt;H(d,m.data[y],m.data[y+1],m.data[y+2]),rt(h,d),S.componentIndex=n.get(D),S.cosAngle=q(d,h)}else{let y=3*mt;if(H(d,m.data[y],m.data[y+1],m.data[y+2]),y=3*pt,H(h,m.data[y],m.data[y+1],m.data[y+2]),S.componentIndex=n.get(D),S.cosAngle=q(d,h),Ct(S,zt))return;S.cosAngle<-.9999&&rt(h,d)}o+=g,a++,dt||Bt(S,Xt)?(e.write(A,b++,S),l.push(g)):Ft(S,xt)&&(T&&r&&r.write(T,k++,S),f.push(g))});let O=new Float32Array(l.reverse()),w=new Float32Array(f.reverse()),L=T&&r?{instancesData:T.slice(0,k),lodInfo:{lengths:w}}:void 0;return{regular:{instancesData:A.slice(0,b),lodInfo:{lengths:O}},silhouette:L,averageEdgeLength:o/a}}function Bt(t,e){return t.cosAngle<e}function Ct(t,e){return t.cosAngle>e}function Ft(t,e){let r=St(t.cosAngle);return It(Tt,t.position1,t.position0),r*(q(nt(_t,t.faceNormal0,t.faceNormal1),Tt)>0?-1:1)>e}function Wt(t){let e=t.faces.length/3,r=t.faces,s=t.neighbors,n=t.vertices.position;E.length=it.length=0;for(let u=0;u<e;u++){let p=3*u,d=s[p],h=s[p+1],i=s[p+2],m=r[p],N=r[p+1],A=r[p+2];n.getVec(m,P),n.getVec(N,Q),n.getVec(A,Z),st(Q,Q,P),st(Z,Z,P),nt(P,Q,Z),U(P,P),it.pushArray(P),(d===$||m<N)&&(E.push(m),E.push(N),E.push(u),E.push(d)),(h===$||N<A)&&(E.push(N),E.push(A),E.push(u),E.push(h)),(i===$||A<m)&&(E.push(A),E.push(m),E.push(u),E.push(i))}return{edges:E,normals:it}}var ct=class{constructor(){this.index=0,this.length=0}},J=new G({allocator:t=>t||new ct,deallocator:null}),E=new G({deallocator:null}),it=new G({deallocator:null}),S=new j,_t=I(),Tt=I(),P=I(),Q=I(),Z=I(),xt=at(4),zt=Math.cos(xt),Ut=at(35),Xt=Math.cos(Ut);function ut(t,e,r){let s=e/3,n=new Uint32Array(r+1),u=new Uint32Array(r+1),p=(o,a)=>{o<a?n[o+1]++:u[a+1]++};for(let o=0;o<s;o++){let a=t[3*o],l=t[3*o+1],f=t[3*o+2];p(a,l),p(l,f),p(f,a)}let d=0,h=0;for(let o=0;o<r;o++){let a=n[o+1],l=u[o+1];n[o+1]=d,u[o+1]=h,d+=a,h+=l}let i=new Uint32Array(6*s),m=n[r],N=(o,a,l)=>{if(o<a){let f=n[o+1]++;i[2*f]=a,i[2*f+1]=l}else{let f=u[a+1]++;i[2*m+2*f]=o,i[2*m+2*f+1]=l}};for(let o=0;o<s;o++){let a=t[3*o],l=t[3*o+1],f=t[3*o+2];N(a,l,o),N(l,f,o),N(f,a,o)}let A=(o,a)=>{let l=2*o,f=a-o;for(let O=1;O<f;O++){let w=i[l+2*O],L=i[l+2*O+1],g=O-1;for(;g>=0&&i[l+2*g]>w;g--)i[l+2*g+2]=i[l+2*g],i[l+2*g+3]=i[l+2*g+1];i[l+2*g+2]=w,i[l+2*g+3]=L}};for(let o=0;o<r;o++)A(n[o],n[o+1]),A(m+u[o],m+u[o+1]);let b=new Int32Array(3*s),z=(o,a)=>o===t[3*a]?0:o===t[3*a+1]?1:o===t[3*a+2]?2:-1,T=(o,a)=>{let l=z(o,a);b[3*a+l]=-1},k=(o,a,l,f)=>{let O=z(o,a);b[3*a+O]=f;let w=z(l,f);b[3*f+w]=a};for(let o=0;o<r;o++){let a=n[o],l=n[o+1],f=u[o],O=u[o+1];for(;a<l&&f<O;){let w=i[2*a],L=i[2*m+2*f];w===L?(k(o,i[2*a+1],L,i[2*m+2*f+1]),a++,f++):w<L?(T(o,i[2*a+1]),a++):(T(L,i[2*m+2*f+1]),f++)}for(;a<l;)T(o,i[2*a+1]),a++;for(;f<O;)T(i[2*m+2*f],i[2*m+2*f+1]),f++}return b}function tt(t,e,r,s,n,u=2){let p=1/(Math.abs(r)+Math.abs(s)+Math.abs(n)),d=r*p,h=s*p,i=n<=0?(d>=0?1:-1)*(1-Math.abs(h)):d,m=n<=0?(h>=0?1:-1)*(1-Math.abs(d)):h,N=e*u;t[N]=Lt(i),t[N+1]=Lt(m)}function Lt(t){return Et(Math.round(32767*t),-32767,32767)}var ft=.7,ot=class{updateSettings(e){this.settings=e,this._edgeHashFunction=e.reducedPrecision?Gt:kt}write(e,r,s){et.seed=this._edgeHashFunction(s);let n=et.getIntRange(0,255),u=et.getIntRange(0,this.settings.variants-1),p=et.getFloat(),d=255*(.5*Ht(-(1-Math.min(p/ft,1))+Math.max(0,p-ft)/(1-ft),1.2)+.5);e.position0.setVec(r,s.position0),e.position1.setVec(r,s.position1),e.componentIndex.set(r,s.componentIndex),e.variantOffset.set(r,n),e.variantStroke.set(r,u),e.variantExtension.set(r,d)}},V=new Float32Array(6),v=new Uint32Array(V.buffer),F=new Uint32Array(1);function kt(t){return V[0]=t.position0[0],V[1]=t.position0[1],V[2]=t.position0[2],V[3]=t.position1[0],V[4]=t.position1[1],V[5]=t.position1[2],F[0]=31*(31*(31*(31*(31*(166811+v[0])+v[1])+v[2])+v[3])+v[4])+v[5],F[0]}function Gt(t){let e=V;e[0]=B(t.position0[0]),e[1]=B(t.position0[1]),e[2]=B(t.position0[2]),e[3]=B(t.position1[0]),e[4]=B(t.position1[1]),e[5]=B(t.position1[2]),F[0]=5381;for(let r=0;r<v.length;r++)F[0]=31*F[0]+v[r];return F[0]}var Mt=1e4;function B(t){return Math.round(t*Mt)/Mt}function Ht(t,e){return Math.abs(t)**e*Math.sign(t)}var W=class{constructor(){this._commonWriter=new ot}updateSettings(e){this._commonWriter.updateSettings(e)}allocate(e){return K.createBuffer(e)}write(e,r,s){this._commonWriter.write(e,r,s),ht(C,s.faceNormal0,s.faceNormal1),U(C,C);let{typedBuffer:n,typedBufferStride:u}=e.normalCompressed;tt(n,r,C[0],C[1],C[2],u)}};W.Layout=K,W.glLayout=X(K,1);var _=class{constructor(){this._commonWriter=new ot}updateSettings(e){this._commonWriter.updateSettings(e)}allocate(e){return Y.createBuffer(e)}write(e,r,s){this._commonWriter.write(e,r,s);{let{typedBuffer:n,typedBufferStride:u}=e.normalCompressed;tt(n,r,s.faceNormal0[0],s.faceNormal0[1],s.faceNormal0[2],u)}{let{typedBuffer:n,typedBufferStride:u}=e.normal2Compressed;tt(n,r,s.faceNormal1[0],s.faceNormal1[1],s.faceNormal1[2],u)}}};_.Layout=Y,_.glLayout=X(Y,1);var C=I(),et=new gt;function be(t){let e=qt(t.data,t.skipDeduplicate,t.indices,t.indicesLength);return Rt.updateSettings(t.writerSettings),Vt.updateSettings(t.writerSettings),wt(e,Rt,Vt)}function qt(t,e,r,s){if(e){let p=ut(r,s,t.count);return new lt(r,s,p,t)}let n=At(t.buffer,t.stride/4,{originalIndices:r,originalIndicesLength:s}),u=ut(n.indices,s,n.uniqueCount);return{faces:n.indices,facesLength:n.indices.length,neighbors:u,vertices:yt.createView(n.buffer)}}var lt=class{constructor(e,r,s,n){this.faces=e,this.facesLength=r,this.neighbors=s,this.vertices=n}},Rt=new W,Vt=new _,Pe=M().vec3f(c.POSITION0).vec3f(c.POSITION1),De=M().vec3f(c.POSITION0).vec3f(c.POSITION1).u16(c.COMPONENTINDEX);export{yt as a,wt as b,be as c,qt as d,Pe as e,De as f};
