import{a as M,b as Qe,e as Mr,f as ce,g as Tt,h as Lt,i as Ir,q as pi,s as Cr,t as Ar}from"./chunk-WHLV5SNG.js";import{a as hi}from"./chunk-CKGQR2CH.js";import"./chunk-FRAAR7RR.js";import"./chunk-QPP4HOHY.js";import"./chunk-WQ4ZETPN.js";import"./chunk-TMKRZUEM.js";import"./chunk-6YY7MALF.js";import"./chunk-XJCAKA5Q.js";import"./chunk-DDHMQRMR.js";import"./chunk-RUWSKLE4.js";import{a as Et}from"./chunk-ZAKRS4NA.js";import{a as _r}from"./chunk-RXT7IR37.js";import"./chunk-7DQXDTLA.js";import"./chunk-GK4CPRU2.js";import"./chunk-PZ6UKR7S.js";import"./chunk-UBPTWFJG.js";import"./chunk-DAEAGXUL.js";import"./chunk-TGYRM66E.js";import"./chunk-FJJ2HK4Z.js";import"./chunk-7T6KH2Z6.js";import"./chunk-OH74MGAF.js";import"./chunk-KWPJ7W7D.js";import"./chunk-RIDPE7TS.js";import"./chunk-RZU6EEB3.js";import"./chunk-CIY4UOGB.js";import"./chunk-22VKLLNJ.js";import"./chunk-B4G6EV5H.js";import"./chunk-Y353ORYJ.js";import"./chunk-HRSAZUEG.js";import"./chunk-LQKHYKYR.js";import"./chunk-OTCE2CL6.js";import"./chunk-A32YL34U.js";import"./chunk-53GUVE7Z.js";import"./chunk-UTTIMDT4.js";import"./chunk-LAZNO6VW.js";import"./chunk-KFCU4KQY.js";import"./chunk-WNOBQY3K.js";import"./chunk-QS6RCA6Y.js";import"./chunk-WDTJILD4.js";import"./chunk-6NTMQUAJ.js";import"./chunk-APGKXN3F.js";import"./chunk-PHCUTV4M.js";import"./chunk-7C77LBCZ.js";import"./chunk-LK52GLIE.js";import"./chunk-GHKFJTCN.js";import"./chunk-IZF35GKA.js";import"./chunk-KS53OQGV.js";import"./chunk-EB5RRWIA.js";import{a as ui}from"./chunk-RWIKH4KN.js";import"./chunk-TH7OTU7Q.js";import"./chunk-MP46524Y.js";import"./chunk-WA64AKK6.js";import"./chunk-UKVDWQFD.js";import{a as li}from"./chunk-CYT6KIBU.js";import"./chunk-UH6DTPOD.js";import"./chunk-N3BNSVOS.js";import"./chunk-XCJPZZY7.js";import"./chunk-Y2F4CIGY.js";import"./chunk-AC7AQWXQ.js";import"./chunk-4DVY2TZI.js";import"./chunk-BPPBSQ5N.js";import"./chunk-2B3PG2ZT.js";import"./chunk-SYTNPSW4.js";import"./chunk-2AAD7VYB.js";import"./chunk-7TBWQ2OA.js";import{a as vr}from"./chunk-3PKDQQMT.js";import"./chunk-DVSFGYL7.js";import"./chunk-FALMC3VB.js";import{a as nt}from"./chunk-65ILPZGY.js";import"./chunk-COOG77AU.js";import"./chunk-SH6QBC5R.js";import"./chunk-3JO3IXGW.js";import"./chunk-U436ZYW5.js";import"./chunk-Y3R63VWF.js";import"./chunk-LHY2TOIB.js";import"./chunk-DACZ4LLK.js";import"./chunk-2EOPE46E.js";import"./chunk-2UGJ72JG.js";import"./chunk-LWI2RQ66.js";import"./chunk-LOEAA5XF.js";import{a as ne}from"./chunk-MAPO7YGF.js";import{b as pr,d as At,e as hr,f as mr,g as fr,i as xt,j as gr,k as yr,l as Ve,m as ai}from"./chunk-OLIJD5I4.js";import{a as It}from"./chunk-OOE2LCNP.js";import"./chunk-I3S324BU.js";import"./chunk-ESBNO4XM.js";import"./chunk-3A7OIH4J.js";import"./chunk-RMS5474O.js";import{k as ur}from"./chunk-2SHNUN5D.js";import"./chunk-IFCRPPYQ.js";import{a as ni}from"./chunk-YW3L7OMP.js";import"./chunk-FDQ4JKC5.js";import"./chunk-NAV5L5PJ.js";import"./chunk-J4HNE4D3.js";import{c as cr,d as Ct}from"./chunk-MXSUS5HK.js";import"./chunk-IM7ZT3FY.js";import"./chunk-EK4W5QYS.js";import"./chunk-DDZ3KR2Q.js";import"./chunk-DKSAM23M.js";import"./chunk-SPJDFBYB.js";import"./chunk-4R5DT3TR.js";import"./chunk-NVBPDYQT.js";import"./chunk-WMT47BMV.js";import"./chunk-PJQZD5QI.js";import{a as dr}from"./chunk-IEUNGS56.js";import"./chunk-6KRFVLII.js";import"./chunk-SPAOTNUK.js";import"./chunk-JHZRGEBS.js";import"./chunk-RQQJT345.js";import"./chunk-27SQOLVY.js";import"./chunk-6QNRNEQJ.js";import"./chunk-7QY3BMVN.js";import"./chunk-NWPYI2UP.js";import"./chunk-TNPL7MIN.js";import"./chunk-UYBHUOFR.js";import"./chunk-BYQI7UDX.js";import"./chunk-A6I6D7FN.js";import"./chunk-BES4JRIO.js";import{i as oi,j as si}from"./chunk-CD7FGRAU.js";import"./chunk-G4NJ66JB.js";import"./chunk-HIQGSNLD.js";import"./chunk-QU77E3KV.js";import"./chunk-SSGUIPHM.js";import"./chunk-7WFRJSY3.js";import"./chunk-PSQRUING.js";import"./chunk-DFTBSFIN.js";import{m as sr}from"./chunk-3JLZ7SFH.js";import"./chunk-FUBITVJ7.js";import{E as di,L as Fr,M as ci,c as br,z as wr}from"./chunk-VOH7XGOR.js";import"./chunk-Y6HWUWZ3.js";import"./chunk-AQ74ANSJ.js";import"./chunk-5UCI4TUX.js";import"./chunk-SAOUSUZE.js";import"./chunk-PPFMRTTD.js";import"./chunk-IWJQ3PU6.js";import"./chunk-Z5Q76SB7.js";import"./chunk-TTN7UOJS.js";import"./chunk-5QLB7ZJ7.js";import"./chunk-E5R4OI7X.js";import"./chunk-N566L3JG.js";import"./chunk-7S6PD5JC.js";import"./chunk-ZWI7LLTZ.js";import"./chunk-6NCXSKJD.js";import{g as nr,i as ar,s as lr}from"./chunk-ATXTHXJA.js";import"./chunk-VFINLX57.js";import"./chunk-LM5MGO7W.js";import"./chunk-4HUAEW4D.js";import"./chunk-XWRPBDYS.js";import"./chunk-TCCAOREC.js";import"./chunk-BCREO4Q5.js";import{i as rr,l as Ge}from"./chunk-SO6OJFOM.js";import"./chunk-DG5QI6E2.js";import{b as or}from"./chunk-TMZNSBQB.js";import"./chunk-ZGLJFDS6.js";import"./chunk-RSDQHAJX.js";import{S as Mt}from"./chunk-OFVMJORF.js";import{e as ee,f as V,g as q}from"./chunk-6OZZJZHT.js";import{g as c,h as er}from"./chunk-72VQRINQ.js";import{a as tr}from"./chunk-MDSLION2.js";import{g as de,h as ii,i as ri}from"./chunk-R2RE6SI6.js";import"./chunk-V2KSICSA.js";import{a as f,b as ke,c as oe,d as Ki,f as Ji,g as I}from"./chunk-2FYXACXP.js";import{a as st,b as Me,c as Q}from"./chunk-XGVKSCMM.js";import"./chunk-FX2VBPAM.js";import{a as Ft,f as Gi,h as Qi,i as ti}from"./chunk-K4GPNFIS.js";import{b as fe}from"./chunk-RP7XSKHE.js";import{a as Zi}from"./chunk-VV7MGXTC.js";import"./chunk-IXNVQC76.js";import"./chunk-LYPZUCFI.js";import"./chunk-QYC4ILGT.js";import"./chunk-HFQFGALU.js";import{a as Yi}from"./chunk-5TSEU5EE.js";import{a as se}from"./chunk-VC35VCVT.js";import"./chunk-MT7BXRRQ.js";import{a as Xi}from"./chunk-NNKLK2DS.js";import"./chunk-F4EX5NX6.js";import"./chunk-MDAB6L5Y.js";import"./chunk-OMNN7QFV.js";import"./chunk-VU5W7W6Y.js";import{aa as ir}from"./chunk-BRGZVJPZ.js";import{I as a,L as U,b as rt}from"./chunk-Z5NXR7SL.js";import{S as b,m as Le}from"./chunk-7JLWSSXP.js";import{a as n}from"./chunk-W3WDPWBE.js";import{l as ji,o as Ui,p as ot,q as bt,r as me,u as wt,y as Ze}from"./chunk-JKP4I6UL.js";import{b as Hi}from"./chunk-TZHKPIVH.js";import"./chunk-JPDAKIWT.js";import"./chunk-W6LY37E4.js";import{l as he,p as ei,q as S,s as L}from"./chunk-BRWS572J.js";import{c as Jt,m as Fe}from"./chunk-AKNRR36C.js";import{a as _,b as Te,g}from"./chunk-JEGVIFEP.js";function Be(e,t,i,r){let s=null,o=1e3;typeof t=="number"?(o=t,r=i):(s=t??null,o=i);let l,d=0,u=()=>{d=0,e.apply(r,l)},p=(...h)=>{s&&s.apply(r,h),l=h,o?d||(d=setTimeout(u,o)):u()};return p.remove=()=>{d&&(clearTimeout(d),d=0)},p.forceUpdate=()=>{d&&(clearTimeout(d),u())},p.hasPendingUpdates=()=>!!d,p}function at(e){switch(e?.type){case"point":return e;case"extent":return e.center;case"polygon":return e.centroid;case"multipoint":case"polyline":return e.extent?.center;default:return null}}function xr(e){return e?{backgroundImage:`url(${e})`}:{}}function Er({action:e,feature:t}){let i=t?.attributes,r="image"in e?e.image:void 0;return r&&i?Q(r,i):r??""}function Vo(e,t){return{type:Mt(t),value:e,unit:t}}function Bo(e,t){return{type:Mt(t),value:e,unit:t}}function mi(e,t,i="arithmetic"){return{type:Mt(t),value:e,unit:t,rotationType:i}}var an=Vo(0,"meters"),ln=Bo(0,"square-meters"),dn=mi(0,"radians"),cn=mi(0,"degrees"),un=mi(0,"degrees","geographic");var Tr=["B","kB","MB","GB","TB"];function Lr(e,t){let i=(t=Math.round(t))===0?0:Math.floor(Math.log(t)/Math.log(ni.KILOBYTES));i=or(i,0,Tr.length-1);let r=Me(t/ni.KILOBYTES**i,{maximumFractionDigits:2});return he(e.units.bytes[Tr[i]],{fileSize:r})}var Do="esri.widgets.Feature.support.featureUtils",gi=()=>S.getLogger(Do),qo=/href=(""|'')/gi,zo=/(\{([^{\r\n]+)\})/g,Wo=/'/g,Or=/^\s*expression\//i,Ho=/(\n)/gi,jo=/[\u00A0-\u9999<>&]/gim,Uo=/href\s*=\s*(?:"([^"]+)"|'([^']+)')/gi,Zo=/^(?:mailto:|tel:)/,$r="relationships/",kr=Qi("short-date-short-time");function kt(e){if(e!=null)return(e.sourceLayer||e.layer)??void 0}function Ye(r){return g(this,arguments,function*({type:e,value:t,event:i}){try{return typeof t=="function"?t(i):t}catch(s){return void gi().error("error",`An error occurred when calling the "${e}" function`,{error:s,graphic:i.graphic,value:t})}})}function Rt(e=""){if(e)return!Zo.test(e.trim().toLowerCase())}function lt(e){return!!e&&Or.test(e)}function Go(e,t){if(!t||!lt(t)||!e)return;let i=t.replace(Or,"").toLowerCase();return e.find(({name:r})=>r.toLowerCase()===i)}function Pt(e,t){let i=Go(t,e?.fieldName);return i?i.title||null:e?e.label||e.fieldName:null}function Qo(e,t){return`{${t.get(e.toLowerCase())?.fieldName||e}}`}function Xo(e){return e.replaceAll(qo,"")}function De(e,t){let i=yi(t,e);return i?i.name:e}function Sr(e,t){return e&&e.map(i=>De(i,t))}function yi(e,t){return e&&typeof e.getField=="function"&&t?e.getField(t)??null:null}function Vr(e){return`${e}`.trim()}function Ie({attributes:e,globalAttributes:t,layer:i,text:r,expressionAttributes:s,fieldInfoMap:o}){return r?Nt({formattedAttributes:t,template:es(r,_(_(_({},t),s),e),i),fieldInfoMap:o}):""}function Nt({formattedAttributes:e,template:t,fieldInfoMap:i}){return Vr(Xo(he(he(t,r=>Qo(r,i)),e)))}function Yo(e,t,i=!1){let r=t[e];if(typeof r=="string"){let s="%27",o=(i?encodeURIComponent(r):r).replaceAll(Wo,s);t[e]=o}}function Ko(e,t=!1){let i=_({},e);return Object.keys(i).forEach(r=>Yo(r,i,t)),i}function Jo(e,t,i){let r=(t=Vr(t))&&t[0]!=="{";return he(e,Ko(i,r||!1))}function Ot(e,t){return e.replaceAll(zo,(i,r,s)=>{let o=yi(t,s);return o?`{${o.name}}`:r})}function es(e,t,i){let r=Ot(e,i);return r&&r.replaceAll(Uo,(s,o,l)=>Jo(s,o||l,t))}function ts(e,t){if(typeof e=="string"&&t&&t.dateFormat==null&&(t.places!=null||t.digitSeparator!=null)){let i=Number(e);if(!isNaN(i))return i}return e}function is(e){return e!=null&&typeof e=="object"&&"fieldsIndex"in e&&"geometryType"in e&&"getField"in e&&"load"in e&&"loaded"in e&&"objectIdField"in e&&"spatialReference"in e&&"type"in e&&(e.type==="feature"||e.type==="scene"||e.type==="sublayer")&&"when"in e}function rs(e){return e!=null&&typeof e=="object"&&"createQuery"in e&&"queryFeatureCount"in e&&"queryObjectIds"in e&&"queryRelatedFeatures"in e&&"queryRelatedFeaturesCount"in e&&"relationships"in e}function vi(e){return is(e)&&rs(e)}function os(e,t){let{fieldInfos:i,fieldName:r,preventPlacesFormatting:s,layer:o,timeZone:l}=t,d=_i(i,r),u=yi(o,r);if(d&&!ci(r)){let h=u?.type,m=d.format?.dateFormat;if(h==="date"||h==="date-only"||h==="time-only"||h==="timestamp-offset"||m)return si(e,{format:m,fieldType:h,timeZoneOptions:{layerTimeZone:o&&"preferredTimeZone"in o?o.preferredTimeZone:null,viewTimeZone:l,datesInUnknownTimezone:!(!o||!("datesInUnknownTimezone"in o))&&!!o.datesInUnknownTimezone}})}let p=d?.format;return typeof e=="string"&&ci(r)&&p?ss(e,p):typeof(e=ts(e,p))=="string"||e==null||p==null?Ke(e):Me(e,s?Te(_({},st(p)),{minimumFractionDigits:0,maximumFractionDigits:20}):st(p))}function ss(e,t){return e=e.trim(),/\d{2}-\d{2}/.test(e)?e:e.includes(",")?fi(e,",",", ",t):e.includes(";")?fi(e,";","; ",t):e.includes(" ")?fi(e," "," ",t):Me(Number(e),st(t))}function fi(e,t,i,r){return e.trim().split(t).map(s=>Me(Number(s),st(r))).join(i)}function _i(e,t){if(e?.length&&t)return e.find(i=>i.fieldName?.toLowerCase()===t.toLowerCase())}function ns({fieldName:e,graphic:t,layer:i}){if(ae(e)||!i||typeof i.getFeatureType!="function")return null;let{typeIdField:r}=i;if(!r||e!==r)return null;let s=i.getFeatureType(t);return s?s.name:null}function as({fieldName:e,value:t,graphic:i,layer:r}){if(ae(e)||!r||typeof r.getFieldDomain!="function")return null;let s=i&&r.getFieldDomain(e,{feature:i});return s&&s.type==="coded-value"?s.getName(t):null}function Br(e,t,i,r){let{creatorField:s,creationDateField:o,editorField:l,editDateField:d}=e;if(!t)return;let u=Gi(r&&"preferredTimeZone"in r?r.preferredTimeZone:null,!(!r||!("datesInUnknownTimezone"in r))&&!!r.datesInUnknownTimezone,i,kr,"date"),p=_(_({},kr),u),h=t[d];if(typeof h=="number"){let v=t[l];return{type:"edit",date:ti(h,p),user:v}}let m=t[o];if(typeof m=="number"){let v=t[s];return{type:"create",date:ti(m,p),user:v}}return null}function Dr(e,t){let i=new Map;if(!e)return i;for(let r of e){if(!r.fieldName)continue;let s=De(r.fieldName,t);r.fieldName=s,i.set(s.toLowerCase(),r)}return i}function bi(e){let t=[];if(!e)return t;let{fieldInfos:i,content:r}=e;return i&&t.push(...i),r&&Array.isArray(r)&&r.forEach(s=>{if(s.type==="fields"){let o=s?.fieldInfos;o&&t.push(...o)}}),t}function $t(e){return e.replaceAll(jo,t=>`&#${t.charCodeAt(0)};`)}function Ke(e){return typeof e=="string"?e.replaceAll(Ho,'<br class="esri-text-new-line" />'):e}function qr(e){let{value:t,fieldName:i,fieldInfos:r,fieldInfoMap:s,layer:o,graphic:l,timeZone:d}=e;if(t==null)return"";let u=as({fieldName:i,value:t,graphic:l,layer:o});if(u)return u;let p=ns({fieldName:i,graphic:l,layer:o});if(p)return p;if(s.get(i.toLowerCase()))return os(t,{fieldInfos:r||Array.from(s.values()),fieldName:i,layer:o,timeZone:d});let h=o?.fieldsIndex?.get(i);return h&&(oi(h)||di(h))?si(t,{fieldType:h.type,timeZoneOptions:{layerTimeZone:o&&"preferredTimeZone"in o?o.preferredTimeZone:null,viewTimeZone:d,datesInUnknownTimezone:!(!o||!("datesInUnknownTimezone"in o))&&!!o.datesInUnknownTimezone}}):Ke(t)}function St({fieldInfos:e,attributes:t,layer:i,graphic:r,fieldInfoMap:s,relatedInfos:o,timeZone:l}){let d={};return o?.forEach(u=>cs({attributes:d,relatedInfo:u,fieldInfoMap:s,fieldInfos:e,layer:i,timeZone:l})),t&&Object.keys(t).forEach(u=>{let p=t[u];d[u]=qr({fieldName:u,fieldInfos:e,fieldInfoMap:s,layer:i,value:p,graphic:r,timeZone:l})}),d}function wi(e,t){return g(this,null,function*(){let{layer:i,graphic:r,outFields:s,objectIds:o,returnGeometry:l,spatialReference:d}=e,u=o[0];if(typeof u!="number"&&typeof u!="string"){let h="Could not query required fields for the specified feature. The feature's ID is invalid.",m={layer:i,graphic:r,objectId:u,requiredFields:s};return gi().warn(h,m),null}if(!sr(i)?.operations?.supportsQuery){let h="The specified layer cannot be queried. The following fields will not be available.",m={layer:i,graphic:r,requiredFields:s,returnGeometry:l};return gi().warn(h,m),null}let p=i.createQuery();return p.objectIds=o,p.outFields=s?.length?s:[i.objectIdField],p.returnGeometry=!!l,p.returnZ=!!l,p.returnM=!!l,p.outSpatialReference=d,(yield i.queryFeatures(p,t)).features[0]})}function ls(e){return g(this,null,function*(){if(!e.expressionInfos?.length)return!1;let t=yield br(),{arcadeUtils:{hasGeometryFunctions:i}}=t;return i(e)})}function zr(o,l){return g(this,arguments,function*({graphic:e,popupTemplate:t,layer:i,spatialReference:r},s){if(!i||!t||(typeof i.load=="function"&&(yield i.load(s)),!e.attributes))return;let d=i.objectIdField,u=e.attributes[d];if(u==null)return;let p=[u],h=yield t.getRequiredFields(i.fieldsIndex),m=Fr(h,e),v=m?[]:h.includes(d)?h:[...h,d],y=t.returnGeometry||(yield ls(t));if(m&&!y)return;let w=yield wi({layer:i,graphic:e,outFields:v,objectIds:p,returnGeometry:y,spatialReference:r},s);w&&(w.geometry&&(e.geometry=w.geometry),w.attributes&&(e.attributes=_(_({},e.attributes),w.attributes)))})}function ae(e=""){return!!e&&e.includes($r)}function ds(e){return e?`${$r}${e.layerId}/${e.fieldName}`:""}function Rr({attributes:e,graphic:t,relatedInfo:i,fieldInfos:r,fieldInfoMap:s,layer:o,timeZone:l}){e&&t&&i&&Object.keys(t.attributes).forEach(d=>{let u=ds({layerId:i.relation.id.toString(),fieldName:d}),p=t.attributes[d];e[u]=qr({fieldName:u,fieldInfos:r,fieldInfoMap:s,layer:o,value:p,graphic:t,timeZone:l})})}function cs({attributes:e,relatedInfo:t,fieldInfoMap:i,fieldInfos:r,layer:s,timeZone:o}){e&&t&&(t.relatedFeatures?.forEach(l=>Rr({attributes:e,graphic:l,relatedInfo:t,fieldInfoMap:i,fieldInfos:r,layer:s,timeZone:o})),t.relatedStatsFeatures?.forEach(l=>Rr({attributes:e,graphic:l,relatedInfo:t,fieldInfoMap:i,fieldInfos:r,layer:s,timeZone:o})))}var Pr=e=>{if(!e)return!1;let t=e.toUpperCase();return t.includes("CURRENT_TIMESTAMP")||t.includes("CURRENT_DATE")||t.includes("CURRENT_TIME")},Wr=({layer:e,method:t,query:i,definitionExpression:r})=>{if(!e.capabilities?.query?.supportsCacheHint||t==="attachments")return;let s=i.where!=null?i.where:null,o=i.geometry!=null?i.geometry:null;Pr(r)||Pr(s)||o?.type==="extent"||i.resultType==="tile"||(i.cacheHint=!0)},Hr=({query:e,layer:t,method:i})=>{Wr({layer:t,method:i,query:e,definitionExpression:`${t.definitionExpression} ${t.serviceDefinitionExpression??""}`})},jr=({queryPayload:e,layer:t,method:i})=>{Wr({layer:t,method:i,query:e,definitionExpression:`${t.definitionExpression} ${t.serviceDefinitionExpression??""}`})};function Ur(e,t,i){return e&&t&&i?t.type==="sublayer"?Xe({layers:t.layer?.sublayers,map:e,relatedLayer:t,relationship:i})||Xe({layers:t.layer?.subtables,map:e,relatedLayer:t,relationship:i}):Xe({layers:e.allLayers,map:e,relatedLayer:t,relationship:i})||Xe({layers:e.allTables,map:e,relatedLayer:t,relationship:i}):null}function Nr(e,t){return e?.allTables.find(i=>i.type==="feature"&&i.layerId===t.id&&i.url===t.layer?.url)}function Xe({map:e,relationship:t,relationship:{relatedTableId:i},relatedLayer:r,layers:s}){if(!s)return null;for(let o of s){if(o.type==="map-image"){let d=Xe({layers:o.sublayers,map:e,relatedLayer:r,relationship:t})||Xe({layers:o.subtables,map:e,relatedLayer:r,relationship:t});if(d)return d;continue}if(!vi(o))continue;if(r.type==="sublayer"){if(o!==r&&o.id===i)return o.isTable?Nr(e,o):o;continue}let l=r.type==="scene"&&r.associatedLayer?r.associatedLayer.url:r.url;if(!l)return null;if(o.type!=="sublayer"){if(o!==r&&o.url===l&&o.layerId===i)return o}else if(o!==r&&o.layer?.url===l&&o.id===i)return o.isTable?Nr(e,o):o}return null}var Zr={editing:!1,operations:{add:!0,update:!0,delete:!0}},Gr=fe.ofType(vr),te=class extends U{constructor(e){super(e),this._getAttachmentsPromise=null,this._attachmentLayer=null,this.capabilities=_({},Zr),this.activeAttachmentInfo=null,this.activeFileInfo=null,this.attachmentInfos=new Gr,this.fileInfos=new fe,this.graphic=null,this.mode="view",this.filesEnabled=!1,this.addHandles(f(()=>this.graphic,()=>this._graphicChanged(),I))}destroy(){this._attachmentLayer=null,this.graphic=null}castCapabilities(e){return _(_({},Zr),e)}get state(){return this._getAttachmentsPromise?"loading":this.graphic?"ready":"disabled"}get supportsResizeAttachments(){let{graphic:e}=this;if(!e)return!1;let t=e.layer||e.sourceLayer;return t?.loaded&&"capabilities"in t&&t.capabilities&&"operations"in t.capabilities&&"supportsResizeAttachments"in t.capabilities.operations&&t.capabilities.operations.supportsResizeAttachments||!1}getAttachments(){return g(this,null,function*(){let{_attachmentLayer:e,attachmentInfos:t}=this;if(!e||typeof e.queryAttachments!="function")throw new L("invalid-layer","getAttachments(): A valid layer is required.");let i=this._getObjectId(),r=new li({objectIds:[i],returnMetadata:!0}),s=[],o=e.queryAttachments(r).then(d=>d[i]||s).catch(()=>s);this._getAttachmentsPromise=o,this.notifyChange("state");let l=yield o;return t.destroyAll(),l.length&&t.addMany(l),this._getAttachmentsPromise=null,this.notifyChange("state"),l})}addAttachment(i){return g(this,arguments,function*(e,t=this.graphic){let{_attachmentLayer:r,attachmentInfos:s,capabilities:o}=this;if(!t)throw new L("invalid-graphic","addAttachment(): A valid graphic is required.",{graphic:t});if(!e)throw new L("invalid-attachment","addAttachment(): An attachment is required.",{attachment:e});if(!o.operations?.add)throw new L("invalid-capabilities","addAttachment(): add capabilities are required.");if(!r||typeof r.addAttachment!="function")throw new L("invalid-layer","addAttachment(): A valid layer is required.");let l=r.addAttachment(t,e).then(u=>this._queryAttachment(u.objectId,t)),d=yield l;return s.add(d),d})}deleteAttachment(e){return g(this,null,function*(){let{_attachmentLayer:t,attachmentInfos:i,graphic:r,capabilities:s}=this;if(!e)throw new L("invalid-attachment-info","deleteAttachment(): An attachmentInfo is required.",{attachmentInfo:e});if(!s.operations?.delete)throw new L("invalid-capabilities","deleteAttachment(): delete capabilities are required.");if(!t||typeof t.deleteAttachments!="function")throw new L("invalid-layer","deleteAttachment(): A valid layer is required.");if(!r)throw new L("invalid-graphic","deleteAttachment(): A graphic is required.");let o=t.deleteAttachments(r,[e.id]).then(()=>e),l=yield o;return i.remove(l),l.destroy(),l})}updateAttachment(i){return g(this,arguments,function*(e,t=this.activeAttachmentInfo){let{_attachmentLayer:r,attachmentInfos:s,graphic:o,capabilities:l}=this;if(!e)throw new L("invalid-attachment","updateAttachment(): An attachment is required.",{attachment:e});if(!t)throw new L("invalid-attachment-info","updateAttachment(): An attachmentInfo is required.",{attachmentInfo:t});if(!l.operations?.update)throw new L("invalid-capabilities","updateAttachment(): Update capabilities are required.");let d=s.indexOf(t);if(!r||typeof r.updateAttachment!="function")throw new L("invalid-layer","updateAttachment(): A valid layer is required.");if(!o)throw new L("invalid-graphic","updateAttachment(): A graphic is required.");let u=r.updateAttachment(o,t.id,e).then(h=>this._queryAttachment(h.objectId)),p=yield u;return s.splice(d,1,p),p})}commitFiles(){return g(this,null,function*(){return yield Promise.all(this.fileInfos.items.map(e=>this.addAttachment(e.form))),this.fileInfos.removeAll(),this.getAttachments()})}addFile(e,t){if(!e||!t)return null;let i={file:e,form:t};return this.fileInfos.add(i),i}updateFile(e,t,i=this.activeFileInfo){if(!e||!t||!i)return null;let r=this.fileInfos.indexOf(i);return r>-1&&this.fileInfos.splice(r,1,{file:e,form:t}),this.fileInfos.items[r]}deleteFile(e){let t=this.fileInfos.find(i=>i.file===e);return t?(this.fileInfos.remove(t),t):null}_queryAttachment(e,t){return g(this,null,function*(){let{_attachmentLayer:i}=this;if(!e||!i?.queryAttachments)throw new L("invalid-attachment-id","Could not query attachment.");let r=this._getObjectId(t),s=new li({objectIds:[r],attachmentsWhere:`AttachmentId=${e}`,returnMetadata:!0});return i.queryAttachments(s).then(o=>o[r][0])})}_getObjectId(e=this.graphic){return e?.getObjectId()??null}_graphicChanged(){this.graphic&&(this._setAttachmentLayer(),this.getAttachments().catch(()=>{}))}_setAttachmentLayer(){let{graphic:e}=this,t=kt(e);this._attachmentLayer=t?t.type==="scene"&&t.associatedLayer!=null?t.associatedLayer:t:null}};n([a()],te.prototype,"capabilities",void 0),n([se("capabilities")],te.prototype,"castCapabilities",null),n([a()],te.prototype,"activeAttachmentInfo",void 0),n([a()],te.prototype,"activeFileInfo",void 0),n([a({readOnly:!0,type:Gr})],te.prototype,"attachmentInfos",void 0),n([a()],te.prototype,"fileInfos",void 0),n([a({type:ne})],te.prototype,"graphic",void 0),n([a()],te.prototype,"mode",void 0),n([a({readOnly:!0})],te.prototype,"state",null),n([a()],te.prototype,"filesEnabled",void 0),n([a({readOnly:!0})],te.prototype,"supportsResizeAttachments",null),te=n([b("esri.widgets.Attachments.AttachmentsViewModel")],te);var dt=te;function Fi(e){let t=e.toLowerCase();return t==="image/bmp"||t==="image/emf"||t==="image/exif"||t==="image/gif"||t==="image/x-icon"||t==="image/jpeg"||t==="image/png"||t==="image/tiff"||t==="image/x-wmf"}function Qr(e){let t=Xi("esri/themes/base/images/files/");return e?e==="text/plain"?`${t}text-32.svg`:e==="application/pdf"?`${t}pdf-32.svg`:e==="text/csv"?`${t}csv-32.svg`:e==="application/gpx+xml"?`${t}gpx-32.svg`:e==="application/x-dwf"?`${t}cad-32.svg`:e==="application/postscript"||e==="application/json"||e==="text/xml"||e==="model/vrml"?`${t}code-32.svg`:e==="application/x-zip-compressed"||e==="application/x-7z-compressed"||e==="application/x-gzip"||e==="application/x-tar"||e==="application/x-gtar"||e==="application/x-bzip2"||e==="application/gzip"||e==="application/x-compress"||e==="application/x-apple-diskimage"||e==="application/x-rar-compressed"||e==="application/zip"?`${t}zip-32.svg`:e.includes("image/")?`${t}image-32.svg`:e.includes("audio/")?`${t}sound-32.svg`:e.includes("video/")?`${t}video-32.svg`:e.includes("msexcel")||e.includes("ms-excel")||e.includes("spreadsheetml")?`${t}excel-32.svg`:e.includes("msword")||e.includes("ms-word")||e.includes("wordprocessingml")?`${t}word-32.svg`:e.includes("powerpoint")||e.includes("presentationml")?`${t}report-32.svg`:`${t}generic-32.svg`:`${t}generic-32.svg`}var Xr={addButton:!0,addSubmitButton:!0,cancelAddButton:!0,cancelUpdateButton:!0,deleteButton:!0,errorMessage:!0,progressBar:!0,updateButton:!0},k="esri-attachments",F={base:k,loaderContainer:`${k}__loader-container`,loader:`${k}__loader`,fadeIn:`${k}--fade-in`,container:`${k}__container`,containerList:`${k}__container--list`,containerPreview:`${k}__container--preview`,actions:`${k}__actions`,deleteButton:`${k}__delete-button`,addAttachmentButton:`${k}__add-attachment-button`,errorMessage:`${k}__error-message`,items:`${k}__items`,item:`${k}__item`,itemButton:`${k}__item-button`,itemMask:`${k}__item-mask`,itemMaskIcon:`${k}__item-mask--icon`,itemImage:`${k}__image`,itemImageResizable:`${k}__image--resizable`,itemLabel:`${k}__label`,itemFilename:`${k}__filename`,itemChevronIcon:`${k}__item-chevron-icon`,itemLink:`${k}__item-link`,itemLinkOverlay:`${k}__item-link-overlay`,itemLinkOverlayIcon:`${k}__item-link-overlay-icon`,itemEditIcon:`${k}__item-edit-icon`,itemAddIcon:`${k}__item-add-icon`,itemAddButton:`${k}__item-add-button`,formNode:`${k}__form-node`,fileFieldset:`${k}__file-fieldset`,fileLabel:`${k}__file-label`,fileName:`${k}__file-name`,fileInput:`${k}__file-input`,metadata:`${k}__metadata`,metadataFieldset:`${k}__metadata-fieldset`,progressBar:`${k}__progress-bar`},Mi=window.CSS,Z=class extends V{constructor(e,t){super(e,t),this.displayType="auto",this.messages=null,this.messagesUnits=null,this.selectedFile=null,this.submitting=!1,this.viewModel=null,this.visibleElements=_({},Xr),this._supportsImageOrientation=Mi&&Mi.supports&&Mi.supports("image-orientation","from-image"),this._addAttachmentForm=null,this._updateAttachmentForm=null}normalizeCtorArgs(e){return e?.viewModel||(e=_({viewModel:new dt},e)),e}initialize(){this.addHandles([oe(()=>this.viewModel?.attachmentInfos,"change",()=>this.scheduleRender()),oe(()=>this.viewModel?.fileInfos,"change",()=>this.scheduleRender()),f(()=>this.viewModel?.mode,()=>this._modeChanged(),I)])}loadDependencies(){return ee({icon:()=>import("./chunk-WEV76HGW.js")})}get capabilities(){return this.viewModel.capabilities}set capabilities(e){this.viewModel.capabilities=e}get effectiveDisplayType(){let{displayType:e}=this;return e&&e!=="auto"?e:this.viewModel.supportsResizeAttachments?"preview":"list"}get graphic(){return this.viewModel.graphic}set graphic(e){this.viewModel.graphic=e}get icon(){return"attachment"}set icon(e){this._overrideIfSome("icon",e)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}castVisibleElements(e){return _(_({},Xr),e)}addAttachment(){let{_addAttachmentForm:e,viewModel:t}=this;return this._set("submitting",!0),this._set("error",null),t.addAttachment(e).then(i=>(this._set("submitting",!1),this._set("error",null),t.mode="view",i)).catch(i=>{throw this._set("submitting",!1),this._set("error",new L("attachments:add-attachment",this.messages.addErrorMessage,i)),i})}deleteAttachment(e){let{viewModel:t}=this;return this._set("submitting",!0),this._set("error",null),t.deleteAttachment(e).then(i=>(this._set("submitting",!1),this._set("error",null),t.mode="view",i)).catch(i=>{throw this._set("submitting",!1),this._set("error",new L("attachments:delete-attachment",this.messages.deleteErrorMessage,i)),i})}updateAttachment(){let{viewModel:e}=this,{_updateAttachmentForm:t}=this;return this._set("submitting",!0),this._set("error",null),e.updateAttachment(t).then(i=>(this._set("submitting",!1),this._set("error",null),e.mode="view",i)).catch(i=>{throw this._set("submitting",!1),this._set("error",new L("attachments:update-attachment",this.messages.updateErrorMessage,i)),i})}addFile(){let e=this.viewModel.addFile(this.selectedFile,this._addAttachmentForm);return this.viewModel.mode="view",e}updateFile(){let{viewModel:e}=this,t=e.updateFile(this.selectedFile,this._updateAttachmentForm,e.activeFileInfo);return e.mode="view",t}deleteFile(e){let t=this.viewModel.deleteFile(e||this.viewModel.activeFileInfo?.file);return this.viewModel.mode="view",t}render(){let{submitting:e,viewModel:t}=this,{state:i}=t;return c("div",{class:this.classes(F.base,M.widget)},e?this._renderProgressBar():null,i==="loading"?this._renderLoading():this._renderAttachments(),this._renderErrorMessage())}_renderErrorMessage(){let{error:e,visibleElements:t}=this;return e&&t.errorMessage?c("div",{class:F.errorMessage,key:"error-message"},e.message):null}_renderAttachments(){let{activeFileInfo:e,mode:t,activeAttachmentInfo:i}=this.viewModel;return t==="add"?this._renderAddForm():t==="edit"?this._renderDetailsForm(i||e):this._renderAttachmentContainer()}_renderLoading(){return c("div",{class:F.loaderContainer,key:"loader"},c("div",{class:F.loader}))}_renderProgressBar(){return this.visibleElements.progressBar?c("div",{class:F.progressBar,key:"progress-bar"}):null}_renderAddForm(){let{submitting:e,selectedFile:t}=this,i=e||!t,r=this.visibleElements.cancelAddButton?c("button",{bind:this,class:this.classes(M.button,M.buttonTertiary,M.buttonSmall,M.buttonHalf,e&&M.buttonDisabled),disabled:e,onclick:this._cancelForm,type:"button"},this.messages.cancel):null,s=this.visibleElements.addSubmitButton?c("button",{class:this.classes(M.button,M.buttonSecondary,M.buttonSmall,M.buttonHalf,{[M.buttonDisabled]:i}),disabled:i,type:"submit"},this.messages.add):null,o=t?c("span",{class:F.fileName,key:"file-name"},t.name):null,l=c("form",{afterCreate:ri,afterRemoved:ii,bind:this,"data-node-ref":"_addAttachmentForm",onsubmit:this._submitAddAttachment},c("fieldset",{class:F.fileFieldset},o,c("label",{class:this.classes(F.fileLabel,M.button,M.buttonSecondary)},t?this.messages.changeFile:this.messages.selectFile,c("input",{bind:this,class:F.fileInput,name:"attachment",onchange:this._handleFileInputChange,type:"file"}))),s,r);return c("div",{class:F.formNode,key:"add-form-container"},l)}_renderDetailsForm(e){let{visibleElements:t,viewModel:i,selectedFile:r,submitting:s}=this,{capabilities:o}=i,l=s||!r,d,u,p,h;r?(d=r.type,u=r.name,p=r.size):e&&"file"in e?(d=e.file.type,u=e.file.name,p=e.file.size):e&&"contentType"in e&&(d=e.contentType,u=e.name,p=e.size,h=e.url);let m=o.editing&&o.operations?.delete&&t.deleteButton?c("button",{bind:this,class:this.classes(M.button,M.buttonSmall,M.buttonTertiary,F.deleteButton,{[M.buttonDisabled]:s}),disabled:s,key:"delete-button",onclick:$=>this._submitDeleteAttachment($,e),type:"button"},this.messages.delete):void 0,v=o.editing&&o.operations?.update&&t.updateButton?c("button",{class:this.classes(M.button,M.buttonSmall,M.buttonThird,{[M.buttonDisabled]:l}),disabled:l,key:"update-button",type:"submit"},this.messages.update):void 0,y=this.visibleElements.cancelUpdateButton?c("button",{bind:this,class:this.classes(M.button,M.buttonSmall,M.buttonTertiary,M.buttonThird,{[M.buttonDisabled]:s}),disabled:s,key:"cancel-button",onclick:this._cancelForm,type:"button"},this.messages.cancel):void 0,w=o.editing&&o.operations?.update?c("fieldset",{class:F.fileFieldset,key:"file"},c("span",{class:F.fileName,key:"file-name"},u),c("label",{class:this.classes(F.fileLabel,M.button,M.buttonSecondary)},this.messages.changeFile,c("input",{bind:this,class:F.fileInput,name:"attachment",onchange:this._handleFileInputChange,type:"file"}))):void 0,T=c("fieldset",{class:F.metadataFieldset,key:"size"},c("label",null,Lr(this.messagesUnits,p??0))),R=c("fieldset",{class:F.metadataFieldset,key:"content-type"},c("label",null,d)),A=h!=null?c("a",{class:F.itemLink,href:h,rel:"noreferrer",target:"_blank"},this._renderImageMask(e,400),c("div",{class:F.itemLinkOverlay},c("span",{class:F.itemLinkOverlayIcon},c("calcite-icon",{icon:"launch"})))):this._renderImageMask(e,400),N=c("form",{afterCreate:ri,afterRemoved:ii,bind:this,"data-node-ref":"_updateAttachmentForm",onsubmit:$=>this._submitUpdateAttachment($,e)},c("div",{class:F.metadata},T,R),w,c("div",{class:F.actions},m,y,v));return c("div",{class:F.formNode,key:"edit-form-container"},A,N)}_renderImageMask(e,t){return e?"file"in e?this._renderGenericImageMask(e.file.name,e.file.type):this._renderImageMaskForAttachment(e,t):null}_renderGenericImageMask(e,t){let{supportsResizeAttachments:i}=this.viewModel,r=Qr(t),s={[F.itemImageResizable]:i};return c("div",{class:this.classes(F.itemMaskIcon,F.itemMask),key:r},c("img",{alt:e,class:this.classes(s,F.itemImage),src:r,title:e}))}_renderImageMaskForAttachment(e,t){let{supportsResizeAttachments:i}=this.viewModel;if(!e)return null;let{contentType:r,name:s,url:o}=e;if(!i||!Fi(r))return this._renderGenericImageMask(s,r);let l=this._getCSSTransform(e),d=l?{transform:l,"image-orientation":"none"}:{},u=`${o}${o?.includes("?")?"&":"?"}w=${t}`,p={[F.itemImageResizable]:i};return c("div",{class:this.classes(F.itemMask),key:u},c("img",{alt:s,class:this.classes(p,F.itemImage),src:u,styles:d,title:s}))}_renderFile(e){let{file:t}=e;return c("li",{class:F.item,key:t},c("button",{"aria-label":this.messages.attachmentDetails,bind:this,class:F.itemButton,key:"details-button",onclick:()=>this._startEditFile(e),title:this.messages.attachmentDetails,type:"button"},this._renderImageMask(e),c("label",{class:F.itemLabel},c("span",{class:F.itemFilename},t.name||this.messages.noTitle),c("span",{"aria-hidden":"true",class:this.classes(F.itemChevronIcon,de(this.container)?ce.left:ce.right)}))))}_renderAttachmentInfo({attachmentInfo:e,displayType:t}){let{viewModel:i,effectiveDisplayType:r}=this,{capabilities:s,supportsResizeAttachments:o}=i,{contentType:l,name:d,url:u}=e,p=this._renderImageMask(e,t==="list"?48:400),h=s.editing?c("span",{"aria-hidden":"true",class:this.classes(F.itemChevronIcon,de(this.container)?ce.left:ce.right)}):null,m=[p,r==="preview"&&o&&Fi(l)?null:c("label",{class:F.itemLabel},c("span",{class:F.itemFilename},d||this.messages.noTitle),h)],v=s.editing?c("button",{"aria-label":this.messages.attachmentDetails,bind:this,class:F.itemButton,"data-attachment-info-id":e.id,key:"details-button",onclick:()=>this._startEditAttachment(e),title:this.messages.attachmentDetails,type:"button"},m):c("a",{class:F.itemButton,href:u??void 0,key:"details-link",rel:"noreferrer",target:"_blank"},m);return c("li",{class:F.item,key:e},v)}_renderAttachmentContainer(){let{effectiveDisplayType:e,viewModel:t,visibleElements:i}=this,{attachmentInfos:r,capabilities:s,fileInfos:o}=t,l=!!r?.length,d=!!o?.length,u={[F.containerList]:e!=="preview",[F.containerPreview]:e==="preview"},p=s.editing&&s.operations?.add&&i.addButton?c("button",{bind:this,class:this.classes(M.button,M.buttonTertiary,F.addAttachmentButton),onclick:()=>this._startAddAttachment(),type:"button"},c("span",{"aria-hidden":"true",class:this.classes(F.itemAddIcon,ce.plus)}),this.messages.add):void 0,h=l?c("ul",{class:F.items,key:"attachments-list"},r.toArray().map(y=>this._renderAttachmentInfo({attachmentInfo:y,displayType:e}))):void 0,m=d?c("ul",{class:F.items,key:"file-list"},o.toArray().map(y=>this._renderFile(y))):void 0,v=d||l?void 0:c("div",{class:M.empty},this.messages.noAttachments);return c("div",{class:this.classes(F.container,u),key:"attachments-container"},h,m,v,p)}_modeChanged(){this._set("error",null),this._set("selectedFile",null)}_handleFileInputChange(e){let t=e.target,i=t.files?.item(0);this._set("selectedFile",i)}_submitDeleteAttachment(e,t){e.preventDefault(),t&&("file"in t?this.deleteFile(t.file):t&&this.deleteAttachment(t))}_submitAddAttachment(e){e.preventDefault(),this.viewModel.filesEnabled?this.addFile():this.addAttachment()}_submitUpdateAttachment(e,t){e.preventDefault(),t&&"file"in t?this.updateFile():this.updateAttachment()}_startEditAttachment(e){let{viewModel:t}=this;t.activeFileInfo=null,t.activeAttachmentInfo=e,t.mode="edit"}_startEditFile(e){let{viewModel:t}=this;t.activeAttachmentInfo=null,t.activeFileInfo=e,t.mode="edit"}_startAddAttachment(){this.viewModel.mode="add"}_cancelForm(e){e.preventDefault(),this.viewModel.mode="view"}_getCSSTransform(e){let{orientationInfo:t}=e;return!this._supportsImageOrientation&&t?[t.rotation?`rotate(${t.rotation}deg)`:"",t.mirrored?"scaleX(-1)":""].join(" "):""}};n([a()],Z.prototype,"capabilities",null),n([a()],Z.prototype,"displayType",void 0),n([a({readOnly:!0})],Z.prototype,"effectiveDisplayType",null),n([a()],Z.prototype,"graphic",null),n([a()],Z.prototype,"icon",null),n([a()],Z.prototype,"label",null),n([a(),q("esri/widgets/Attachments/t9n/Attachments")],Z.prototype,"messages",void 0),n([a(),q("esri/core/t9n/Units")],Z.prototype,"messagesUnits",void 0),n([a({readOnly:!0})],Z.prototype,"selectedFile",void 0),n([a({readOnly:!0})],Z.prototype,"submitting",void 0),n([a({readOnly:!0})],Z.prototype,"error",void 0),n([a({type:dt})],Z.prototype,"viewModel",void 0),n([a()],Z.prototype,"visibleElements",void 0),n([se("visibleElements")],Z.prototype,"castVisibleElements",null),Z=n([b("esri.widgets.Attachments")],Z);var Yr=Z;var ct=class extends dt{constructor(e){super(e),this.description=null,this.title=null}};n([a()],ct.prototype,"description",void 0),n([a()],ct.prototype,"title",void 0),ct=n([b("esri.widgets.Feature.FeatureAttachments.FeatureAttachmentsViewModel")],ct);var ut=ct;var Ii="esri-feature-element-info",Ci={base:Ii,title:`${Ii}__title`,description:`${Ii}__description`},Je=class extends V{constructor(e,t){super(e,t),this.description=null,this.headingLevel=2,this.title=null}render(){return c("div",{class:Ci.base},this._renderTitle(),this._renderDescription())}_renderTitle(){let{title:e}=this;return e?c(Qe,{class:Ci.title,innerHTML:e,level:this.headingLevel}):null}_renderDescription(){let{description:e}=this;return e?c("div",{class:Ci.description,innerHTML:e,key:"description"}):null}};n([a()],Je.prototype,"description",void 0),n([a()],Je.prototype,"headingLevel",void 0),n([a()],Je.prototype,"title",void 0),Je=n([b("esri.widgets.Feature.support.FeatureElementInfo")],Je);var Re=Je;var us={base:"esri-feature-attachments"},ge=class extends V{constructor(e,t){super(e,t),this._featureElementInfo=null,this.attachmentsWidget=new Yr,this.headingLevel=2,this.viewModel=new ut}initialize(){this._featureElementInfo=new Re,this.addHandles([f(()=>[this.viewModel?.description,this.viewModel?.title,this.headingLevel],()=>this._setupFeatureElementInfo(),I),f(()=>this.viewModel,e=>this.attachmentsWidget.viewModel=e,I)])}destroy(){this.attachmentsWidget.viewModel=null,this.attachmentsWidget.destroy(),this._featureElementInfo?.destroy()}get description(){return this.viewModel.description}set description(e){this.viewModel.description=e}get displayType(){return this.attachmentsWidget.displayType}set displayType(e){this.attachmentsWidget.displayType=e}get graphic(){return this.viewModel.graphic}set graphic(e){this.viewModel.graphic=e}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}render(){let{attachmentsWidget:e}=this;return c("div",{class:us.base},this._featureElementInfo?.render(),e?.render())}_setupFeatureElementInfo(){let{description:e,title:t,headingLevel:i}=this;this._featureElementInfo?.set({description:e,title:t,headingLevel:i})}};n([a({readOnly:!0})],ge.prototype,"attachmentsWidget",void 0),n([a()],ge.prototype,"description",null),n([a()],ge.prototype,"displayType",null),n([a()],ge.prototype,"graphic",null),n([a()],ge.prototype,"headingLevel",void 0),n([a()],ge.prototype,"title",null),n([a({type:ut})],ge.prototype,"viewModel",void 0),ge=n([b("esri.widgets.Feature.FeatureAttachments")],ge);var Kr=ge;var Pe=class extends U{constructor(e){super(e),this._loadingPromise=null,this.created=null,this.creator=null,this.destroyer=null,this.graphic=null,this.addHandles(f(()=>this.creator,t=>{this._destroyContent(),this._createContent(t)},I))}destroy(){this._destroyContent()}get state(){return this._loadingPromise?"loading":"ready"}_destroyContent(){let{created:e,graphic:t,destroyer:i}=this;e&&t&&(Ye({type:"content",value:i,event:{graphic:t}}),this._set("created",null))}_createContent(e){return g(this,null,function*(){let t=this.graphic;if(!t||!e)return;let i=Ye({type:"content",value:e,event:{graphic:t}});this._loadingPromise=i,this.notifyChange("state");let r=yield i;i===this._loadingPromise&&(this._loadingPromise=null,this.notifyChange("state"),this._set("created",r))})}};n([a({readOnly:!0})],Pe.prototype,"created",void 0),n([a()],Pe.prototype,"creator",void 0),n([a()],Pe.prototype,"destroyer",void 0),n([a({type:ne})],Pe.prototype,"graphic",void 0),n([a({readOnly:!0})],Pe.prototype,"state",null),Pe=n([b("esri.widgets.Feature.FeatureContent.FeatureContentViewModel")],Pe);var qe=Pe;var Ai="esri-feature-content",xi={base:Ai,loaderContainer:`${Ai}__loader-container`,loader:`${Ai}__loader`},et=class extends V{constructor(e,t){super(e,t),this.viewModel=null,this._addTargetToAnchors=i=>{Array.from(i.querySelectorAll("a")).forEach(r=>{Rt(r.href)&&!r.hasAttribute("target")&&r.setAttribute("target","_blank")})}}get creator(){return this.viewModel?.creator}set creator(e){this.viewModel&&(this.viewModel.creator=e)}get graphic(){return this.viewModel?.graphic}set graphic(e){this.viewModel&&(this.viewModel.graphic=e)}render(){let e=this.viewModel?.state;return c("div",{class:xi.base},e==="loading"?this._renderLoading():this._renderCreated())}_renderLoading(){return c("div",{class:xi.loaderContainer,key:"loader"},c("div",{class:xi.loader}))}_renderCreated(){let e=this.viewModel?.created;return e?e instanceof HTMLElement?c("div",{afterCreate:this._attachToNode,bind:e,key:e}):Lt(e)?c("div",{key:e},!e.destroyed&&e.render()):c("div",{afterCreate:this._addTargetToAnchors,innerHTML:e,key:e}):null}_attachToNode(e){let t=this;e.appendChild(t)}};n([a()],et.prototype,"creator",null),n([a()],et.prototype,"graphic",null),n([a({type:qe})],et.prototype,"viewModel",void 0),et=n([b("esri.widgets.Feature.FeatureContent")],et);var tt=et;var Ce=class extends U{constructor(e){super(e),this.attributes=null,this.expressionInfos=null,this.description=null,this.fieldInfos=null,this.title=null}get formattedFieldInfos(){let{expressionInfos:e,fieldInfos:t}=this,i=[];return t?.forEach(r=>{if(!(!r.hasOwnProperty("visible")||r.visible))return;let s=r.clone();s.label=Pt(s,e),i.push(s)}),i}};n([a()],Ce.prototype,"attributes",void 0),n([a({type:[gr]})],Ce.prototype,"expressionInfos",void 0),n([a()],Ce.prototype,"description",void 0),n([a({type:[At]})],Ce.prototype,"fieldInfos",void 0),n([a({readOnly:!0})],Ce.prototype,"formattedFieldInfos",null),n([a()],Ce.prototype,"title",void 0),Ce=n([b("esri.widgets.Feature.FeatureFields.FeatureFieldsViewModel")],Ce);var ze=Ce;var ps=[{pattern:/^\s*(https?:\/\/([^\s]+))\s*$/i,target:"_blank",label:"{messages.view}"},{pattern:/^\s*(tel:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(mailto:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(arcgis-appstudio-player:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"App Studio Player"},{pattern:/^\s*(arcgis-collector:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Collector"},{pattern:/^\s*(arcgis-explorer:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Explorer"},{pattern:/^\s*(arcgis-navigator:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Navigator"},{pattern:/^\s*(arcgis-survey123:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Survey123"},{pattern:/^\s*(arcgis-trek2there:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Trek2There"},{pattern:/^\s*(arcgis-workforce:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Workforce"},{pattern:/^\s*(iform:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"iForm"},{pattern:/^\s*(flow:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"FlowFinity"},{pattern:/^\s*(lfmobile:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Laserfische"},{pattern:/^\s*(mspbi:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Microsoft Power Bi"}];function Jr(e,t){if(typeof t!="string"||!t)return t;let i=ps.find(u=>u.pattern.test(t));if(!i)return t;let r=t.match(i.pattern),s=r?.[2],o=he(he(i.label,{messages:e,hierPart:s}),{appName:i.appName}),l=i.target?` target="${i.target}"`:"",d=i.target==="_blank"?' rel="noreferrer"':"";return t.replace(i.pattern,`<a${l} href="$1"${d}>${o}</a>`)}var Vt="esri-feature-fields",Bt={base:Vt,fieldHeader:`${Vt}__field-header`,fieldData:`${Vt}__field-data`,fieldDataDate:`${Vt}__field-data--date`},ue=class extends V{constructor(e,t){super(e,t),this._featureElementInfo=null,this.viewModel=new ze,this.messages=null,this.messagesURIUtils=null}initialize(){this._featureElementInfo=new Re,this.addHandles(f(()=>[this.viewModel?.description,this.viewModel?.title],()=>this._setupFeatureElementInfo(),I))}destroy(){this._featureElementInfo?.destroy()}get attributes(){return this.viewModel.attributes}set attributes(e){this.viewModel.attributes=e}get description(){return this.viewModel.description}set description(e){this.viewModel.description=e}get expressionInfos(){return this.viewModel.expressionInfos}set expressionInfos(e){this.viewModel.expressionInfos=e}get fieldInfos(){return this.viewModel.fieldInfos}set fieldInfos(e){this.viewModel.fieldInfos=e}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}render(){return c("div",{class:Bt.base},this._featureElementInfo?.render(),this._renderFields())}_renderFieldInfo(e,t){let{attributes:i}=this.viewModel,r=e.fieldName||"",s=e.label||r,o=i?i[r]==null?"":i[r]:"",l=!!e.format?.dateFormat,d=typeof o=="number"&&!l?this._forceLTR(o):Jr(this.messagesURIUtils,o),u={[Bt.fieldDataDate]:l};return c("tr",{key:`fields-element-info-row-${r}-${t}`},c("th",{class:Bt.fieldHeader,innerHTML:s,key:`fields-element-info-row-header-${r}-${t}`}),c("td",{class:this.classes(Bt.fieldData,u),innerHTML:d,key:`fields-element-info-row-data-${r}-${t}`}))}_renderFields(){let{formattedFieldInfos:e}=this.viewModel;return e?.length?c("table",{class:M.table,summary:this.messages.fieldsSummary},c("tbody",null,e.map((t,i)=>this._renderFieldInfo(t,i)))):null}_setupFeatureElementInfo(){let{description:e,title:t}=this;this._featureElementInfo?.set({description:e,title:t})}_forceLTR(e){return`&lrm;${e}`}};n([a()],ue.prototype,"attributes",null),n([a()],ue.prototype,"description",null),n([a()],ue.prototype,"expressionInfos",null),n([a()],ue.prototype,"fieldInfos",null),n([a()],ue.prototype,"title",null),n([a({type:ze,nonNullable:!0})],ue.prototype,"viewModel",void 0),n([a(),q("esri/widgets/Feature/t9n/Feature")],ue.prototype,"messages",void 0),n([a(),q("esri/widgets/support/t9n/uriUtils")],ue.prototype,"messagesURIUtils",void 0),ue=n([b("esri.widgets.Feature.FeatureFields")],ue);var Dt=ue;var hs="esri.widgets.Feature.support.relatedFeatureUtils",eo=()=>S.getLogger(hs),to=new Map;function it(e){if(!ae(e))return null;let[t,i]=e.split("/").slice(1);return{layerId:t,fieldName:i}}function ms(e,t){if(!t.relationships)return null;let i=null,{relationships:r}=t;return r.some(s=>s.id===parseInt(e,10)&&(i=s,!0)),i}function fs({originRelationship:e,relationships:t,layerId:i}){return t.find(({relatedTableId:r,id:s})=>`${r}`===i&&s===e?.id)??null}function gs(e,t){let i=t.toLowerCase();for(let r in e)if(r.toLowerCase()===i)return e[r];return null}function io(e,t){let i=ms(e,t);if(i)return{url:`${t.url}/${i.relatedTableId}`,sourceSpatialReference:t.spatialReference,relation:i,relatedFields:[],outStatistics:[]}}function ro(e,t){if(!t||!e)return;let{features:i,statsFeatures:r}=e,s=i?.value;t.relatedFeatures=s?s.features:[];let o=r?.value;t.relatedStatsFeatures=o?o.features:[]}function ys(e,t,i,r){let s=new nt;return s.outFields=["*"],s.relationshipId=typeof t.id=="number"?t.id:parseInt(t.id,10),s.objectIds=[e.attributes[i.objectIdField]],s.gdbVersion=i.gdbVersion??null,s.historicMoment=i.historicMoment??null,i.queryRelatedFeatures?.(s,r)??Promise.resolve({})}function vs(e,t,i){let r=0,s=[];for(;r<t.length;)s.push(`${e} IN (${t.slice(r,i+r)})`),r+=i;return s.join(" OR ")}function _s(e){return e?Jt(e):void 0}function bs(e){return e?Jt(e,(t,i)=>JSON.stringify(t.toJSON())===JSON.stringify(i.toJSON())):void 0}function ws(e,t,i,r){return g(this,null,function*(){let s=i.layerId.toString(),{layerInfo:o,relation:l,relatedFields:d,outStatistics:u,url:p,sourceSpatialReference:h}=t,m=_s(d),v=bs(u);if(!o||!l)return null;let y=fs({originRelationship:l,relationships:o.relationships,layerId:s});if(y?.relationshipTableId&&y.keyFieldInRelationshipTable){let T=(yield ys(e,y,i,r))[e.attributes[i.objectIdField]];if(!T)return null;let R=T.features.map(A=>A.attributes[o.objectIdField]);if(v?.length&&o.supportsStatistics){let A=new Ct;A.where=vs(o.objectIdField,R,1e3),A.outFields=m,A.outStatistics=v,A.sourceSpatialReference=h;let N={features:Promise.resolve(T),statsFeatures:Et(p,A)};return me(N)}}let w=y?.keyField;if(w){let T=wr(Ms(o.fields,w)),R=gs(e.attributes,l.keyField),A=T?`${w}=${R}`:`${w}='${R}'`,N=i.historicMoment,$=i.gdbVersion,le=Et(p,new Ct({where:A,outFields:m,sourceSpatialReference:h,historicMoment:N,gdbVersion:$}),r),be=v?.length&&o.supportsStatistics?Et(p,new Ct({where:A,outFields:m,outStatistics:v,sourceSpatialReference:h}),r):null,Ee={features:le};return be&&(Ee.statsFeatures=be),me(Ee)}return null})}function Fs(e,t){return ir(e,{query:{f:"json"},signal:t?.signal})}function oo({relatedInfos:e,layer:t},i){let r={};return e.forEach((s,o)=>{let{relation:l}=s;if(!l){let m=new L("relation-required","A relation is required on a layer to retrieve related records.");throw eo().error(m),m}let{relatedTableId:d}=l;if(typeof d!="number"){let m=new L("A related table ID is required on a layer to retrieve related records.");throw eo().error(m),m}let u=`${t.url}/${d}`,p=to.get(u),h=p??Fs(u);p||to.set(u,h),r[o]=h}),Ui(me(r),i)}function so({graphic:e,relatedInfos:t,layer:i},r){let s={};return t.forEach((o,l)=>{o.layerInfo&&(s[l]=ws(e,o,i,r))}),me(s)}function no({relatedInfo:e,fieldName:t,fieldInfo:i}){if(e.relatedFields?.push(t),i.statisticType){let r=new cr({statisticType:i.statisticType,onStatisticField:t,outStatisticFieldName:t});e.outStatistics?.push(r)}}function Ms(e,t){if(e!=null){t=t.toLowerCase();for(let i of e)if(i&&i.name.toLowerCase()===t)return i}return null}var ao={chartAnimation:!0},z=class extends U{constructor(e){super(e),this.abilities=_({},ao),this.activeMediaInfoIndex=0,this.attributes=null,this.description=null,this.fieldInfoMap=null,this.formattedAttributes=null,this.expressionAttributes=null,this.isAggregate=!1,this.layer=null,this.mediaInfos=null,this.popupTemplate=null,this.relatedInfos=null,this.title=null}castAbilities(e){return _(_({},ao),e)}get activeMediaInfo(){return this.formattedMediaInfos[this.activeMediaInfoIndex]||null}get formattedMediaInfos(){return this._formatMediaInfos()||[]}get formattedMediaInfoCount(){return this.formattedMediaInfos.length}setActiveMedia(e){this._setContentElementMedia(e)}next(){this._pageContentElementMedia(1)}previous(){this._pageContentElementMedia(-1)}_setContentElementMedia(e){let{formattedMediaInfoCount:t}=this,i=(e+t)%t;this.activeMediaInfoIndex=i}_pageContentElementMedia(e){let{activeMediaInfoIndex:t}=this,i=t+e;this._setContentElementMedia(i)}_formatMediaInfos(){let{mediaInfos:e,layer:t}=this,i=this.attributes??{},r=this.formattedAttributes??{},s=this.expressionAttributes??{},o=this.fieldInfoMap??new Map;return e?.map(l=>{let d=l?.clone();return d?(d.title=Ie({attributes:i,fieldInfoMap:o,globalAttributes:r,expressionAttributes:s,layer:t,text:d.title}),d.caption=Ie({attributes:i,fieldInfoMap:o,globalAttributes:r,expressionAttributes:s,layer:t,text:d.caption}),d.altText=Ie({attributes:i,fieldInfoMap:o,globalAttributes:r,expressionAttributes:s,layer:t,text:d.altText}),d.type==="image"?d.value?(this._setImageValue({value:d.value,formattedAttributes:r,layer:t}),d.value.sourceURL?d:void 0):void 0:d.type==="pie-chart"||d.type==="line-chart"||d.type==="column-chart"||d.type==="bar-chart"?d.value?(this._setChartValue({value:d.value,chartType:d.type,attributes:i,formattedAttributes:r,layer:t,expressionAttributes:s}),d):void 0:null):null}).filter(Fe)??[]}_setImageValue(e){let t=this.fieldInfoMap??new Map,{value:i,formattedAttributes:r,layer:s}=e,{linkURL:o,sourceURL:l}=i;if(l){let d=Ot(l,s);i.sourceURL=Nt({formattedAttributes:r,template:d,fieldInfoMap:t})}if(o){let d=Ot(o,s);i.linkURL=Nt({formattedAttributes:r,template:d,fieldInfoMap:t})}}_setChartValue(e){let{value:t,attributes:i,formattedAttributes:r,chartType:s,layer:o,expressionAttributes:l}=e,{popupTemplate:d,relatedInfos:u}=this,{fields:p,normalizeField:h}=t,m=o;if(t.fields=Sr(p,m),h&&(t.normalizeField=De(h,m)),!p.some(y=>!!(r[y]!=null||ae(y)&&u?.size)))return;let v=d?.fieldInfos??[];p.forEach((y,w)=>{let T=t.colors?.[w];if(ae(y))return void(t.series=[...t.series,...this._getRelatedChartInfos({fieldInfos:v,fieldName:y,formattedAttributes:r,chartType:s,value:t,color:T})]);let R=this._getChartOption({value:t,attributes:i,chartType:s,formattedAttributes:r,expressionAttributes:l,fieldName:y,fieldInfos:v,color:T});t.series.push(R)})}_getRelatedChartInfos(e){let{fieldInfos:t,fieldName:i,formattedAttributes:r,chartType:s,value:o,color:l}=e,d=[],u=it(i),p=u&&this.relatedInfos?.get(u.layerId.toString());if(!p)return d;let{relatedFeatures:h,relation:m}=p;if(!m||!h)return d;let{cardinality:v}=m;return h.forEach(y=>{let{attributes:w}=y;w&&Object.keys(w).forEach(T=>{T===u.fieldName&&d.push(this._getChartOption({value:o,attributes:w,formattedAttributes:r,fieldName:i,chartType:s,relatedFieldName:T,hasMultipleRelatedFeatures:h?.length>1,fieldInfos:t,color:l}))})}),v==="one-to-many"||v==="many-to-many"?d:[d[0]]}_getTooltip({label:e,value:t,chartType:i}){return i==="pie-chart"?`${e}`:`${e}: ${t}`}_getChartOption(e){let{value:t,attributes:i,formattedAttributes:r,expressionAttributes:s,fieldName:o,relatedFieldName:l,fieldInfos:d,chartType:u,hasMultipleRelatedFeatures:p,color:h}=e,m=this.layer,v=this.fieldInfoMap??new Map,{normalizeField:y,tooltipField:w}=t,T=y?ae(y)?i[it(y).fieldName]:i[y]:null,R=lt(o)&&s&&s[o]!==void 0?s[o]:l&&i[l]!==void 0?i[l]:i[o]!==void 0?i[o]:r[o],A=new mr({fieldName:o,color:h,value:R===void 0?null:R&&T?R/T:R});if(ae(o)){let Ee=v.get(o.toLowerCase()),_t=w&&v.get(w.toLowerCase()),we=Ee?.fieldName??o,Kt=p&&w?it(w).fieldName:_t?.fieldName??w,Oo=p&&Kt?i[Kt]:r[Kt]??Ee?.label??Ee?.fieldName??l,$o=p&&l?i[l]:r[we];return A.tooltip=this._getTooltip({label:Oo,value:$o,chartType:u}),A}let N=_i(d,o),$=De(o,m),le=w&&r[w]!==void 0?r[w]:Pt(N||new At({fieldName:$}),this.popupTemplate?.expressionInfos),be=r[$];return A.tooltip=this._getTooltip({label:le,value:be,chartType:u}),A}};n([a()],z.prototype,"abilities",void 0),n([se("abilities")],z.prototype,"castAbilities",null),n([a()],z.prototype,"activeMediaInfoIndex",void 0),n([a({readOnly:!0})],z.prototype,"activeMediaInfo",null),n([a()],z.prototype,"attributes",void 0),n([a()],z.prototype,"description",void 0),n([a()],z.prototype,"fieldInfoMap",void 0),n([a()],z.prototype,"formattedAttributes",void 0),n([a()],z.prototype,"expressionAttributes",void 0),n([a({readOnly:!0})],z.prototype,"formattedMediaInfos",null),n([a()],z.prototype,"isAggregate",void 0),n([a()],z.prototype,"layer",void 0),n([a({readOnly:!0})],z.prototype,"formattedMediaInfoCount",null),n([a()],z.prototype,"mediaInfos",void 0),n([a()],z.prototype,"popupTemplate",void 0),n([a()],z.prototype,"relatedInfos",void 0),n([a()],z.prototype,"title",void 0),z=n([b("esri.widgets.Feature.FeatureMedia.FeatureMediaViewModel")],z);var ye=z;var W="esri-feature-media",Y={base:W,mediaContainer:`${W}__container`,mediaItemContainer:`${W}__item-container`,mediaItem:`${W}__item`,mediaItemText:`${W}__item-text`,mediaItemTitle:`${W}__item-title`,mediaItemCaption:`${W}__item-caption`,mediaNavigation:`${W}__item-navigation`,mediaPagination:`${W}__pagination`,mediaPaginationText:`${W}__pagination-text`,mediaPrevious:`${W}__previous`,mediaPreviousIconLTR:`${W}__previous-icon`,mediaPreviousIconRTL:`${W}__previous-icon--rtl`,mediaNext:`${W}__next`,mediaNextIconLTR:`${W}__next-icon`,mediaNextIconRTL:`${W}__next-icon--rtl`,mediaChart:`${W}__chart`,mediaPaginationButton:`${W}__pagination-button`,mediaPaginationIcon:`${W}__pagination-icon`,mediaChartRendered:`${W}__chart--rendered`},Ei=15,Ne="category",pt="value",Is="rgba(50, 50, 50, 1)",Cs=250,As=500,xs=200,K=class extends V{constructor(e,t){super(e,t),this._refreshTimer=null,this._refreshIntervalInfo=null,this._featureElementInfo=null,this._chartRootMap=new WeakMap,this.viewModel=new ye,this.messages=null,this._disposeChart=i=>{this._chartRootMap.get(i)?.dispose(),this._chartRootMap.delete(i)},this._createChart=i=>g(this,null,function*(){let{destroyed:r,viewModel:s}=this;if(r||!s||!i)return;let{createRoot:o}=yield import("./chunk-6JWO57WQ.js"),l=yield o(i);this._chartRootMap.set(i,l),this._renderChart({mediaInfo:s.activeMediaInfo,root:l})})}initialize(){this._featureElementInfo=new Re,this.addHandles([f(()=>[this.viewModel?.activeMediaInfo,this.viewModel?.activeMediaInfoIndex],()=>this._setupMediaRefreshTimer(),I),f(()=>[this.viewModel?.description,this.viewModel?.title],()=>this._setupFeatureElementInfo(),I)])}loadDependencies(){return ee({icon:()=>import("./chunk-WEV76HGW.js")})}destroy(){this._clearMediaRefreshTimer(),this._featureElementInfo?.destroy()}get attributes(){return this.viewModel.attributes}set attributes(e){this.viewModel.attributes=e}get activeMediaInfoIndex(){return this.viewModel.activeMediaInfoIndex}set activeMediaInfoIndex(e){this.viewModel.activeMediaInfoIndex=e}get description(){return this.viewModel.description}set description(e){this.viewModel.description=e}get fieldInfoMap(){return this.viewModel.fieldInfoMap}set fieldInfoMap(e){this.viewModel.fieldInfoMap=e}get layer(){return this.viewModel.layer}set layer(e){this.viewModel.layer=e}get mediaInfos(){return this.viewModel.mediaInfos}set mediaInfos(e){this.viewModel.mediaInfos=e}get popupTemplate(){return this.viewModel.popupTemplate}set popupTemplate(e){this.viewModel.popupTemplate=e}get relatedInfos(){return this.viewModel.relatedInfos}set relatedInfos(e){this.viewModel.relatedInfos=e}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}render(){return c("div",{bind:this,class:Y.base,onkeyup:this._handleMediaKeyup},this._featureElementInfo?.render(),this._renderMedia())}_renderMedia(){let{formattedMediaInfoCount:e,activeMediaInfoIndex:t}=this.viewModel,i=this._renderMediaText();return e?c("div",{class:Y.mediaContainer,key:"media-element-container"},this._renderMediaInfo(),c("div",{class:Y.mediaNavigation},i,e>1?c("div",{class:Y.mediaPagination},this._renderMediaPageButton("previous"),c("span",{class:Y.mediaPaginationText},Q(this.messages.pageText,{index:t+1,total:e})),this._renderMediaPageButton("next")):null)):null}_renderMediaText(){let{activeMediaInfo:e}=this.viewModel;if(!e)return null;let t=e&&e.title?c("div",{class:Y.mediaItemTitle,innerHTML:e.title,key:"media-title"}):null,i=e&&e.caption?c("div",{class:Y.mediaItemCaption,innerHTML:e.caption,key:"media-caption"}):null;return t||i?c("div",{class:Y.mediaItemText,key:"media-text"},t,i):null}_renderImageMediaInfo(e){if(!e.value)return null;let{_refreshIntervalInfo:t}=this,{activeMediaInfoIndex:i,formattedMediaInfoCount:r}=this.viewModel,{value:s,refreshInterval:o,altText:l,title:d,type:u}=e,{sourceURL:p,linkURL:h}=s,m=Rt(h??void 0)?"_blank":"_self",v=m==="_blank"?"noreferrer":"",y=o?t:null,w=y?y.timestamp:0,T=y?y.sourceURL:p,R=c("img",{alt:l||d,key:`media-${u}-${i}-${r}-${w}`,src:T??void 0});return(h?c("a",{href:h,rel:v,target:m,title:d},R):null)??R}_renderChartMediaInfo(e){let{activeMediaInfoIndex:t,formattedMediaInfoCount:i}=this.viewModel;return c("div",{afterCreate:this._createChart,afterRemoved:this._disposeChart,bind:this,class:Y.mediaChart,key:`media-${e.type}-${t}-${i}`})}_renderMediaInfoType(){let{activeMediaInfo:e}=this.viewModel;return e?e.type==="image"?this._renderImageMediaInfo(e):e.type.includes("chart")?this._renderChartMediaInfo(e):null:null}_renderMediaInfo(){let{activeMediaInfo:e}=this.viewModel;return e?c("div",{class:Y.mediaItemContainer,key:"media-container"},c("div",{class:Y.mediaItem,key:"media-item-container"},this._renderMediaInfoType())):null}_renderMediaPageButton(e){if(this.viewModel.formattedMediaInfoCount<2)return null;let t=e==="previous",i=t?this.messages.previous:this.messages.next,r=t?"chevron-left":"chevron-right",s=t?"media-previous":"media-next",o=t?this._previous:this._next;return c("button",{"aria-label":i,bind:this,class:Y.mediaPaginationButton,key:s,onclick:o,tabIndex:0,title:i,type:"button"},c("calcite-icon",{class:Y.mediaPaginationIcon,icon:r,scale:"s"}))}_setupFeatureElementInfo(){let{description:e,title:t}=this;this._featureElementInfo?.set({description:e,title:t})}_next(){this.viewModel.next()}_previous(){this.viewModel.previous()}_getRenderer(){if(!this.viewModel)return;let{isAggregate:e,layer:t}=this.viewModel;return e&&t?.featureReduction&&"renderer"in t.featureReduction?t.featureReduction.renderer:t?.renderer}_getSeriesColors(e){return g(this,null,function*(){let{colorAm5:t}=yield import("./chunk-EKE6XNKA.js"),i=new Map;return e.forEach(r=>{r.color&&i.set(r,t(r.color.toCss(!0)))}),i})}_getRendererColors(){return g(this,null,function*(){let{colorAm5:e}=yield import("./chunk-EKE6XNKA.js"),t=new Map,i=this._getRenderer(),r="default";if(!i)return t;let s=yield Cr(i);return s.delete(r),Array.from(s.values()).every(o=>o?.length===1)&&Array.from(s.keys()).forEach(o=>{let l=s.get(o)?.[0]?.toCss(!0);l&&t.set(o,e(l))}),t})}_handleMediaKeyup(e){let{key:t}=e;t==="ArrowLeft"&&(e.stopPropagation(),this.viewModel.previous()),t==="ArrowRight"&&(e.stopPropagation(),this.viewModel.next())}_canAnimateChart(){return!!this.viewModel&&!!this.viewModel.abilities.chartAnimation&&!Ar()}_getChartAnimationMS(){return this._canAnimateChart()?Cs:0}_getChartSeriesAnimationMS(){return this._canAnimateChart()?As:0}_renderChart(e){return g(this,null,function*(){let{root:t,mediaInfo:i}=e,{value:r,type:s}=i,{ResponsiveThemeAm5:o,DarkThemeAm5:l,AnimatedThemeAm5:d,ColorSetAm5:u,ThemeAm5:p,esriChartColorSet:h}=yield import("./chunk-EKE6XNKA.js"),m=p.new(t);m.rule("ColorSet").set("colors",h),m.rule("ColorSet").set("reuse",!0);let v=[o.new(t),m];tr()&&v.push(l.new(t)),this._canAnimateChart()&&v.push(d.new(t)),t.setThemes(v);let y=yield this._getRendererColors(),w=yield this._getSeriesColors(r.series),T=u.new(t,{}),R=w.get(r.series[0]),A=R?{lineSettings:{stroke:R}}:void 0,N=r.series.map(($,le)=>{let be=w.get($)||y.get($.fieldName)||T.getIndex(le);return _({[Ne]:$.tooltip,[pt]:$.value,columnSettings:{fill:be,stroke:be}},A)}).filter($=>s!=="pie-chart"||$.value!=null&&$.value>0);s==="pie-chart"?this._createPieChart(e,N):this._createXYChart(e,N)})}_getDirection(){return de(this.container)?"rtl":"ltr"}_isInversed(){return!!de(this.container)}_customizeChartTooltip(e,t="horizontal"){return g(this,null,function*(){let{colorAm5:i}=yield import("./chunk-EKE6XNKA.js");e.setAll({pointerOrientation:t}),e.get("background")?.setAll({stroke:i(Is)}),e.label.setAll({direction:this._getDirection(),oversizedBehavior:"wrap",maxWidth:xs})})}_createPieChart(e,t){return g(this,null,function*(){let{TooltipAm5:i}=yield import("./chunk-EKE6XNKA.js"),{PieChartAm5:r,PieSeriesAm5:s}=yield import("./chunk-VTGDK744.js"),{mediaInfo:o,root:l}=e,{title:d}=o,u=5,p=o?.altText||o?.title||"",h=l.container.children.push(r.new(l,{ariaLabel:p,focusable:!0,paddingBottom:u,paddingTop:u,paddingLeft:u,paddingRight:u})),m=`{category}: {valuePercentTotal.formatNumber('0.00')}%
 ({value})`,v=i.new(l,{labelText:m}),y=h.series.push(s.new(l,{name:d,valueField:pt,categoryField:Ne,tooltip:v}));y.ticks.template.set("forceHidden",!0),y.labels.template.set("forceHidden",!0),y.slices.template.states.create("active",{shiftRadius:u}),this._customizeChartTooltip(v),y.slices.template.setAll({ariaLabel:m,focusable:!0,templateField:"columnSettings"}),y.data.setAll(t),y.appear(this._getChartSeriesAnimationMS()),h.appear(this._getChartAnimationMS()),h.root.dom.classList.toggle(Y.mediaChartRendered,!0)})}_getMinSeriesValue(e){let t=0;return e.forEach(i=>t=Math.min(i.value,t)),t}_createColumnChart(e,t,i){return g(this,null,function*(){let{TooltipAm5:r,ScrollbarAm5:s}=yield import("./chunk-EKE6XNKA.js"),{CategoryAxisAm5:o,AxisRendererXAm5:l,ValueAxisAm5:d,AxisRendererYAm5:u,ColumnSeriesAm5:p}=yield import("./chunk-JGWBUQFP.js"),{mediaInfo:h,root:m}=t,{value:v,title:y}=h;e.setAll({wheelX:"panX",wheelY:"zoomX"});let w=e.xAxes.push(o.new(m,{renderer:l.new(m,{inversed:this._isInversed()}),categoryField:Ne}));w.get("renderer").labels.template.setAll({forceHidden:!0});let T=e.yAxes.push(d.new(m,{renderer:u.new(m,{inside:!1}),min:this._getMinSeriesValue(v.series)}));T.get("renderer").labels.template.setAll({direction:this._getDirection()});let R="{categoryX}",A=r.new(m,{labelText:R}),N=e.series.push(p.new(m,{name:y,xAxis:w,yAxis:T,valueYField:pt,categoryXField:Ne,tooltip:A}));this._customizeChartTooltip(A),N.columns.template.setAll({ariaLabel:R,focusable:!0,templateField:"columnSettings"}),v.series.length>Ei&&e.set("scrollbarX",s.new(m,{orientation:"horizontal"})),w.data.setAll(i),N.data.setAll(i),N.appear(this._getChartSeriesAnimationMS()),e.appear(this._getChartAnimationMS())})}_createBarChart(e,t,i){return g(this,null,function*(){let{TooltipAm5:r,ScrollbarAm5:s}=yield import("./chunk-EKE6XNKA.js"),{CategoryAxisAm5:o,AxisRendererXAm5:l,ValueAxisAm5:d,AxisRendererYAm5:u,ColumnSeriesAm5:p}=yield import("./chunk-JGWBUQFP.js"),{mediaInfo:h,root:m}=t,{value:v,title:y}=h;e.setAll({wheelX:"panY",wheelY:"zoomY"});let w=e.yAxes.push(o.new(m,{renderer:u.new(m,{inversed:!0}),categoryField:Ne}));w.get("renderer").labels.template.setAll({forceHidden:!0});let T=e.xAxes.push(d.new(m,{renderer:l.new(m,{inside:!1,inversed:this._isInversed()}),min:this._getMinSeriesValue(v.series)}));T.get("renderer").labels.template.setAll({direction:this._getDirection()});let R="{categoryY}",A=r.new(m,{labelText:R}),N=e.series.push(p.new(m,{name:y,xAxis:T,yAxis:w,valueXField:pt,categoryYField:Ne,tooltip:A}));this._customizeChartTooltip(A,"vertical"),N.columns.template.setAll({ariaLabel:R,focusable:!0,templateField:"columnSettings"}),v.series.length>Ei&&e.set("scrollbarY",s.new(m,{orientation:"vertical"})),w.data.setAll(i),N.data.setAll(i),N.appear(this._getChartSeriesAnimationMS()),e.appear(this._getChartAnimationMS())})}_createLineChart(e,t,i){return g(this,null,function*(){let{TooltipAm5:r,ScrollbarAm5:s}=yield import("./chunk-EKE6XNKA.js"),{CategoryAxisAm5:o,AxisRendererXAm5:l,ValueAxisAm5:d,AxisRendererYAm5:u,LineSeriesAm5:p}=yield import("./chunk-JGWBUQFP.js"),{root:h,mediaInfo:m}=t,{value:v,title:y}=m;e.setAll({wheelX:"panX",wheelY:"zoomX"});let w=e.xAxes.push(o.new(h,{renderer:l.new(h,{inversed:this._isInversed()}),categoryField:Ne}));w.get("renderer").labels.template.setAll({forceHidden:!0});let T=e.yAxes.push(d.new(h,{renderer:u.new(h,{inside:!1}),min:this._getMinSeriesValue(v.series)}));T.get("renderer").labels.template.setAll({direction:this._getDirection()});let R="{categoryX}",A=i[0]?.lineSettings?.stroke,N=r.new(h,{getFillFromSprite:!A,labelText:R});A&&N.get("background")?.setAll({fill:A});let $=e.series.push(p.new(h,{name:y,xAxis:w,yAxis:T,valueYField:pt,categoryXField:Ne,tooltip:N}));$.strokes.template.setAll({templateField:"lineSettings"}),this._customizeChartTooltip(N,"vertical"),v.series.length>Ei&&e.set("scrollbarX",s.new(h,{orientation:"horizontal"})),w.data.setAll(i),$.data.setAll(i),$.appear(this._getChartSeriesAnimationMS()),e.appear(this._getChartAnimationMS())})}_createXYChart(e,t){return g(this,null,function*(){let{XYChartAm5:i,XYCursorAm5:r}=yield import("./chunk-JGWBUQFP.js"),{root:s,mediaInfo:o}=e,{type:l}=o,d=o?.altText||o?.title||"",u=s.container.children.push(i.new(s,{ariaLabel:d,focusable:!0,panX:!0,panY:!0}));u.set("cursor",r.new(s,{})),l==="column-chart"&&(yield this._createColumnChart(u,e,t)),l==="bar-chart"&&(yield this._createBarChart(u,e,t)),l==="line-chart"&&(yield this._createLineChart(u,e,t)),u.root.dom.classList.toggle(Y.mediaChartRendered,!0)})}_clearMediaRefreshTimer(){let{_refreshTimer:e}=this;e&&(clearTimeout(e),this._refreshTimer=null)}_updateMediaInfoTimestamp(e){let t=Date.now();this._refreshIntervalInfo={timestamp:t,sourceURL:e&&this._getImageSource(e,t)}}_setupMediaRefreshTimer(){this._clearMediaRefreshTimer();let{activeMediaInfo:e}=this.viewModel;e?.type==="image"&&e?.refreshInterval>0&&this._setRefreshTimeout(e)}_setRefreshTimeout(e){let{refreshInterval:t,value:i}=e,r=6e4*t;this._updateMediaInfoTimestamp(i.sourceURL);let s=setInterval(()=>{this._updateMediaInfoTimestamp(i.sourceURL)},r);this._refreshTimer=s}_getImageSource(e,t){let i=e.includes("?")?"&":"?",[r,s=""]=e.split("#");return`${r}${i}timestamp=${t}${s?"#":""}${s}`}};n([a()],K.prototype,"_refreshIntervalInfo",void 0),n([a()],K.prototype,"attributes",null),n([a()],K.prototype,"activeMediaInfoIndex",null),n([a()],K.prototype,"description",null),n([a()],K.prototype,"fieldInfoMap",null),n([a()],K.prototype,"layer",null),n([a()],K.prototype,"mediaInfos",null),n([a()],K.prototype,"popupTemplate",null),n([a()],K.prototype,"relatedInfos",null),n([a()],K.prototype,"title",null),n([a({type:ye})],K.prototype,"viewModel",void 0),n([a(),q("esri/widgets/Feature/t9n/Feature")],K.prototype,"messages",void 0),K=n([b("esri.widgets.Feature.FeatureMedia")],K);var qt=K;var Es="esri.widgets.Feature.support.arcadeFeatureUtils",lo=()=>S.getLogger(Es);function Ts(e){return typeof e=="string"?Ke($t(e)):Array.isArray(e)?Ls(e):e?.declaredClass==="esri.arcade.Dictionary"?ks(e):e}function Ls(e){return`<ul class="esri-widget__list">${e.map(t=>`<li>${typeof t=="string"?Ke($t(t)):t}</li>`).join("")}</ul>`}function ks(e){let t=e.keys().map(i=>{let r=e.field(i);return`<tr><th>${i}</th><td>${typeof r=="string"?Ke($t(r)):r}</td></tr>`}).join("");return`<table class="${M.table}">${t}</table>`}function Ti(){return import("./chunk-EUZJKT2U.js")}function Rs(e){return"createQuery"in e&&"queryFeatures"in e}function Ps(r){return g(this,arguments,function*({graphic:e,view:t,options:i}){let{isAggregate:s,layer:o}=e;if(!s||!o||t?.type!=="2d")return[];let l=yield t.whenLayerView(o);if(!Rs(l))return[];let d=l.createQuery(),u=e.getObjectId();d.aggregateIds=u!=null?[u]:[];let{features:p}=yield l.queryFeatures(d,i);return p})}function Ns({layer:e,aggregatedFeatures:t,interceptor:i}){let{fields:r,objectIdField:s,geometryType:o,spatialReference:l,displayField:d}=e;return new _r(Te(_({fields:r,objectIdField:s,geometryType:o,spatialReference:l,displayField:d,interceptor:i},e.type==="feature"?{templates:e.templates,typeIdField:e.typeIdField,types:e.types}:null),{source:t}))}function Li(p){return g(this,arguments,function*({expressionInfo:e,arcade:t,interceptor:i,spatialReference:r,map:s,graphic:o,location:l,view:d,options:u}){if(!e?.expression)return null;let{isAggregate:h}=o,m=(o.sourceLayer||o.layer)??void 0,v=h?"feature-reduction-popup":"popup",y=t.createArcadeProfile(v),w=t.createArcadeExecutor(e.expression,y).catch(le=>lo().error("arcade-executor-error",{error:le,expressionInfo:e})),[T,R]=yield Promise.all([Ps({graphic:o,view:d,options:u}),w]);if(!R)return null;let A=v==="feature-reduction-popup"?Ns({layer:m,aggregatedFeatures:T,interceptor:i}):void 0,N=Te(_({},v==="feature-reduction-popup"?{$aggregatedFeatures:A}:{$datastore:m?.url,$layer:m?.type==="feature"||m?.type==="subtype-sublayer"||m?.type==="catalog-footprint"||m?.type==="oriented-imagery"?m:m?.type==="scene"&&m.associatedLayer!=null?m.associatedLayer:void 0,$map:s,$userInput:l,$graph:m?.type==="knowledge-graph-sublayer"?m?.parentCompositeLayer?.knowledgeGraph:void 0}),{$feature:o}),$={abortSignal:u?.signal??void 0,interceptor:i??void 0,rawOutput:!0,spatialReference:r??void 0,timeZone:d?.timeZone};return yield R.executeAsync(N,$).catch(le=>lo().error("arcade-execution-error",{error:le,graphic:o,expressionInfo:e})).finally(()=>A?.destroy())})}function co(u){return g(this,arguments,function*({expressionInfos:e,spatialReference:t,graphic:i,interceptor:r,map:s,view:o,location:l,options:d}){if(!e?.length)return{};let p=yield Ti(),h={};for(let y of e)h[`expression/${y.name}`]=Li({expressionInfo:y,arcade:p,interceptor:r,spatialReference:t,map:s,graphic:i,location:l,view:o,options:d});let m=yield me(h),v={};for(let y in m)v[y]=Ts(m[y].value);return v})}var Os=1,ie=class extends U{constructor(e){super(e),this._abortController=null,this.expressionInfo=null,this.graphic=null,this.contentElement=null,this.contentElementViewModel=null,this.interceptor=null,this.location=null,this.view=null,this._cancelQuery=()=>{let{_abortController:t}=this;t&&t.abort(),this._abortController=null},this._createVM=()=>{let t=this.contentElement?.type;this.contentElementViewModel?.destroy();let i=t==="fields"?new ze:t==="media"?new ye:t==="text"?new qe:null;this._set("contentElementViewModel",i)},this._compile=()=>g(this,null,function*(){this._cancelQuery();let t=new AbortController;this._abortController=t,yield this._compileExpression(),this._abortController===t&&(this._abortController=null)}),this._compileThrottled=Be(this._compile,Os,this),this._compileExpression=()=>g(this,null,function*(){let{expressionInfo:t,graphic:i,interceptor:r,spatialReference:s,map:o,location:l,view:d,_abortController:u}=this;if(!t||!i)return void this._set("contentElement",null);let p=yield Ti();if(u!==this._abortController)return;let h=yield Li({arcade:p,expressionInfo:t,graphic:i,location:l,interceptor:r,map:o,spatialReference:s,view:d});if(!h||h.declaredClass!=="esri.arcade.Dictionary")return void this._set("contentElement",null);let m=yield h.castAsJsonAsync(u?.signal),v=m?.type,y=v==="media"?fr.fromJSON(m):v==="text"?xt.fromJSON(m):v==="fields"?hr.fromJSON(m):null;this._set("contentElement",y)}),this.addHandles([f(()=>[this.expressionInfo,this.graphic,this.map,this.spatialReference,this.view],()=>this._compileThrottled(),I),f(()=>[this.contentElement],()=>this._createVM(),I)])}initialize(){this.addHandles(this._compileThrottled)}destroy(){this._cancelQuery(),this.contentElementViewModel?.destroy(),this._set("contentElementViewModel",null),this._set("contentElement",null)}get spatialReference(){return this.view?.spatialReference??null}set spatialReference(e){this._override("spatialReference",e)}get state(){let{_abortController:e,contentElement:t,contentElementViewModel:i}=this;return e?"loading":t||i?"ready":"disabled"}get map(){return this.view?.map??null}set map(e){this._override("map",e)}};n([a()],ie.prototype,"_abortController",void 0),n([a({type:pr})],ie.prototype,"expressionInfo",void 0),n([a({type:ne})],ie.prototype,"graphic",void 0),n([a({readOnly:!0})],ie.prototype,"contentElement",void 0),n([a({readOnly:!0})],ie.prototype,"contentElementViewModel",void 0),n([a()],ie.prototype,"interceptor",void 0),n([a({type:Ge})],ie.prototype,"location",void 0),n([a()],ie.prototype,"spatialReference",null),n([a({readOnly:!0})],ie.prototype,"state",null),n([a()],ie.prototype,"map",null),n([a()],ie.prototype,"view",void 0),ie=n([b("esri.widgets.Feature.FeatureExpression.FeatureExpressionViewModel")],ie);var ht=ie;var uo="esri-feature",po={base:`${uo}-expression`,loadingSpinnerContainer:`${uo}__loading-container`},zt=class extends V{constructor(e,t){super(e,t),this._contentWidget=null,this.viewModel=new ht}initialize(){this.addHandles(f(()=>this.viewModel?.contentElementViewModel,()=>this._setupExpressionWidget(),I))}loadDependencies(){return ee({loader:()=>import("./chunk-C4B6QL4L.js")})}destroy(){this._destroyContentWidget()}render(){let{state:e}=this.viewModel;return c("div",{class:po.base},e==="loading"?this._renderLoading():e==="disabled"?null:this._contentWidget?.render())}_renderLoading(){return c("div",{class:po.loadingSpinnerContainer,key:"loading-container"},c("calcite-loader",{inline:!0,label:""}))}_destroyContentWidget(){let{_contentWidget:e}=this;e&&(e.viewModel=null,e.destroy()),this._contentWidget=null}_setupExpressionWidget(){let{contentElementViewModel:e,contentElement:t}=this.viewModel,i=t?.type;this._destroyContentWidget();let r=e?i==="fields"?new Dt({viewModel:e}):i==="media"?new qt({viewModel:e}):i==="text"?new tt({viewModel:e}):null:null;this._contentWidget=r,this.scheduleRender()}};n([a({type:ht})],zt.prototype,"viewModel",void 0),zt=n([b("esri.widgets.Feature.FeatureExpression")],zt);var ho=zt;var mo;(function(e){e.TOO_SHORT="length-validation-error::too-short",e.TOO_LONG="length-validation-error::too-long"})(mo||(mo={}));var fo=e=>{let t=[];if(e.formTemplate){let{description:i,title:r}=e.formTemplate;e.fields?.forEach(s=>{let o=r&&ei(r,s.name),l=i&&ei(i,s.name);(o||l)&&t.push(s.name)})}return t};var ki=100,P=class extends dr(It(U)){constructor(e){super(e),this._loaded=!1,this._queryAbortController=null,this._queryPageAbortController=null,this._queryFeatureCountAbortController=null,this.featuresPerPage=10,this.description=null,this.graphic=null,this.layer=null,this.map=null,this.orderByFields=null,this.featureCount=0,this.relationshipId=null,this.showAllEnabled=!1,this.title=null,this._cancelQuery=()=>{let{_queryAbortController:t}=this;t&&t.abort(),this._queryAbortController=null},this._cancelQueryFeatureCount=()=>{let{_queryFeatureCountAbortController:t}=this;t&&t.abort(),this._queryFeatureCountAbortController=null},this._cancelQueryPage=()=>{let{_queryPageAbortController:t}=this;t&&t.abort(),this._queryPageAbortController=null},this._queryController=()=>g(this,null,function*(){this._cancelQuery();let t=new AbortController;this._queryAbortController=t,yield bt(this._query()),this._queryAbortController===t&&(this._queryAbortController=null)}),this._queryFeatureCountController=()=>g(this,null,function*(){this._loaded=!1,this._cancelQueryFeatureCount();let t=new AbortController;this._queryFeatureCountAbortController=t,yield bt(this._queryFeatureCount()),this._queryFeatureCountAbortController===t&&(this._queryFeatureCountAbortController=null),this._loaded=!0}),this._queryPageController=()=>g(this,null,function*(){let t=new AbortController;this._queryPageAbortController=t,yield bt(this._queryPage()),this._queryPageAbortController===t&&(this._queryPageAbortController=null)}),this._queryDebounced=Ze(this._queryController,ki),this._queryFeatureCountDebounced=Ze(this._queryFeatureCountController,ki),this._queryPageDebounced=Ze(this._queryPageController,ki),this._query=()=>g(this,null,function*(){let{_queryAbortController:t,relatedFeatures:i}=this;this.featureCount&&(this._destroyRelatedFeatureViewModels(),this.featurePage=1,i.destroyAll(),this.destroyed||i.addMany(this._sliceFeatures(yield this._queryRelatedFeatures({signal:t?.signal}))))}),this.addHandles([f(()=>[this.displayCount,this.graphic,this.layer,this.layer?.loaded,this.map,this.orderByFields,this.relationshipId,this.featuresPerPage,this.showAllEnabled,this.canQuery,this.featureCount],()=>this._queryDebounced(),I),f(()=>[this.featurePage,this.showAllEnabled],()=>this._queryPageDebounced()),f(()=>[this.layer,this.relationshipId,this.objectId,this.canQuery],()=>this._queryFeatureCountDebounced())])}destroy(){this._destroyRelatedFeatureViewModels(),this.relatedFeatures.destroyAll(),this._cancelQuery(),this._cancelQueryFeatureCount(),this._cancelQueryPage()}set featurePage(e){let{featuresPerPage:t,featureCount:i}=this,r=1,s=Math.ceil(i/t)||1;this._set("featurePage",Math.min(Math.max(e,r),s))}get featurePage(){return this._get("featurePage")}get orderByFieldsFixedCasing(){let{orderByFields:e,relatedLayer:t}=this;return e&&t?.loaded?e.map(i=>{let r=i.clone();return r.field=De(i.field,t),r}):e??[]}get supportsCacheHint(){return!!this.layer?.capabilities?.queryRelated?.supportsCacheHint}get canLoad(){return!!this.map&&this.relationshipId!=null&&typeof this.objectId=="number"}get canQuery(){let e=this.layer?.capabilities?.queryRelated;return!!(this.relatedLayer&&this.relationship&&this.relationshipId!=null&&this.objectId!=null&&e?.supportsCount&&e?.supportsPagination)}get itemDescriptionFieldName(){return this.orderByFieldsFixedCasing[0]?.field||null}set displayCount(e){this._set("displayCount",Math.min(Math.max(e,0),10))}get displayCount(){return this._get("displayCount")}get objectId(){return(this.objectIdField&&this.graphic?.attributes?.[this.objectIdField])??null}get objectIdField(){return this.layer?.objectIdField||null}get relatedFeatures(){return this._get("relatedFeatures")||new fe}get relatedLayer(){let{layer:e,map:t,relationship:i}=this;return e?.loaded&&t&&i?Ur(t,e,i)??null:null}get relationship(){let{relationshipId:e,layer:t}=this;return e!=null?t?.relationships?.find(({id:i})=>i===e)??null:null}get relatedFeatureViewModels(){return this._get("relatedFeatureViewModels")||new fe}get state(){let{_queryAbortController:e,_queryFeatureCountAbortController:t,_queryPageAbortController:i,canQuery:r,_loaded:s,canLoad:o}=this;return t||o&&!s?"loading":e||i?"querying":r?"ready":"disabled"}getRelatedFeatureByObjectId(e){return this.relatedFeatures.find(t=>t.getObjectId()===e)}refresh(){this._queryFeatureCountDebounced()}_destroyRelatedFeatureViewModels(){this.relatedFeatureViewModels?.destroyAll()}_queryFeatureCount(){return g(this,null,function*(){let{layer:e,relatedLayer:t,relationshipId:i,objectId:r,_queryFeatureCountAbortController:s,canQuery:o,supportsCacheHint:l}=this;if(yield e?.load(),yield t?.load(),!o||!e||!t||r==null)return void this._set("featureCount",0);let d=t.createQuery(),{historicMoment:u,gdbVersion:p}=e,h=new nt({cacheHint:l,gdbVersion:p,historicMoment:u,relationshipId:i,returnGeometry:!1,objectIds:[r],where:d.where??void 0}),m=yield e.queryRelatedFeaturesCount(h,{signal:s?.signal});this._set("featureCount",m[r]||0)})}_sliceFeatures(e){let{showAllEnabled:t,displayCount:i}=this;return t?e:i?e.slice(0,i):[]}_queryPage(){return g(this,null,function*(){let{relatedFeatures:e,featurePage:t,showAllEnabled:i,_queryPageAbortController:r,featureCount:s}=this;!i||t<2||!s||e.addMany(yield this._queryRelatedFeatures({signal:r?.signal}))})}_queryRelatedFeatures(e){return g(this,null,function*(){let{orderByFieldsFixedCasing:t,showAllEnabled:i,featuresPerPage:r,displayCount:s,layer:o,relationshipId:l,featurePage:d,featureCount:u,relatedLayer:p,supportsCacheHint:h}=this,{canQuery:m,objectId:v}=this;if(!m||!o||!p||v==null)return[];let y=i?((d-1)*r+u)%u:0,w=i?r:s,T=p.objectIdField,R=[...t.map(we=>we.field),...fo(p),T].filter(Fe),A=t.map(we=>`${we.field} ${we.order}`),N=p.createQuery(),{historicMoment:$,gdbVersion:le}=o,be=new nt({orderByFields:A,start:y,num:w,outFields:R,cacheHint:h,historicMoment:$,gdbVersion:le,relationshipId:l,returnGeometry:!1,objectIds:[v],where:N.where??void 0}),Ee=yield o.queryRelatedFeatures(be,{signal:e?.signal}),_t=Ee[v]?.features||[];return _t.forEach(we=>{we.sourceLayer=p,we.layer=p}),_t})}};n([a()],P.prototype,"_loaded",void 0),n([a()],P.prototype,"_queryAbortController",void 0),n([a()],P.prototype,"_queryPageAbortController",void 0),n([a()],P.prototype,"_queryFeatureCountAbortController",void 0),n([a({value:1})],P.prototype,"featurePage",null),n([a()],P.prototype,"featuresPerPage",void 0),n([a({readOnly:!0})],P.prototype,"orderByFieldsFixedCasing",null),n([a({readOnly:!0})],P.prototype,"supportsCacheHint",null),n([a({readOnly:!0})],P.prototype,"canLoad",null),n([a({readOnly:!0})],P.prototype,"canQuery",null),n([a()],P.prototype,"description",void 0),n([a({readOnly:!0})],P.prototype,"itemDescriptionFieldName",null),n([a({value:3})],P.prototype,"displayCount",null),n([a({type:ne})],P.prototype,"graphic",void 0),n([a()],P.prototype,"layer",void 0),n([a()],P.prototype,"map",void 0),n([a({readOnly:!0})],P.prototype,"objectId",null),n([a({readOnly:!0})],P.prototype,"objectIdField",null),n([a()],P.prototype,"orderByFields",void 0),n([a({readOnly:!0})],P.prototype,"relatedFeatures",null),n([a({readOnly:!0})],P.prototype,"relatedLayer",null),n([a({readOnly:!0})],P.prototype,"relationship",null),n([a()],P.prototype,"featureCount",void 0),n([a({readOnly:!0})],P.prototype,"relatedFeatureViewModels",null),n([a()],P.prototype,"relationshipId",void 0),n([a()],P.prototype,"showAllEnabled",void 0),n([a()],P.prototype,"state",null),n([a()],P.prototype,"title",void 0),P=n([b("esri.widgets.Feature.FeatureRelationship.FeatureRelationshipViewModel")],P);var mt=P;var Wt="esri-feature",ft=`${Wt}-relationship`,Oe={base:ft,listContainer:`${ft}__list`,listItem:`${ft}__list-item`,listItemHidden:`${ft}__list-item--hidden`,listContainerQuerying:`${ft}__list--querying`,featureObserver:`${Wt}__feature-observer`,stickySpinnerContainer:`${Wt}__sticky-loading-container`,loadingSpinnerContainer:`${Wt}__loading-container`},go={title:!0,description:!0},J=class extends V{constructor(e,t){super(e,t),this._featureElementInfo=null,this._relatedFeatureIntersectionObserverNode=null,this._relatedFeatureIntersectionObserver=new IntersectionObserver(([i])=>{i?.isIntersecting&&this._increaseFeaturePage()},{root:window.document}),this.headingLevel=2,this.viewModel=new mt,this.messages=null,this.messagesCommon=null,this.visibleElements=_({},go),this._increaseFeaturePage=()=>{let{state:i,showAllEnabled:r,relatedFeatures:s,featuresPerPage:o,featurePage:l}=this.viewModel;i==="ready"&&r&&s.length>=o*l&&this.viewModel.featurePage++}}initialize(){this._featureElementInfo=new Re,this.addHandles([f(()=>[this.viewModel.description,this.viewModel.title,this.headingLevel],()=>this._setupFeatureElementInfo(),I),f(()=>[this.viewModel.state,this.viewModel.showAllEnabled,this._relatedFeatureIntersectionObserverNode],()=>this._handleRelatedFeatureObserverChange()),oe(()=>this.viewModel.relatedFeatureViewModels,"change",()=>this._setupRelatedFeatureViewModels())])}loadDependencies(){return ee({icon:()=>import("./chunk-WEV76HGW.js"),list:()=>import("./chunk-2WJA24ER.js"),"list-item":()=>import("./chunk-6SVICUTH.js"),loader:()=>import("./chunk-C4B6QL4L.js"),notice:()=>import("./chunk-GIMP5C5S.js")})}destroy(){this._unobserveRelatedFeatureObserver(),this._featureElementInfo=Hi(this._featureElementInfo)}get displayShowAllButton(){let{showAllEnabled:e,featureCount:t,displayCount:i,state:r}=this.viewModel;return!e&&!!t&&r==="ready"&&(t>i||i===0)}get displayListItems(){return this.displayShowAllButton||this.viewModel.relatedFeatureViewModels.length>0}get description(){return this.viewModel.description}set description(e){this.viewModel.description=e}get featureCountDescription(){let{messages:e}=this,{featureCount:t}=this.viewModel;return Q(e?.numberRecords,{number:t})}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}castVisibleElements(e){return _(_({},go),e)}render(){let{state:e}=this.viewModel;return c("div",{class:this.classes(Oe.base,M.widget)},this._featureElementInfo?.render(),e==="loading"?this._renderLoading():e==="disabled"?this._renderRelationshipNotFound():this._renderRelatedFeatures())}_renderStickyLoading(){return this.viewModel.state==="querying"?c("div",{class:Oe.stickySpinnerContainer,key:"sticky-loader"},this._renderLoadingIcon()):null}_renderLoadingIcon(){return c("calcite-loader",{inline:!0,label:""})}_renderLoading(){return c("div",{class:Oe.loadingSpinnerContainer,key:"loading-container"},this._renderLoadingIcon())}_renderShowAllIconNode(){return c("calcite-icon",{icon:"list",scale:"s",slot:"content-end"})}_renderChevronIconNode(){let e=de(this.container)?"chevron-left":"chevron-right";return c("calcite-icon",{icon:e,scale:"s",slot:"content-end"})}_renderRelatedFeature(e){let{itemDescriptionFieldName:t}=this.viewModel,i=e.title;e.description=t&&e.formattedAttributes?.global[t];let r=e.state==="loading";return c("calcite-list-item",{class:this.classes(Oe.listItem,{[Oe.listItemHidden]:r}),description:e.description??"",key:e.uid,label:i,onCalciteListItemSelect:()=>this.emit("select-record",{featureViewModel:e})},this._renderChevronIconNode())}_renderShowAllListItem(){return this.displayShowAllButton?c("calcite-list-item",{description:this.featureCountDescription,key:"show-all-item",label:this.messages?.showAll,onCalciteListItemSelect:()=>this.emit("show-all-records")},this._renderShowAllIconNode()):null}_renderNoRelatedFeaturesMessage(){return c("calcite-notice",{icon:"information",key:"no-related-features-message",kind:"brand",open:!0,scale:"s",width:"full"},c("div",{slot:"message"},this.messages?.noRelatedFeatures))}_renderFeatureObserver(){return c("div",{afterCreate:this._relatedFeatureIntersectionObserverCreated,bind:this,class:Oe.featureObserver,key:"feature-observer"})}_renderList(){let{relatedFeatureViewModels:e}=this.viewModel;return c("calcite-list",null,e.toArray().map(t=>this._renderRelatedFeature(t)),this._renderShowAllListItem())}_renderRelatedFeatures(){let{displayListItems:e}=this,{state:t}=this.viewModel;return c("div",{class:this.classes(Oe.listContainer,{[Oe.listContainerQuerying]:t==="querying"}),key:"list-container"},e?this._renderList():t==="ready"?this._renderNoRelatedFeaturesMessage():null,this._renderStickyLoading(),this._renderFeatureObserver())}_renderRelationshipNotFound(){return c("calcite-notice",{icon:"exclamation-mark-triangle",key:"relationship-not-found",kind:"danger",open:!0,scale:"s",width:"full"},c("div",{slot:"message"},this.messages?.relationshipNotFound))}_setupRelatedFeatureViewModels(){let{relatedFeatureViewModels:e}=this.viewModel,t="related-feature-viewmodels";this.removeHandles(t),e?.forEach(i=>{this.addHandles(f(()=>[i.title,i.state],()=>this.scheduleRender(),I),t)}),this.scheduleRender()}_setupFeatureElementInfo(){let{headingLevel:e,visibleElements:t}=this,i=t.description&&this.description,r=t.title&&this.title;this._featureElementInfo?.set({description:i,title:r,headingLevel:e})}_handleRelatedFeatureObserverChange(){return g(this,null,function*(){this._unobserveRelatedFeatureObserver();let{state:e,showAllEnabled:t}=this.viewModel;yield wt(0),this._relatedFeatureIntersectionObserverNode&&e==="ready"&&t&&this._relatedFeatureIntersectionObserver.observe(this._relatedFeatureIntersectionObserverNode)})}_relatedFeatureIntersectionObserverCreated(e){this._relatedFeatureIntersectionObserverNode=e}_unobserveRelatedFeatureObserver(){this._relatedFeatureIntersectionObserverNode&&this._relatedFeatureIntersectionObserver.unobserve(this._relatedFeatureIntersectionObserverNode)}};n([a()],J.prototype,"_relatedFeatureIntersectionObserverNode",void 0),n([a({readOnly:!0})],J.prototype,"displayShowAllButton",null),n([a({readOnly:!0})],J.prototype,"displayListItems",null),n([a()],J.prototype,"description",null),n([a({readOnly:!0})],J.prototype,"featureCountDescription",null),n([a()],J.prototype,"headingLevel",void 0),n([a()],J.prototype,"title",null),n([a({type:mt})],J.prototype,"viewModel",void 0),n([a(),q("esri/widgets/Feature/t9n/Feature")],J.prototype,"messages",void 0),n([a(),q("esri/t9n/common")],J.prototype,"messagesCommon",void 0),n([a()],J.prototype,"visibleElements",void 0),n([se("visibleElements")],J.prototype,"castVisibleElements",null),J=n([b("esri.widgets.Feature.FeatureRelationship")],J);var Ri=J;var Ht=class{constructor(t,i){this.preLayerQueryCallback=t,this.preRequestCallback=i,this.preLayerQueryCallback||(this.preLayerQueryCallback=r=>{}),this.preRequestCallback||(this.preLayerQueryCallback=r=>{})}};var gt,$s=1,yo="content-view-models",vo="relationship-view-models",_o={attachmentsContent:!0,chartAnimation:!0,customContent:!0,expressionContent:!0,fieldsContent:!0,mediaContent:!0,textContent:!0,relationshipContent:!0},O=gt=class extends It(U){constructor(e){super(e),this._error=null,this._featureAbortController=null,this._graphicChangedThrottled=Be(this._graphicChanged,$s,this),this._expressionAttributes=null,this._graphicExpressionAttributes=null,this.abilities=_({},_o),this.content=null,this.contentViewModels=[],this.description=null,this.defaultPopupTemplateEnabled=!1,this.formattedAttributes=null,this.lastEditInfo=null,this.location=null,this.relatedInfos=new Map,this.title="",this.view=null,this._isAllowedContentType=t=>{let{abilities:i}=this;return t.type==="attachments"&&!!i.attachmentsContent||t.type==="custom"&&!!i.customContent||t.type==="fields"&&!!i.fieldsContent||t.type==="media"&&!!i.mediaContent||t.type==="text"&&!!i.textContent||t.type==="expression"&&!!i.expressionContent||t.type==="relationship"&&!!i.relationshipContent},this.addHandles(f(()=>[this.graphic,this._effectivePopupTemplate,this.abilities,this.timeZone],()=>this._graphicChangedThrottled(),I))}initialize(){this.addHandles(this._graphicChangedThrottled)}destroy(){this._clear(),this._cancelFeatureQuery(),this._error=null,this.graphic=null,this._destroyContentViewModels(),this.relatedInfos.clear()}get _effectivePopupTemplate(){return this.graphic!=null?this.graphic.getEffectivePopupTemplate(this.defaultPopupTemplateEnabled):null}get _fieldInfoMap(){return Dr(bi(this._effectivePopupTemplate),this._sourceLayer)}get _sourceLayer(){return kt(this.graphic)}castAbilities(e){return _(_({},_o),e)}get isTable(){return this._sourceLayer?.isTable||!1}get state(){return this.graphic?this._error?"error":this.waitingForContent?"loading":"ready":"disabled"}set graphic(e){this._set("graphic",e?.clone()??null)}get spatialReference(){return this.view?.spatialReference??null}set spatialReference(e){this._override("spatialReference",e)}get timeZone(){return this.view?.timeZone??Ft}set timeZone(e){this._overrideIfSome("timeZone",e)}get map(){return this.view?.map||null}set map(e){this._override("map",e)}get waitingForContent(){return!!this._featureAbortController}setActiveMedia(e,t){let i=this.contentViewModels[e];i instanceof ye&&i.setActiveMedia(t)}nextMedia(e){let t=this.contentViewModels[e];t instanceof ye&&t.next()}previousMedia(e){let t=this.contentViewModels[e];t instanceof ye&&t.previous()}updateGeometry(){return g(this,null,function*(){let{graphic:e,spatialReference:t,_sourceLayer:i}=this;yield i?.load();let r=i?.objectIdField;if(!r||!e||!i)return;let s=e?.attributes?.[r];if(s==null)return;let o=[s];if(!e.geometry){let l=yield wi({layer:i,graphic:e,outFields:[],objectIds:o,returnGeometry:!0,spatialReference:t}),d=l?.geometry;d&&(e.geometry=d)}})}_clear(){this._set("title",""),this._set("content",null),this._set("formattedAttributes",null)}_graphicChanged(){return g(this,null,function*(){this._cancelFeatureQuery(),this._error=null,this._clear();let{graphic:e}=this;if(!e)return;let t=new AbortController;this._featureAbortController=t;try{yield this._queryFeature({signal:t.signal})}catch(i){ot(i)||(this._error=i,S.getLogger(this).error("error","The popupTemplate could not be displayed for this feature.",{error:i,graphic:e,popupTemplate:this._effectivePopupTemplate}))}this._featureAbortController===t&&(this._featureAbortController=null)})}_cancelFeatureQuery(){let{_featureAbortController:e}=this;e&&e.abort(),this._featureAbortController=null}_compileContentElement(e,t){return e.type==="attachments"?this._compileAttachments(e,t):e.type==="custom"?this._compileCustom(e,t):e.type==="fields"?this._compileFields(e,t):e.type==="media"?this._compileMedia(e,t):e.type==="text"?this._compileText(e,t):e.type==="expression"?this._compileExpression(e,t):e.type==="relationship"?this._compileRelationship(e,t):void 0}_compileContent(e){if(this._destroyContentViewModels(),this.graphic)return Array.isArray(e)?e.filter(this._isAllowedContentType).map((t,i)=>this._compileContentElement(t,i)).filter(Fe):typeof e=="string"?this._compileText(new xt({text:e}),0).text:e}_destroyContentViewModels(){this.removeHandles(vo),this.removeHandles(yo),this.contentViewModels.forEach(e=>e&&!e.destroyed&&e.destroy()),this._set("contentViewModels",[])}_matchesFeature(e,t){let i=e?.graphic?.getObjectId(),r=t?.getObjectId();return i!=null&&r!=null&&i===r}_setRelatedFeaturesViewModels({relatedFeatureViewModels:e,relatedFeatures:t,map:i}){let{view:r,spatialReference:s,timeZone:o}=this;t?.filter(Boolean).forEach(l=>{e.some(d=>this._matchesFeature(d,l))||e.add(new gt({abilities:{relationshipContent:!1},map:i,view:r,spatialReference:s,timeZone:o,graphic:l}))}),e.forEach(l=>{t?.find(u=>this._matchesFeature(l,u))||e.remove(l)})}_setExpressionContentVM(e,t){let i=this.formattedAttributes,{contentElement:r,contentElementViewModel:s}=e,o=r?.type;s&&o&&(o==="fields"&&(this._createFieldsFormattedAttributes({contentElement:r,contentElementIndex:t,formattedAttributes:i}),s.set(this._createFieldsVMParams(r,t))),o==="media"&&(this._createMediaFormattedAttributes({contentElement:r,contentElementIndex:t,formattedAttributes:i}),s.set(this._createMediaVMParams(r,t))),o==="text"&&s.set(this._createTextVMParams(r)))}_compileRelationship(e,t){let{displayCount:i,orderByFields:r,relationshipId:s,title:o,description:l}=e,{_sourceLayer:d,graphic:u,map:p}=this;if(!vi(d))return;let h=new mt(_({displayCount:i,graphic:u,orderByFields:r,relationshipId:s,layer:d,map:p},this._compileTitleAndDesc({title:o,description:l})));return this.contentViewModels[t]=h,this.addHandles(oe(()=>h.relatedFeatures,"change",()=>this._setRelatedFeaturesViewModels(h)),vo),e}_compileExpression(e,t){let{expressionInfo:i}=e,{graphic:r,map:s,spatialReference:o,view:l,location:d}=this,u=new ht({expressionInfo:i,graphic:r,interceptor:gt.interceptor,map:s,spatialReference:o,view:l,location:d});return this.contentViewModels[t]=u,this.addHandles(f(()=>u.contentElementViewModel,()=>this._setExpressionContentVM(u,t),I),yo),e}_compileAttachments(e,t){let{graphic:i}=this,{description:r,title:s}=e;return this.contentViewModels[t]=new ut(_({graphic:i},this._compileTitleAndDesc({title:s,description:r}))),e}_compileCustom(e,t){let{graphic:i}=this,{creator:r,destroyer:s}=e;return this.contentViewModels[t]=new qe({graphic:i,creator:r,destroyer:s}),e}_compileTitleAndDesc({title:e,description:t}){let{_fieldInfoMap:i,_sourceLayer:r,graphic:s,formattedAttributes:o}=this,l=s?.attributes,d=this._expressionAttributes,u=o.global;return{title:Ie({attributes:l,fieldInfoMap:i,globalAttributes:u,expressionAttributes:d,layer:r,text:e}),description:Ie({attributes:l,fieldInfoMap:i,globalAttributes:u,expressionAttributes:d,layer:r,text:t})}}_createFieldsVMParams(e,t){let i=this._effectivePopupTemplate,r=this.formattedAttributes,s=_(_({},r?.global),r?.content[t]),o=e?.fieldInfos||i?.fieldInfos,l=o?.filter(({fieldName:h})=>!!h&&(lt(h)||ae(h)||s.hasOwnProperty(h))),d=i?.expressionInfos,{description:u,title:p}=e;return _({attributes:s,expressionInfos:d,fieldInfos:l},this._compileTitleAndDesc({title:p,description:u}))}_compileFields(e,t){let i=e.clone(),r=new ze(this._createFieldsVMParams(e,t));return this.contentViewModels[t]=r,i.fieldInfos=r.formattedFieldInfos.slice(0),i}_createMediaVMParams(e,t){let{abilities:i,graphic:r,_fieldInfoMap:s,_effectivePopupTemplate:o,relatedInfos:l,_sourceLayer:d,_expressionAttributes:u}=this,p=this.formattedAttributes,h=r?.attributes??{},{description:m,mediaInfos:v,title:y}=e;return _({abilities:{chartAnimation:i.chartAnimation},activeMediaInfoIndex:e.activeMediaInfoIndex||0,attributes:h,isAggregate:r?.isAggregate,layer:d,fieldInfoMap:s,formattedAttributes:_(_({},p?.global),p?.content[t]),expressionAttributes:u,mediaInfos:v,popupTemplate:o,relatedInfos:l},this._compileTitleAndDesc({title:y,description:m}))}_compileMedia(e,t){let i=e.clone(),r=new ye(this._createMediaVMParams(e,t));return i.mediaInfos=r.formattedMediaInfos.slice(0),this.contentViewModels[t]=r,i}_createTextVMParams(e){let{graphic:t,_fieldInfoMap:i,_sourceLayer:r,_expressionAttributes:s}=this;if(e&&e.text){let o=t?.attributes??{},l=this.formattedAttributes?.global??{};e.text=Ie({attributes:o,fieldInfoMap:i,globalAttributes:l,expressionAttributes:s,layer:r,text:e.text})}return{graphic:t,creator:e.text}}_compileText(e,t){let i=e.clone();return this.contentViewModels[t]=new qe(this._createTextVMParams(i)),i}_compileLastEditInfo(){let{_effectivePopupTemplate:e,_sourceLayer:t,graphic:i,timeZone:r}=this;if(!e)return;let{lastEditInfoEnabled:s}=e,o=t?.editFieldsInfo;return s&&o?Br(o,i?.attributes,r,t):void 0}_compileTitle(e){let{_fieldInfoMap:t,_sourceLayer:i,graphic:r,_expressionAttributes:s}=this,o=r?.attributes??{},l=this.formattedAttributes?.global??{};return Ie({attributes:o,fieldInfoMap:t,globalAttributes:l,expressionAttributes:s,layer:i,text:e})}_getTitle(){return g(this,null,function*(){let{_effectivePopupTemplate:e,graphic:t}=this;return t?Ye({type:"title",value:e?.title,event:{graphic:t}}):null})}_getContent(){return g(this,null,function*(){let{_effectivePopupTemplate:e,graphic:t}=this;return t?Ye({type:"content",value:e?.content,event:{graphic:t}}):null})}_queryFeature(e){return g(this,null,function*(){let{_featureAbortController:t,_sourceLayer:i,graphic:r,_effectivePopupTemplate:s}=this,o=this.map,l=this.view,d=this.spatialReference,u=this.location;if(t!==this._featureAbortController||!r)return;yield zr({graphic:r,popupTemplate:s,layer:i,spatialReference:d},e);let{content:{value:p},title:{value:h}}=yield me({content:this._getContent(),title:this._getTitle()}),{expressionAttributes:{value:m}}=yield me({checkForRelatedFeatures:this._checkForRelatedFeatures(e),expressionAttributes:co({expressionInfos:s?.expressionInfos,spatialReference:d,graphic:r,map:o,interceptor:gt.interceptor,view:l,options:e,location:u})});t===this._featureAbortController&&r&&(this._expressionAttributes=m,this._graphicExpressionAttributes=_(_({},r.attributes),m),this._set("formattedAttributes",this._createFormattedAttributes(p)),this._set("title",this._compileTitle(h)),this._set("lastEditInfo",this._compileLastEditInfo()||null),this._set("content",this._compileContent(p)||null))})}_createMediaFormattedAttributes({contentElement:e,contentElementIndex:t,formattedAttributes:i}){let{_effectivePopupTemplate:r,graphic:s,relatedInfos:o,_sourceLayer:l,_fieldInfoMap:d,_graphicExpressionAttributes:u,timeZone:p}=this;i.content[t]=St({fieldInfos:r?.fieldInfos,graphic:s,attributes:_(_({},u),e.attributes),layer:l,fieldInfoMap:d,relatedInfos:o,timeZone:p})}_createFieldsFormattedAttributes({contentElement:e,contentElementIndex:t,formattedAttributes:i}){if(e.fieldInfos){let{graphic:r,relatedInfos:s,_sourceLayer:o,_fieldInfoMap:l,_graphicExpressionAttributes:d,timeZone:u}=this;i.content[t]=St({fieldInfos:e.fieldInfos,graphic:r,attributes:_(_({},d),e.attributes),layer:o,fieldInfoMap:l,relatedInfos:s,timeZone:u})}}_createFormattedAttributes(e){let{_effectivePopupTemplate:t,graphic:i,relatedInfos:r,_sourceLayer:s,_fieldInfoMap:o,_graphicExpressionAttributes:l,timeZone:d}=this,u=t?.fieldInfos,p={global:St({fieldInfos:u,graphic:i,attributes:l,layer:s,fieldInfoMap:o,relatedInfos:r,timeZone:d}),content:[]};return Array.isArray(e)&&e.forEach((h,m)=>{h.type==="fields"&&this._createFieldsFormattedAttributes({contentElement:h,contentElementIndex:m,formattedAttributes:p}),h.type==="media"&&this._createMediaFormattedAttributes({contentElement:h,contentElementIndex:m,formattedAttributes:p})}),p}_checkForRelatedFeatures(e){let{graphic:t,_effectivePopupTemplate:i}=this;return this._queryRelatedInfos(t,bi(i),e)}_queryRelatedInfos(e,t,i){return g(this,null,function*(){let{relatedInfos:r,_sourceLayer:s}=this;r.clear();let o=s?.associatedLayer!=null?yield s?.associatedLayer.load(i):s;if(!o||!e||!t.filter(p=>!!p.fieldName&&ae(p.fieldName))?.length)return;t.forEach(p=>this._configureRelatedInfo(p,o));let d=yield oo({relatedInfos:r,layer:o},i);Object.keys(d).forEach(p=>{let h=r.get(p.toString()),m=d[p]?.value;h&&m&&(h.layerInfo=m.data)});let u=yield so({graphic:e,relatedInfos:r,layer:o},i);Object.keys(u).forEach(p=>{ro(u[p]?.value,r.get(p.toString()))})})}_configureRelatedInfo(e,t){let{relatedInfos:i}=this,r=it(e.fieldName||"");if(!r)return;let{layerId:s,fieldName:o}=r;if(!s)return;let l=i.get(s.toString())||io(s,t);l&&(no({relatedInfo:l,fieldName:o,fieldInfo:e}),this.relatedInfos.set(s,l))}};O.interceptor=new Ht(Hr,jr),n([a()],O.prototype,"_error",void 0),n([a()],O.prototype,"_featureAbortController",void 0),n([a({readOnly:!0})],O.prototype,"_effectivePopupTemplate",null),n([a({readOnly:!0})],O.prototype,"_fieldInfoMap",null),n([a({readOnly:!0})],O.prototype,"_sourceLayer",null),n([a()],O.prototype,"abilities",void 0),n([se("abilities")],O.prototype,"castAbilities",null),n([a({readOnly:!0})],O.prototype,"content",void 0),n([a({readOnly:!0})],O.prototype,"contentViewModels",void 0),n([a()],O.prototype,"description",void 0),n([a({type:Boolean})],O.prototype,"defaultPopupTemplateEnabled",void 0),n([a({readOnly:!0})],O.prototype,"isTable",null),n([a({readOnly:!0})],O.prototype,"state",null),n([a({readOnly:!0})],O.prototype,"formattedAttributes",void 0),n([a({type:ne,value:null})],O.prototype,"graphic",null),n([a({readOnly:!0})],O.prototype,"lastEditInfo",void 0),n([a({type:Ge})],O.prototype,"location",void 0),n([a({readOnly:!0})],O.prototype,"relatedInfos",void 0),n([a()],O.prototype,"spatialReference",null),n([a()],O.prototype,"timeZone",null),n([a({readOnly:!0})],O.prototype,"title",void 0),n([a()],O.prototype,"map",null),n([a({readOnly:!0})],O.prototype,"waitingForContent",null),n([a()],O.prototype,"view",void 0),O=gt=n([b("esri.widgets.Feature.FeatureViewModel")],O);var yt=O;var G="esri-feature",B={base:G,container:`${G}__size-container`,title:`${G}__title`,main:`${G}__main-container`,btn:`${G}__button`,icon:`${G}__icon`,content:`${G}__content`,contentNode:`${G}__content-node`,contentNodeText:`${G}__content-node--text`,contentElement:`${G}__content-element`,text:`${G}__text`,lastEditedInfo:`${G}__last-edited-info`,fields:`${G}__fields`,fieldHeader:`${G}__field-header`,fieldData:`${G}__field-data`,fieldDataDate:`${G}__field-data--date`,loadingSpinnerContainer:`${G}__loading-container`};var jt=e=>{let t=class extends e{constructor(){super(...arguments),this.renderNodeContent=i=>Lt(i)&&!i.destroyed?c("div",{class:B.contentNode,key:i},i.render()):i instanceof HTMLElement?c("div",{afterCreate:this._attachToNode,bind:i,class:B.contentNode,key:i}):Ir(i)?c("div",{afterCreate:this._attachToNode,bind:i.domNode,class:B.contentNode,key:i}):null}_attachToNode(i){let r=this;i.appendChild(r)}};return t=n([b("esri.widgets.Feature.support.FeatureContentMixin")],t),t};var Pi,bo={title:!0,content:!0,lastEditedInfo:!0},wo="relationship-handles",H=Pi=class extends jt(V){constructor(e,t){super(e,t),this._contentWidgets=[],this.flowItems=null,this.headingLevel=2,this.messages=null,this.messagesCommon=null,this.visibleElements=_({},bo),this.viewModel=new yt}initialize(){this.addHandles(f(()=>this.viewModel?.contentViewModels,()=>this._setupContentWidgets(),I))}loadDependencies(){return ee({notice:()=>import("./chunk-GIMP5C5S.js"),loader:()=>import("./chunk-C4B6QL4L.js")})}destroy(){this._destroyContentWidgets()}get graphic(){return this.viewModel.graphic}set graphic(e){this.viewModel.graphic=e}get defaultPopupTemplateEnabled(){return this.viewModel.defaultPopupTemplateEnabled}set defaultPopupTemplateEnabled(e){this.viewModel.defaultPopupTemplateEnabled=e}get isTable(){return this.viewModel.isTable}get icon(){return"polygon"}set icon(e){this._overrideIfSome("icon",e)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get spatialReference(){return this.viewModel.spatialReference}set spatialReference(e){this.viewModel.spatialReference=e}get timeZone(){return this.viewModel.timeZone}set timeZone(e){this.viewModel.timeZone=e}get title(){return this.viewModel.title}castVisibleElements(e){return _(_({},bo),e)}get map(){return this.viewModel.map}set map(e){this.viewModel.map=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}setActiveMedia(e,t){return this.viewModel.setActiveMedia(e,t)}nextMedia(e){return this.viewModel.nextMedia(e)}previousMedia(e){return this.viewModel.previousMedia(e)}render(){let{state:e}=this.viewModel,t=c("div",{class:B.container,key:"container"},this._renderTitle(),e==="error"?this._renderError():e==="loading"?this._renderLoading():this._renderContentContainer());return c("div",{class:this.classes(B.base,M.widget)},t)}_renderError(){let{messagesCommon:e,messages:t,visibleElements:i}=this;return c("calcite-notice",{icon:"exclamation-mark-circle",kind:"danger",open:!0,scale:"s"},i.title?c("div",{key:"error-title",slot:"title"},e.errorMessage):null,c("div",{key:"error-message",slot:"message"},t.loadingError))}_renderLoading(){return c("div",{class:B.loadingSpinnerContainer,key:"loading-container"},c("calcite-loader",{inline:!0,label:""}))}_renderContentContainer(){let{visibleElements:e}=this;return e.content?c("div",{class:B.main},[this._renderContent(),this._renderLastEditInfo()]):null}_renderTitle(){let{visibleElements:e,title:t}=this;return e.title?c(Qe,{class:B.title,innerHTML:t,level:this.headingLevel}):null}_renderContent(){let e=this.viewModel.content,t="content";if(!e)return null;if(Array.isArray(e))return e.length?c("div",{class:B.contentNode,key:`${t}-content-elements`},e.map(this._renderContentElement,this)):null;if(typeof e=="string"){let i=this._contentWidgets[0];return!i||i.destroyed?null:c("div",{class:this.classes(B.contentNode,B.contentNodeText),key:`${t}-content`},i.render())}return this.renderNodeContent(e)}_renderContentElement(e,t){let{visibleElements:i}=this;if(typeof i.content!="boolean"&&!i.content?.[e.type])return null;switch(e.type){case"attachments":return this._renderAttachments(t);case"custom":return this._renderCustom(e,t);case"fields":return this._renderFields(t);case"media":return this._renderMedia(t);case"text":return this._renderText(e,t);case"expression":return this._renderExpression(t);case"relationship":return this._renderRelationship(t);default:return null}}_renderAttachments(e){let t=this._contentWidgets[e];if(!t||t.destroyed)return null;let{state:i,attachmentInfos:r}=t.viewModel;return i==="loading"||r.length>0?c("div",{class:this.classes(B.contentElement),key:this._buildKey("attachments-element",e)},t.render()):null}_renderRelationship(e){let t=this._contentWidgets[e];return t&&!t.destroyed&&this.flowItems?c("div",{class:B.contentElement,key:this._buildKey("relationship-element",e)},t.render()):null}_renderExpression(e){let t=this._contentWidgets[e];return!t||t.destroyed?null:c("div",{class:B.contentElement,key:this._buildKey("expression-element",e)},t.render())}_renderCustom(e,t){let{creator:i}=e,r=this._contentWidgets[t];return!r||r.destroyed?null:i?c("div",{class:B.contentElement,key:this._buildKey("custom-element",t)},r.render()):null}_renderFields(e){let t=this._contentWidgets[e];return!t||t.destroyed?null:c("div",{class:B.contentElement,key:this._buildKey("fields-element",e)},t.render())}_renderMedia(e){let t=this._contentWidgets[e];return!t||t.destroyed?null:c("div",{class:B.contentElement,key:this._buildKey("media-element",e)},t.render())}_renderLastEditInfo(){let{visibleElements:e,messages:t}=this,{lastEditInfo:i}=this.viewModel;if(!i||!e.lastEditedInfo)return null;let{date:r,user:s}=i,o=i.type==="edit"?s?t.lastEditedByUser:t.lastEdited:s?t.lastCreatedByUser:t.lastCreated,l=Q(o,{date:r,user:s});return c("div",{class:this.classes(B.lastEditedInfo,B.contentElement),key:"edit-info-element"},l)}_renderText(e,t){let i=e.text,r=this._contentWidgets[t];return!r||r.destroyed?null:i?c("div",{class:this.classes(B.contentElement,B.text),key:this._buildKey("text-element",t)},r.render()):null}_buildKey(e,...t){return`${e}__${this.viewModel?.graphic?.uid||"0"}-${t.join("-")}`}_destroyContentWidget(e){e&&(e.viewModel=null,!e.destroyed&&e.destroy())}_destroyContentWidgets(){this.removeHandles(wo),this._contentWidgets.forEach(e=>this._destroyContentWidget(e)),this._contentWidgets=[]}_addFeatureRelationshipHandles(e){let{flowItems:t,visibleElements:i}=this;this.addHandles([oe(()=>e,"select-record",({featureViewModel:r})=>{t&&(r.abilities={relationshipContent:!0},t.push(new Pi({flowItems:t,viewModel:r,visibleElements:i})))}),oe(()=>e,"show-all-records",()=>{if(!t)return;let{viewModel:r}=e;r.showAllEnabled=!0;let s=new Ri({visibleElements:{title:!1,description:!1},viewModel:r});this._addFeatureRelationshipHandles(s),t.push(s)})],wo)}_setupContentWidgets(){this._destroyContentWidgets();let{headingLevel:e,visibleElements:t}=this,i=this.viewModel?.content,{contentViewModels:r}=this.viewModel;if(Array.isArray(i))i.forEach((s,o)=>{if(s.type==="attachments"&&(this._contentWidgets[o]=new Kr({displayType:s.displayType,headingLevel:t.title&&e<6?e+1:e,viewModel:r[o]})),s.type==="fields"&&(this._contentWidgets[o]=new Dt({viewModel:r[o]})),s.type==="media"&&(this._contentWidgets[o]=new qt({viewModel:r[o]})),s.type==="text"&&(this._contentWidgets[o]=new tt({viewModel:r[o]})),s.type==="custom"&&(this._contentWidgets[o]=new tt({viewModel:r[o]})),s.type==="expression"&&(this._contentWidgets[o]=new ho({viewModel:r[o]})),s.type==="relationship"){let l=new Ri({viewModel:r[o]});this._addFeatureRelationshipHandles(l),this._contentWidgets[o]=l}},this);else{let s=r[0];s&&!s.destroyed&&(this._contentWidgets[0]=new tt({viewModel:s}))}this.scheduleRender()}};n([a()],H.prototype,"graphic",null),n([a()],H.prototype,"defaultPopupTemplateEnabled",null),n([a()],H.prototype,"flowItems",void 0),n([a()],H.prototype,"headingLevel",void 0),n([a({readOnly:!0})],H.prototype,"isTable",null),n([a()],H.prototype,"icon",null),n([a()],H.prototype,"label",null),n([a(),q("esri/widgets/Feature/t9n/Feature")],H.prototype,"messages",void 0),n([a(),q("esri/t9n/common")],H.prototype,"messagesCommon",void 0),n([a()],H.prototype,"spatialReference",null),n([a()],H.prototype,"timeZone",null),n([a({readOnly:!0})],H.prototype,"title",null),n([a()],H.prototype,"visibleElements",void 0),n([se("visibleElements")],H.prototype,"castVisibleElements",null),n([a()],H.prototype,"map",null),n([a()],H.prototype,"view",null),n([a({type:yt})],H.prototype,"viewModel",void 0),H=Pi=n([b("esri.widgets.Feature")],H);var Fo=H;var We=class extends Zi.EventedAccessor{constructor(e){super(e),this.location=null,this.screenLocationEnabled=!1,this.view=null,this.addHandles([ke(()=>{let t=this.screenLocationEnabled?this.view:null;return t?[t.size,t.type==="3d"?t.camera:t.viewpoint]:null},()=>this.notifyChange("screenLocation")),f(()=>this.screenLocation,(t,i)=>{t!=null&&i!=null&&this.emit("view-change")})])}destroy(){this.view=null}get screenLocation(){let{location:e,view:t,screenLocationEnabled:i}=this,r=t?.spatialReference,s=r?ar(e,r).geometry:null;return i&&s&&t?.ready?t.toScreen(s):null}};n([a()],We.prototype,"location",void 0),n([a()],We.prototype,"screenLocation",null),n([a()],We.prototype,"screenLocationEnabled",void 0),n([a()],We.prototype,"view",void 0),We=n([b("esri.widgets.support.AnchorElementViewModel")],We);var Ut=We;var Zt=class extends Ut{constructor(e){super(e),this.visible=!1}};n([a()],Zt.prototype,"visible",void 0),Zt=n([b("esri.widgets.Spinner.SpinnerViewModel")],Zt);var Ni=Zt;var Oi="esri-spinner",$i={base:Oi,spinnerStart:`${Oi}--start`,spinnerFinish:`${Oi}--finish`},He=class extends V{constructor(e,t){super(e,t),this._animationDelay=500,this._animationPromise=null,this.viewModel=new Ni}initialize(){this.addHandles(f(()=>this.visible,e=>this._visibleChange(e)))}destroy(){this._animationPromise=null}get location(){return this.viewModel.location}set location(e){this.viewModel.location=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}get visible(){return this.viewModel.visible}set visible(e){this.viewModel.visible=e}show(e){let{location:t,promise:i}=e??{};t&&(this.viewModel.location=t),this.visible=!0;let r=()=>this.hide();i&&i.catch(()=>{}).then(r)}hide(){this.visible=!1}render(){let{visible:e}=this,{screenLocation:t}=this.viewModel,i=!!t,r=e&&i,s=!e&&i,o={[$i.spinnerStart]:r,[$i.spinnerFinish]:s},l=this._getPositionStyles();return c("div",{class:this.classes($i.base,o),styles:l})}_visibleChange(e){if(e)return void(this.viewModel.screenLocationEnabled=!0);let t=wt(this._animationDelay);this._animationPromise=t,t.catch(()=>{}).then(()=>{this._animationPromise===t&&(this.viewModel.screenLocationEnabled=!1,this._animationPromise=null)})}_getPositionStyles(){let{screenLocation:e,view:t}=this.viewModel;if(t==null||e==null)return{};let{padding:i}=t;return{left:e.x-i.left+"px",top:e.y-i.top+"px"}}};n([a()],He.prototype,"location",null),n([a()],He.prototype,"view",null),n([a({type:Ni})],He.prototype,"viewModel",void 0),n([a()],He.prototype,"visible",null),He=n([b("esri.widgets.Spinner")],He);var Mo=He;var X="esri-features",j={icon:`${X}__icon`,actionImage:`${X}__action-image`,base:X,container:`${X}__container`,contentContainer:`${X}__content-container`,contentFeature:`${X}__content-feature`,flowItemCollapsed:`${X}__flow-item--collapsed`,header:`${X}__header`,footer:`${X}__footer`,featureMenuObserver:`${X}__feature-menu-observer`,actionExit:`${X}__action--exit`,loader:`${X}__loader`,featuresHeading:`${X}__heading`,paginationActionBar:`${X}__pagination-action-bar`,paginationPrevious:`${X}__pagination-previous`,paginationNext:`${X}__pagination-next`};var je=class extends V{constructor(e,t){super(e,t),this.messages=null,this.closed=!1,this.closable=!0,this._handleOpenRelatedFeature=i=>{this.emit("open-related-feature",{feature:i})}}loadDependencies(){return ee({action:()=>import("./chunk-T4R4QART.js"),"flow-item":()=>import("./chunk-KLO7UIMN.js")})}render(){let{flowItems:e}=this,t=e?.toArray();return c(er,null,t?.map(i=>this._renderRelatedRecordsFlowItem(i)))}_handleCloseClick(){this.emit("close")}_handleExitClick(){this.emit("exit")}_handleRelatedRecordsBackClick(){let e=this.flowItems?.pop();e&&("showAllEnabled"in e.viewModel&&(e.viewModel.showAllEnabled=!1),e&&(e.viewModel=null,e.destroy()))}_renderRelatedRecordsFlowItem(e){let{messages:t,closable:i,closed:r}=this,s="graphic"in e&&!e.isTable&&e.graphic?.geometry,o=t.exitRelatedRecords,l=t.selectFeature;return c("calcite-flow-item",{bind:this,closable:i,closed:r,description:this._getRelatedRecordsFlowItemDescription(e),heading:e.title??"",key:`flow-item-${e.viewModel.uid}`,onCalciteFlowItemBack:d=>{d.preventDefault(),this._handleRelatedRecordsBackClick()},onCalciteFlowItemClose:this._handleCloseClick},c("calcite-action",{appearance:"transparent",bind:this,class:j.actionExit,icon:"move-up",key:"exit-related-records-action",onclick:this._handleExitClick,slot:"header-actions-start",text:o,title:o}),s?c("calcite-action",{appearance:"transparent",bind:this,icon:"zoom-to-object",key:"open-related-feature-action",onclick:()=>this._handleOpenRelatedFeature(e),slot:"header-actions-end",text:l,title:l}):null,c("div",{class:j.container},e.render()))}_getRelatedRecordsFlowItemDescription(e){return"featureCountDescription"in e?e.featureCountDescription:e.viewModel.description??""}};n([a()],je.prototype,"flowItems",void 0),n([a(),q("esri/widgets/Features/t9n/Features")],je.prototype,"messages",void 0),n([a()],je.prototype,"closed",void 0),n([a()],je.prototype,"closable",void 0),je=n([b("esri.widgets.Features.FeaturesRelatedRecords")],je);var Io=je;var Gt=class{constructor(t){this._observable=new Yi,this._set=new Set(t)}get size(){return Le(this._observable),this._set.size}add(t){let i=this._set.size;return this._set.add(t),this._set.size!==i&&this._observable.notify(),this}clear(){this._set.size>0&&(this._set.clear(),this._observable.notify())}delete(t){let i=this._set.delete(t);return i&&this._observable.notify(),i}entries(){return Le(this._observable),this._set.entries()}forEach(t,i){Le(this._observable),this._set.forEach((r,s)=>t.call(i,r,s,this),i)}has(t){return Le(this._observable),this._set.has(t)}keys(){return Le(this._observable),this._set.keys()}values(){return Le(this._observable),this._set.values()}[Symbol.iterator](){return Le(this._observable),this._set[Symbol.iterator]()}get[Symbol.toStringTag](){return this._set[Symbol.toStringTag]}};var Co="OBJECTID";var Ae=fe.ofType({key:"type",defaultKeyValue:"button",base:yr,typeMap:{button:Ve,toggle:ai}}),xe=new Ve({icon:"magnifying-glass-plus",id:"zoom-to-feature",title:"{messages.zoom}",className:ce.zoomInMagnifyingGlass}),Si=new Ve({icon:"trash",id:"remove-selected-feature",title:"{messages.remove}",className:ce.trash}),$e=new Ve({icon:"magnifying-glass-plus",id:"zoom-to-clustered-features",title:"{messages.zoom}",className:ce.zoomInMagnifyingGlass}),ve=new ai({icon:"table",id:"browse-clustered-features",title:"{messages.browseClusteredFeatures}",className:ce.table,value:!1});var Ss="esri.widgets.Popup.PopupViewModel",Qt=()=>S.getLogger(Ss),Ao=e=>{let{event:t,view:i,viewModel:r}=e,{action:s}=t;if(!s)return Promise.reject(new L("trigger-action:missing-arguments","Event has no action"));let{disabled:o,id:l}=s;if(!l)return Promise.reject(new L("trigger-action:invalid-action","action.id is missing"));if(o)return Promise.reject(new L("trigger-action:invalid-action","Action is disabled"));if(l===xe.id)return Bs(r).catch(ji);if(l===$e.id)return Ds(r);if(l===ve.id)return r.browseClusterEnabled=!r.browseClusterEnabled,r.featureMenuOpen=r.browseClusterEnabled,Promise.resolve();if(l===Si.id){r.visible=!1;let{selectedFeature:d}=r;if(!d)return Promise.reject(new L(`trigger-action:${Si.id}`,"selectedFeature is required",{selectedFeature:d}));let{sourceLayer:u}=d;return u?u.remove(d):i?.graphics.remove(d),Promise.resolve()}return Promise.resolve()};function Vi(e){let{selectedFeature:t,location:i,view:r}=e;return r?t??i??null:null}function Se(e){return!!e&&e.isAggregate&&e.sourceLayer?.featureReduction?.type==="cluster"}function Vs(e,t){return g(this,null,function*(){if(t?.type!=="3d"||!e||e.declaredClass!=="esri.Graphic")return!0;let i=t.getViewForGraphic(e);if(i&&"whenGraphicBounds"in i){let r=null;try{r=yield i.whenGraphicBounds(e,{useViewElevation:!0})}catch{}return!r||!r.boundingBox||r.boundingBox[0]===r.boundingBox[3]&&r.boundingBox[1]===r.boundingBox[4]&&r.boundingBox[2]===r.boundingBox[5]}return!0})}function Bs(e){return g(this,null,function*(){let{location:t,selectedFeature:i,view:r,zoomFactor:s}=e,o=Vi(e);if(!r||!o){let h=new L("zoom-to:invalid-target-or-view","Cannot zoom to location without a target and view.",{target:o,view:r});throw Qt().error(h),h}let l=r.scale/s,d=e.selectedFeature?.geometry,u=d??t,p=u!=null&&u.type==="point"&&(yield Vs(i,r));xe.active=!0,xe.disabled=!0;try{yield e.zoomTo({target:{target:o,scale:p?l:void 0}})}catch{let m=new L("zoom-to:invalid-graphic","Could not zoom to the location of the graphic.",{graphic:i});Qt().error(m)}finally{xe.active=!1,xe.disabled=!1,e.zoomToLocation=null,p&&(e.location=u)}})}function Ds(e){return g(this,null,function*(){let{selectedFeature:t,view:i}=e;if(i?.type!=="2d"){let l=new L("zoomToCluster:invalid-view","View must be 2d MapView.",{view:i});throw Qt().error(l),l}if(!t||!Se(t)){let l=new L("zoomToCluster:invalid-selectedFeature","Selected feature must represent an aggregate/cluster graphic.",{selectedFeature:t});throw Qt().error(l),l}let[r,s]=yield Bi(i,t);$e.active=!0,$e.disabled=!0;let{extent:o}=yield r.queryExtent(s);o&&(yield e.zoomTo({target:o})),$e.active=!1,$e.disabled=!1})}function xo(e){return g(this,null,function*(){let{view:t,selectedFeature:i}=e;if(!t||!i)return;let[r,s]=yield Bi(t,i),{extent:o}=yield r.queryExtent(s);e.selectedClusterBoundaryFeature.geometry=o,t.graphics.add(e.selectedClusterBoundaryFeature)})}function Eo(e){return g(this,null,function*(){let{selectedFeature:t,view:i}=e;if(!i||!t)return;let[r,s]=yield Bi(i,t);ve.active=!0,ve.disabled=!0;let{features:o}=yield r.queryFeatures(s);ve.active=!1,ve.disabled=!1,ve.value=!0,e?.open({features:[t].concat(o),featureMenuOpen:!0})})}function Bi(e,t){return g(this,null,function*(){let i=yield e.whenLayerView(t.sourceLayer),r=i.createQuery(),s=t.getObjectId();return r.aggregateIds=s!=null?[s]:[],[i,r]})}function To(e){ve.value=!1;let t=e.features.filter(i=>Se(i));t.length&&(e.features=t)}var Di="location-scale-handle",qs=()=>[xe.clone()],zs=()=>[$e.clone(),ve.clone()],Xt=null;function Ws(e,t){return e==="building-scene"||t==="2d"&&(e==="map-image"||e==="tile"||e==="imagery"||e==="imagery-tile")}var C=class extends Mr(Ut){constructor(e){super(e),this._pendingPromises=new Gt,this._fetchFeaturesController=null,this._highlightSelectedFeaturePromise=null,this._highlightActiveFeaturePromise=null,this._selectedClusterFeature=null,this.actions=new Ae,this.activeFeature=null,this.autoCloseEnabled=!1,this.browseClusterEnabled=!1,this.content=null,this.defaultPopupTemplateEnabled=!1,this.featurePage=null,this.featuresPerPage=20,this.featureMenuOpen=!1,this.featureViewModelAbilities=null,this.featureViewModels=[],this.highlightEnabled=!0,this.includeDefaultActions=!0,this.selectedClusterBoundaryFeature=new ne({symbol:new ur({outline:{width:1.5,color:"cyan"},style:"none"})}),this.title=null,this.updateLocationEnabled=!1,this.view=null,this.visible=!1,this.zoomFactor=4,this.zoomToLocation=null,this._debouncedLocationUpdate=Ze(t=>g(this,null,function*(){let{spatialReference:i}=this,r=this.selectedFeature?.geometry?.type,s=this.location??t;if(r&&r!=="mesh"&&i&&s&&this.selectedFeature)if(r!=="point")try{let o=this.selectedFeature,l=o.geometry,d=this._getHighlightLayer(o),u=o.getObjectId();if(!d||!this.view)return;if(u){let p=this.view?.allLayerViews.find(v=>v.layer.uid===d.uid);if(!p||!("queryFeatures"in p))return;let h=p.createQuery();h.outSpatialReference=i,h.objectIds=[u],h.returnGeometry=!0;let{features:m}=yield p.queryFeatures(h);l=m[0]?.geometry}if(!l||l.type==="mesh")return;if(l=nr(l,i),Xt||(Xt=yield import("./chunk-63T32QWT.js")),!(yield Xt.intersects(l,s))){let p=(yield Xt.nearestCoordinate(l,s)).coordinate??s;this.selectedFeature===o&&(this.location=p)}}catch(o){ot(o)||S.getLogger(this).error(o)}else this.location=at(this.selectedFeature.geometry)??s}))}initialize(){this.addHandles([this.on("view-change",()=>this._autoClose()),f(()=>[this.highlightEnabled,this.selectedFeature,this.visible,this.view],()=>this._highlightSelectedFeature()),f(()=>[this.highlightEnabled,this.activeFeature,this.visible,this.view],()=>this._highlightActiveFeature()),f(()=>this.view?.animation?.state,e=>this._animationStateChange(e)),f(()=>this.location,e=>this._locationChange(e)),f(()=>this.selectedFeature,e=>this._selectedFeatureChange(e)),f(()=>[this.selectedFeatureIndex,this.featureCount,this.featuresPerPage],()=>this._selectedFeatureIndexChange()),f(()=>[this.featurePage,this.selectedFeatureIndex,this.featureCount,this.featuresPerPage,this.featureViewModels],()=>this._setGraphicOnFeatureViewModels()),f(()=>this.featureViewModels,()=>this._featureViewModelsChange()),this.on("trigger-action",e=>Ao({event:e,viewModel:this,view:this.view})),ke(()=>!this.waitingForResult,()=>this._waitingForResultChange(),Ji),f(()=>[this.features,this.map,this.spatialReference,this.timeZone],()=>this._updateFeatureVMs()),f(()=>this.view?.scale,()=>this._viewScaleChange()),ke(()=>!this.visible,()=>this.browseClusterEnabled=!1),f(()=>this.browseClusterEnabled,e=>e?this.enableClusterBrowsing():this.disableClusterBrowsing())])}destroy(){this._cancelFetchingFeatures(),this._pendingPromises.clear(),this.browseClusterEnabled=!1,this.view=null,this.map=null,this.spatialReference=null,this.timeZone=null}get active(){return!(!this.visible||this.waitingForResult)}get allActions(){let e=this._get("allActions")||new Ae;e.removeAll();let{actions:t,defaultActions:i,defaultPopupTemplateEnabled:r,includeDefaultActions:s,selectedFeature:o}=this,l=s?i.concat(t):t,d=o&&(typeof o.getEffectivePopupTemplate=="function"&&o.getEffectivePopupTemplate(r)||o.popupTemplate),u=d?.actions;return(d?.overwriteActions?u:u?.concat(l)??l)?.filter(Boolean).forEach(h=>e.add(h)),e}get defaultActions(){let e=this._get("defaultActions")||new Ae;return e.removeAll(),e.addMany(Se(this.selectedFeature)?zs():qs()),e}get featureCount(){return this.features.length}set features(e){let t=e||[];this._set("features",t);let{pendingPromisesCount:i,promiseCount:r,selectedFeatureIndex:s}=this,o=r&&t.length;o&&i&&s===-1?this.selectedFeatureIndex=0:o&&s!==-1||(this.selectedFeatureIndex=t.length?0:-1)}set location(e){let t=e,i=this.spatialReference?.isWebMercator;e?.spatialReference?.isWGS84&&i&&(t=rr(e)),this._set("location",t)}get map(){return this.view?.map??null}set map(e){this._override("map",e)}get pendingPromisesCount(){return this._pendingPromises.size}get promiseCount(){return this.promises.length}get promises(){return this._get("promises")||[]}set promises(e){this._pendingPromises.clear(),this.features=[],Array.isArray(e)&&e.length?(this._set("promises",e),(e=e.slice(0)).forEach(t=>this._pendingPromises.add(t)),e.reduce((t,i)=>t.finally(()=>i.then(r=>{this._pendingPromises.has(i)&&this._updateFeatures(r)}).finally(()=>this._pendingPromises.delete(i)).catch(()=>{})),Promise.resolve())):this._set("promises",[])}get selectedFeature(){let{features:e,selectedFeatureIndex:t}=this;return t===-1?null:e[t]||null}get selectedFeatureIndex(){let e=this._get("selectedFeatureIndex");return typeof e=="number"?e:-1}set selectedFeatureIndex(e){let{featureCount:t}=this;e=isNaN(e)||e<-1||!t?-1:(e+t)%t,this.activeFeature=null,this._set("selectedFeatureIndex",e)}get selectedFeatureViewModel(){return this.featureViewModels[this.selectedFeatureIndex]||null}get spatialReference(){return this.view?.spatialReference??null}set spatialReference(e){this._override("spatialReference",e)}get state(){let{view:e,map:t}=this;return e?e.ready?"ready":"disabled":t?"ready":"disabled"}get timeZone(){return this.view?.timeZone??Ft}set timeZone(e){this._overrideIfSome("timeZone",e)}get waitingForContents(){return this.featureViewModels.some(e=>e.waitingForContent)}get waitingForResult(){return!(!(this._fetchFeaturesController||this.pendingPromisesCount>0)||this.featureCount!==0)}centerAtLocation(){let{view:e}=this,t=Vi(this);return t&&e?this.callGoTo({target:{target:t,scale:e.scale}}):Promise.reject(new L("center-at-location:invalid-target-or-view","Cannot center at a location without a target and view.",{target:t,view:e}))}zoomTo(e){return this.callGoTo(e)}clear(){this.set({promises:[],features:[],content:null,title:null,location:null,activeFeature:null})}fetchFeatures(e,t){let{view:i}=this;if(!i||!e)throw new L("fetch-features:invalid-screenpoint-or-view","Cannot fetch features without a screenPoint and view.",{screenPoint:e,view:i});return i.fetchPopupFeatures(e,{pointerType:t?.event?.pointerType,defaultPopupTemplateEnabled:this.defaultPopupTemplateEnabled,signal:t?.signal})}open(e){let t=Te(_({updateLocationEnabled:!1,promises:[],fetchFeatures:!1},e),{visible:!0}),{fetchFeatures:i}=t;delete t.fetchFeatures,i&&this._setFetchFeaturesPromises(t.location);let r=["actionsMenuOpen","collapsed"];for(let s of r)delete t[s];this.set(t)}triggerAction(e){let t=this.allActions.at(e);t&&!t.disabled&&this.emit("trigger-action",{action:t})}next(){return this.selectedFeatureIndex++,this}previous(){return this.selectedFeatureIndex--,this}disableClusterBrowsing(){To(this),this._clearBrowsedClusterGraphics()}enableClusterBrowsing(){return g(this,null,function*(){let{view:e,selectedFeature:t}=this;e?.type==="2d"?Se(t)?(yield xo(this),yield Eo(this)):S.getLogger(this).warn("enableClusterBrowsing:invalid-selectedFeature: Selected feature must represent an aggregate/cluster graphic.",t):S.getLogger(this).warn("enableClusterBrowsing:invalid-view: View must be 2d MapView.",t)})}handleViewClick(e){this._fetchFeaturesAndOpen(e)}_animationStateChange(e){this.zoomToLocation||(xe.disabled=e==="waiting-for-target")}_clearBrowsedClusterGraphics(){let e=[this.selectedClusterBoundaryFeature,this._selectedClusterFeature].filter(Fe);this.view?.graphics?.removeMany(e),this._selectedClusterFeature=null,this.selectedClusterBoundaryFeature.geometry=null}_viewScaleChange(){if(Se(this.selectedFeature))return this.browseClusterEnabled=!1,this.visible=!1,void this.clear();this.browseClusterEnabled&&(this.features=this.selectedFeature?[this.selectedFeature]:[])}_locationChange(e){let{selectedFeature:t,updateLocationEnabled:i,view:r}=this;r&&i&&e&&(!t||t.geometry)&&this.centerAtLocation()}_selectedFeatureIndexChange(){this.featurePage=this.featureCount>1?Math.floor(this.selectedFeatureIndex/this.featuresPerPage)+1:null}_featureViewModelsChange(){this.featurePage=this.featureCount>1?1:null}_setGraphicOnFeatureViewModels(){let{features:e,featureCount:t,featurePage:i,featuresPerPage:r,featureViewModels:s}=this;if(i===null)return;let o=((i-1)*r+t)%t,l=o+r;s.slice(o,l).forEach((d,u)=>{d&&(d.graphic??=e[o+u])})}_selectedFeatureChange(e){return g(this,null,function*(){let{location:t,updateLocationEnabled:i,view:r}=this;if(!e||!r)return;if(this.browseClusterEnabled)return this._selectedClusterFeature&&(r.graphics.remove(this._selectedClusterFeature),this._selectedClusterFeature=null),Se(e)?void 0:(e.symbol=yield pi(e),this._selectedClusterFeature=e,void r.graphics.add(this._selectedClusterFeature));let s=e.sourceLayer?.type;if(s!=="map-image"&&s!=="imagery"&&s!=="imagery-tile"||(e.symbol=yield pi(e)),!i&&t||!e.geometry){if(i&&!e.geometry){yield this.centerAtLocation();let o=r.center?.clone();o&&(this.location=o)}}else this.location=at(e.geometry)})}_waitingForResultChange(){!this.featureCount&&this.promises&&(this.visible=!1)}_setFetchFeaturesPromises(e){return g(this,null,function*(){let{pendingFeatures:t}=yield this._fetchFeaturesWithController({mapPoint:e});this.promises=t})}_destroyFeatureVMs(){this.featureViewModels.forEach(e=>e&&!e.destroyed&&e.destroy()),this._set("featureViewModels",[])}_updateFeatureVMs(){let{selectedFeature:e,features:t,featureViewModels:i,view:r,spatialReference:s,map:o,timeZone:l,location:d}=this;if(Se(e)||(this.browseClusterEnabled=!1),this._destroyFeatureVMs(),!t?.length)return;let u=i.slice(0),p=[];t.forEach((h,m)=>{if(!h)return;let v=null;if(u.some((y,w)=>(y&&y.graphic===h&&(v=y,u.splice(w,1)),!!v)),v)p[m]=v;else{let y=new yt({abilities:this.featureViewModelAbilities,defaultPopupTemplateEnabled:this.defaultPopupTemplateEnabled,spatialReference:s,graphic:h===e?h:null,location:d,map:o,view:r,timeZone:l});p[m]=y}}),u.forEach(h=>h&&!h.destroyed&&h.destroy()),this._set("featureViewModels",p)}_getScreenPoint(e,t){return g(this,null,function*(){let{spatialReference:i,view:r}=this;if(!r)return null;yield r?.when();let s=e?.spatialReference;return s&&i?(yield lr(s,i,null,t),r.toScreen(e)):null})}_cancelFetchingFeatures(){let e=this._fetchFeaturesController;e&&e.abort(),this._fetchFeaturesController=null}_projectScreenPointAndFetchFeatures(s){return g(this,arguments,function*({mapPoint:e,screenPoint:t,event:i,signal:r}){return this.fetchFeatures(t??(yield this._getScreenPoint(e??this.location,{signal:r})),{signal:r,event:i})})}_fetchFeaturesWithController({mapPoint:e,screenPoint:t,event:i}){this._cancelFetchingFeatures();let r=new AbortController,{signal:s}=r;this._fetchFeaturesController=r;let o=this._projectScreenPointAndFetchFeatures({mapPoint:e,screenPoint:t,signal:s,event:i});return o.catch(()=>{}).then(()=>{this._fetchFeaturesController=null}),o}_fetchFeaturesAndOpen(e){return g(this,null,function*(){let{mapPoint:t,screenPoint:i}=e,{view:r}=this;this.removeHandles(Di),this.addHandles([f(()=>this.view?.scale,()=>this._debouncedLocationUpdate(t).catch(o=>{ot(o)||S.getLogger(this).error(o)})),ke(()=>!this.visible,()=>{this.removeHandles(Di)},{once:!0})],Di);let{pendingFeatures:s}=yield this._fetchFeaturesWithController({mapPoint:t,screenPoint:i,event:e});r?.popup&&"open"in r.popup&&r.popup.open({location:t??void 0,promises:s})})}_autoClose(){this.autoCloseEnabled&&(this.visible=!1)}_getLayerView(e,t){return g(this,null,function*(){return yield e.when(),e.whenLayerView(t)})}_getHighlightLayer(e){let{layer:t,sourceLayer:i}=e;return i&&"layer"in i&&i.layer?i.layer:i?.type==="map-notes"||i?.type==="subtype-group"?i:t}_getHighlightTarget(e,t,i){if(Ws(t.type,i))return e;let r=e.getObjectId();if(r!=null)return r;let s=t.type==="imagery"?void 0:"objectIdField"in t?t.objectIdField||Co:null,o=e.attributes;return o&&s&&o[s]||e}_mapIncludesLayer(e){return!!this.map?.allLayers?.includes(e)}_highlightActiveFeature(){return g(this,null,function*(){let e="highlight-active-feature";this.removeHandles(e);let{highlightEnabled:t,view:i,activeFeature:r,visible:s}=this;if(!(r&&i&&t&&s))return;let o=this._getHighlightLayer(r);if(!(o&&o instanceof ui&&this._mapIncludesLayer(o)))return;let l=this._getLayerView(i,o);this._highlightActiveFeaturePromise=l;let d=yield l;if(!(d&&hi(d)&&this._highlightActiveFeaturePromise===l&&this.activeFeature&&this.highlightEnabled))return;let u=d.highlight(this._getHighlightTarget(r,o,i.type));this.addHandles(u,e)})}_highlightSelectedFeature(){return g(this,null,function*(){let e="highlight-selected-feature";this.removeHandles(e);let{selectedFeature:t,highlightEnabled:i,view:r,visible:s}=this;if(!(t&&r&&i&&s))return;let o=this._getHighlightLayer(t);if(!(o&&o instanceof ui&&this._mapIncludesLayer(o)))return;let l=this._getLayerView(r,o);this._highlightSelectedFeaturePromise=l;let d=yield l;if(!(d&&hi(d)&&this._highlightSelectedFeaturePromise===l&&this.selectedFeature&&this.highlightEnabled&&this.visible))return;let u=d.highlight(this._getHighlightTarget(t,o,r.type));this.addHandles(u,e)})}_updateFeatures(e){let{features:t}=this,i=e.filter(r=>!t.includes(r));i?.length&&(this.features=t.concat(i))}};n([a()],C.prototype,"_fetchFeaturesController",void 0),n([a({type:Ae})],C.prototype,"actions",void 0),n([a({readOnly:!0})],C.prototype,"active",null),n([a()],C.prototype,"activeFeature",void 0),n([a({readOnly:!0})],C.prototype,"allActions",null),n([a()],C.prototype,"autoCloseEnabled",void 0),n([a()],C.prototype,"browseClusterEnabled",void 0),n([a()],C.prototype,"content",void 0),n([a({type:Ae,readOnly:!0})],C.prototype,"defaultActions",null),n([a({type:Boolean})],C.prototype,"defaultPopupTemplateEnabled",void 0),n([a({readOnly:!0})],C.prototype,"featureCount",null),n([a()],C.prototype,"featurePage",void 0),n([a({value:[]})],C.prototype,"features",null),n([a()],C.prototype,"featuresPerPage",void 0),n([a()],C.prototype,"featureMenuOpen",void 0),n([a()],C.prototype,"featureViewModelAbilities",void 0),n([a({readOnly:!0})],C.prototype,"featureViewModels",void 0),n([a()],C.prototype,"highlightEnabled",void 0),n([a()],C.prototype,"includeDefaultActions",void 0),n([a({type:Ge})],C.prototype,"location",null),n([a()],C.prototype,"map",null),n([a({readOnly:!0})],C.prototype,"pendingPromisesCount",null),n([a({readOnly:!0})],C.prototype,"promiseCount",null),n([a()],C.prototype,"promises",null),n([a({readOnly:!0})],C.prototype,"selectedClusterBoundaryFeature",void 0),n([a({value:null,readOnly:!0})],C.prototype,"selectedFeature",null),n([a({value:-1})],C.prototype,"selectedFeatureIndex",null),n([a({readOnly:!0})],C.prototype,"selectedFeatureViewModel",null),n([a({readOnly:!0})],C.prototype,"state",null),n([a()],C.prototype,"timeZone",null),n([a()],C.prototype,"title",void 0),n([a()],C.prototype,"updateLocationEnabled",void 0),n([a()],C.prototype,"view",void 0),n([a()],C.prototype,"visible",void 0),n([a({readOnly:!0})],C.prototype,"waitingForContents",null),n([a({readOnly:!0})],C.prototype,"waitingForResult",null),n([a()],C.prototype,"zoomFactor",void 0),n([a()],C.prototype,"zoomToLocation",void 0),n([a()],C.prototype,"centerAtLocation",null),C=n([b("esri.widgets.Features.FeaturesViewModel")],C);var vt=C;var pe=class extends U{constructor(){super(...arguments),this.actionBar=!0,this.closeButton=!0,this.collapseButton=!1,this.featureNavigation=!0,this.featureListLayerTitle=!0,this.flow=!0,this.heading=!0,this.spinner=!0}};n([a({type:Boolean,nonNullable:!0})],pe.prototype,"actionBar",void 0),n([a({type:Boolean,nonNullable:!0})],pe.prototype,"closeButton",void 0),n([a({type:Boolean,nonNullable:!0})],pe.prototype,"collapseButton",void 0),n([a({type:Boolean,nonNullable:!0})],pe.prototype,"featureNavigation",void 0),n([a({type:Boolean,nonNullable:!0})],pe.prototype,"featureListLayerTitle",void 0),n([a({type:Boolean,nonNullable:!0})],pe.prototype,"flow",void 0),n([a({type:Boolean,nonNullable:!0})],pe.prototype,"heading",void 0),n([a({type:Boolean,nonNullable:!0})],pe.prototype,"spinner",void 0),pe=n([b("esri.widgets.Features.FeaturesVisibleElements")],pe);var qi=pe;var Lo="selected-index",Hs=0,ko="features-spinner",js=50;function Ro(e){return e?.declaredClass.startsWith("esri.layers.")??!1}var x=class extends jt(V){constructor(e,t){super(e,t),this._featureMenuIntersectionObserverCallback=([i])=>{i?.isIntersecting&&this.viewModel.featurePage!=null&&this.viewModel.featurePage++},this._featureMenuIntersectionObserver=new IntersectionObserver(this._featureMenuIntersectionObserverCallback,{root:window.document}),this._featureMenuIntersectionObserverNode=null,this._focusOn=null,this._spinner=null,this._feature=null,this._relatedRecordsFlowItems=new fe,this._relatedRecordsWidget=new Io({flowItems:this._relatedRecordsFlowItems}),this._rootFlowItemNode=null,this._featureMenuViewportNode=null,this._actionBarMenuNode=null,this.collapsed=!1,this.featureNavigationTop=!1,this.headerActions=new Ae,this.headingLevel=2,this.messages=null,this.messagesCommon=null,this.responsiveActionsEnabled=!1,this.viewModel=new vt,this.visibleElements=new qi,this._renderAction=(i,r)=>{let s=this._getActionTitle(i),{type:o,active:l,uid:d,disabled:u,indicator:p}=i;return i.visible?c("calcite-action",{active:o==="toggle"&&i.value,appearance:"solid",bind:this,"data-action-uid":d,disabled:u,icon:this._getActionIcon(i),indicator:p,key:`action-${r}`,loading:l,onclick:this._triggerAction,scale:"s",text:s,title:this._hideActionText?s:void 0},this._getFallbackIcon(i)):null},this._openFeatureMenu=()=>{this.featureMenuOpen=!0,this._focusOn="menu-flow-item"},this._previousFeature=()=>{this.viewModel.selectedFeatureIndex--},this._nextFeature=()=>{this.viewModel.selectedFeatureIndex++},this._handleFeatureMenuBack=()=>{this.featureMenuOpen&&(this._focusOn="root-flow-item",this.featureMenuOpen=!1)},this._focusFlowItemNode=i=>{this._focusOn===i&&requestAnimationFrame(()=>g(this,null,function*(){switch(i){case"menu-flow-item":yield this._featureMenuViewportNode?.setFocus();break;case"root-flow-item":yield this._rootFlowItemNode?.setFocus()}this._focusOn=null}))},this._focusFlowItemNodeThrottled=Be(this._focusFlowItemNode,js),this._displaySpinnerThrottled=Be(()=>this._displaySpinner(),Hs),this._addSelectedFeatureIndexHandle(),this.addHandles([this._displaySpinnerThrottled,this._focusFlowItemNodeThrottled,f(()=>this.viewModel?.active,()=>this._toggleScreenLocationEnabled()),f(()=>this.viewModel?.active,i=>this._relatedRecordsWidget.closed=!i),f(()=>this.visibleElements?.closeButton,i=>this._relatedRecordsWidget.closable=i),f(()=>this.visibleElements?.spinner,i=>this._spinnerEnabledChange(i)),f(()=>this.viewModel?.view,(i,r)=>this._viewChange(i,r)),f(()=>this.viewModel?.view?.ready,(i,r)=>this._viewReadyChange(i??!1,r??!1)),f(()=>[this.viewModel?.waitingForResult,this.viewModel?.location],()=>{this._hideSpinner(),this._displaySpinnerThrottled()}),f(()=>this.viewModel?.screenLocation,()=>this._closeOpenActionMenu()),f(()=>this.selectedFeatureWidget,()=>this._destroyRelatedRecordsFlowItemWidgets()),f(()=>{let i=this.selectedFeatureWidget?.viewModel;return[i?.title,i?.state]},()=>this._setTitleFromFeatureWidget()),f(()=>{let i=this.selectedFeatureWidget?.viewModel;return[i?.content,i?.state]},()=>this._setContentFromFeatureWidget()),f(()=>this.viewModel?.featureViewModels,()=>this._featureMenuViewportScrollTop()),this._relatedRecordsWidget.on("close",()=>this.close()),this._relatedRecordsWidget.on("exit",()=>this._destroyRelatedRecordsFlowItemWidgets()),this._relatedRecordsWidget.on("open-related-feature",({feature:i})=>this._openRelatedFeature(i))])}loadDependencies(){return ee({action:()=>import("./chunk-T4R4QART.js"),"action-bar":()=>import("./chunk-QMUVVPI7.js"),"action-group":()=>import("./chunk-2KEO4LSV.js"),button:()=>import("./chunk-DLYYRWO3.js"),flow:()=>import("./chunk-YWKW5O3R.js"),"flow-item":()=>import("./chunk-KLO7UIMN.js"),list:()=>import("./chunk-2WJA24ER.js"),"list-item":()=>import("./chunk-6SVICUTH.js"),"list-item-group":()=>import("./chunk-H3R5WAX3.js"),loader:()=>import("./chunk-C4B6QL4L.js")})}destroy(){this._destroyRelatedRecordsFlowItemWidgets(),this._destroySelectedFeatureWidget(),this._destroySpinner(),this._unobserveFeatureMenuObserver(),this._featureMenuIntersectionObserver?.disconnect(),this._relatedRecordsWidget?.destroy()}get _hideActionText(){if(!this.responsiveActionsEnabled)return!1;let e=this.view?.widthBreakpoint;return e==="xsmall"||e==="small"||e==="medium"}get _featureNavigationVisible(){return this.viewModel.active&&this.viewModel.featureCount>1&&this.visibleElements.featureNavigation}get _isCollapsed(){return this._collapseEnabled&&this.collapsed}get _collapseEnabled(){return this.visibleElements.collapseButton&&!!this.title&&!!this.content}get active(){return this.viewModel.active}get content(){return this.viewModel.content}set content(e){this.viewModel.content=e}get icon(){return null}get featureMenuOpen(){return this.viewModel.featureMenuOpen}set featureMenuOpen(e){this.viewModel.featureMenuOpen=e}get features(){return this.viewModel.features}set features(e){this.viewModel.features=e}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(e){this.viewModel.goToOverride=e}get location(){return this.viewModel.location}set location(e){this.viewModel.location=e}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get map(){return this.viewModel.map}set map(e){this.viewModel.map=e}get promises(){return this.viewModel.promises}set promises(e){this.viewModel.promises=e}get selectedFeature(){return this.viewModel.selectedFeature}get selectedFeatureIndex(){return this.viewModel.selectedFeatureIndex}set selectedFeatureIndex(e){this.viewModel.selectedFeatureIndex=e}get selectedFeatureWidget(){let{_feature:e,headingLevel:t,_relatedRecordsFlowItems:i,timeZone:r,spatialReference:s,map:o}=this,{selectedFeatureViewModel:l}=this.viewModel,d={title:!1};return l?(e?(e.viewModel=l,e.visibleElements=d):this._feature=new Fo({flowItems:i,headingLevel:t+1,timeZone:r,spatialReference:s,map:o,viewModel:l,visibleElements:d}),this._feature):null}get spatialReference(){return this.viewModel.spatialReference}set spatialReference(e){this.viewModel.spatialReference=e}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}get timeZone(){return this.viewModel.timeZone}set timeZone(e){this.viewModel.timeZone=e}get updateLocationEnabled(){return this.viewModel.updateLocationEnabled}set updateLocationEnabled(e){this.viewModel.updateLocationEnabled=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}get visible(){return this.viewModel.visible}set visible(e){this.viewModel.visible=e}blur(){let{active:e}=this.viewModel;e?this._rootFlowItemNode?.blur():S.getLogger(this).warn("Features can only be blurred when currently active.")}clear(){return this.viewModel.clear()}close(){this.viewModel.visible=!1}fetchFeatures(e,t){return this.viewModel.fetchFeatures(e,t)}focus(){let{active:e}=this.viewModel;e?this._setFocusOn():S.getLogger(this).warn("Features can only be focused when currently active.")}next(){return this.viewModel.next()}open(e){this.removeHandles(Lo);let t={collapsed:e?.collapsed??!1};this.set(t),this.viewModel.open(e),this.addHandles(ke(()=>!this.viewModel.waitingForResult,()=>this._addSelectedFeatureIndexHandle(),{once:!0}))}previous(){return this.viewModel.previous()}triggerAction(e){return this.viewModel.triggerAction(e)}render(){return c("div",{bind:this,class:this.classes(j.base,M.widget,M.panel),onkeydown:this._onMainKeydown},this._renderHeader(),this._renderContentContainer())}_renderFeatureNavigation(){return[this._renderPagination(),this._renderFeatureMenuButton()]}_renderHeader(){return!this.featureMenuOpen&&this.featureNavigationTop&&this._featureNavigationVisible?c("div",{class:j.header,key:"header-actions"},this._renderFeatureNavigation()):null}_renderFooter(){return this.featureMenuOpen||this.featureNavigationTop||!this._featureNavigationVisible?null:c("div",{class:j.footer,key:"footer-actions",slot:"footer"},this._renderFeatureNavigation())}_renderFeatureMenuButton(){let{messages:e,viewModel:t}=this,{featureCount:i,selectedFeatureIndex:r,pendingPromisesCount:s}=t;return c("calcite-action",{appearance:"solid",bind:this,icon:"list",key:"feature-menu-button",label:e.selectFeature,loading:s>0,onclick:this._openFeatureMenu,scale:"s",text:Q(e.pageText,{index:Me(r+1),total:Me(i)}),textEnabled:!0,title:e.selectFeature})}_renderPagination(){let{previous:e,next:t}=this.messagesCommon.pagination;return c("calcite-action-bar",{class:j.paginationActionBar,expandDisabled:!0,key:"pagination-action-bar",layout:"horizontal",overflowActionsDisabled:!0,scale:"s"},c("calcite-action-group",{scale:"s"},c("calcite-action",{appearance:"solid",class:j.paginationPrevious,icon:"chevron-left",iconFlipRtl:!0,label:e,onclick:this._previousFeature,scale:"s",text:e,title:e}),c("calcite-action",{appearance:"solid",icon:"chevron-right",iconFlipRtl:!0,label:t,onclick:this._nextFeature,scale:"s",text:t,title:t})))}_renderFeatureMenuItem(e){let{selectedFeatureViewModel:t,featureViewModels:i}=this.viewModel,r=e===t,s=i.indexOf(e);return c("calcite-list-item",{bind:this,"data-feature-index":s,key:`feature-menu-item-${e.uid}`,onblur:this._removeActiveFeature,onfocus:this._setActiveFeature,onmouseleave:this._removeActiveFeature,onmouseover:this._setActiveFeature,selected:r,onCalciteListItemSelect:this._selectFeature},c("span",{innerHTML:e.title||this.messagesCommon.untitled,slot:"content"}))}_groupResultsByLayer(){let{featureViewModels:e}=this.viewModel,t=new Map;return e.forEach(i=>{let r=i?.graphic;if(!r)return;let{layer:s,sourceLayer:o}=r,l=(Ro(s)?s:null)||(Ro(o)?o:null),d=t.get(l)??[];t.set(l,[...d,i])}),t}_renderFeatureMenu(){let{featureViewModels:e}=this.viewModel,t=this._groupResultsByLayer();return e.length?c("calcite-list",{selectionAppearance:"icon",selectionMode:"single"},Array.from(t.keys(),i=>{let r=t.get(i)?.map(o=>this._renderFeatureMenuItem(o)),s=i?i.title??this.messagesCommon.untitled:null;return this.visibleElements.featureListLayerTitle&&s!==null?c("calcite-list-item-group",{heading:s,key:i?.uid||"map-graphics"},r):r})):null}_renderHeaderAction(e,t){let i=e.title||"";return e.visible?c("calcite-action",{active:e.type==="toggle"&&e.value,appearance:"solid",bind:this,"data-action-uid":e.uid,disabled:e.disabled,icon:e.icon??void 0,indicator:e.indicator,key:`header-action-${t}`,loading:e.active,onclick:this._triggerHeaderAction,slot:"header-actions-end",text:i,title:i}):null}_renderHeaderActions(){return this.headerActions.map((e,t)=>this._renderHeaderAction(e,t)).toArray()}_renderContentFeature(){let{headingLevel:e,visibleElements:t,_isCollapsed:i,_collapseEnabled:r,featureNavigationTop:s}=this,{title:o,active:l}=this.viewModel,d=t.heading&&o?o:"";return c("calcite-flow-item",{afterCreate:this._storeRootFlowItemNode,afterUpdate:this._focusRootFlowItemNode,bind:this,class:this.classes({[j.contentFeature]:!0,[j.flowItemCollapsed]:i}),closable:t.closeButton,closed:!l,collapsed:i,collapseDirection:s?"down":"up",collapsible:r,headingLevel:e,key:"root-flow-item",onCalciteFlowItemClose:this.close,onCalciteFlowItemToggle:this._handleCollapseToggle},d?c(Qe,{class:this.classes(j.featuresHeading,M.heading),innerHTML:d,key:"header-content",level:this.headingLevel,slot:"header-content"}):null,this._renderHeaderActions(),this._renderActionBar(),i?null:c("div",{class:this.classes(j.container,j.contentContainer)},this._renderContent()),this._renderFooter())}_renderFeatureMenuContainer(){let{viewModel:e,featureMenuOpen:t,messages:i,messagesCommon:r}=this,{active:s,featureViewModels:o,pendingPromisesCount:l}=e;return t?c("calcite-flow-item",{afterCreate:this._storeFeatureMenuFlowItemNode,afterUpdate:this._focusFeatureMenuFlowItemNode,bind:this,closable:!1,closed:!s,description:Q(i.total,{total:o.length}),heading:i.selectFeature,key:"feature-menu",loading:e.waitingForContents,onCalciteFlowItemBack:d=>{d.preventDefault(),this._handleFeatureMenuBack()}},l>0?c("calcite-loader",{class:j.loader,inline:!0,key:"feature-menu-loader",label:r.loading,slot:"header-actions-end"}):null,c("div",{class:j.container},this._renderFeatureMenu()),c("div",{afterCreate:this._featureMenuIntersectionObserverCreated,bind:this,class:j.featureMenuObserver}),c("calcite-button",{appearance:"transparent",onclick:this._handleFeatureMenuBack,slot:"footer-actions",width:"full"},r.back)):null}_renderContentContainer(){let e=[this._renderContentFeature(),this._renderFeatureMenuContainer(),this._relatedRecordsWidget.render()];return this.visibleElements.flow?c("calcite-flow",{key:"content-container"},e):e}_getFallbackIcon(e){let{className:t,icon:i}=e;if(i)return null;let r=Er({action:e,feature:this.selectedFeature}),s={[j.icon]:!!t,[j.actionImage]:!!r};return t&&(s[t]=!0),r||t?c("span",{"aria-hidden":"true",class:this.classes(j.icon,s),key:"icon",styles:xr(r)}):null}_renderActionBar(){return!this._isCollapsed&&this.visibleElements.actionBar&&this.viewModel.allActions?.length?c("calcite-action-bar",{expandDisabled:!0,expanded:!this._hideActionText,key:"header-action-bar",scale:"s",slot:"action-bar"},c("calcite-action-group",{afterCreate:e=>this._actionBarMenuNode=e,overlayPositioning:"fixed",scale:"s"},this._renderActions())):null}_renderActions(){return this.viewModel.allActions.toArray().map(this._renderAction)}_renderContent(){let e=this.viewModel?.content;return e?typeof e=="string"?c("div",{class:B.contentNode,innerHTML:e,key:e}):this.renderNodeContent(e):null}_setFocusOn(){this.renderNow(),requestAnimationFrame(()=>{this._focusOn=this.featureMenuOpen?"menu-flow-item":"root-flow-item"})}_handleCollapseToggle(){this.collapsed=!this.collapsed}_openRelatedFeature(e){return g(this,null,function*(){yield e.viewModel.updateGeometry();let t=e.graphic,i=t?.geometry;if(i==null||t==null)return;this._destroyRelatedRecordsFlowItemWidgets(),yield this.viewModel.zoomTo({target:i});let r=at(i);this.open({features:[t],location:r??void 0})})}_focusRootFlowItemNode(){this._focusFlowItemNodeThrottled("root-flow-item")}_focusFeatureMenuFlowItemNode(){this._focusFlowItemNodeThrottled("menu-flow-item")}_storeRootFlowItemNode(e){this._rootFlowItemNode=e,this._focusFlowItemNodeThrottled("root-flow-item")}_storeFeatureMenuFlowItemNode(e){this._featureMenuViewportNode=e,this._focusFlowItemNodeThrottled("menu-flow-item")}_setActiveFeature(e){let{viewModel:t}=this,i=e.currentTarget["data-feature-index"];t.activeFeature=t.features?.[i]||null}_removeActiveFeature(){this.viewModel.activeFeature=null}_selectFeature(e){let t=e.currentTarget["data-feature-index"];isNaN(t)||(this.viewModel.selectedFeatureIndex=t),this._handleFeatureMenuBack()}_unobserveFeatureMenuObserver(){this._featureMenuIntersectionObserverNode&&this._featureMenuIntersectionObserver.unobserve(this._featureMenuIntersectionObserverNode)}_featureMenuIntersectionObserverCreated(e){this._unobserveFeatureMenuObserver(),this._featureMenuIntersectionObserver.observe(e),this._featureMenuIntersectionObserverNode=e}_getActionIcon(e){return e.icon?e.icon:e.image||e.className?void 0:"question"}_getActionTitle(e){let{messages:t,selectedFeature:i,messagesCommon:r}=this,{id:s}=e,o=i?.attributes,l=e.title??"",d=s==="zoom-to-feature"?Q(l,{messages:t}):s==="remove-selected-feature"?Q(l,{messages:r}):s==="zoom-to-clustered-features"||s==="browse-clustered-features"?Q(l,{messages:t}):e.title;return d&&o?Q(d,o):d??""}_onMainKeydown(e){let{key:t}=e;t==="ArrowLeft"&&(e.stopPropagation(),this._handleFeatureMenuBack(),this.previous()),t==="ArrowRight"&&(e.stopPropagation(),this._handleFeatureMenuBack(),this.next())}_featureMenuViewportScrollTop(){this._featureMenuViewportNode&&this._featureMenuViewportNode.scrollContentTo({top:0})}_setContentFromFeatureWidget(){let{selectedFeatureWidget:e}=this;e&&(this.viewModel.content=e)}_setTitleFromFeatureWidget(){let{selectedFeatureWidget:e,messagesCommon:t}=this,i=e?.viewModel;e&&(this.viewModel.title=i?.state==="error"?t?.errorMessage:i?.title||"")}_addSelectedFeatureIndexHandle(){let e=f(()=>this.viewModel?.selectedFeatureIndex,(t,i)=>this._selectedFeatureIndexUpdated(t,i));this.addHandles(e,Lo)}_selectedFeatureIndexUpdated(e,t){let{featureCount:i}=this.viewModel;i&&e!==t&&e!==-1&&(this._destroyRelatedRecordsFlowItemWidgets(),this._rootFlowItemNode&&this._rootFlowItemNode.scrollContentTo({top:0}))}_triggerHeaderAction(e){let t=e.currentTarget;if(t.disabled)return;let i=t.dataset.actionUid,r=this.headerActions.find(({uid:s})=>s===i);r&&!r.disabled&&(r?.type==="toggle"&&(r.value=!r.value),this.emit("trigger-header-action",{action:r}))}_triggerAction(e){let t=e.currentTarget;if(t.disabled)return;let i=t.dataset.actionUid,{allActions:r}=this.viewModel,s=r.findIndex(l=>l.uid===i),o=r.at(s);o&&o.type==="toggle"&&(o.value=!o.value),this.viewModel.triggerAction(s)}_createSpinner(e){e&&(this._spinner=new Mo({view:e}),e.ui.add(this._spinner,{key:ko,position:"manual",internal:!0}))}_wireUpView(e){this._destroySpinner(),e&&this.visibleElements?.spinner&&this._createSpinner(e)}_hideSpinner(){let{_spinner:e}=this;e&&(e.location=null,e.hide())}_viewReadyChange(e,t){e?this._wireUpView(this.viewModel?.view):t&&this.viewModel.clear()}_viewChange(e,t){e&&t&&this.viewModel.clear()}_destroySelectedFeatureWidget(){let{_feature:e}=this;e&&(e.viewModel=null,!e.destroyed&&e.destroy()),this._feature=null}_closeOpenActionMenu(){let{_actionBarMenuNode:e}=this;e&&(e.menuOpen=!1)}_destroyRelatedRecordsFlowItemWidgets(){this._relatedRecordsFlowItems.drain(e=>{"showAllEnabled"in e.viewModel&&(e.viewModel.showAllEnabled=!1),e.viewModel=null,e.destroy()})}_toggleScreenLocationEnabled(){let{viewModel:e}=this;e&&(e.screenLocationEnabled=e.active)}_displaySpinner(){let{_spinner:e}=this;if(!e)return;let{location:t,waitingForResult:i}=this.viewModel;i&&t?e.show({location:t}):e.hide()}_destroySpinner(){let{_spinner:e,view:t}=this;e&&(t?.ui?.remove(e,ko),e.destroy(),this._spinner=null)}_spinnerEnabledChange(e){this._destroySpinner(),e&&this._createSpinner(this.viewModel?.view)}};n([a()],x.prototype,"_focusOn",void 0),n([a()],x.prototype,"_relatedRecordsFlowItems",void 0),n([a()],x.prototype,"_hideActionText",null),n([a()],x.prototype,"_featureNavigationVisible",null),n([a()],x.prototype,"_isCollapsed",null),n([a()],x.prototype,"_collapseEnabled",null),n([a({readOnly:!0})],x.prototype,"active",null),n([a()],x.prototype,"collapsed",void 0),n([a()],x.prototype,"content",null),n([a()],x.prototype,"icon",null),n([a()],x.prototype,"featureMenuOpen",null),n([a()],x.prototype,"featureNavigationTop",void 0),n([a()],x.prototype,"features",null),n([a()],x.prototype,"goToOverride",null),n([a({type:Ae})],x.prototype,"headerActions",void 0),n([a()],x.prototype,"headingLevel",void 0),n([a()],x.prototype,"location",null),n([a()],x.prototype,"label",null),n([a()],x.prototype,"map",null),n([a(),q("esri/widgets/Features/t9n/Features")],x.prototype,"messages",void 0),n([a(),q("esri/t9n/common")],x.prototype,"messagesCommon",void 0),n([a()],x.prototype,"promises",null),n([a()],x.prototype,"responsiveActionsEnabled",void 0),n([a({readOnly:!0})],x.prototype,"selectedFeature",null),n([a()],x.prototype,"selectedFeatureIndex",null),n([a({readOnly:!0})],x.prototype,"selectedFeatureWidget",null),n([a()],x.prototype,"spatialReference",null),n([a()],x.prototype,"title",null),n([a()],x.prototype,"timeZone",null),n([a()],x.prototype,"updateLocationEnabled",null),n([a()],x.prototype,"view",null),n([a({type:vt}),Tt(["triggerAction","trigger-action"])],x.prototype,"viewModel",void 0),n([a({type:qi,nonNullable:!0})],x.prototype,"visibleElements",void 0),n([a()],x.prototype,"visible",null),x=n([b("esri.widgets.Features")],x);var Po=x;var re="esri-popup",Ue=`${re}--is-docked`,D={base:re,baseHidden:`${re}--hidden`,main:`${re}__main-container`,shadow:`${re}--shadow`,isDocked:Ue,isDockedTopLeft:`${Ue}-top-left`,isDockedTopCenter:`${Ue}-top-center`,isDockedTopRight:`${Ue}-top-right`,isDockedBottomLeft:`${Ue}-bottom-left`,isDockedBottomCenter:`${Ue}-bottom-center`,isDockedBottomRight:`${Ue}-bottom-right`,alignTopCenter:`${re}--aligned-top-center`,alignBottomCenter:`${re}--aligned-bottom-center`,alignTopLeft:`${re}--aligned-top-left`,alignBottomLeft:`${re}--aligned-bottom-left`,alignTopRight:`${re}--aligned-top-right`,alignBottomRight:`${re}--aligned-bottom-right`,pointer:`${re}__pointer`,pointerDirection:`${re}__pointer-direction`};var zi=class extends vt{constructor(e){super(e)}};zi=n([b("esri.widgets.Popup.PopupViewModel")],zi);var Wi=zi;var _e=class extends U{constructor(){super(...arguments),this.actionBar=!0,this.closeButton=!0,this.collapseButton=!0,this.featureNavigation=!0,this.featureListLayerTitle=!0,this.heading=!0,this.spinner=!0}};n([a({type:Boolean,nonNullable:!0})],_e.prototype,"actionBar",void 0),n([a({type:Boolean,nonNullable:!0})],_e.prototype,"closeButton",void 0),n([a({type:Boolean,nonNullable:!0})],_e.prototype,"collapseButton",void 0),n([a({type:Boolean,nonNullable:!0})],_e.prototype,"featureNavigation",void 0),n([a({type:Boolean,nonNullable:!0})],_e.prototype,"featureListLayerTitle",void 0),n([a({type:Boolean,nonNullable:!0})],_e.prototype,"heading",void 0),n([a({type:Boolean,nonNullable:!0})],_e.prototype,"spinner",void 0),_e=n([b("esri.widgets.Popup.PopupVisibleElements")],_e);var Yt=_e;var No={buttonEnabled:!0,position:"auto",breakpoint:{width:544}},E=class extends V{constructor(e,t){super(e,t),this._dockAction=new Ve({id:"popup-dock-action"}),this._featuresWidget=new Po({responsiveActionsEnabled:!0}),this._containerNode=null,this._mainContainerNode=null,this._pointerOffsetInPx=16,this.alignment="auto",this.dockEnabled=!1,this.headingLevel=2,this.messages=null,this.viewModel=new Wi,this.visibleElements=new Yt}initialize(){this.addHandles([f(()=>[this.viewModel?.view?.widthBreakpoint,this.dockEnabled],()=>this._handleDockIcon(),I),f(()=>[this.dockEnabled,this.messages?.undock,this.messages?.dock],()=>this._handleDockEnabled(),I),f(()=>this.dockOptions,e=>{let{_dockAction:t}=this,i=this._featuresWidget.headerActions;i.remove(t),e.buttonEnabled&&i.add(t)},I),f(()=>this.viewModel?.screenLocation,()=>this._positionContainer()),f(()=>[this.viewModel?.active,this.dockEnabled],()=>this._toggleScreenLocationEnabled()),f(()=>[this.viewModel?.screenLocation,this.viewModel?.view?.padding,this.viewModel?.view?.size,this.viewModel?.active,this.viewModel?.location,this.alignment],()=>this.reposition()),f(()=>this.viewModel?.view?.size,(e,t)=>this._updateDockEnabledForViewSize(e,t)),f(()=>this.viewModel?.view,(e,t)=>this._viewChange(e,t)),f(()=>this.viewModel?.view?.ready,(e,t)=>this._viewReadyChange(e??!1,t??!1)),f(()=>this.viewModel,()=>this._featuresWidget.viewModel=this.viewModel,I),f(()=>this._featureNavigationTop,e=>this._featuresWidget.featureNavigationTop=e,I),f(()=>this.headingLevel,e=>this._featuresWidget.headingLevel=e,I),f(()=>this.visibleElements.actionBar,e=>this._featuresWidget.visibleElements.actionBar=!!e,I),f(()=>this.visibleElements.closeButton,e=>this._featuresWidget.visibleElements.closeButton=!!e,I),f(()=>this.visibleElements.collapseButton,e=>this._featuresWidget.visibleElements.collapseButton=!!e,I),f(()=>this.visibleElements.heading,e=>this._featuresWidget.visibleElements.heading=!!e,I),f(()=>this.visibleElements.spinner,e=>this._featuresWidget.visibleElements.spinner=!!e,I),f(()=>this.visibleElements.featureNavigation,e=>this._featuresWidget.visibleElements.featureNavigation=!!e,I),f(()=>this.visibleElements.featureListLayerTitle,e=>this._featuresWidget.visibleElements.featureListLayerTitle=!!e,I),oe(()=>this._featuresWidget,"trigger-header-action",e=>{e.action===this._dockAction&&(this.dockEnabled=!this.dockEnabled)})])}normalizeCtorArgs(e){let t=_({},e);return e?.visibleElements!=null&&(t.visibleElements=new Yt(e.visibleElements),e.collapseEnabled!=null&&(t.visibleElements.collapseButton=e.collapseEnabled),e.spinnerEnabled!=null&&(t.visibleElements.spinner=e.spinnerEnabled)),t}destroy(){this._dockAction.destroy(),this._featuresWidget?.destroy()}get _featureNavigationTop(){let{currentAlignment:e,currentDockPosition:t}=this;return e==="bottom-left"||e==="bottom-center"||e==="bottom-right"||t==="top-left"||t==="top-center"||t==="top-right"}get actions(){return this.viewModel.actions}set actions(e){this.viewModel.actions=e}get active(){return this.viewModel.active}get autoCloseEnabled(){return this.viewModel.autoCloseEnabled}set autoCloseEnabled(e){this.viewModel.autoCloseEnabled=e}get defaultPopupTemplateEnabled(){return this.viewModel.defaultPopupTemplateEnabled}set defaultPopupTemplateEnabled(e){this.viewModel.defaultPopupTemplateEnabled=e}get content(){return this.viewModel.content}set content(e){this.viewModel.content=e}get collapsed(){return this._featuresWidget.collapsed}set collapsed(e){this._featuresWidget.collapsed=e}get collapseEnabled(){return rt(S.getLogger(this),"collapseEnabled",{replacement:"PopupVisibleElements.collapseButton",version:"4.29"}),this.visibleElements.collapseButton}set collapseEnabled(e){rt(S.getLogger(this),"collapseEnabled",{replacement:"PopupVisibleElements.collapseButton",version:"4.29"}),this.visibleElements.collapseButton=e}get currentAlignment(){return this._getCurrentAlignment()}get currentDockPosition(){return this._getCurrentDockPosition()}get dockOptions(){return this._get("dockOptions")||No}set dockOptions(e){let t=_({},No),i=this.viewModel?.view?.breakpoints,r={};i&&(r.width=i.xsmall,r.height=i.xsmall);let s=_(_({},t),e),o=_(_({},t.breakpoint),r),{breakpoint:l}=s;typeof l=="object"?s.breakpoint=_(_({},o),l):l&&(s.breakpoint=o),this._set("dockOptions",s),this._setCurrentDockPosition(),this.reposition()}get featureCount(){return this.viewModel.featureCount}get featureMenuOpen(){return this.viewModel.featureMenuOpen}set featureMenuOpen(e){this.viewModel.featureMenuOpen=e}get features(){return this.viewModel.features}set features(e){this.viewModel.features=e}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(e){this.viewModel.goToOverride=e}get highlightEnabled(){return this.viewModel.highlightEnabled}set highlightEnabled(e){this.viewModel.highlightEnabled=e}get icon(){return"popup"}set icon(e){this._overrideIfSome("icon",e)}get location(){return this.viewModel.location}set location(e){this.viewModel.location=e}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get promises(){return this.viewModel.promises}set promises(e){this.viewModel.promises=e}get selectedFeature(){return this.viewModel.selectedFeature}get selectedFeatureIndex(){return this.viewModel.selectedFeatureIndex}set selectedFeatureIndex(e){this.viewModel.selectedFeatureIndex=e}get selectedFeatureWidget(){return this._featuresWidget.selectedFeatureWidget}get spinnerEnabled(){return rt(S.getLogger(this),"spinnerEnabled",{replacement:"PopupVisibleElements.spinner",version:"4.29"}),this.visibleElements.spinner}set spinnerEnabled(e){rt(S.getLogger(this),"spinnerEnabled",{replacement:"PopupVisibleElements.spinner",version:"4.29"}),this.visibleElements.spinner=e}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}get updateLocationEnabled(){return this.viewModel.updateLocationEnabled}set updateLocationEnabled(e){this.viewModel.updateLocationEnabled=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}get visible(){return this.viewModel.visible}set visible(e){this.viewModel.visible=e}blur(){let{active:e}=this.viewModel;e||S.getLogger(this).warn("Popup can only be blurred when currently active."),this._featuresWidget.blur()}clear(){return this.viewModel.clear()}close(){this.visible=!1}fetchFeatures(e,t){return this.viewModel.fetchFeatures(e,t)}focus(){let{active:e}=this.viewModel;e||S.getLogger(this).warn("Popup can only be focused when currently active."),this.reposition(),requestAnimationFrame(()=>{this._featuresWidget.focus()})}next(){return this.viewModel.next()}open(e){let t=!!e&&!!e.featureMenuOpen,i={collapsed:!!e&&!!e.collapsed,featureMenuOpen:t};this.set(i),this.viewModel.open(e),this._shouldFocus(e)}previous(){return this.viewModel.previous()}reposition(){this.renderNow(),this._positionContainer(),this._setCurrentAlignment()}triggerAction(e){return this.viewModel.triggerAction(e)}render(){let{dockEnabled:e,currentAlignment:t,currentDockPosition:i}=this,{active:r,screenLocation:s}=this.viewModel,o=r&&e,l=r&&!e,d=this.selectedFeature?.layer?.title,u=this.selectedFeature?.layer?.id,p={[D.alignTopCenter]:t==="top-center",[D.alignBottomCenter]:t==="bottom-center",[D.alignTopLeft]:t==="top-left",[D.alignBottomLeft]:t==="bottom-left",[D.alignTopRight]:t==="top-right",[D.alignBottomRight]:t==="bottom-right",[D.isDocked]:o,[D.shadow]:l,[D.isDockedTopLeft]:i==="top-left",[D.isDockedTopCenter]:i==="top-center",[D.isDockedTopRight]:i==="top-right",[D.isDockedBottomLeft]:i==="bottom-left",[D.isDockedBottomCenter]:i==="bottom-center",[D.isDockedBottomRight]:i==="bottom-right"};return c("div",{afterCreate:this._positionContainer,afterUpdate:this._positionContainer,bind:this,class:this.classes(D.base,p,{[D.baseHidden]:!s&&!e}),"data-layer-id":u,"data-layer-title":d,role:"presentation"},r?[this._renderMainContainer(),this._renderPointer()]:null)}_renderPointer(){return this.dockEnabled?null:c("div",{class:D.pointer,key:"popup-pointer",role:"presentation"},c("div",{class:this.classes(D.pointerDirection,D.shadow)}))}_renderMainContainer(){let{dockEnabled:e}=this,t={[D.shadow]:e};return c("div",{afterCreate:this._setMainContainerNode,afterUpdate:this._setMainContainerNode,bind:this,class:this.classes(D.main,M.widget,t)},this._featuresWidget.render())}_shouldFocus(e){return g(this,null,function*(){e?.shouldFocus&&(yield Ki(()=>this.viewModel?.active===!0),this.focus())})}_isOutsideView(e){let{popupHeight:t,popupWidth:i,screenLocation:r,side:s,view:o}=e;if(isNaN(i)||isNaN(t)||!o||!r)return!1;let l=o.padding;return s==="right"&&r.x+i/2>o.width-l.right||s==="left"&&r.x-i/2<l.left||s==="top"&&r.y-t<l.top||s==="bottom"&&r.y+t>o.height-l.bottom}_calculateAutoAlignment(e){if(e!=="auto")return e;let{_pointerOffsetInPx:t,_containerNode:i,_mainContainerNode:r,viewModel:s}=this,{screenLocation:o,view:l}=s;if(o==null||!l||!i)return"top-center";function d($){return parseInt($.replaceAll(/[^-\d.]/g,""),10)}let u=r?window.getComputedStyle(r,null):null,p=u?d(u.getPropertyValue("max-height")):0,h=u?d(u.getPropertyValue("height")):0,{height:m,width:v}=i.getBoundingClientRect(),y=v+t,w=Math.max(m,p,h)+t,T=this._isOutsideView({popupHeight:w,popupWidth:y,screenLocation:o,side:"right",view:l}),R=this._isOutsideView({popupHeight:w,popupWidth:y,screenLocation:o,side:"left",view:l}),A=this._isOutsideView({popupHeight:w,popupWidth:y,screenLocation:o,side:"top",view:l}),N=this._isOutsideView({popupHeight:w,popupWidth:y,screenLocation:o,side:"bottom",view:l});return R?A?"bottom-right":"top-right":T?A?"bottom-left":"top-left":A?N?"top-center":"bottom-center":"top-center"}_callCurrentAlignment(e){return typeof e=="function"?e.call(this):e}_getCurrentAlignment(){let{alignment:e,dockEnabled:t}=this;return t||!this.viewModel.active?null:this._calculatePositionResult(this._calculateAutoAlignment(this._callCurrentAlignment(e)))}_setCurrentAlignment(){this._set("currentAlignment",this._getCurrentAlignment())}_setCurrentDockPosition(){this._set("currentDockPosition",this._getCurrentDockPosition())}_calculatePositionResult(e){let t=["left","right"];return de(this.container)&&t.reverse(),e?.replace(/leading/gi,t[0]).replaceAll(/trailing/gi,t[1])}_callDockPosition(e){return typeof e=="function"?e.call(this):e}_getDockPosition(){return this._calculatePositionResult(this._calculateAutoDockPosition(this._callDockPosition(this.dockOptions?.position)))}_getCurrentDockPosition(){return this.dockEnabled&&this.viewModel.active?this._getDockPosition():null}_calculateAutoDockPosition(e){if(e!=="auto")return e;let t=this.viewModel?.view,i=de(this.container)?"top-left":"top-right";if(!t)return i;let r=t.padding||{left:0,right:0,top:0,bottom:0},s=t.width-r.left-r.right,{breakpoints:o}=t;return o&&s<=o.xsmall?"bottom-center":i}_getDockIcon(){let e=this._getDockPosition();if(this.dockEnabled)return"minimize";switch(e){case"top-left":case"bottom-left":return"dock-left";case"top-center":return"maximize";case"bottom-center":return"dock-bottom";default:return"dock-right"}}_handleDockIcon(){this._dockAction.icon=this._getDockIcon()}_handleDockEnabled(){this._dockAction.title=this.dockEnabled?this.messages?.undock:this.messages?.dock}_setMainContainerNode(e){this._mainContainerNode=e}_positionContainer(e=this._containerNode){if(e&&(this._containerNode=e),!this._containerNode)return;let{screenLocation:t}=this.viewModel,{width:i}=this._containerNode.getBoundingClientRect(),r=this._calculatePositionStyle(t,i);r&&Object.assign(this._containerNode.style,r)}_calculateFullWidth(e){let{currentAlignment:t,_pointerOffsetInPx:i}=this;return t==="top-left"||t==="bottom-left"||t==="top-right"||t==="bottom-right"?e+i:e}_calculateAlignmentPosition(e,t,i,r){let{currentAlignment:s,_pointerOffsetInPx:o}=this;if(!i)return;let{padding:l}=i,d=r/2,u=i.height-t,p=i.width-e;return s==="bottom-center"?{top:t+o-l.top,left:e-d-l.left}:s==="top-left"?{bottom:u+o-l.bottom,right:p+o-l.right}:s==="bottom-left"?{top:t+o-l.top,right:p+o-l.right}:s==="top-right"?{bottom:u+o-l.bottom,left:e+o-l.left}:s==="bottom-right"?{top:t+o-l.top,left:e+o-l.left}:s==="top-center"?{bottom:u+o-l.bottom,left:e-d-l.left}:void 0}_calculatePositionStyle(e,t){let{dockEnabled:i,view:r}=this;if(!r)return;if(i)return{left:"",top:"",right:"",bottom:""};if(e==null||!t)return;let s=this._calculateFullWidth(t),o=this._calculateAlignmentPosition(e.x,e.y,r,s);return o?{top:o.top!==void 0?`${o.top}px`:"auto",left:o.left!==void 0?`${o.left}px`:"auto",bottom:o.bottom!==void 0?`${o.bottom}px`:"auto",right:o.right!==void 0?`${o.right}px`:"auto"}:void 0}_viewChange(e,t){e&&t&&(this.close(),this.clear())}_viewReadyChange(e,t){e?this._wireUpView():t&&(this.close(),this.clear())}_wireUpView(){this._setDockEnabledForViewSize(this.dockOptions)}_dockingThresholdCrossed(e,t,i){let[r,s]=e,[o,l]=t,{width:d=0,height:u=0}=i??{};return r<=d&&o>d||r>d&&o<=d||s<=u&&l>u||s>u&&l<=u}_updateDockEnabledForViewSize(e,t){if(!e||!t)return;let i=this.viewModel?.view?.padding||{left:0,right:0,top:0,bottom:0},r=i.left+i.right,s=i.top+i.bottom,o=[],l=[];o[0]=e[0]-r,o[1]=e[1]-s,l[0]=t[0]-r,l[1]=t[1]-s;let{dockOptions:d}=this,u=d.breakpoint;this._dockingThresholdCrossed(o,l,u)&&this._setDockEnabledForViewSize(d),this._setCurrentDockPosition()}_toggleScreenLocationEnabled(){let{dockEnabled:e,viewModel:t}=this;if(!t)return;let i=t.active&&!e;t.screenLocationEnabled=i}_shouldDockAtCurrentViewSize(e){let t=e.breakpoint,i=this.viewModel?.view?.ui;if(!i)return!1;let{width:r,height:s}=i;if(isNaN(r)||isNaN(s)||!t)return!1;let o=t.hasOwnProperty("width")&&r<=(t.width??0),l=t.hasOwnProperty("height")&&s<=(t.height??0);return o||l}_setDockEnabledForViewSize(e){e.breakpoint&&(this.dockEnabled=this._shouldDockAtCurrentViewSize(e))}};n([a({readOnly:!0})],E.prototype,"_featureNavigationTop",null),n([a()],E.prototype,"actions",null),n([a({readOnly:!0})],E.prototype,"active",null),n([a()],E.prototype,"alignment",void 0),n([a()],E.prototype,"autoCloseEnabled",null),n([a()],E.prototype,"defaultPopupTemplateEnabled",null),n([a()],E.prototype,"content",null),n([a()],E.prototype,"collapsed",null),n([a()],E.prototype,"collapseEnabled",null),n([a({readOnly:!0})],E.prototype,"currentAlignment",null),n([a({readOnly:!0})],E.prototype,"currentDockPosition",null),n([a()],E.prototype,"dockOptions",null),n([a()],E.prototype,"dockEnabled",void 0),n([a({readOnly:!0})],E.prototype,"featureCount",null),n([a()],E.prototype,"featureMenuOpen",null),n([a()],E.prototype,"features",null),n([a()],E.prototype,"goToOverride",null),n([a()],E.prototype,"headingLevel",void 0),n([a()],E.prototype,"highlightEnabled",null),n([a()],E.prototype,"icon",null),n([a()],E.prototype,"location",null),n([a()],E.prototype,"label",null),n([a(),q("esri/widgets/Popup/t9n/Popup")],E.prototype,"messages",void 0),n([a()],E.prototype,"promises",null),n([a({readOnly:!0})],E.prototype,"selectedFeature",null),n([a()],E.prototype,"selectedFeatureIndex",null),n([a({readOnly:!0})],E.prototype,"selectedFeatureWidget",null),n([a()],E.prototype,"spinnerEnabled",null),n([a()],E.prototype,"title",null),n([a()],E.prototype,"updateLocationEnabled",null),n([a()],E.prototype,"view",null),n([a({type:Wi}),Tt(["triggerAction","trigger-action"])],E.prototype,"viewModel",void 0),n([a()],E.prototype,"visible",null),n([a({type:Yt,nonNullable:!0})],E.prototype,"visibleElements",void 0),E=n([b("esri.widgets.Popup")],E);var _y=E;export{_y as default};
