import{a as Y}from"./chunk-XBCADXRU.js";import{a as xe}from"./chunk-6YNGFTDW.js";import{a as Se}from"./chunk-I6FBO5KL.js";import{a as B,b as q,c as V,d as Ne,e as M,f as v,g as Le,h as Ce,i as $e,j as Pe,l as Ze,m as ee,n as Re,o as Ue,r as Me,s as le}from"./chunk-ANMYXKZE.js";import"./chunk-V4Y5M4BK.js";import{o as oe,t as ve}from"./chunk-DFEIUFQN.js";import{a as Ae}from"./chunk-TUPKV4BV.js";import{c as P}from"./chunk-C3UHYQBM.js";import{$ as _,Da as be,Na as se,Q as K,R as Ie,T as L,V as $,Y as De,_ as S,aa as N,b as d,c as m,ca as ie,ea as U,fa as re,ga as J,ha as Te,ja as b,oa as A,q as Q,ra as O,sa as Ee,ta as z}from"./chunk-FXWBXMPB.js";import{a as ge}from"./chunk-OCNYIIP3.js";import"./chunk-RMJ37HEO.js";import"./chunk-HUD2IWHR.js";import"./chunk-LXPXZB5U.js";import"./chunk-ZAKRS4NA.js";import{a as X}from"./chunk-RXT7IR37.js";import"./chunk-7DQXDTLA.js";import"./chunk-GK4CPRU2.js";import"./chunk-PZ6UKR7S.js";import"./chunk-UBPTWFJG.js";import"./chunk-DAEAGXUL.js";import"./chunk-TGYRM66E.js";import"./chunk-FJJ2HK4Z.js";import"./chunk-7T6KH2Z6.js";import"./chunk-OH74MGAF.js";import"./chunk-KWPJ7W7D.js";import"./chunk-RIDPE7TS.js";import"./chunk-RZU6EEB3.js";import"./chunk-CIY4UOGB.js";import"./chunk-22VKLLNJ.js";import"./chunk-B4G6EV5H.js";import"./chunk-Y353ORYJ.js";import"./chunk-HRSAZUEG.js";import"./chunk-LQKHYKYR.js";import"./chunk-OTCE2CL6.js";import"./chunk-A32YL34U.js";import"./chunk-53GUVE7Z.js";import"./chunk-UTTIMDT4.js";import"./chunk-LAZNO6VW.js";import"./chunk-KFCU4KQY.js";import"./chunk-WNOBQY3K.js";import"./chunk-QS6RCA6Y.js";import"./chunk-WDTJILD4.js";import"./chunk-6NTMQUAJ.js";import"./chunk-APGKXN3F.js";import"./chunk-PHCUTV4M.js";import"./chunk-7C77LBCZ.js";import"./chunk-LK52GLIE.js";import"./chunk-GHKFJTCN.js";import"./chunk-IZF35GKA.js";import"./chunk-KS53OQGV.js";import"./chunk-EB5RRWIA.js";import"./chunk-RWIKH4KN.js";import"./chunk-TH7OTU7Q.js";import"./chunk-MP46524Y.js";import"./chunk-WA64AKK6.js";import"./chunk-UKVDWQFD.js";import"./chunk-CYT6KIBU.js";import"./chunk-UH6DTPOD.js";import"./chunk-N3BNSVOS.js";import"./chunk-XCJPZZY7.js";import"./chunk-Y2F4CIGY.js";import"./chunk-4DVY2TZI.js";import"./chunk-BPPBSQ5N.js";import"./chunk-2B3PG2ZT.js";import"./chunk-SYTNPSW4.js";import"./chunk-2AAD7VYB.js";import"./chunk-7TBWQ2OA.js";import"./chunk-3PKDQQMT.js";import"./chunk-DVSFGYL7.js";import"./chunk-FALMC3VB.js";import"./chunk-65ILPZGY.js";import"./chunk-COOG77AU.js";import"./chunk-7EQBH2NW.js";import"./chunk-SH6QBC5R.js";import"./chunk-3JO3IXGW.js";import"./chunk-U436ZYW5.js";import"./chunk-DACZ4LLK.js";import"./chunk-2EOPE46E.js";import"./chunk-2UGJ72JG.js";import"./chunk-LWI2RQ66.js";import"./chunk-LOEAA5XF.js";import"./chunk-MAPO7YGF.js";import"./chunk-OLIJD5I4.js";import"./chunk-OOE2LCNP.js";import"./chunk-I3S324BU.js";import"./chunk-ESBNO4XM.js";import"./chunk-3A7OIH4J.js";import"./chunk-RMS5474O.js";import"./chunk-2SHNUN5D.js";import"./chunk-IFCRPPYQ.js";import"./chunk-GYYF3HMQ.js";import"./chunk-FDQ4JKC5.js";import"./chunk-NAV5L5PJ.js";import"./chunk-J4HNE4D3.js";import"./chunk-MXSUS5HK.js";import"./chunk-IM7ZT3FY.js";import"./chunk-EK4W5QYS.js";import"./chunk-DDZ3KR2Q.js";import"./chunk-DKSAM23M.js";import"./chunk-SPJDFBYB.js";import"./chunk-4R5DT3TR.js";import"./chunk-NVBPDYQT.js";import{c as H}from"./chunk-WMT47BMV.js";import"./chunk-PJQZD5QI.js";import"./chunk-IEUNGS56.js";import"./chunk-6KRFVLII.js";import"./chunk-SPAOTNUK.js";import"./chunk-JHZRGEBS.js";import"./chunk-RQQJT345.js";import"./chunk-27SQOLVY.js";import"./chunk-6QNRNEQJ.js";import"./chunk-UHE637ZN.js";import"./chunk-7QY3BMVN.js";import"./chunk-NWPYI2UP.js";import"./chunk-TNPL7MIN.js";import"./chunk-UYBHUOFR.js";import"./chunk-BYQI7UDX.js";import"./chunk-A6I6D7FN.js";import{f as D}from"./chunk-HW25OXMH.js";import{a as Fe}from"./chunk-IBDPR46F.js";import"./chunk-BES4JRIO.js";import"./chunk-SSGUIPHM.js";import"./chunk-7WFRJSY3.js";import"./chunk-PSQRUING.js";import"./chunk-DFTBSFIN.js";import"./chunk-3JLZ7SFH.js";import"./chunk-FUBITVJ7.js";import"./chunk-VOH7XGOR.js";import"./chunk-Y6HWUWZ3.js";import"./chunk-AQ74ANSJ.js";import"./chunk-5UCI4TUX.js";import"./chunk-SAOUSUZE.js";import"./chunk-PPFMRTTD.js";import"./chunk-IWJQ3PU6.js";import"./chunk-Z5Q76SB7.js";import"./chunk-TTN7UOJS.js";import"./chunk-5QLB7ZJ7.js";import"./chunk-E5R4OI7X.js";import"./chunk-N566L3JG.js";import{c as fe}from"./chunk-7S6PD5JC.js";import"./chunk-ZWI7LLTZ.js";import"./chunk-6NCXSKJD.js";import"./chunk-ATXTHXJA.js";import"./chunk-VFINLX57.js";import"./chunk-LM5MGO7W.js";import"./chunk-4HUAEW4D.js";import"./chunk-XWRPBDYS.js";import"./chunk-TCCAOREC.js";import"./chunk-BCREO4Q5.js";import"./chunk-SO6OJFOM.js";import"./chunk-DG5QI6E2.js";import"./chunk-TMZNSBQB.js";import"./chunk-ZGLJFDS6.js";import"./chunk-RSDQHAJX.js";import"./chunk-OFVMJORF.js";import"./chunk-V2KSICSA.js";import"./chunk-2FYXACXP.js";import"./chunk-XGVKSCMM.js";import"./chunk-FX2VBPAM.js";import"./chunk-K4GPNFIS.js";import"./chunk-RP7XSKHE.js";import"./chunk-VV7MGXTC.js";import"./chunk-IXNVQC76.js";import"./chunk-LYPZUCFI.js";import"./chunk-QYC4ILGT.js";import"./chunk-HFQFGALU.js";import"./chunk-5TSEU5EE.js";import"./chunk-VC35VCVT.js";import"./chunk-MT7BXRRQ.js";import"./chunk-NNKLK2DS.js";import"./chunk-VU5W7W6Y.js";import"./chunk-BRGZVJPZ.js";import"./chunk-Z5NXR7SL.js";import"./chunk-7JLWSSXP.js";import"./chunk-W3WDPWBE.js";import{w as he}from"./chunk-JKP4I6UL.js";import"./chunk-TZHKPIVH.js";import"./chunk-JPDAKIWT.js";import"./chunk-W6LY37E4.js";import"./chunk-BRWS572J.js";import"./chunk-AKNRR36C.js";import{g as x}from"./chunk-JEGVIFEP.js";function We(r){if(r.length===1){if(S(r[0]))return Y("distinct",r[0],-1);if(U(r[0]))return Y("distinct",r[0].toArray(),-1)}return Y("distinct",r,-1)}function ue(r,n,a){return x(this,null,function*(){let y=r.getVariables();if(y.length>0){let I=[];for(let t=0;t<y.length;t++){let s={name:y[t]};I.push(yield n.evaluateIdentifier(a,s))}let e={};for(let t=0;t<y.length;t++)e[y[t]]=I[t];return r.parameters=e,r}return r})}function c(r,n,a=null){for(let y in r)if(y.toLowerCase()===n.toLowerCase())return r[y];return a}function ke(r){if(r===null)return null;let n={type:c(r,"type",""),name:c(r,"name","")};if(n.type==="range")n.range=c(r,"range",[]);else{n.codedValues=[];for(let a of c(r,"codedValues",[]))n.codedValues.push({name:c(a,"name",""),code:c(a,"code",null)})}return n}function ce(r){if(r===null)return null;let n={},a=c(r,"wkt");a!==null&&(n.wkt=a);let y=c(r,"wkid");return y!==null&&(n.wkid=y),n}function Oe(r){if(r===null)return null;let n={hasZ:c(r,"hasz",!1),hasM:c(r,"hasm",!1)},a=c(r,"spatialreference");a!=null&&(n.spatialReference=ce(a));let y=c(r,"x",null);if(y!==null)return n.x=y,n.y=c(r,"y",null),n.hasZ&&(n.z=c(r,"z",null)),n.hasM&&(n.m=c(r,"m",null)),n;let I=c(r,"rings",null);if(I!==null)return n.rings=I,n;let e=c(r,"paths",null);if(e!==null)return n.paths=e,n;let t=c(r,"points",null);if(t!==null)return n.points=t,n;for(let s of["xmin","xmax","ymin","ymax","zmin","zmax","mmin","mmax"]){let l=c(r,s,null);l!==null&&(n[s]=l)}return n}function je(r,n){for(let a of n)if(a===r)return!0;return!1}function Ge(r){return!!r.layerDefinition&&!!r.featureSet&&je(r.layerDefinition.geometryType,["",null,"esriGeometryNull","esriGeometryPoint","esriGeometryPolyline","esriGeometryPolygon","esriGeometryMultipoint","esriGeometryEnvelope"])!==!1&&S(r.layerDefinition.fields)!==!1&&S(r.featureSet.features)!==!1}function W(r){return r?.toLowerCase()==="utc"?"UTC":r?.toLowerCase()==="unknown"?"Unknown":r}function wn(r){r.mode==="async"&&(r.functions.timezone=function(n,a){return r.standardFunctionAsync(n,a,(y,I,e)=>x(this,null,function*(){if(b(e,1,2,n,a),Te(e[0])||J(e[0]))return"Unknown";if(N(e[0])){if(yield e[0].load(),e.length===1||e[1]===null)return e[0].datesInUnknownTimezone?W("unknown"):W(e[0].dateFieldsTimeZone);if(!(e[1]instanceof P)||e[1].hasField("type")===!1)throw new m(n,d.InvalidParameter,a);let l=e[1].field("type");if($(l)===!1)throw new m(n,d.InvalidParameter,a);switch(A(l).toLowerCase()){case"preferredtimezone":return W(e[0].preferredTimeZone);case"editfieldsinfo":return W(e[0].editFieldsInfo?.timeZone??null);case"timeinfo":return W(e[0].timeInfo?.timeZone??null);case"field":if(e[1].hasField("fieldname")&&$(e[1].field("fieldname")))return W(e[0].fieldTimeZone(A(e[1].field("fieldname"))))}throw new m(n,d.InvalidParameter,a)}let t=Ee(e[0],se(n));if(t===null)return null;let s=t.timeZone;return s==="system"?Fe.systemTimeZoneCanonicalName:s.toLowerCase()==="utc"?"UTC":s.toLowerCase()==="unknown"?"Unknown":s}))},r.functions.sqltimestamp=function(n,a){return r.standardFunctionAsync(n,a,(y,I,e)=>x(this,null,function*(){b(e,1,3,n,a);let t=e[0];if(re(t)){if(e.length===1)return t.toSQLWithKeyword();if(e.length===2)return t.changeTimeZone(A(e[1])).toSQLWithKeyword();throw new m(n,d.InvalidParameter,a)}if(J(t))return t.toSQLWithKeyword();if(N(t)){if(e.length!==3)throw new m(n,d.InvalidParameter,a);yield t.load();let s=A(e[1]);if(J(e[2]))return e[2].toSQLWithKeyword();if(re(e[2])===!1)throw new m(n,d.InvalidParameter,a);let l=t.fieldTimeZone(s);return l===null?e[2].toSQLWithKeyword():e[2].changeTimeZone(l).toSQLWithKeyword()}throw new m(n,d.InvalidParameter,a)}))},r.signatures.push({name:"sqltimestamp",min:2,max:4}),r.functions.featuresetbyid=function(n,a){return r.standardFunctionAsync(n,a,(y,I,e)=>{if(b(e,2,4,n,a),ie(e[0])){let t=A(e[1]),s=L(e[2],null),l=z(L(e[3],!0));if(s===null&&(s=["*"]),S(s)===!1)throw new m(n,d.InvalidParameter,a);return e[0].featureSetById(t,l,s)}throw new m(n,d.InvalidParameter,a)})},r.signatures.push({name:"featuresetbyid",min:2,max:4}),r.functions.getfeatureset=function(n,a){return r.standardFunctionAsync(n,a,(y,I,e)=>x(this,null,function*(){if(b(e,1,2,n,a),_(e[0])){let t=L(e[1],"datasource");return t===null&&(t="datasource"),t=A(t).toLowerCase(),Me(e[0].fullSchema(),t,n.lrucache,n.interceptor,n.spatialReference??null)}throw new m(n,d.InvalidParameter,a)}))},r.signatures.push({name:"getfeatureset",min:1,max:2}),r.functions.featuresetbyportalitem=function(n,a){return r.standardFunctionAsync(n,a,(y,I,e)=>{if(b(e,2,5,n,a),e[0]===null)throw new m(n,d.PortalRequired,a);if(e[0]instanceof Se){let f=A(e[1]),i=A(e[2]),o=L(e[3],null),u=z(L(e[4],!0));if(o===null&&(o=["*"]),S(o)===!1)throw new m(n,d.InvalidParameter,a);let w;return w=n.services?.portal?n.services.portal:fe.getDefault(),w=xe(e[0],w),le(f,i,n.spatialReference??null,o,u,w,n.lrucache,n.interceptor)}if($(e[0])===!1)throw new m(n,d.PortalRequired,a);let t=A(e[0]),s=A(e[1]),l=L(e[2],null),p=z(L(e[3],!0));if(l===null&&(l=["*"]),S(l)===!1)throw new m(n,d.InvalidParameter,a);return le(t,s,n.spatialReference??null,l,p,n.services?.portal??fe.getDefault(),n.lrucache,n.interceptor)})},r.signatures.push({name:"featuresetbyportalitem",min:2,max:5}),r.functions.featuresetbyname=function(n,a){return r.standardFunctionAsync(n,a,(y,I,e)=>{if(b(e,2,4,n,a),ie(e[0])){let t=A(e[1]),s=L(e[2],null),l=z(L(e[3],!0));if(s===null&&(s=["*"]),S(s)===!1)throw new m(n,d.InvalidParameter,a);return e[0].featureSetByName(t,l,s)}throw new m(n,d.InvalidParameter,a)})},r.signatures.push({name:"featuresetbyname",min:2,max:4}),r.functions.featureset=function(n,a){return r.standardFunction(n,a,(y,I,e)=>{b(e,1,1,n,a);let t={layerDefinition:{geometryType:"",objectIdField:"",globalIdField:"",typeIdField:"",hasM:!1,hasZ:!1,fields:[]},featureSet:{geometryType:"",features:[]}};if($(e[0])){let s=JSON.parse(e[0]);s.layerDefinition!==void 0?(t.layerDefinition=s.layerDefinition,t.featureSet=s.featureSet,s.layerDefinition.spatialReference&&(t.layerDefinition.spatialReference=s.layerDefinition.spatialReference)):(t.featureSet.features=s.features,t.featureSet.geometryType=s.geometryType,t.layerDefinition.geometryType=t.featureSet.geometryType,t.layerDefinition.objectIdField=s.objectIdFieldName??"",t.layerDefinition.typeIdField=s.typeIdFieldName,t.layerDefinition.globalIdField=s.globalIdFieldName,t.layerDefinition.fields=s.fields,s.spatialReference&&(t.layerDefinition.spatialReference=s.spatialReference))}else{if(!(e[0]instanceof P))throw new m(n,d.InvalidParameter,a);{let s=JSON.parse(e[0].castToText(!0)),l=c(s,"layerdefinition");if(l!==null){t.layerDefinition.geometryType=c(l,"geometrytype",""),t.featureSet.geometryType=t.layerDefinition.geometryType,t.layerDefinition.globalIdField=c(l,"globalidfield",""),t.layerDefinition.objectIdField=c(l,"objectidfield",""),t.layerDefinition.typeIdField=c(l,"typeidfield",""),t.layerDefinition.hasZ=c(l,"hasz",!1)===!0,t.layerDefinition.hasM=c(l,"hasm",!1)===!0;let p=c(l,"spatialreference");p&&(t.layerDefinition.spatialReference=ce(p));let f=[];for(let o of c(l,"fields",[])){let u={name:c(o,"name",""),alias:c(o,"alias",""),type:c(o,"type",""),nullable:c(o,"nullable",!0),editable:c(o,"editable",!0),length:c(o,"length",null),domain:ke(c(o,"domain"))};f.push(u)}t.layerDefinition.fields=f;let i=c(s,"featureset");if(i){let o={};for(let u of f)o[u.name.toLowerCase()]=u.name;for(let u of c(i,"features",[])){let w={},T=c(u,"attributes",{});for(let F in T)w[o[F.toLowerCase()]]=T[F];t.featureSet.features.push({attributes:w,geometry:Oe(c(u,"geometry"))})}}}else{t.layerDefinition.hasZ=c(s,"hasz",!1)===!0,t.layerDefinition.hasM=c(s,"hasm",!1)===!0,t.layerDefinition.geometryType=c(s,"geometrytype",""),t.featureSet.geometryType=t.layerDefinition.geometryType,t.layerDefinition.objectIdField=c(s,"objectidfieldname",""),t.layerDefinition.typeIdField=c(s,"typeidfieldname","");let p=c(s,"spatialreference");p&&(t.layerDefinition.spatialReference=ce(p));let f=[],i=c(s,"fields",null);if(!S(i))throw new m(n,d.InvalidParameter,a);for(let w of i){let T={name:c(w,"name",""),alias:c(w,"alias",""),type:c(w,"type",""),nullable:c(w,"nullable",!0),editable:c(w,"editable",!0),length:c(w,"length",null),domain:ke(c(w,"domain"))};f.push(T)}t.layerDefinition.fields=f;let o={};for(let w of f)o[w.name.toLowerCase()]=w.name;let u=c(s,"features",null);if(S(u))for(let w of u){let T={},F=c(w,"attributes",{});for(let E in F)T[o[E.toLowerCase()]]=F[E];t.featureSet.features.push({attributes:T,geometry:Oe(c(w,"geometry",null))})}else u=null,t.featureSet.features=u}}}if(Ge(t)===!1)throw new m(n,d.InvalidParameter,a);return t.layerDefinition.geometryType||(t.layerDefinition.geometryType="esriGeometryNull"),Pe.create(t,n.spatialReference)})},r.signatures.push({name:"featureset",min:1,max:1}),r.functions.filter=function(n,a){return r.standardFunctionAsync(n,a,(y,I,e)=>x(this,null,function*(){if(b(e,2,2,n,a),S(e[0])||U(e[0])){let t=[],s,l=e[0];if(l instanceof ge&&(l=l.toArray()),!Ie(e[1]))throw new m(n,d.InvalidParameter,a);s=e[1].createFunction(n);for(let p of l){let f=s(p);he(f)?(yield f)===!0&&t.push(p):f===!0&&t.push(p)}return t}if(N(e[0])){let t=yield e[0].load(),s=D.create(e[1],t.getFieldsIndex(),t.dateFieldsTimeZoneDefaultUTC),l=s.getVariables();if(l.length>0){let p=[];for(let i=0;i<l.length;i++){let o={name:l[i]};p.push(yield r.evaluateIdentifier(n,o))}let f={};for(let i=0;i<l.length;i++)f[l[i]]=p[i];return s.parameters=f,new B({parentfeatureset:e[0],whereclause:s})}return new B({parentfeatureset:e[0],whereclause:s})}throw new m(n,d.InvalidParameter,a)}))},r.signatures.push({name:"filter",min:2,max:2}),r.functions.orderby=function(n,a){return r.standardFunctionAsync(n,a,(y,I,e)=>x(this,null,function*(){if(b(e,2,2,n,a),N(e[0])){let t=new Le(e[1]);return new Ce({parentfeatureset:e[0],orderbyclause:t})}throw new m(n,d.InvalidParameter,a)}))},r.signatures.push({name:"orderby",min:2,max:2}),r.functions.top=function(n,a){return r.standardFunctionAsync(n,a,(y,I,e)=>x(this,null,function*(){if(b(e,2,2,n,a),N(e[0]))return new $e({parentfeatureset:e[0],topnum:e[1]});if(S(e[0]))return O(e[1])>=e[0].length?e[0].slice(0):e[0].slice(0,O(e[1]));if(U(e[0]))return O(e[1])>=e[0].length()?e[0].slice(0):e[0].slice(0,O(e[1]));throw new m(n,d.InvalidParameter,a)}))},r.signatures.push({name:"top",min:2,max:2}),r.functions.first=function(n,a){return r.standardFunctionAsync(n,a,(y,I,e)=>x(this,null,function*(){if(b(e,1,1,n,a),N(e[0])){let t=yield e[0].first(y.abortSignal);if(t!==null){let s=Ae.createFromGraphicLikeObject(t.geometry,t.attributes,e[0],n.timeZone);return s._underlyingGraphic=t,s}return t}return S(e[0])?e[0].length===0?null:e[0][0]:U(e[0])?e[0].length()===0?null:e[0].get(0):null}))},r.signatures.push({name:"first",min:1,max:1}),r.functions.attachments=function(n,a){return r.standardFunctionAsync(n,a,(y,I,e)=>x(this,null,function*(){b(e,1,2,n,a);let t={minsize:-1,maxsize:-1,types:null,returnMetadata:!1};if(e.length>1){if(e[1]instanceof P){if(e[1].hasField("minsize")&&(t.minsize=O(e[1].field("minsize"))),e[1].hasField("metadata")&&(t.returnMetadata=z(e[1].field("metadata"))),e[1].hasField("maxsize")&&(t.maxsize=O(e[1].field("maxsize"))),e[1].hasField("types")){let s=be(e[1].field("types"),!1);s.length>0&&(t.types=s)}}else if(e[1]!==null)throw new m(n,d.InvalidParameter,a)}if(_(e[0])){let s=e[0]._layer;return s instanceof X&&(s=ee(s,n.spatialReference,["*"],!0,n.lrucache,n.interceptor)),s===null?[]:N(s)===!1?[]:(yield s.load(),s.queryAttachments(e[0].field(s.objectIdField),t.minsize,t.maxsize,t.types,t.returnMetadata))}if(e[0]===null)return[];throw new m(n,d.InvalidParameter,a)}))},r.signatures.push({name:"attachments",min:1,max:2}),r.functions.featuresetbyrelationshipname=function(n,a){return r.standardFunctionAsync(n,a,(y,I,e)=>x(this,null,function*(){b(e,2,4,n,a);let t=e[0],s=A(e[1]),l=L(e[2],null),p=z(L(e[3],!0));if(l===null&&(l=["*"]),S(l)===!1)throw new m(n,d.InvalidParameter,a);if(e[0]===null)return null;if(!_(e[0]))throw new m(n,d.InvalidParameter,a);let f=t._layer;if(f instanceof X&&(f=ee(f,n.spatialReference,["*"],!0,n.lrucache,n.interceptor)),f===null||N(f)===!1)return null;f=yield f.load();let i=f.relationshipMetaData().filter(F=>F.name===s);if(i.length===0)return null;if(i[0].relationshipTableId!==void 0&&i[0].relationshipTableId!==null&&i[0].relationshipTableId>-1)return Ue(f,i[0],t.field(f.objectIdField),f.spatialReference,l,p,n.lrucache,n.interceptor);let o=f.serviceUrl();if(!o)return null;o=o.charAt(o.length-1)==="/"?o+i[0].relatedTableId.toString():o+"/"+i[0].relatedTableId.toString();let u=yield Ze(o,f.spatialReference,l,p,n.lrucache,n.interceptor);yield u.load();let w=u.relationshipMetaData();if(w=w.filter(F=>F.id===i[0].id),t.hasField(i[0].keyField)===!1||t.field(i[0].keyField)===null){let F=yield f.getFeatureByObjectId(t.field(f.objectIdField),[i[0].keyField]);if(F){let E=D.create(w[0].keyField+"= @id",u.getFieldsIndex(),u.dateFieldsTimeZoneDefaultUTC);return E.parameters={id:F.attributes[i[0].keyField]},u.filter(E)}return new ve({parentfeatureset:u})}let T=D.create(w[0].keyField+"= @id",u.getFieldsIndex(),u.dateFieldsTimeZoneDefaultUTC);return T.parameters={id:t.field(i[0].keyField)},u.filter(T)}))},r.signatures.push({name:"featuresetbyrelationshipname",min:2,max:4}),r.functions.featuresetbyassociation=function(n,a){return r.standardFunctionAsync(n,a,(y,I,e)=>x(this,null,function*(){b(e,2,3,n,a);let t=e[0],s=A(L(e[1],"")).toLowerCase(),l=$(e[2])?A(e[2]):null;if(e[0]===null)return null;if(!_(e[0]))throw new m(n,d.InvalidParameter,a);let p=t._layer;if(p instanceof X&&(p=ee(p,n.spatialReference,["*"],!0,n.lrucache,n.interceptor)),p===null||N(p)===!1)return null;yield p.load();let f=p.serviceUrl(),i=yield Re(f,n.spatialReference),o=null,u=null,w=!1;if(l!==null&&l!==""&&l!==void 0){for(let g of i.terminals)g.terminalName===l&&(u=g.terminalId);u===null&&(w=!0)}let T=i.associations.getFieldsIndex(),F=T.get("TOGLOBALID").name,E=T.get("FROMGLOBALID").name,ne=T.get("TOTERMINALID").name,te=T.get("FROMTERMINALID").name,j=T.get("FROMNETWORKSOURCEID").name,G=T.get("TONETWORKSOURCEID").name,k=T.get("ASSOCIATIONTYPE").name,ze=T.get("ISCONTENTVISIBLE").name,He=T.get("OBJECTID").name;for(let g of p.fields)if(g.type==="global-id"){o=t.field(g.name);break}let Z=null,de=new M(new H({name:"percentalong",alias:"percentalong",type:"double"}),D.create("0",i.associations.getFieldsIndex(),i.associations.dateFieldsTimeZoneDefaultUTC)),me=new M(new H({name:"side",alias:"side",type:"string"}),D.create("''",i.associations.getFieldsIndex(),i.associations.dateFieldsTimeZoneDefaultUTC)),C="globalid",pe="globalId",ye={};for(let g in i.lkp)ye[g]=i.lkp[g].sourceId;let R=new Ne(new H({name:"classname",alias:"classname",type:"string"}),null,ye),h="";switch(s){case"midspan":{h=`((${F}='${o}') OR ( ${E}='${o}')) AND (${k} IN (5))`,R.codefield=D.create(`CASE WHEN (${F}='${o}') THEN ${j} ELSE ${G} END`,i.associations.getFieldsIndex(),i.associations.dateFieldsTimeZoneDefaultUTC);let g=Q(v.findField(i.associations.fields,E));g.name=C,g.alias=C,Z=new M(g,D.create(`CASE WHEN (${E}='${o}') THEN ${F} ELSE ${E} END`,i.associations.getFieldsIndex(),i.associations.dateFieldsTimeZoneDefaultUTC)),de=i.unVersion>=4?new q(v.findField(i.associations.fields,T.get("PERCENTALONG").name)):new M(new H({name:"percentalong",alias:"percentalong",type:"double"}),D.create("0",i.associations.getFieldsIndex(),i.associations.dateFieldsTimeZoneDefaultUTC));break}case"junctionedge":{h=`((${F}='${o}') OR ( ${E}='${o}')) AND (${k} IN (4,6))`,R.codefield=D.create(`CASE WHEN (${F}='${o}') THEN ${j} ELSE ${G} END`,i.associations.getFieldsIndex(),i.associations.dateFieldsTimeZoneDefaultUTC);let g=Q(v.findField(i.associations.fields,E));g.name=C,g.alias=C,Z=new M(g,D.create(`CASE WHEN (${E}='${o}') THEN ${F} ELSE ${E} END`,i.associations.getFieldsIndex(),i.associations.dateFieldsTimeZoneDefaultUTC)),me=new M(new H({name:"side",alias:"side",type:"string"}),D.create(`CASE WHEN (${k}=4) THEN 'from' ELSE 'to' END`,i.associations.getFieldsIndex(),i.associations.dateFieldsTimeZoneDefaultUTC));break}case"connected":{let g=`${F}='@T'`,we=`${E}='@T'`;u!==null&&(g+=` AND ${ne}=@A`,we+=` AND ${te}=@A`),h="(("+g+") OR ("+we+"))",h=K(h,"@T",o??""),g=K(g,"@T",o??""),u!==null&&(g=K(g,"@A",u.toString()),h=K(h,"@A",u.toString())),R.codefield=D.create("CASE WHEN "+g+` THEN ${j} ELSE ${G} END`,i.associations.getFieldsIndex(),i.associations.dateFieldsTimeZoneDefaultUTC);let ae=Q(v.findField(i.associations.fields,E));ae.name=C,ae.alias=C,Z=new M(ae,D.create("CASE WHEN "+g+` THEN ${E} ELSE ${F} END`,i.associations.getFieldsIndex(),i.associations.dateFieldsTimeZoneDefaultUTC));break}case"container":h=`${F}='${o}' AND ${k} = 2`,u!==null&&(h+=` AND ${ne} = `+u.toString()),R.codefield=j,h="( "+h+" )",Z=new V(v.findField(i.associations.fields,E),C,C);break;case"content":h=`(${E}='${o}' AND ${k} = 2)`,u!==null&&(h+=` AND ${te} = `+u.toString()),R.codefield=G,h="( "+h+" )",Z=new V(v.findField(i.associations.fields,F),C,C);break;case"structure":h=`(${F}='${o}' AND ${k} = 3)`,u!==null&&(h+=` AND ${ne} = `+u.toString()),R.codefield=j,h="( "+h+" )",Z=new V(v.findField(i.associations.fields,E),C,pe);break;case"attached":h=`(${E}='${o}' AND ${k} = 3)`,u!==null&&(h+=` AND ${te} = `+u.toString()),R.codefield=G,h="( "+h+" )",Z=new V(v.findField(i.associations.fields,F),C,pe);break;default:throw new m(n,d.InvalidParameter,a)}return w&&(h="1 <> 1"),new v({parentfeatureset:i.associations,adaptedFields:[new q(v.findField(i.associations.fields,He)),new q(v.findField(i.associations.fields,ze)),Z,me,R,de],extraFilter:h?D.create(h,i.associations.getFieldsIndex(),i.associations.dateFieldsTimeZoneDefaultUTC):null})}))},r.signatures.push({name:"featuresetbyassociation",min:2,max:6}),r.functions.groupby=function(n,a){return r.standardFunctionAsync(n,a,(y,I,e)=>x(this,null,function*(){if(b(e,3,3,n,a),!N(e[0]))throw new m(n,d.InvalidParameter,a);let t=yield e[0].load(),s=[],l=[],p=!1,f=[];if($(e[1]))f.push(e[1]);else if(e[1]instanceof P)f.push(e[1]);else if(S(e[1]))f=e[1];else{if(!U(e[1]))throw new m(n,d.InvalidParameter,a);f=e[1].toArray()}for(let i of f)if($(i)){let o=D.create(A(i),t.getFieldsIndex(),t.dateFieldsTimeZoneDefaultUTC),u=oe(o)===!0?A(i):"%%%%FIELDNAME";s.push({name:u,expression:o}),u==="%%%%FIELDNAME"&&(p=!0)}else{if(!(i instanceof P))throw new m(n,d.InvalidParameter,a);{let o=i.hasField("name")?i.field("name"):"%%%%FIELDNAME",u=i.hasField("expression")?i.field("expression"):"";if(o==="%%%%FIELDNAME"&&(p=!0),!o)throw new m(n,d.InvalidParameter,a);s.push({name:o,expression:D.create(u||o,t.getFieldsIndex(),t.dateFieldsTimeZoneDefaultUTC)})}}if(f=[],$(e[2]))f.push(e[2]);else if(S(e[2]))f=e[2];else if(U(e[2]))f=e[2].toArray();else{if(!(e[2]instanceof P))throw new m(n,d.InvalidParameter,a);f.push(e[2])}for(let i of f){if(!(i instanceof P))throw new m(n,d.InvalidParameter,a);{let o=i.hasField("name")?i.field("name"):"",u=i.hasField("statistic")?i.field("statistic"):"",w=i.hasField("expression")?i.field("expression"):"";if(!o||!u||!w)throw new m(n,d.InvalidParameter,a);l.push({name:o,statistic:u.toLowerCase(),expression:D.create(w,t.getFieldsIndex(),t.dateFieldsTimeZoneDefaultUTC)})}}if(p){let i={};for(let u of t.fields)i[u.name.toLowerCase()]=1;for(let u of s)u.name!=="%%%%FIELDNAME"&&(i[u.name.toLowerCase()]=1);for(let u of l)u.name!=="%%%%FIELDNAME"&&(i[u.name.toLowerCase()]=1);let o=0;for(let u of s)if(u.name==="%%%%FIELDNAME"){for(;i["field_"+o.toString()]===1;)o++;i["field_"+o.toString()]=1,u.name="FIELD_"+o.toString()}}for(let i of s)yield ue(i.expression,r,n);for(let i of l)yield ue(i.expression,r,n);return e[0].groupby(s,l)}))},r.signatures.push({name:"groupby",min:3,max:3}),r.functions.distinct=function(n,a){return r.standardFunctionAsync(n,a,(y,I,e)=>x(this,null,function*(){if(N(e[0])){b(e,2,2,n,a);let t=yield e[0].load(),s=[],l=[];if($(e[1]))l.push(e[1]);else if(e[1]instanceof P)l.push(e[1]);else if(S(e[1]))l=e[1];else{if(!U(e[1]))throw new m(n,d.InvalidParameter,a);l=e[1].toArray()}let p=!1;for(let f of l)if($(f)){let i=D.create(A(f),t.getFieldsIndex(),t.dateFieldsTimeZoneDefaultUTC),o=oe(i)===!0?A(f):"%%%%FIELDNAME";s.push({name:o,expression:i}),o==="%%%%FIELDNAME"&&(p=!0)}else{if(!(f instanceof P))throw new m(n,d.InvalidParameter,a);{let i=f.hasField("name")?f.field("name"):"%%%%FIELDNAME",o=f.hasField("expression")?f.field("expression"):"";if(i==="%%%%FIELDNAME"&&(p=!0),!i)throw new m(n,d.InvalidParameter,a);s.push({name:i,expression:D.create(o||i,t.getFieldsIndex(),t.dateFieldsTimeZoneDefaultUTC)})}}if(p){let f={};for(let o of t.fields)f[o.name.toLowerCase()]=1;for(let o of s)o.name!=="%%%%FIELDNAME"&&(f[o.name.toLowerCase()]=1);let i=0;for(let o of s)if(o.name==="%%%%FIELDNAME"){for(;f["field_"+i.toString()]===1;)i++;f["field_"+i.toString()]=1,o.name="FIELD_"+i.toString()}}for(let f of s)yield ue(f.expression,r,n);return e[0].groupby(s,[])}return We(e)}))},r.functions.getfeaturesetinfo=function(n,a){return r.standardFunctionAsync(n,a,(y,I,e)=>x(this,null,function*(){if(b(e,1,1,n,a),!N(e[0]))return null;let t=yield e[0].getFeatureSetInfo();return t?P.convertObjectToArcadeDictionary({layerId:t.layerId,layerName:t.layerName,itemId:t.itemId,serviceLayerUrl:t.serviceLayerUrl,webMapLayerId:t.webMapLayerId??null,webMapLayerTitle:t.webMapLayerTitle??null,className:null,objectClassId:null},se(n),!1,!1):null}))},r.signatures.push({name:"getfeaturesetinfo",min:1,max:1}),r.functions.filterbysubtypecode=function(n,a){return r.standardFunctionAsync(n,a,(y,I,e)=>x(this,null,function*(){if(b(e,2,2,n,a),N(e[0])){let t=yield e[0].load(),s=e[1];if(!De(s))throw new m(n,d.InvalidParameter,a);if(t.subtypeField){let p=D.create(`${t.subtypeField}= ${e[1]}`,t.getFieldsIndex(),t.dateFieldsTimeZoneDefaultUTC);return new B({parentfeatureset:e[0],whereclause:p})}if(t.typeIdField===null||t.typeIdField==="")throw new m(n,d.FeatureSetDoesNotHaveSubtypes,a);let l=D.create(`${t.typeIdField}= ${e[1]}`,t.getFieldsIndex(),t.dateFieldsTimeZoneDefaultUTC);return new B({parentfeatureset:e[0],whereclause:l})}throw new m(n,d.InvalidParameter,a)}))},r.signatures.push({name:"filterbysubtypecode",min:2,max:2}))}export{wn as registerFunctions};
