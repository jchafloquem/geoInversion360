import{c as O}from"./chunk-7C77LBCZ.js";import{f as G,g,h as d,i as M,j as F,k as C}from"./chunk-BPPBSQ5N.js";import{d as R,s as p,t as u}from"./chunk-ESBNO4XM.js";import{a as c}from"./chunk-IFCRPPYQ.js";import{c as A}from"./chunk-SPAOTNUK.js";import{a as m,b as z}from"./chunk-AQ74ANSJ.js";import{f as E}from"./chunk-ZGLJFDS6.js";import{a as x}from"./chunk-IXNVQC76.js";import{a as L}from"./chunk-NNKLK2DS.js";import{aa as T}from"./chunk-BRGZVJPZ.js";import{g as f}from"./chunk-JEGVIFEP.js";function k(e){let t=[];return I(g(e),t),t.length?new c(G(t[0])):null}function I(e,t){if(!e)return;let o;o=e.type==="CIMTextSymbol"?e.symbol:e;let r=e.type==="CIMPolygonSymbol";if(o?.symbolLayers){for(let s of o.symbolLayers)if(!(s.colorLocked||r&&(M(s)||d(s)&&s.markerPlacement&&C(s.markerPlacement))))switch(s.type){case"CIMPictureMarker":case"CIMPictureStroke":case"CIMPictureFill":s.tintColor&&j(t,s.tintColor);break;case"CIMVectorMarker":s.markerGraphics?.forEach(n=>{I(n.symbol,t)});break;case"CIMSolidStroke":case"CIMSolidFill":j(t,s.color);break;case"CIMHatchFill":I(s.lineSymbol,t)}}}function j(e,t){for(let o of e)if(o.join(".")===t.join("."))return;e.push(t)}function me(e,t,o){t instanceof c||(t=new c(t));let r=g(e);r&&S(r,t,o)}function S(e,t,o){if(!e)return;let r;r=e.type==="CIMTextSymbol"?e.symbol:e;let s=r?.type==="CIMPolygonSymbol";if(r?.symbolLayers)for(let n of r.symbolLayers){if(n.colorLocked)continue;if(s){if(o){let{layersToColor:l}=o;if((M(n)||d(n)&&n.markerPlacement&&C(n.markerPlacement))&&l==="fill"||F(n)&&l==="outline")continue}else if(M(n)||d(n)&&n.markerPlacement&&C(n.markerPlacement))continue}let a=t.toArray();switch(n.type){case"CIMPictureMarker":case"CIMPictureStroke":case"CIMPictureFill":n.tintColor=a;break;case"CIMVectorMarker":n.markerGraphics?.forEach(l=>{S(l.symbol,t,o)});break;case"CIMSolidStroke":case"CIMSolidFill":n.color=a;break;case"CIMHatchFill":S(n.lineSymbol,t,o)}}}var Y="picture-fill",v="simple-fill",U="simple-line",W="simple-marker",H="text",N="cim",X=new Map([["dash",[4,3]],["dashdot",[4,3,1,3]],["dot",[1,3]],["longdash",[8,3]],["longdashdot",[8,3,1,3]],["longdashdotdot",[8,3,1,3,1,3]],["shortdash",[4,1]],["shortdashdot",[4,1,1,1]],["shortdashdotdot",[4,1,1,1,1,1]],["shortdot",[1,1]],["solid",[]]]),w=new A(1e3);function ke(e){let t=e.style,o=null;if(e)switch(e.type){case W:t!=="cross"&&t!=="x"&&(o=e.color);break;case v:t&&t!=="solid"?t!=="none"&&(o={type:"pattern",x:0,y:0,src:L(`esri/symbols/patterns/${t}.png`),width:5,height:5}):o=e.color;break;case Y:o={type:"pattern",src:e.url,width:m(e.width)*e.xscale,height:m(e.height)*e.yscale,x:m(e.xoffset),y:m(e.yoffset)};break;case H:o=e.color;break;case N:o=k(e)}return o}function ge(e,t){let o=e+"-"+t;return w.get(o)!==void 0?Promise.resolve(w.get(o)):T(e,{responseType:"image"}).then(r=>{let s=r.data,n=s.naturalWidth,a=s.naturalHeight,l=document.createElement("canvas");l.width=n,l.height=a;let i=l.getContext("2d");i.fillStyle=t,i.fillRect(0,0,n,a),i.globalCompositeOperation="destination-in",i.drawImage(s,0,0);let y=l.toDataURL();return w.put(o,y),y})}function P(e){if(!e)return null;let t=null;switch(e.type){case v:case Y:case W:t=P(e.outline);break;case U:{let o=m(e.width);e.style!=null&&e.style!=="none"&&o!==0&&(t={color:e.color,style:B(e.style),width:o,cap:e.cap,join:e.join==="miter"?m(e.miterLimit):e.join},t.dashArray=J(t).join(",")||"none");break}default:t=null}return t}function J(e){if(!e?.style)return[];let{dashArray:t,style:o,width:r}=e;if(typeof t=="string"&&t!=="none")return t.split(",").map(a=>Number(a));let s=r??0,n=X.has(o)?X.get(o).map(a=>a*s):[];if(e.cap!=="butt")for(let[a,l]of n.entries())n[a]=a%2==1?l+s:Math.max(l-s,1);return n}var B=(()=>{let e={};return t=>{if(e[t])return e[t];let o=t.replaceAll("-","");return e[t]=o,o}})(),Ie=new c([128,128,128]);var $=new c("white");function q(e){let t=e.symbolLayers?.at(-1);if(t&&"outline"in t)return t?.outline?.size}function Fe(e){if(!e)return 0;if(u(e)){let t=q(e);return t??0}return z(P(e)?.width)}function Re(e){if(e==null||!("symbolLayers"in e)||e.symbolLayers==null)return!1;switch(e.type){case"point-3d":return e.symbolLayers.some(t=>t.type==="object");case"line-3d":return e.symbolLayers.some(t=>t.type==="path");case"polygon-3d":return e.symbolLayers.some(t=>t.type==="object"||t.type==="extrude");default:return!1}}function je(e){return e.resource?.href??""}function Xe(e,t){if(!e)return null;let o=null;return u(e)?o=K(e):p(e)&&(o=e.type==="cim"?k(e):e.color?new c(e.color):null),o?b(o,t):null}function K(e){let t=e.symbolLayers;if(!t)return null;let o=null;return t.forEach(r=>{r.type==="object"&&r.resource?.href||(o=r.type==="water"?r.color:r.material?r.material.color:null)}),o?new c(o):null}function b(e,t){if(t==null||e==null)return e;let o=e.toRgba();return o[3]=o[3]*t,new c(o)}function Q(e,t,o){let r=e.symbolLayers;if(!r)return;let s=n=>b(t=t??n??(o!=null?$:null),o);r.forEach(n=>{if(n.type!=="object"||!n.resource?.href||t)if(n.type==="water")n.color=s(n.color);else{let a=n.material!=null?n.material.color:null,l=s(a);n.material==null?n.material=new R({color:l}):n.material.color=l,o!=null&&"outline"in n&&n.outline?.color!=null&&(n.outline.color=b(n.outline.color,o))}})}function Z(e,t,o){(t=t??e.color)&&(e.color=b(t,o)),o!=null&&"outline"in e&&e.outline?.color&&(e.outline.color=b(e.outline.color,o))}function Ye(e,t,o){e&&(t||o!=null)&&(t&&(t=new c(t)),u(e)?Q(e,t,o):p(e)&&Z(e,t,o))}function _(e,t){return f(this,null,function*(){let o=e.symbolLayers;o&&(yield x(o,r=>f(this,null,function*(){return ee(r,t)})))})}function ee(e,t){return f(this,null,function*(){switch(e.type){case"extrude":oe(e,t);break;case"icon":case"line":case"text":te(e,t);break;case"path":ne(e,t);break;case"object":yield re(e,t)}})}function te(e,t){let o=D(t);o!=null&&(e.size=o)}function D(e){for(let t of e)if(typeof t=="number")return t;return null}function oe(e,t){e.size=typeof t[2]=="number"?t[2]:0}function re(e,t){return f(this,null,function*(){let{resourceSize:o,symbolSize:r}=yield se(e),s=V(t,o,r);e.width=h(t[0],r[0],o[0],s),e.depth=h(t[1],r[1],o[1],s),e.height=h(t[2],r[2],o[2],s)})}function ne(e,t){let o=V(t,E,[e.width,void 0,e.height]);e.width=h(t[0],e.width,1,o),e.height=h(t[2],e.height,1,o)}function V(e,t,o){for(let r=0;r<3;r++){let s=e[r];switch(s){case"symbol-value":{let n=o[r];return n!=null?n/t[r]:1}case"proportional":break;default:if(s&&t[r])return s/t[r]}}return 1}function se(e){return f(this,null,function*(){let{computeObjectLayerResourceSize:t}=yield import("./chunk-ALQL5F2U.js"),o=yield t(e,10),{width:r,height:s,depth:n}=e,a=[r,n,s],l=1;for(let i=0;i<3;i++){let y=a[i];if(y!=null){l=y/o[i];break}}for(let i=0;i<3;i++)a[i]==null&&(a[i]=o[i]*l);return{resourceSize:o,symbolSize:a}})}function h(e,t,o,r){switch(e){case"proportional":return o*r;case"symbol-value":return t??o;default:return e}}function ae(e,t){let o=D(t);if(o!=null)switch(e.type){case"simple-marker":e.size=o;break;case"picture-marker":{let r=e.width/e.height;r>1?(e.width=o,e.height=o*r):(e.width=o*r,e.height=o);break}case"simple-line":e.width=o;break;case"text":e.font.size=o}}function ve(e,t){return f(this,null,function*(){if(e&&t)return u(e)?_(e,t):void(p(e)&&ae(e,t))})}function We(e,t,o){if(e&&t!=null)if(u(e)){let r=e.symbolLayers;r&&r.forEach(s=>{if(s&&s.type==="object")switch(o){case"tilt":s.tilt=(s.tilt??0)+t;break;case"roll":s.roll=(s.roll??0)+t;break;default:s.heading=(s.heading??0)+t}})}else p(e)&&(e.type!=="simple-marker"&&e.type!=="picture-marker"&&e.type!=="text"||(e.angle+=t))}function De(e){if(!e)return null;let t=e.effects.filter(o=>o.type!=="bloom").map(o=>o.toJSON());return O(t)}function Ve(e,t){return f(this,null,function*(){return(yield e.fetchSymbol(t))||e.fetchCIMSymbol(t)})}export{me as a,ke as b,ge as c,P as d,J as e,B as f,Ie as g,Fe as h,Re as i,je as j,Xe as k,Ye as l,ve as m,We as n,De as o,Ve as p};
