import{a as q}from"./chunk-O4X2MXQH.js";import{i as k}from"./chunk-QPP4HOHY.js";import{a as G}from"./chunk-WQ4ZETPN.js";import"./chunk-DDHMQRMR.js";import{a as D}from"./chunk-WNOBQY3K.js";import"./chunk-7C77LBCZ.js";import"./chunk-LK52GLIE.js";import"./chunk-MP46524Y.js";import{p as j,r as E,v as C}from"./chunk-SE7FIBEW.js";import"./chunk-NOUYXRP4.js";import"./chunk-GH3IUQVA.js";import"./chunk-AC7AQWXQ.js";import"./chunk-37H4LYIE.js";import"./chunk-GHXDYQ3O.js";import"./chunk-ZOOQQO74.js";import"./chunk-P7VZMSEG.js";import"./chunk-B7IX6UFG.js";import"./chunk-HUYHDVA2.js";import{B as _}from"./chunk-BPPBSQ5N.js";import"./chunk-S5RWPBKA.js";import"./chunk-2UGJ72JG.js";import"./chunk-ESBNO4XM.js";import"./chunk-3A7OIH4J.js";import"./chunk-RMS5474O.js";import"./chunk-2SHNUN5D.js";import"./chunk-IFCRPPYQ.js";import"./chunk-J57HR4DB.js";import"./chunk-IEUNGS56.js";import"./chunk-6KRFVLII.js";import"./chunk-SPAOTNUK.js";import"./chunk-TNPL7MIN.js";import"./chunk-BYQI7UDX.js";import"./chunk-7WFRJSY3.js";import"./chunk-DFTBSFIN.js";import"./chunk-FUBITVJ7.js";import"./chunk-VOH7XGOR.js";import"./chunk-Y6HWUWZ3.js";import{a as H,b as z}from"./chunk-AQ74ANSJ.js";import"./chunk-5UCI4TUX.js";import"./chunk-SAOUSUZE.js";import"./chunk-PPFMRTTD.js";import"./chunk-IWJQ3PU6.js";import"./chunk-Z5Q76SB7.js";import"./chunk-TTN7UOJS.js";import"./chunk-5QLB7ZJ7.js";import"./chunk-E5R4OI7X.js";import"./chunk-7S6PD5JC.js";import"./chunk-ZWI7LLTZ.js";import"./chunk-6NCXSKJD.js";import"./chunk-4HUAEW4D.js";import"./chunk-XWRPBDYS.js";import"./chunk-TCCAOREC.js";import"./chunk-BCREO4Q5.js";import"./chunk-SO6OJFOM.js";import"./chunk-DG5QI6E2.js";import"./chunk-TMZNSBQB.js";import"./chunk-ZGLJFDS6.js";import"./chunk-RSDQHAJX.js";import"./chunk-OFVMJORF.js";import"./chunk-72VQRINQ.js";import"./chunk-R2RE6SI6.js";import"./chunk-2FYXACXP.js";import"./chunk-XGVKSCMM.js";import"./chunk-FX2VBPAM.js";import"./chunk-K4GPNFIS.js";import"./chunk-RP7XSKHE.js";import"./chunk-VV7MGXTC.js";import"./chunk-IXNVQC76.js";import"./chunk-LYPZUCFI.js";import"./chunk-QYC4ILGT.js";import"./chunk-HFQFGALU.js";import"./chunk-5TSEU5EE.js";import"./chunk-VC35VCVT.js";import"./chunk-MT7BXRRQ.js";import"./chunk-NNKLK2DS.js";import"./chunk-VU5W7W6Y.js";import"./chunk-BRGZVJPZ.js";import"./chunk-Z5NXR7SL.js";import"./chunk-7JLWSSXP.js";import"./chunk-W3WDPWBE.js";import"./chunk-JKP4I6UL.js";import"./chunk-TZHKPIVH.js";import"./chunk-JPDAKIWT.js";import"./chunk-W6LY37E4.js";import"./chunk-BRWS572J.js";import"./chunk-AKNRR36C.js";import{g as P}from"./chunk-JEGVIFEP.js";var $=96/72,F=class{constructor(a){this._spatialReference=a,this._imageDataCanvas=null,this._cimResourceManager=new q}get _canvas(){return this._imageDataCanvas||(this._imageDataCanvas=document.createElement("canvas")),this._imageDataCanvas}get resourceManager(){return this._cimResourceManager}rasterizeCIMSymbolAsync(a,m,r,n,t,i,l,y,b){return P(this,null,function*(){if(!a)return null;let{data:f}=a;if(!f||f.type!=="CIMSymbolReference"||!f.symbol)return null;let{symbol:I}=f;i||(i=_(I));let c=yield D.resolveSymbolOverrides(f,m,this._spatialReference,t,i,l,y),u=this._cimResourceManager,g=[];C.fetchResources(c,u,g),C.fetchFonts(c,u,g),g.length>0&&(yield Promise.all(g));let{width:o,height:s}=r,S=V(i,o,s,n),e=C.getEnvelope(c,S,u);if(!e)return null;let h=1,v=0,x=0;switch(I.type){case"CIMPointSymbol":case"CIMTextSymbol":{let d=1;e.width>o&&(d=o/e.width);let M=1;e.height>s&&(M=s/e.height),n==="preview"&&(e.width<o&&(d=o/e.width),e.height<s&&(M=s/e.height)),h=Math.min(d,M),v=e.x+e.width/2,x=e.y+e.height/2}break;case"CIMLineSymbol":{(b||e.height>s)&&(h=s/e.height),x=e.y+e.height/2;let d=e.x*h+o/2,M=(e.x+e.width)*h+o/2,{paths:R}=S;R[0][0][0]-=d/h,R[0][2][0]-=(M-o)/h}break;case"CIMPolygonSymbol":{v=e.x+e.width/2,x=e.y+e.height/2;let d=e.x*h+o/2,M=(e.x+e.width)*h+o/2,R=e.y*h+s/2,T=(e.y+e.height)*h+s/2,{rings:w}=S;d<0&&(w[0][0][0]-=d,w[0][3][0]-=d,w[0][4][0]-=d),R<0&&(w[0][0][1]+=R,w[0][1][1]+=R,w[0][4][1]+=R),M>o&&(w[0][1][0]-=M-o,w[0][2][0]-=M-o),T>s&&(w[0][2][1]+=T-s,w[0][3][1]+=T-s)}}let W={type:"cim",data:{type:"CIMSymbolReference",symbol:c}};return this.rasterize(W,o,s,v,x,h,i,1,S)})}rasterize(a,m,r,n,t,i,l,y=0,b=null){let{data:f}=a;if(!f||f.type!=="CIMSymbolReference"||!f.symbol)return null;let{symbol:I}=f,c=this._canvas,u=(window.devicePixelRatio||1)*$;c.width=m*u,c.height=r*u,l||(l=_(I)),b||(b=V(l,m,r,"legend")),c.width+=2*y,c.height+=2*y;let g=c.getContext("2d",{willReadFrequently:!0}),o=j.createIdentity();return o.translate(-n,-t),o.scale(i*u,-i*u),o.translate(m*u/2+y,r*u/2+y),g.clearRect(0,0,c.width,c.height),new E(g,this._cimResourceManager,o,!0).drawSymbol(I,b),g.getImageData(0,0,c.width,c.height)}};function V(p,a,m,r){let t=-a/2+1,i=a/2-1,l=m/2-1,y=-m/2+1;switch(p){case"esriGeometryPoint":return{x:0,y:0};case"esriGeometryPolyline":return{paths:[[[t,0],[0,0],[i,0]]]};default:return r==="legend"?{rings:[[[t,l],[i,0],[i,y],[t,y],[t,l]]]}:{rings:[[[t,l],[i,l],[i,y],[t,y],[t,l]]]}}}var O=new F(null),L=z(G.size),A=z(G.maxSize),U=z(G.lineWidth),B=1;function J(p,a,m){return P(this,null,function*(){let r=a?.size,n=r!=null&&typeof r=="object"&&"width"in r?r.width:r,t=r!=null&&typeof r=="object"&&"height"in r?r.height:r;if(n==null||t==null)if(m==="esriGeometryPolygon")n=L,t=L;else{let i=yield K(p,a,m);i&&(n=i.width,t=i.height),m==="esriGeometryPolyline"&&(n=U),n=n!=null&&isFinite(n)?Math.min(n,A):L,t=t!=null&&isFinite(t)?Math.max(Math.min(t,A),B):L}return a.style==="legend"&&m==="esriGeometryPolyline"&&(n=U),{width:n,height:t}})}function K(p,a,m){return P(this,null,function*(){let{feature:r,fieldMap:n,viewParams:t}=a.cimOptions||a,i=yield D.resolveSymbolOverrides(p.data,r,null,n,m,null,t);if(!i)return null;(p=p.clone()).data={type:"CIMSymbolReference",symbol:i},p.data.primitiveOverrides=void 0;let l=[];return C.fetchResources(i,O.resourceManager,l),C.fetchFonts(i,O.resourceManager,l),l.length>0&&(yield Promise.all(l)),C.getEnvelope(i,null,O.resourceManager)})}function he(m){return P(this,arguments,function*(p,a={}){let{node:r,opacity:n,symbolConfig:t}=a,i=t!=null&&typeof t=="object"&&"isSquareFill"in t&&t.isSquareFill,l=a.cimOptions||a,y=l.geometryType||_(p?.data?.symbol),b=yield J(p,a,y),{feature:f,fieldMap:I}=l,c=i||y!=="esriGeometryPolygon"?"preview":"legend",u=yield O.rasterizeCIMSymbolAsync(p,f,b,c,I,y,null,l.viewParams,l.allowScalingUp);if(!u)return null;let{width:g,height:o}=u,s=document.createElement("canvas");s.width=g,s.height=o,s.getContext("2d").putImageData(u,0,0);let S=H(b.width),e=H(b.height),h=new Image(S,e);h.src=s.toDataURL(),h.ariaLabel=a.ariaLabel??null,h.alt=a.ariaLabel??"",n!=null&&(h.style.opacity=`${n}`);let v=h;if(a.effectView!=null){let x={shape:{type:"image",x:0,y:0,width:S,height:e,src:h.src},fill:null,stroke:null,offset:[0,0]};v=k([[x]],[S,e],{effectView:a.effectView,ariaLabel:a.ariaLabel})}return r&&v&&r.appendChild(v),v})}export{he as previewCIMSymbol};
