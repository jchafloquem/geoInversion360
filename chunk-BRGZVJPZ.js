import{S as re}from"./chunk-Z5NXR7SL.js";import{g as ee,j as H,m as me,p as he}from"./chunk-JKP4I6UL.js";import{b as pe,k as g,q as de,s as A}from"./chunk-BRWS572J.js";import{a as q,m as fe}from"./chunk-AKNRR36C.js";import{a as y,g as m}from"./chunk-JEGVIFEP.js";var Fe=/^https:\/\/([a-z\d-]+)(\.maps([^.]*))?\.arcgis\.com/i,_e={devext:{customBaseUrl:"mapsdevext.arcgis.com",portalHostname:"devext.arcgis.com"},qaext:{customBaseUrl:"mapsqa.arcgis.com",portalHostname:"qaext.arcgis.com"},www:{customBaseUrl:"maps.arcgis.com",portalHostname:"www.arcgis.com"}};function te(e){let r=e?.match(Fe);if(!r)return null;let[,t,n,s]=r;if(!t)return null;let o=null,a=null,i=null,{devext:u,qaext:l,www:f}=_e;if(n)if(o=t,s)switch(s.toLowerCase()){case"devext":({customBaseUrl:a,portalHostname:i}=u);break;case"qa":({customBaseUrl:a,portalHostname:i}=l);break;default:return null}else({customBaseUrl:a,portalHostname:i}=f);else switch(t.toLowerCase()){case"devext":({customBaseUrl:a,portalHostname:i}=u);break;case"qaext":({customBaseUrl:a,portalHostname:i}=l);break;case"www":({customBaseUrl:a,portalHostname:i}=f);break;default:return null}return{customBaseUrl:a,isPortal:!1,portalHostname:i,urlKey:o}}function ye(e){return/\/(sharing|usrsvcs)\/(appservices|servers)\//i.test(e)}function Ar(e){let r=/^https?:\/\/(?:cdn|[a-z\d-]+\.maps)\.arcgis\.com/i,t=/^https?:\/\/(?:cdndev|[a-z\d-]+\.mapsdevext)\.arcgis\.com/i,n=/^https?:\/\/(?:cdnqa|[a-z\d-]+\.mapsqa)\.arcgis\.com/i;return r.test(e)?e=e.replace(r,"https://www.arcgis.com"):t.test(e)?e=e.replace(t,"https://devext.arcgis.com"):n.test(e)&&(e=e.replace(n,"https://qaext.arcgis.com")),e}function ge(e){let r=atob(e),t=new Uint8Array(r.length);for(let n=0;n<r.length;n++)t[n]=r.charCodeAt(n);return t.buffer}function we(e){let r=new Uint8Array(e),t="";for(let n=0;n<r.length;n++)t+=String.fromCharCode(r[n]);return btoa(t)}var ze=()=>de.getLogger("esri.core.urlUtils"),k=g.request,be="esri/config: esriConfig.request.proxyUrl is not set.",xe=/^\s*[a-z][a-z0-9-+.]*:(?![0-9])/i,qe=/^\s*http:/i,Me=/^\s*https:/i,We=/^\s*file:/i,Ke=/:\d+$/,Qe=/^https?:\/\/[^/]+\.arcgis.com\/sharing(\/|$)/i,Ge=new RegExp("^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?$"),Je=new RegExp("^((([^[:]+):)?([^@]+)@)?(\\[([^\\]]+)\\]|([^[:]*))(:([0-9]+))?$"),v=class{constructor(r=""){this.uri=r,this.scheme=null,this.authority=null,this.path=null,this.query=null,this.fragment=null,this.user=null,this.password=null,this.host=null,this.port=null;let t=this.uri.match(Ge);this.scheme=t[2]||(t[1]?"":null),this.authority=t[4]||(t[3]?"":null),this.path=t[5],this.query=t[7]||(t[6]?"":null),this.fragment=t[9]||(t[8]?"":null),this.authority!=null&&(t=this.authority.match(Je),this.user=t[3]||null,this.password=t[4]||null,this.host=t[6]||t[7],this.port=t[9]||null)}toString(){return this.uri}},B={},Ve=new v(g.applicationUrl),p=Ve,Xe=Ye(),oe=Xe,z=()=>p,Hr=()=>oe;function Ye(){let e=p.path,r=e.substring(0,e.lastIndexOf(e.split("/")[e.split("/").length-1]));return`${`${p.scheme}://${p.host}${p.port!=null?`:${p.port}`:""}`}${r}`}function T(e){if(!e)return null;let r={path:null,query:null},t=new v(e),n=e.indexOf("?");return t.query===null?r.path=e:(r.path=e.substring(0,n),r.query=M(t.query)),t.fragment&&(r.hash=t.fragment,t.query===null&&(r.path=r.path.substring(0,r.path.length-(t.fragment.length+1)))),r}function M(e){let r=e.split("&"),t={};for(let n of r){if(!n)continue;let s=n.indexOf("="),o,a;s<0?(o=decodeURIComponent(n),a=""):(o=decodeURIComponent(n.slice(0,s)),a=decodeURIComponent(n.slice(s+1)));let i=t[o];typeof i=="string"&&(i=t[o]=[i]),Array.isArray(i)?i.push(a):t[o]=a}return t}function $(e,r){return e?r&&typeof r=="function"?Object.keys(e).map(t=>encodeURIComponent(t)+"="+encodeURIComponent(r(t,e[t]))).join("&"):Object.keys(e).map(t=>{let n=e[t];if(n==null)return"";let s=encodeURIComponent(t)+"=",o=r?.[t];return o?s+encodeURIComponent(o(n)):Array.isArray(n)?n.map(a=>re(a)?s+encodeURIComponent(JSON.stringify(a)):s+encodeURIComponent(a)).join("&"):re(n)?s+encodeURIComponent(JSON.stringify(n)):s+encodeURIComponent(n)}).filter(t=>t).join("&"):""}function Oe(e=!1){let r,t=k.proxyUrl;if(typeof e=="string"){r=nr(e);let n=E(e);n&&(t=n.proxyUrl)}else r=!!e;if(!t)throw ze().warn(be),new A("urlUtils:proxy-not-set",be);return r&&ne()&&(t=G(t)),T(t)}function Br(e){let r=E(e),t,n;if(r){let s=ae(r.proxyUrl);t=s.path,n=s.query?M(s.query):null}if(t){let s=T(e);e=t+"?"+s.path;let o=$(y(y({},n),s.query));o&&(e=`${e}?${o}`)}return e}var R={path:"",query:""};function ae(e){let r=e.indexOf("?");return r!==-1?(R.path=e.slice(0,r),R.query=e.slice(r+1)):(R.path=e,R.query=null),R}function Se(e){return e=(e=_(e=lr(e=ae(e).path),!0)).toLowerCase()}function ve(e){let r={proxyUrl:e.proxyUrl,urlPrefix:Se(e.urlPrefix)},t=k.proxyRules,n=r.urlPrefix,s=t.length;for(let o=0;o<t.length;o++){let a=t[o].urlPrefix;if(n.indexOf(a)===0){if(n.length===a.length)return-1;s=o;break}a.indexOf(n)===0&&(s=o+1)}return t.splice(s,0,r),s}function E(e){let r=k.proxyRules,t=Se(e);for(let n=0;n<r.length;n++)if(t.indexOf(r[n].urlPrefix)===0)return r[n]}function Nr(e,r){if(!e||!r)return!1;e=N(e),r=N(r);let t=te(e),n=te(r);return t!=null&&n!=null?t.portalHostname===n.portalHostname:t==null&&n==null&&U(e,r,!0)}function Fr(e,r){return e=N(e),r=N(r),_(e)===_(r)}function N(e){let r=(e=P(e)).indexOf("/sharing");return r>0?e.substring(0,r):e.replace(/\/+$/,"")}function ie(e,r=k.interceptors){let t=n=>n==null||n instanceof RegExp&&n.test(e)||typeof n=="string"&&e.startsWith(n);if(r){for(let n of r)if(Array.isArray(n.urls)){if(n.urls.some(t))return n}else if(t(n.urls))return n}return null}function U(e,r,t=!1){if(!e||!r)return!1;let n=se(e),s=se(r);return!(!t&&n.scheme!==s.scheme)&&n.host!=null&&s.host!=null&&n.host.toLowerCase()===s.host.toLowerCase()&&n.port===s.port}function W(e){if(typeof e=="string"){if(!D(e))return!0;e=se(e)}if(U(e,p))return!0;let r=k.trustedServers||[];for(let t=0;t<r.length;t++){let n=Ze(r[t]);for(let s=0;s<n.length;s++)if(U(e,n[s]))return!0}return!1}function Ze(e){return B[e]||(ue(e)||C(e)?B[e]=[new v(le(e))]:B[e]=[new v(`http://${e}`),new v(`https://${e}`)]),B[e]}function le(e,r=oe,t){return C(e)?t?.preserveProtocolRelative?e:p.scheme==="http"&&p.authority===h(e).slice(2)?`http:${e}`:`https:${e}`:ue(e)?e:er(e[0]==="/"?ir(r):r,e)}function _r(e,r=oe,t){if(e==null||!D(e))return e;let n=P(e),s=n.toLowerCase(),o=P(r).toLowerCase().replace(/\/+$/,""),a=t?P(t).toLowerCase().replace(/\/+$/,""):null;if(a&&o.indexOf(a)!==0)return e;let i=(b,c,x)=>(x=b.indexOf(c,x))===-1?b.length:x,u=i(s,"/",s.indexOf("//")+2),l=-1;for(;s.slice(0,u+1)===o.slice(0,u)+"/"&&(l=u+1,u!==s.length);)u=i(s,"/",u+1);if(l===-1||a&&l<a.length)return e;e=n.slice(l);let f=o.slice(l-1).replaceAll(/[^/]+/g,"").length;if(f>0)for(let b=0;b<f;b++)e=`../${e}`;else e=`./${e}`;return e}function P(e){return e=fr(e=cr(e=ur(e=le(e=e.trim()))))}function er(...e){let r=e.filter(fe);if(!r?.length)return;let t=[];if(D(r[0])){let s=r[0],o=s.indexOf("//");o!==-1&&(t.push(s.slice(0,o+1)),or(r[0])&&(t[0]+="/"),r[0]=s.slice(o+2))}else r[0][0]==="/"&&t.push("");let n=r.reduce((s,o)=>o?s.concat(o.split("/")):s,[]);for(let s=0;s<n.length;s++){let o=n[s];o===".."&&t.length>0&&t[t.length-1]!==".."?t.pop():(!o&&s===n.length-1||o&&(o!=="."||t.length===0))&&t.push(o)}return t.join("/")}function h(e,r=!1){if(e==null||K(e)||Q(e))return null;let t=e.indexOf("://");if(t===-1&&C(e))t=2;else{if(t===-1)return null;t+=3}let n=e.indexOf("/",t);return n!==-1&&(e=e.slice(0,n)),r&&(e=_(e,!0)),e}function D(e){return C(e)||ue(e)}function K(e){return e!=null&&e.slice(0,5)==="blob:"}function Q(e){return e!=null&&e.slice(0,5)==="data:"}function rr(e){let r=F(e);return r?.isBase64?ge(r.data):null}function zr(e){return we(e).replaceAll("+","-").replaceAll("/","_").replace(/=+$/,"")}var tr=/^data:(.*?)(;base64)?,(.*)$/;function F(e){let r=e.match(tr);if(!r)return null;let[,t,n,s]=r;return{mediaType:t,isBase64:!!n,data:s}}function Mr(e){return e.isBase64?`data:${e.mediaType};base64,${e.data}`:`data:${e.mediaType},${e.data}`}function Wr(e){return m(this,null,function*(){return(yield fetch(e)).blob()})}function Kr(e){let r=rr(e);if(!r)return null;let t=F(e);return new Blob([r],{type:t.mediaType})}function C(e){return e!=null&&e[0]==="/"&&e[1]==="/"}function ue(e){return e!=null&&xe.test(e)}function nr(e){return e!=null&&Me.test(e)||p.scheme==="https"&&C(e)}function sr(e){return e!=null&&qe.test(e)||p.scheme==="http"&&C(e)}function or(e){return e!=null&&We.test(e)}function G(e){return C(e)?`https:${e}`:e.replace(qe,"https:")}function ar(){return p.scheme==="http"}function ne(){return p.scheme==="https"}function _(e,r=!1){return C(e)?e.slice(2):(e=e.replace(xe,""),r&&e.length>1&&e[0]==="/"&&e[1]==="/"&&(e=e.slice(2)),e)}function ir(e){let r=e.indexOf("//"),t=e.indexOf("/",r+2);return t===-1?e:e.slice(0,t)}function Qr(e){let r=0;if(D(e)){let n=e.indexOf("//");n!==-1&&(r=n+2)}let t=e.lastIndexOf("/");return t<r?e:e.slice(0,t+1)}function Gr(e,r){if(!e)return"";let t=T(e).path.replace(/\/+$/,""),n=t.substring(t.lastIndexOf("/")+1);if(!r?.length)return n;let s=new RegExp(`\\.(${r.join("|")})$`,"i");return n.replace(s,"")}function lr(e){return e.endsWith("/")?e:`${e}/`}function Jr(e){return e.replace(/\/+$/,"")}function ur(e){if(/^https?:\/\//i.test(e)){let r=ae(e);e=(e=r.path.replaceAll(/\/{2,}/g,"/")).replace("/","//"),r.query&&(e+=`?${r.query}`)}return e}function cr(e){return e.replace(/^(https?:\/\/)(arcgis\.com)/i,"$1www.$2")}function fr(e){let r=k.httpsDomains;if(!sr(e))return e;let t=e.indexOf("/",7),n;if(n=t===-1?e:e.slice(0,t),n=n.toLowerCase().slice(7),Ke.test(n)){if(!n.endsWith(":80"))return e;n=n.slice(0,-3),e=e.replace(":80","")}return ar()&&n===p.authority&&!Qe.test(e)||(ne()&&n===p.authority||r&&r.some(s=>n===s||n.endsWith(`.${s}`))||ne()&&!E(e))&&(e=G(e)),e}function Vr(e,r,t){if(!(r&&t&&e&&D(e)))return e;let n=e.indexOf("//"),s=e.indexOf("/",n+2),o=e.indexOf(":",n+2),a=Math.min(s<0?e.length:s,o<0?e.length:o);return e.slice(n+2,a).toLowerCase()!==r.toLowerCase()?e:`${e.slice(0,n+2)}${t}${e.slice(a)}`}function se(e){return typeof e=="string"?new v(le(e)):(e.scheme||(e.scheme=p.scheme),e)}function Xr(e){return pr.test(e)}function Yr(e,r){let t=T(e),n=Object.keys(t.query||{});return n.length>0&&r&&r.warn("removeQueryParameters()",`Url query parameters are not supported, the following parameters have been removed: ${n.join(", ")}.`),t.path}function Te(e,r,t){let n=T(e),s=n.query||{};return s[r]=String(t),`${n.path}?${$(s)}`}function J(e,r){if(!r)return e;let t=T(e),n=t.query||{};for(let[o,a]of Object.entries(r))a!=null&&(n[o]=a);let s=$(n);return s?`${t.path}?${s}`:t.path}function Zr(e){if(e==null)return null;let r=e.match(Ce);return r?r[2]:null}function et(e){if(e==null)return null;let r=e.match(Ce);return r?{path:r[1],extension:r[2]}:{path:e,extension:null}}function rt(e){return m(this,null,function*(){return typeof e=="string"?F(e)??{data:e}:new Promise((r,t)=>{let n=new FileReader;n.readAsDataURL(e),n.onload=()=>r(F(n.result)),n.onerror=s=>t(s)})})}var Ce=/([^.]*)\.([^/]*)$/,pr=/(^data:image\/svg|\.svg$)/i;var dr="20240709",mr="4e2e659f53c3b60cdade3d91a30466cbe90b86f9";Symbol.dispose??=Symbol("Symbol.dispose"),Symbol.asyncDispose??=Symbol("Symbol.asyncDispose");var hr="4.30",d,yr=hr;yr="4.30.8";function lt(e){d=e}function ut(e){let r=d?.findCredential(e);return r?.token?Te(e,"token",r.token):e}q("host-webworker");var gr=new Set(["elevation3d.arcgis.com","js.arcgis.com","jsdev.arcgis.com","jsqa.arcgis.com","static.arcgis.com"]);function Ue(e){let r=h(e,!0);return!!r&&r.endsWith(".arcgis.com")&&!gr.has(r)&&!e.endsWith("/sharing/rest/generateToken")}function Pe(e,r,t=!1,n){return new Promise((s,o)=>{if(H(n))return void o(Ae());let a=()=>{l(),o(new Error(`Unable to load ${r}`))},i=()=>{let f=e;l(),s(f)},u=()=>{if(!e)return;let f=e;l(),f.src="",o(Ae())},l=()=>{q("esri-image-decode")||(e.removeEventListener("error",a),e.removeEventListener("load",i)),a=null,i=null,e=null,n?.removeEventListener("abort",u),u=null,t&&URL.revokeObjectURL(r)};n?.addEventListener("abort",u),q("esri-image-decode")?e.decode().then(i,a):(e.addEventListener("error",a),e.addEventListener("load",i))})}function Ae(){try{return new DOMException("Aborted","AbortError")}catch{let e=new Error;return e.name="AbortError",e}}var ke="Timeout exceeded";function $e(){return new Error(ke)}function gt(e){return typeof e=="object"&&!!e&&"message"in e&&e.message===ke}function Le(e){g.request.crossOriginNoCorsDomains||(g.request.crossOriginNoCorsDomains={});let r=g.request.crossOriginNoCorsDomains;for(let t of e)t=t.toLowerCase(),/^https?:\/\//.test(t)?r[h(t)??""]=0:(r[h("http://"+t)??""]=0,r[h("https://"+t)??""]=0)}function Re(e){let r=g.request.crossOriginNoCorsDomains;if(r){let t=h(e);if(t)return t=t.toLowerCase(),!U(t,z())&&r[t]<Date.now()-36e5}return!1}function Ee(e){return m(this,null,function*(){let r=g.request.crossOriginNoCorsDomains,t=h(e);r&&t&&(r[t.toLowerCase()]=Date.now());let n=T(e);e=n.path,n.query?.f==="json"&&(e+="?f=json");try{yield fetch(e,{mode:"no-cors",credentials:"include"})}catch{}})}function O(e,r){return m(this,null,function*(){e instanceof URL&&(e=e.toString()),r?.query instanceof URLSearchParams&&(r.query=M(r.query.toString().replaceAll("+"," ")));let t=Q(e),n=K(e);n||t||(e=P(e));let s={url:e,requestOptions:y({},r)},o=c=>({data:c,getAllHeaders:L,getHeader:L,httpStatus:200,requestOptions:s.requestOptions,url:s.url}),a=ie(e,w.internalInterceptors);if(a){let c=yield Ie(a,s);if(c!=null)return o(c)}let i=ie(e);if(i){let c=yield Ie(i,s);if(c!=null)return o(c);i.after||i.error||(i=null)}if(e=s.url,(r=s.requestOptions).responseType==="image"&&(q("host-webworker")||q("host-node")))throw S("request:invalid-parameters",new Error("responseType 'image' is not supported in Web Workers or Node environment"),s);if(r.method==="head"){if(r.body)throw S("request:invalid-parameters",new Error("body parameter cannot be set when method is 'head'"),s);if(t||n)throw S("request:invalid-parameters",new Error("data and blob URLs are not supported for method 'head'"),s)}if(yield Or(),V)return V.execute(e,r);let u=new AbortController,l=me(r,()=>u.abort()),f={controller:u,credential:void 0,credentialToken:void 0,fetchOptions:void 0,hasToken:!1,interceptor:i,params:s,redoRequest:!1,useIdentity:w.useIdentity,useProxy:!1,useSSL:!1,withCredentials:!1},b=yield Cr(f).finally(()=>l?.remove());return i?.after?.(b),b})}var V,w=g.request,Be="FormData"in globalThis,wr=new Set([499,498,403,401]),br=new Set(["COM_0056","COM_0057","SB_0008"]),xr=[/\/arcgis\/tokens/i,/\/sharing(\/rest)?\/generatetoken/i,/\/rest\/info/i],L=()=>null,X=Symbol();function qr(e){let r=h(e);r&&!O._corsServers.includes(r)&&O._corsServers.push(r)}function De(e){let r=h(e);return!r||r.endsWith(".arcgis.com")||O._corsServers.includes(r)||W(r)}function S(e,r,t,n){let s="Error",o={url:t.url,requestOptions:t.requestOptions,getAllHeaders:L,getHeader:L,ssl:!1};if(r instanceof A)return r.details?(r.details=pe(r.details),r.details.url=t.url,r.details.requestOptions=t.requestOptions):r.details=o,r;if(r){let a=n&&(()=>Array.from(n.headers)),i=n&&(f=>n.headers.get(f)),u=n?.status,l=r.message;l&&(s=l),a&&i&&(o.getAllHeaders=a,o.getHeader=i),o.httpStatus=(r.httpCode!=null?r.httpCode:r.code)||u||0,o.subCode=r.subcode,o.messageCode=r.messageCode,typeof r.details=="string"?o.messages=[r.details]:o.messages=r.details,o.raw=X in r?r[X]:r}return he(r)?ee():new A(e,s,o)}function Or(){return m(this,null,function*(){q("host-webworker")&&!V&&(V=yield import("./chunk-PVEYZUH6.js"))})}function ce(){return m(this,null,function*(){d||(yield import("./chunk-4UNE475E.js"))})}function Sr(e){return m(this,null,function*(){let r=e.params.url,t=e.params.requestOptions,n=e.controller.signal,s=t.body,o=null,a=null;if(Be&&"HTMLFormElement"in globalThis&&(s instanceof FormData?o=s:s instanceof HTMLFormElement&&(o=new FormData(s))),typeof s=="string"&&(a=s),e.fetchOptions={cache:t.cacheBust?"no-cache":"default",credentials:"same-origin",headers:t.headers||{},method:t.method==="head"?"HEAD":"GET",mode:"cors",priority:w.priority,redirect:"follow",signal:n},(o||a)&&(e.fetchOptions.body=o||a),t.authMode==="anonymous"&&(e.useIdentity=!1),e.hasToken=!!(/token=/i.test(r)||t.query?.token||o?.get("token")),!e.hasToken&&g.apiKey&&Ue(r)&&(t.query||(t.query={}),t.query.token=g.apiKey,e.hasToken=!0),e.useIdentity&&!e.hasToken&&!e.credentialToken&&!Ne(r)&&!H(n)){let i;t.authMode==="immediate"?(yield ce(),i=yield d.getCredential(r,{signal:n}),e.credential=i):t.authMode==="no-prompt"?(yield ce(),i=yield d.getCredential(r,{prompt:!1,signal:n}).catch(()=>{}),e.credential=i):d&&(i=d.findCredential(r)),i&&(e.credentialToken=i.token,e.useSSL=!!i.ssl)}})}function Ne(e){return xr.some(r=>r.test(e))}function vr(e){return m(this,null,function*(){let r=e.params.url,t=e.params.requestOptions,n=e.fetchOptions??{},s=K(r)||Q(r),o=t.responseType||"json",a=s?0:t.timeout!=null?t.timeout:w.timeout,i=!1;if(!s){e.useSSL&&(r=G(r));let c=y({},t.query);e.credentialToken&&(c.token=e.credentialToken);let x=$(c);q("esri-url-encodes-apostrophe")&&(x=x.replaceAll("'","%27"));let Y=r.length+1+x.length,Z;i=t.method==="delete"||t.method==="post"||t.method==="put"||!!t.body||Y>w.maxUrlLength;let I=t.useProxy||!!E(r);if(I){let j=Oe(r);Z=j.path,!i&&Z.length+1+Y>w.maxUrlLength&&(i=!0),j.query&&(c=y(y({},j.query),c))}if(n.method==="HEAD"&&(i||I)){if(i)throw Y>w.maxUrlLength?S("request:invalid-parameters",new Error("URL exceeds maximum length"),e.params):S("request:invalid-parameters",new Error("cannot use POST request when method is 'head'"),e.params);if(I)throw S("request:invalid-parameters",new Error("cannot use proxy when method is 'head'"),e.params)}i?(n.method=t.method==="delete"?"DELETE":t.method==="put"?"PUT":"POST",t.body?r=J(r,c):(n.body=$(c),n.headers||(n.headers={}),n.headers["Content-Type"]="application/x-www-form-urlencoded")):r=J(r,c),I&&(e.useProxy=!0,r=`${Z}?${r}`),c.token&&Be&&n.body instanceof FormData&&!ye(r)&&n.body.set("token",c.token),t.hasOwnProperty("withCredentials")?e.withCredentials=t.withCredentials:U(r,z())||(W(r)||d&&d.findServerInfo(r)?.webTierAuth)&&(e.withCredentials=!0),e.withCredentials&&(n.credentials="include",Re(r)&&(yield Ee(i?J(r,c):r)))}let u,l,f=0,b=!1;a>0&&(f=setTimeout(()=>{b=!0,e.controller.abort()},a));try{if(t.responseType==="native-request-init")l=n,l.url=r;else if(t.responseType!=="image"||n.cache!=="default"||n.method!=="GET"||i||Tr(t.headers)||!s&&!e.useProxy&&w.proxyUrl&&!De(r)){if(O._beforeFetch&&(yield O._beforeFetch(r,n)),u=yield fetch(r,n),O._afterFetch&&(yield O._afterFetch(u)),e.useProxy||qr(r),t.responseType==="native")l=u;else if(n.method!=="HEAD")if(u.ok){switch(o){case"array-buffer":l=yield u.arrayBuffer();break;case"blob":case"image":l=yield u.blob();break;default:l=yield u.text()}if(f&&(clearTimeout(f),f=0),o==="json"||o==="xml"||o==="document")if(l)switch(o){case"json":l=JSON.parse(l);break;case"xml":l=je(l,"application/xml");break;case"document":l=je(l,"text/html")}else l=null;if(l){if(o==="array-buffer"||o==="blob"){let c=u.headers.get("Content-Type");if(c&&/application\/json|text\/plain/i.test(c)&&l[o==="blob"?"size":"byteLength"]<=750)try{let x=yield new Response(l).json();x.error&&(l=x)}catch{}}o==="image"&&l instanceof Blob&&(l=yield He(URL.createObjectURL(l),e,!0))}}else{l=yield u.text();try{l=JSON.parse(l)}catch{}}}else l=yield He(r,e)}catch(c){if(c.name==="AbortError")throw b?$e():ee("Request canceled");if(!(!u&&c instanceof TypeError&&w.proxyUrl)||t.body||t.method==="delete"||t.method==="head"||t.method==="post"||t.method==="put"||e.useProxy||De(r))throw c;e.redoRequest=!0,ve({proxyUrl:w.proxyUrl,urlPrefix:h(r)??""})}finally{f&&clearTimeout(f)}return[u,l]})}function Ie(e,r){return m(this,null,function*(){if(e.responseData!=null)return e.responseData;if(e.headers&&(r.requestOptions.headers=y(y({},r.requestOptions.headers),e.headers)),e.query&&(r.requestOptions.query=y(y({},r.requestOptions.query),e.query)),e.before){let t,n;try{n=yield e.before(r)}catch(s){t=S("request:interceptor",s,r)}if((n instanceof Error||n instanceof A)&&(t=S("request:interceptor",n,r)),t)throw e.error&&e.error(t),t;return n}})}function Tr(e){if(e){for(let r of Object.getOwnPropertyNames(e))if(e[r])return!0}return!1}function je(e,r){let t;try{t=new DOMParser().parseFromString(e,r)}catch{}if(!t||t.getElementsByTagName("parsererror").length)throw new SyntaxError("XML Parse error");return t}function Cr(e){return m(this,null,function*(){let r,t;yield Sr(e);try{do[r,t]=yield vr(e);while(!(yield Ur(e,r,t)))}catch(o){let a=S("request:server",o,e.params,r);throw a.details.ssl=e.useSSL,e.interceptor?.error&&e.interceptor.error(a),a}let n=e.params.url;if(t&&/\/sharing\/rest\/(accounts|portals)\/self/i.test(n)){if(!e.hasToken&&!e.credentialToken&&t.user?.username&&!W(n)){let o=h(n,!0);o&&w.trustedServers.push(o)}Array.isArray(t.authorizedCrossOriginNoCorsDomains)&&Le(t.authorizedCrossOriginNoCorsDomains)}let s=e.credential;if(s&&d){let a=d.findServerInfo(s.server)?.owningSystemUrl;if(a){a=a.replace(/\/?$/,"/sharing");let i=d.findCredential(a,s.userId);i&&d._getIdenticalSvcIdx(a,i)===-1&&i.resources.unshift(a)}}return{data:t,getAllHeaders:r?()=>Array.from(r.headers):L,getHeader:r?o=>r.headers.get(o):L,httpStatus:r?.status??200,requestOptions:e.params.requestOptions,ssl:e.useSSL,url:e.params.url}})}function Ur(e,r,t){return m(this,null,function*(){if(e.redoRequest)return e.redoRequest=!1,!1;let n=e.params.requestOptions;if(!r||n.responseType==="native"||n.responseType==="native-request-init")return!0;let s,o;if(t&&(t.error&&typeof t.error=="object"?s=t.error:t.status==="error"&&Array.isArray(t.messages)&&(s=y({},t),s[X]=t,s.details=t.messages)),!s&&!r.ok)throw s=new Error(`Unable to load ${r.url} status: ${r.status}`),s[X]=t,s;let a,i=null;s&&(o=Number(s.code),i=s.hasOwnProperty("subcode")?Number(s.subcode):null,a=s.messageCode,a=a?.toUpperCase());let u=n.authMode;if(o===403&&(i===4||s.message?.toLowerCase().includes("ssl")&&!s.message.toLowerCase().includes("permission"))){if(!e.useSSL)return e.useSSL=!0,!1}else if(!e.hasToken&&e.useIdentity&&(u!=="no-prompt"||o===498)&&o!==void 0&&wr.has(o)&&!Ne(e.params.url)&&(o!==403||(!a||!br.has(a))&&(i==null||i===2&&e.credentialToken))){yield ce();try{let l=yield d.getCredential(e.params.url,{error:S("request:server",s,e.params),prompt:u!=="no-prompt",signal:e.controller.signal,token:e.credentialToken});return e.credential=l,e.credentialToken=l.token,e.useSSL=e.useSSL||l.ssl,!1}catch(l){if(u==="no-prompt")return e.credential=void 0,e.credentialToken=void 0,!1;s=l}}if(s)throw s;return!0})}function He(e,r,t=!1){let n=r.controller.signal,s=new Image;return r.withCredentials?s.crossOrigin="use-credentials":s.crossOrigin="anonymous",s.alt="",s.fetchPriority=w.priority,s.src=e,Pe(s,e,t,n)}O._corsServers=["https://server.arcgisonline.com","https://services.arcgisonline.com"],O._beforeFetch=void 0,O._afterFetch=void 0;export{te as a,ye as b,Ar as c,ge as d,v as e,z as f,Hr as g,T as h,M as i,$ as j,Br as k,E as l,Nr as m,Fr as n,ie as o,U as p,le as q,_r as r,P as s,er as t,h as u,D as v,K as w,Q as x,rr as y,zr as z,F as A,Mr as B,Wr as C,Kr as D,C as E,nr as F,G,Qr as H,Gr as I,lr as J,Jr as K,Vr as L,Xr as M,Yr as N,J as O,Zr as P,et as Q,rt as R,dr as S,mr as T,hr as U,d as V,yr as W,lt as X,ut as Y,Ue as Z,Pe as _,gt as $,O as aa};
