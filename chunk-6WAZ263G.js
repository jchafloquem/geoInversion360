import{Pa as et,Qa as Yt,Ua as R,i as gt,j as _t,k as Me,l as Te,m as be,n as we,o as ve}from"./chunk-HWE2MRBZ.js";import{k as ke,l as Pe,n as yt,o as Se}from"./chunk-MODIWOII.js";import{a as S,b as zt,d as Gt,e as pe,k as de,l as xe,m as ye,t as Nt}from"./chunk-SE7FIBEW.js";import{a as ue,e as he,g as fe,k as me}from"./chunk-AC7AQWXQ.js";import{a as ce,b as le,c as Ee}from"./chunk-JSBUB3E7.js";import{a as Ct,c as Wt,k as _e}from"./chunk-P7VZMSEG.js";import{E as A,I as z,S as ne,T as ae,c as se,d as ie,w as oe}from"./chunk-B7IX6UFG.js";import{a as ut,b as ht,c as ft,q as mt,s as dt}from"./chunk-HUYHDVA2.js";import{D as xt}from"./chunk-BPPBSQ5N.js";import{a as ge}from"./chunk-IFCRPPYQ.js";import{h as u}from"./chunk-ZAQLF7TN.js";import{n as tt}from"./chunk-J57HR4DB.js";import{a as re}from"./chunk-TNPL7MIN.js";import{a as x}from"./chunk-AQ74ANSJ.js";import{b as ee}from"./chunk-4HUAEW4D.js";import{b as Lt}from"./chunk-TMZNSBQB.js";import{q as $t,s as te}from"./chunk-BRWS572J.js";import{a as Kt}from"./chunk-AKNRR36C.js";import{a as g,b as P,f as W,g as w}from"./chunk-JEGVIFEP.js";function Fe(e,t,r,s,i,o,n){Vt=0;let a=(s-r)*o,c=i&&i.length,p=c?(i[0]-r)*o:a,l,f,h,m,d,y=De(t,r,s,0,p,o,!0);if(y&&y.next!==y.prev){if(c&&(y=ar(t,r,s,i,y,o)),a>80*o){l=h=t[0+r*o],f=m=t[1+r*o];for(let _=o;_<p;_+=o){let T=t[_+r*o],E=t[_+1+r*o];l=Math.min(l,T),f=Math.min(f,E),h=Math.max(h,T),m=Math.max(m,E)}d=Math.max(h-l,m-f),d=d!==0?1/d:0}st(y,e,o,l,f,d,n,0)}}function De(e,t,r,s,i,o,n){let a;if(n===hr(e,t,r,s,i,o)>0)for(let c=s;c<i;c+=o)a=Ie(c+t*o,e[c+t*o],e[c+1+t*o],a);else for(let c=i-o;c>=s;c-=o)a=Ie(c+t*o,e[c+t*o],e[c+1+t*o],a);return a&&N(a,a.next)&&(it(a),a=a.next),a}function rt(e,t=e){if(!e)return e;let r,s=e;do if(r=!1,s.steiner||!N(s,s.next)&&M(s.prev,s,s.next)!==0)s=s.next;else{if(it(s),s=t=s.prev,s===s.next)break;r=!0}while(r||s!==t);return t}function st(e,t,r,s,i,o,n,a){if(!e)return;!a&&o&&(e=Ae(e,s,i,o));let c=e;for(;e.prev!==e.next;){let p=e.prev,l=e.next;if(o?or(e,s,i,o):ir(e))t.push(p.index/r+n),t.push(e.index/r+n),t.push(l.index/r+n),it(e),e=l.next,c=l.next;else if((e=l)===c){a?a===1?st(e=mr(e,t,r,n),t,r,s,i,o,n,2):a===2&&dr(e,t,r,s,i,o,n):st(rt(e),t,r,s,i,o,n,1);break}}}function ir(e){let t=e.prev,r=e,s=e.next;if(M(t,r,s)>=0)return!1;let i=e.next.next,o=i,n=0;for(;i!==e.prev&&(n===0||i!==o);){if(n++,V(t.x,t.y,r.x,r.y,s.x,s.y,i.x,i.y)&&M(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function or(e,t,r,s){let i=e.prev,o=e,n=e.next;if(M(i,o,n)>=0)return!1;let a=i.x<o.x?i.x<n.x?i.x:n.x:o.x<n.x?o.x:n.x,c=i.y<o.y?i.y<n.y?i.y:n.y:o.y<n.y?o.y:n.y,p=i.x>o.x?i.x>n.x?i.x:n.x:o.x>n.x?o.x:n.x,l=i.y>o.y?i.y>n.y?i.y:n.y:o.y>n.y?o.y:n.y,f=Ot(a,c,t,r,s),h=Ot(p,l,t,r,s),m=e.prevZ,d=e.nextZ;for(;m&&m.z>=f&&d&&d.z<=h;){if(m!==e.prev&&m!==e.next&&V(i.x,i.y,o.x,o.y,n.x,n.y,m.x,m.y)&&M(m.prev,m,m.next)>=0||(m=m.prevZ,d!==e.prev&&d!==e.next&&V(i.x,i.y,o.x,o.y,n.x,n.y,d.x,d.y)&&M(d.prev,d,d.next)>=0))return!1;d=d.nextZ}for(;m&&m.z>=f;){if(m!==e.prev&&m!==e.next&&V(i.x,i.y,o.x,o.y,n.x,n.y,m.x,m.y)&&M(m.prev,m,m.next)>=0)return!1;m=m.prevZ}for(;d&&d.z<=h;){if(d!==e.prev&&d!==e.next&&V(i.x,i.y,o.x,o.y,n.x,n.y,d.x,d.y)&&M(d.prev,d,d.next)>=0)return!1;d=d.nextZ}return!0}function Ie(e,t,r,s){let i=H.create(e,t,r);return s?(i.next=s.next,i.prev=s,s.next.prev=i,s.next=i):(i.prev=i,i.next=i),i}function it(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function nr(e){let t=e,r=e;do(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next;while(t!==e);return r}function ar(e,t,r,s,i,o){let n=new Array;for(let a=0,c=s.length;a<c;a++){let p=De(e,t,r,s[a]*o,a<c-1?s[a+1]*o:r*o,o,!1);p===p.next&&(p.steiner=!0),n.push(nr(p))}n.sort(fr);for(let a of n)i=cr(a,i);return i}function cr(e,t){let r=lr(e,t);if(!r)return t;let s=Le(r,e);return rt(s,s.next),rt(r,r.next)}function lr(e,t){let r=t,s=e.x,i=e.y,o,n=-1/0;do{if(i<=r.y&&i>=r.next.y&&r.next.y!==r.y){let h=r.x+(i-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(h<=s&&h>n){if(n=h,h===s){if(i===r.y)return r;if(i===r.next.y)return r.next}o=r.x<r.next.x?r:r.next}}r=r.next}while(r!==t);if(!o)return null;if(s===n)return o.prev;let a=o,c=o.x,p=o.y,l,f=1/0;for(r=o.next;r!==a;)s>=r.x&&r.x>=c&&s!==r.x&&V(i<p?s:n,i,c,p,i<p?n:s,i,r.x,r.y)&&(l=Math.abs(i-r.y)/(s-r.x),(l<f||l===f&&r.x>o.x)&&ot(r,e)&&(o=r,f=l)),r=r.next;return o}function Ae(e,t,r,s){let i;for(;i!==e;i=i.next){if(i=i||e,i.z===null&&(i.z=Ot(i.x,i.y,t,r,s)),i.prev.next!==i||i.next.prev!==i)return i.prev.next=i,i.next.prev=i,Ae(e,t,r,s);i.prevZ=i.prev,i.nextZ=i.next}return e.prevZ.nextZ=null,e.prevZ=null,pr(e)}function pr(e){let t,r=1;for(;;){let s,i=e;e=null,t=null;let o=0;for(;i;){o++,s=i;let n=0;for(;n<r&&s;n++)s=s.nextZ;let a=r;for(;n>0||a>0&&s;){let c;n===0?(c=s,s=s.nextZ,a--):a!==0&&s?i.z<=s.z?(c=i,i=i.nextZ,n--):(c=s,s=s.nextZ,a--):(c=i,i=i.nextZ,n--),t?t.nextZ=c:e=c,c.prevZ=t,t=c}i=s}if(t.nextZ=null,r*=2,o<2)return e}}function M(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function Be(e,t,r,s){return!!(N(e,t)&&N(r,s)||N(e,s)&&N(r,t))||M(e,t,r)>0!=M(e,t,s)>0&&M(r,s,e)>0!=M(r,s,t)>0}function ur(e,t){let r=e;do{if(r.index!==e.index&&r.next.index!==e.index&&r.index!==t.index&&r.next.index!==t.index&&Be(r,r.next,e,t))return!0;r=r.next}while(r!==e);return!1}function hr(e,t,r,s,i,o){let n=0;for(let a=s,c=i-o;a<i;a+=o)n+=(e[c+t*o]-e[a+t*o])*(e[a+1+t*o]+e[c+1+t*o]),c=a;return n}function V(e,t,r,s,i,o,n,a){return(i-n)*(t-a)-(e-n)*(o-a)>=0&&(e-n)*(s-a)-(r-n)*(t-a)>=0&&(r-n)*(o-a)-(i-n)*(s-a)>=0}function ot(e,t){return M(e.prev,e,e.next)<0?M(e,t,e.next)>=0&&M(e,e.prev,t)>=0:M(e,t,e.prev)<0||M(e,e.next,t)<0}function Ot(e,t,r,s,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*i)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-s)*i)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function N(e,t){return e.x===t.x&&e.y===t.y}function fr(e,t){return e.x-t.x}function mr(e,t,r,s){let i=e;do{let o=i.prev,n=i.next.next;!N(o,n)&&Be(o,i,i.next,n)&&ot(o,n)&&ot(n,o)&&(t.push(o.index/r+s),t.push(i.index/r+s),t.push(n.index/r+s),it(i),it(i.next),i=e=n),i=i.next}while(i!==e);return i}function dr(e,t,r,s,i,o,n){let a=e;do{let c=a.next.next;for(;c!==a.prev;){if(a.index!==c.index&&xr(a,c)){let p=Le(a,c);return a=rt(a,a.next),p=rt(p,p.next),st(a,t,r,s,i,o,n,0),void st(p,t,r,s,i,o,n,0)}c=c.next}a=a.next}while(a!==e)}function xr(e,t){return e.next.index!==t.index&&e.prev.index!==t.index&&!ur(e,t)&&ot(e,t)&&ot(t,e)&&yr(e,t)}function yr(e,t){let r=e,s=!1,i=(e.x+t.x)/2,o=(e.y+t.y)/2;do r.y>o!=r.next.y>o&&r.next.y!==r.y&&i<(r.next.x-r.x)*(o-r.y)/(r.next.y-r.y)+r.x&&(s=!s),r=r.next;while(r!==e);return s}function Le(e,t){let r=H.create(e.index,e.x,e.y),s=H.create(t.index,t.x,t.y),i=e.next,o=t.prev;return e.next=t,t.prev=e,r.next=i,i.prev=r,s.next=r,r.prev=s,o.next=s,s.prev=o,s}var H=class e{constructor(){this.index=0,this.x=0,this.y=0,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}static create(t,r,s){let i=Vt<Rt.length?Rt[Vt++]:new e;return i.index=t,i.x=r,i.y=s,i.prev=null,i.next=null,i.z=null,i.prevZ=null,i.nextZ=null,i.steiner=!1,i}},Rt=[],gr=8096,Vt=0;for(let e=0;e<gr;e++)Rt.push(new H);var _r=1e-5,Y=new Wt(0,0,0,1,0),Ht=new Wt(0,0,0,1,0);function Ce(e,t,r){let s=0;for(let i=1;i<r;i++){let o=e[2*(t+i-1)],n=e[2*(t+i-1)+1];s+=(e[2*(t+i)]-o)*(e[2*(t+i)+1]+n)}return s}function kr(e,t,r,s,i){let o=0,n=2;for(let a=r;a<s;a+=3){let c=(e[a]-i)*n,p=(e[a+1]-i)*n,l=(e[a+2]-i)*n;o+=Math.abs((t[c]-t[l])*(t[p+1]-t[c+1])-(t[c]-t[p])*(t[l+1]-t[c+1]))}return o}function We(e,t){let{coords:r,lengths:s,hasIndeterminateRingOrder:i}=t,o=0,n=e;if(i)return!1;let a=0;for(let c=0;c<s.length;){let p=c,l=s[c],f=Ce(r,a,l),h=[];for(;++p<s.length;){let _=s[p],T=Ce(r,a+l,_);if(!(T>0))break;f+=T,h.push(a+l),l+=_}let m=n.length;Fe(n,r,a,a+l,h,2,o);let d=kr(n,r,m,n.length,o),y=Math.abs(f);if(Math.abs((d-y)/Math.max(1e-7,y))>_r)return n.length=0,!1;c=p,a+=l}return!0}function ze(e){let{coords:t,lengths:r}=e,{buffer:s}=le(t,r);return s}function Pr(e,t,r){let s=0;for(let i=0;i<e.lengths.length;i++){let o=e.lengths[i];for(let n=0;n<o;n++){let a=e.coords[2*(n+s)],c=e.coords[2*(n+s)+1];if(a<t||a>r||c<t||c>r)return!0}s+=o}return!1}function Pt(e,t){if(e==null)return null;if(!Pr(e,-128,640))return e;Y.setPixelMargin(t),Y.reset(Ct.Polygon);let r=0;for(let n=0;n<e.lengths.length;n++){let a=e.lengths[n],c=e.coords[2*(0+r)],p=e.coords[2*(0+r)+1];Y.moveTo(c,p);for(let l=1;l<a;l++)c=e.coords[2*(l+r)],p=e.coords[2*(l+r)+1],Y.lineTo(c,p);Y.close(),r+=a}let s=Y.result(!1);if(!s)return null;let i=[],o=[];for(let n of s){let a=0;for(let c of n)o.push(c.x),o.push(c.y),a++;i.push(a)}return new re(i,o)}function Ge(e,t){Ht.setPixelMargin(t);let r=Ht,s=-t,i=512+t,o=[],n=!1;if(!e.nextPath())return null;let a=!0;for(;a;){e.seekPathStart();let c=[];if(!e.pathSize)return null;r.reset(Ct.LineString),e.nextPoint();let p=e.x,l=e.y;if(n)r.moveTo(p,l);else{if(p<s||p>i||l<s||l>i){n=!0;continue}c.push({x:p,y:l})}let f=!1;for(;e.nextPoint();)if(p=e.x,l=e.y,n)r.lineTo(p,l);else{if(p<s||p>i||l<s||l>i){f=!0;break}c.push({x:p,y:l})}if(f)n=!0;else{if(n){let h=r.resultWithStarts();if(h)for(let m of h)o.push(m)}else o.push({line:c,start:0});a=e.nextPath(),n=!1}}return o=o.filter(c=>c.line.length>1),o.length===0?null:o}Y.setExtent(512),Ht.setExtent(512);var Sr=96/72,St=class{static executeEffects(t,r,s,i){let o=Sr,n=Nt(t),a=new zt(r);for(let c of t){let p=Gt(c);p&&(a=p.execute(a,c,o,s,i,n))}return a}static applyEffects(t,r,s){if(!t)return r;let i=Nt(t),o,n=new zt(S.fromJSONCIM(r));for(let p of t){let l=Gt(p);l&&(n=l.execute(n,p,1,null,s,i))}let a=[],c=null;for(;o=n.next();)a.push(...ee(o)),c=o.geometryType;return a.length===0||c===null?null:c==="esriGeometryPolygon"?{rings:a}:{paths:a}}};var Ne=null;function U(){return Ne}function Ye(){return w(this,null,function*(){Ne=yield import("./chunk-REJPHZXN.js")})}function Oe(e){switch(e){case u.BYTE:case u.UNSIGNED_BYTE:return 1;case u.SHORT:case u.UNSIGNED_SHORT:case u.HALF_FLOAT:return 2;case u.FLOAT:case u.INT:case u.UNSIGNED_INT:return 4}}function Mr(e){let t=[],r=[],s=[];for(let i of e){let o=Oe(i.type)*i.count;switch(o%2||o%4||4){case 4:t.push(i);continue;case 2:r.push(i);continue;case 1:s.push(i);continue;default:throw new Error("Found unexpected dataType byte count")}}return t.push(...r),t.push(...s),t}var Mt=class e{static fromVertexSpec(t,r){let{attributes:s,optionalAttributes:i}=t,o,n,a,c=[];for(let y in s){let _=s[y];_.pack==="position"?o=P(g({},_),{name:y,offset:0}):_.pack==="id"?n=P(g({},_),{name:y,offset:4}):y==="bitset"?a=P(g({},_),{name:y,offset:7}):c.push(P(g({},_),{name:y}))}for(let y in i)if(r[y]===!0){let _=i[y];c.push(P(g({},_),{name:y}))}let p=Mr(c),l=[],f=8,h=1;for(let y of p)l.push(P(g({},y),{offset:f})),f+=Oe(y.type)*y.count,y.packAlternating&&(h=Math.max(y.packAlternating.count,h));let m=Uint32Array.BYTES_PER_ELEMENT,d=f%m;return new e(o,n,a,l,f+(d?m-d:0),h)}constructor(t,r,s,i,o,n){this.position=t,this.id=r,this.bitset=s,this.standardAttributes=i,this.stride=o,this.packVertexCount=n,i.push(s),this._attributes=[t,r,s,...i]}get attributeLayout(){if(!this._attributeLayout){let t=Pe(this._attributes),r=this._attributes.map(s=>({name:s.name,count:s.count,offset:s.offset,type:s.type,packPrecisionFactor:s.packPrecisionFactor,normalized:s.normalized??!1}));this._attributeLayout={attributes:r,hash:t,stride:this.stride}}return this._attributeLayout}};var Tt=class e{static fromVertexSpec(t,r){let s=Mt.fromVertexSpec(t,r);return new e(s)}constructor(t){this._spec=t,this._packed=new Uint8Array(this._spec.stride*this._spec.packVertexCount),this._packedU32View=new Uint32Array(this._packed.buffer),this._dataView=new DataView(this._packed.buffer)}get attributeLayout(){return this._spec.attributeLayout}get stride(){return this._spec.stride}writeVertex(t,r,s,i,o,n){for(let a=0;a<this._spec.packVertexCount;a++){let c=a*this._spec.stride;this._packPosition(s,i,c),this._packId(r,c);let p=this._spec.bitset;if(n){if(p.packTessellation){let l=p.packTessellation(n,o);this._pack(l,p,c)}for(let l of this._spec.standardAttributes)if(l.packTessellation!=null){let f=l.packTessellation(n,o);this._pack(f,l,c)}else if(l.packAlternating?.packTessellation){let f=l.packAlternating.packTessellation(n,o);for(let h=0;h<this._spec.packVertexCount;h++){let m=f[h];this._pack(m,l,h*this._spec.stride)}}}}t.vertexWriteRegion(this._packedU32View)}pack(t,r){for(let s of this._spec.standardAttributes)if(s.pack&&typeof s.pack!="string"){let i=s.pack(t,r);for(let o=0;o<this._spec.packVertexCount;o++)this._pack(i,s,o*this._spec.stride)}else if(s.packAlternating?.pack){let i=s.packAlternating.pack(t,r);for(let o=0;o<this._spec.packVertexCount;o++){let n=i[o];this._pack(n,s,o*this._spec.stride)}}}_packPosition(t,r,s){let{offset:i}=this._spec.position,o=this._spec.position.packPrecisionFactor??1,n=ke(t*o,r*o);this._dataView.setUint32(s+i,n,!0)}_packId(t,r){let s=t*(this._spec.id.packPrecisionFactor??1),i=4278190080&this._dataView.getUint32(r+this._spec.id.offset,!0);this._dataView.setUint32(r+this._spec.id.offset,s|i,!0)}_pack(t,r,s){Se(this._dataView,t,r,s)}};function Tr(e){if(!e)return!1;for(let t of e)switch(t.effect.type){case"CIMGeometricEffectBuffer":case"CIMGeometricEffectOffset":case"CIMGeometricEffectDonut":return!0}return!1}var b=class{constructor(t,r,s,i){this._instanceId=t,this._evaluator=r,this._enabledOptionalAttributes=s,this._viewParams=i,this._evaluator.evaluator=o=>this.vertexSpec.createComputedParams(o)}get _vertexPack(){if(!this._cachedVertexPack){let t=Tt.fromVertexSpec(this.vertexSpec,this._enabledOptionalAttributes);this._evaluator.hasDynamicProperties||t.pack(this._evaluator.evaluatedMeshParams,this._viewParams),this._cachedVertexPack=t}return this._cachedVertexPack}get evaluatedMeshParams(){return this._evaluator.evaluatedMeshParams}get hasEffects(){return!!this.evaluatedMeshParams.effects}get instanceId(){return this._instanceId}get attributeLayout(){return this._vertexPack.attributeLayout}setReferences(t){this._references=t}getBoundsInfo(){return null}getTileInfo(){return this._viewParams.tileInfo}loadDependencies(){return w(this,null,function*(){Tr(this._evaluator.inputMeshParams.effects?.effectInfos)&&(yield Ye())})}enqueueRequest(t,r,s){this._evaluator.hasDynamicProperties&&this._evaluator.enqueueRequest(t,r,s)}write(t,r,s,i,o){this.ensurePacked(r,s,i);let n=this.evaluatedMeshParams.effects;if(!n||n.length===0)return void this._write(t,s,void 0,o);let a=s.readGeometryForDisplay()?.clone();if(!a)return;let c=S.fromOptimizedCIM(a,s.geometryType),p=U();c.invertY();let l=t.id||"",f=St.executeEffects(n,c,l,p),h;for(;h=f.next();)h.invertY(),this._write(t,s,h,o)}ensurePacked(t,r,s){if(!this._evaluator.hasDynamicProperties)return;let i=this._evaluator.evaluateMeshParams(t,r,s);this._vertexPack.pack(i,this._viewParams)}_writeVertex(t,r,s,i,o){let n=this.evaluatedMeshParams;this._vertexPack.writeVertex(t,r,s,i,n,o)}};var br=100,wr=Kt("featurelayer-fast-triangulation-enabled"),X=class e extends b{loadDependencies(){return w(this,null,function*(){yield Promise.all([W(e.prototype,this,"loadDependencies").call(this),ce()])})}_write(t,r,s){let i=s?.asOptimized()??r.readGeometryForDisplay(),o=this._clip(i);o&&(t.recordStart(this.instanceId,this.attributeLayout),this._writeGeometry(t,r,o),t.recordEnd())}_clip(t){if(!t)return null;let r=this.hasEffects;return Pt(t,r?256:8)}_writeGeometry(t,r,s){let i=s.maxLength>br,o=[],n=this.createTesselationParams(r);if(!i&&wr&&We(o,s))return void(o.length&&this._writeVertices(t,r,s.coords,n,o));let a=ze(s);this._writeVertices(t,r,a,n)}_writeVertices(t,r,s,i,o){let n=r.getDisplayId(),a=t.vertexCount(),c=this.hasEffects,p=0;if(o)for(let l of o){let f=s[2*l],h=s[2*l+1];c&&t.recordBounds(f,h,0,0),this._writeVertex(t,n,f,h,i),p++}else for(let l=0;l<s.length;l+=2){let f=Math.round(s[l]),h=Math.round(s[l+1]);c&&t.recordBounds(f,h,0,0),this._writeVertex(t,n,f,h,i),p++}t.indexEnsureSize(p);for(let l=0;l<p;l++)t.indexWrite(l+a)}};var vr={createComputedParams:e=>e,optionalAttributes:{},attributes:{id:{type:u.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:u.UNSIGNED_BYTE,count:1},pos:{type:u.SHORT,count:2,pack:"position",packPrecisionFactor:10},inverseArea:{type:u.FLOAT,count:1,packTessellation:({inverseArea:e})=>e}}},Re=class extends X{constructor(){super(...arguments),this.vertexSpec=vr}createTesselationParams(t){return{inverseArea:1/t.readGeometryArea()}}};var Er=()=>$t.getLogger("esri.views.2d.engine.webgl.shaderGraph.techniques.meshWriterUtils"),Ir=0,Fr=100;function F(e,t){return[!!e?.minScale&&t.scaleToZoom(e.minScale)||Ir,!!e?.maxScale&&t.scaleToZoom(e.maxScale)||Fr]}function Z(e){return 1<<e}function D(e){let t=0;for(let[r,s]of e)s&&(t|=1<<r);return t}function k(e){let t;if(!e)return[0,0,0,0];if(typeof e=="string"){let n=ge.fromString(e);if(!n)return Er().errorOnce(new te("mapview:mesh-processing","Unable to parse string into color",{color:e})),[0,0,0,0];t=n.toArray()}else t=e;let[r,s,i,o]=t;return[r*(o/255),s*(o/255),i*(o/255),o]}function Ve(e){switch(e){case"butt":case mt.Butt:return ut.BUTT;case"round":case mt.Round:return ut.ROUND;case"square":case mt.Square:return ut.SQUARE}}function He(e){switch(e){case"bevel":case dt.Bevel:return ht.BEVEL;case"miter":case dt.Miter:return ht.MITER;case"round":case dt.Round:return ht.ROUND}}function bt(e,t){return Math.round(Math.min(Math.sqrt(e*t),255))}function nt(e,t){return Math.round(e*t)/t}var wt={createComputedParams:e=>e,optionalAttributes:{zoomRange:{type:u.SHORT,count:2,packPrecisionFactor:z,pack:({scaleInfo:e},{tileInfo:t})=>F(e,t)}},attributes:{id:{type:u.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:u.UNSIGNED_BYTE,count:1},pos:{type:u.SHORT,count:2,pack:"position",packPrecisionFactor:10},color:{type:u.UNSIGNED_BYTE,count:4,normalized:!0,pack:({color:e})=>k(e)}}},q=class extends X{constructor(){super(...arguments),this.vertexSpec=wt}createTesselationParams(t){return null}};var B={createComputedParams:e=>e,optionalAttributes:wt.optionalAttributes,attributes:P(g({},wt.attributes),{tlbr:{count:4,type:u.UNSIGNED_SHORT,pack:({sprite:e})=>{let{rect:t,width:r,height:s}=e,i=t.x+A,o=t.y+A;return[i,o,i+r,o+s]}},inverseRasterizationScale:{count:1,type:u.BYTE,packPrecisionFactor:16,pack:({sprite:e})=>1/e.rasterizationScale}})},vt=class extends q{constructor(){super(...arguments),this.vertexSpec=B}_write(t,r,s){let i=s?.asOptimized()??r.readGeometryForDisplay(),o=this._clip(i);if(!o)return;let n=this.evaluatedMeshParams.sprite?.textureBinding;t.recordStart(this.instanceId,this.attributeLayout,n),this._writeGeometry(t,r,o),t.recordEnd()}};function at(e){let{sprite:t,aspectRatio:r,scaleProportionally:s}=e,i=x(e.height),o=i>0?i:t.height,n=i*r;return n<=0?n=t.width:s&&(n*=t.width/t.height),{width:n,height:o}}function Ut(e){let{applyRandomOffset:t,sampleAlphaOnly:r}=e;return D([[Me,t],[gt,r]])}var Xt={createComputedParams:e=>e,optionalAttributes:B.optionalAttributes,attributes:P(g({},B.attributes),{bitset:{count:1,type:u.UNSIGNED_BYTE,pack:Ut},width:{count:1,type:u.HALF_FLOAT,pack:e=>at(e).width},height:{count:1,type:u.HALF_FLOAT,pack:e=>at(e).height},offset:{count:2,type:u.HALF_FLOAT,pack:({offsetX:e,offsetY:t})=>[x(e),-x(t)]},scale:{count:2,type:u.UNSIGNED_BYTE,packPrecisionFactor:16,pack:({scaleX:e,scaleY:t})=>[e,t]},angle:{count:1,type:u.UNSIGNED_BYTE,pack:({angle:e})=>_e(e)}})},Ue=class extends vt{constructor(){super(...arguments),this.vertexSpec=Xt}};var Zt=class{constructor(){this.extrusionOffsetX=0,this.extrusionOffsetY=0,this.normalX=0,this.normalY=0,this.directionX=0,this.directionY=0,this.distance=0}},L={createComputedParams:e=>e,optionalAttributes:{zoomRange:{type:u.SHORT,count:2,packPrecisionFactor:z,pack:({scaleInfo:e},{tileInfo:t})=>F(e,t)}},attributes:{id:{type:u.UNSIGNED_BYTE,count:3,pack:"id"},pos:{type:u.SHORT,count:2,pack:"position",packPrecisionFactor:10},bitset:{type:u.UNSIGNED_BYTE,count:1},color:{type:u.UNSIGNED_BYTE,count:4,normalized:!0,pack:({color:e})=>k(e)},offset:{type:u.BYTE,count:2,packPrecisionFactor:16,packTessellation:({extrusionOffsetX:e,extrusionOffsetY:t})=>[nt(e,16),nt(t,16)]},normal:{type:u.BYTE,count:2,packPrecisionFactor:16,packTessellation:({normalX:e,normalY:t})=>[nt(e,16),nt(t,16)]},halfWidth:{type:u.HALF_FLOAT,count:1,pack:({width:e})=>x(.5*e)},referenceHalfWidth:{type:u.HALF_FLOAT,count:1,pack:({referenceWidth:e})=>x(.5*e)}}},qt=class{constructor(){this.id=0,this.bitset=0,this.indexCount=0,this.vertexCount=0,this.vertexFrom=0,this.vertexBounds=0}},Xe=65535,Q=class extends b{constructor(t,r,s,i){super(t,r,s,i),this.vertexSpec=L,this._currentWrite=new qt,this._tessellationOptions={halfWidth:0,pixelCoordRatio:1,offset:0,wrapDistance:Xe,textured:!1},this._tessParams=new Zt,this._initializeTessellator()}writeLineVertices(t,r,s){let i=this._getLines(r);i!=null&&this._writeVertices(t,s,i)}_initializeTessellator(){this._lineTessellator=new Ee(this._writeTesselatedVertex.bind(this),this._writeTriangle.bind(this),!0)}_write(t,r,s){let i=s??S.fromFeatureSetReaderCIM(r);i&&this._writeGeometry(t,r,i)}_writeGeometry(t,r,s,i){t.recordStart(this.instanceId,this.attributeLayout,i),this.writeLineVertices(t,s,r),t.recordEnd()}_getLines(t){return Ge(t,yt(this.evaluatedMeshParams))}_writeVertices(t,r,s){let{_currentWrite:i,_tessellationOptions:o,evaluatedMeshParams:n}=this,{width:a,capType:c,joinType:p,miterLimit:l,hasSizeVV:f}=n,h=x(.5*a);o.halfWidth=h,o.capType=Ve(c),o.joinType=He(p),o.miterLimit=l;let m=!f;i.out=t,i.id=r.getDisplayId(),i.vertexCount=0,i.indexCount=0,i.vertexFrom=t.vertexCount(),i.vertexBounds=m&&h<oe?0:1;for(let{line:d,start:y}of s)o.initialDistance=y%Xe,this._lineTessellator.tessellate(d,o,m)}_writeTesselatedVertex(t,r,s,i,o,n,a,c,p,l,f){let{out:h,id:m,vertexBounds:d}=this._currentWrite;return this.hasEffects&&h.recordBounds(t,r,d,d),this._tessParams.extrusionOffsetX=a,this._tessParams.extrusionOffsetY=c,this._tessParams.normalX=p,this._tessParams.normalY=l,this._tessParams.directionX=o,this._tessParams.directionY=n,this._tessParams.distance=f,this._writeVertex(h,m,t,r,this._tessParams),this._currentWrite.vertexFrom+this._currentWrite.vertexCount++}_writeTriangle(t,r,s){let{out:i}=this._currentWrite;i.indexEnsureSize(3),i.indexWrite(t),i.indexWrite(r),i.indexWrite(s),this._currentWrite.indexCount+=3}};var Qt={createComputedParams:e=>e,optionalAttributes:L.optionalAttributes,attributes:P(g({},L.attributes),{bitset:{type:u.UNSIGNED_BYTE,count:1,pack:e=>0},color:{type:u.UNSIGNED_BYTE,count:4,normalized:!0,pack:({color:e})=>k(e)}})},ct={createComputedParams:e=>e,optionalAttributes:L.optionalAttributes,attributes:P(g({},L.attributes),{bitset:{type:u.UNSIGNED_BYTE,count:1,pack:e=>D([[_t,!0]])},color:{type:u.UNSIGNED_BYTE,count:4,normalized:!0,pack:({outlineColor:e})=>k(e)}})},O=class extends Q{constructor(){super(...arguments),this.vertexSpec=ct}},J=class e extends q{constructor(t,r,s,i){super(t,r,s,i),this.vertexSpec=Qt,this._lineMeshWriter=this._createOutlineWriter(t,r,s,i)}_createOutlineWriter(t,r,s,i){return new O(t,r,s,i)}_write(t,r,s){let i=s?.asOptimized()??r.readGeometryForDisplay(),o=this._clip(i);o&&(t.recordStart(this.instanceId,this.attributeLayout),this._writeGeometry(t,r,o),this._lineMeshWriter.writeLineVertices(t,S.fromOptimizedCIM(o,"esriGeometryPolyline"),r),t.recordEnd())}_clip(t){return t?Pt(t,yt(this.evaluatedMeshParams)):null}ensurePacked(t,r,s){super.ensurePacked(t,r,s),this._lineMeshWriter.ensurePacked(t,r,s)}enqueueRequest(t,r,s){super.enqueueRequest(t,r,s),this._lineMeshWriter.enqueueRequest(t,r,s)}loadDependencies(){return w(this,null,function*(){yield Promise.all([W(e.prototype,this,"loadDependencies").call(this),this._lineMeshWriter.loadDependencies()])})}};var Et=Xt,Dr=ct,Ar={createComputedParams:e=>e,optionalAttributes:Et.optionalAttributes,attributes:P(g({},Et.attributes),{bitset:{type:u.UNSIGNED_BYTE,count:1,pack:e=>Ut(e)},aux1:{count:1,type:u.HALF_FLOAT,pack:e=>at(e).width},aux2:{count:1,type:u.HALF_FLOAT,pack:e=>at(e).height},aux3:{count:2,type:u.HALF_FLOAT,pack:({offsetX:e,offsetY:t})=>[x(e),x(t)]},aux4:{count:2,type:u.UNSIGNED_BYTE,pack:({scaleX:e,scaleY:t})=>[e*et,t*et]}})},Br={createComputedParams:e=>e,optionalAttributes:Et.optionalAttributes,attributes:P(g({},Et.attributes),{color:Dr.attributes.color,bitset:{type:u.UNSIGNED_BYTE,count:1,pack:e=>D([[_t,!0]])},aux1:{count:1,type:u.HALF_FLOAT,pack:e=>x(.5*e.width)},aux2:{count:1,type:u.HALF_FLOAT,pack:e=>x(.5*e.referenceWidth)},aux3:{count:2,type:u.HALF_FLOAT,packTessellation:({extrusionOffsetX:e,extrusionOffsetY:t})=>[e,t]},aux4:{count:2,type:u.UNSIGNED_BYTE,packTessellation:({normalX:e,normalY:t})=>[e*et+Yt,t*et+Yt]}})},Jt=class extends O{constructor(){super(...arguments),this.vertexSpec=Br}},Ze=class e extends J{constructor(){super(...arguments),this.vertexSpec=Ar}_createOutlineWriter(t,r,s,i){return new Jt(t,r,s,i)}_write(t,r,s){let i=s?.asOptimized()??r.readGeometryForDisplay(),o=this._clip(i);if(!o)return;let n=this.evaluatedMeshParams.sprite?.textureBinding;t.recordStart(this.instanceId,this.attributeLayout,n),this._writeGeometry(t,r,o),this._lineMeshWriter.writeLineVertices(t,S.fromOptimizedCIM(o,"esriGeometryPolyline"),r),t.recordEnd()}ensurePacked(t,r,s){super.ensurePacked(t,r,s),this._lineMeshWriter.ensurePacked(t,r,s)}enqueueRequest(t,r,s){super.enqueueRequest(t,r,s),this._lineMeshWriter.enqueueRequest(t,r,s)}loadDependencies(){return w(this,null,function*(){yield Promise.all([W(e.prototype,this,"loadDependencies").call(this),this._lineMeshWriter.loadDependencies()])})}};var Lr={optionalAttributes:B.optionalAttributes,createComputedParams:e=>e,attributes:g(g({},B.attributes),Qt.attributes)},Cr={optionalAttributes:B.optionalAttributes,createComputedParams:e=>e,attributes:g(g({},B.attributes),ct.attributes)},jt=class extends O{constructor(){super(...arguments),this.vertexSpec=Cr}},qe=class e extends J{constructor(){super(...arguments),this.vertexSpec=Lr}_createOutlineWriter(t,r,s,i){return new jt(t,r,s,i)}_write(t,r,s){let i=s?.asOptimized()??r.readGeometryForDisplay(),o=this._clip(i);if(!o)return;let n=this.evaluatedMeshParams.sprite?.textureBinding;t.recordStart(this.instanceId,this.attributeLayout,n),this._writeGeometry(t,r,o),this._lineMeshWriter.writeLineVertices(t,S.fromOptimizedCIM(o,"esriGeometryPolyline"),r),t.recordEnd()}ensurePacked(t,r,s){super.ensurePacked(t,r,s),this._lineMeshWriter.ensurePacked(t,r,s)}enqueueRequest(t,r,s){super.enqueueRequest(t,r,s),this._lineMeshWriter.enqueueRequest(t,r,s)}loadDependencies(){return w(this,null,function*(){yield Promise.all([W(e.prototype,this,"loadDependencies").call(this),this._lineMeshWriter.loadDependencies()])})}};var Wr={createComputedParams:e=>e,optionalAttributes:{},attributes:{pos:{type:u.SHORT,count:2,pack:"position",packPrecisionFactor:10},id:{type:u.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:u.UNSIGNED_BYTE,count:1},offset:{type:u.BYTE,count:2,packAlternating:{count:4,pack:()=>[[-1,-1],[1,-1],[-1,1],[1,1]]}}}},Qe=class extends b{constructor(){super(...arguments),this.vertexSpec=Wr}_write(t,r){t.recordStart(this.instanceId,this.attributeLayout);let s=r.getDisplayId();if(r.geometryType==="esriGeometryPoint"){let i=r.readXForDisplay(),o=r.readYForDisplay();this._writeQuad(t,s,i,o)}else r.geometryType==="esriGeometryMultipoint"&&r.readGeometryForDisplay()?.forEachVertex((o,n)=>{o>=0&&o<=512&&n>=0&&n<=512&&this._writeQuad(t,s,o,n)});t.recordEnd()}_writeQuad(t,r,s,i){let o=t.vertexCount();this._writeVertex(t,r,s,i),t.indexWrite(o+0),t.indexWrite(o+1),t.indexWrite(o+2),t.indexWrite(o+1),t.indexWrite(o+3),t.indexWrite(o+2)}};var j=class{static getPlacement(t,r,s,i,o,n){let a=pe(s);return a?(r===-1&&t.invertY(),a.execute(t,s,i,o,n)):null}};var Je=96,It=class{constructor(t){let{offsetX:r,offsetY:s,postAngle:i,fontSize:o,scaleFactor:n,transforms:a}=t;if(this.offsetX=r,this.offsetY=s,this.postAngle=i,this.fontSize=Math.min(o,Je),this.transforms=a,a&&a.infos.length>1){let c=xt(o,i,!1,r,s,a);this.fontSize=Math.min(c.size,Je),this.postAngle=c.rotation,this.offsetX=c.offsetX,this.offsetY=c.offsetY}n&&(this.fontSize*=n,this.offsetX*=n,this.offsetY*=n)}};var zr=28,G=[4,4],Ft=[16,4],Gr={topLeft:Ft,topRight:Ft,bottomLeft:Ft,bottomRight:Ft},Dt=[4,2],v=[4,6],je={topLeft:Dt,topRight:Dt,bottomLeft:v,bottomRight:v},Ke={topLeft:Dt,topRight:v,bottomLeft:Dt,bottomRight:v},Nr={topLeft:v,topRight:v,bottomLeft:G,bottomRight:G},Yr={topLeft:G,topRight:G,bottomLeft:v,bottomRight:v},Or={topLeft:v,topRight:G,bottomLeft:v,bottomRight:G},Rr={topLeft:G,topRight:v,bottomLeft:G,bottomRight:v},Vr={createComputedParams:e=>e,optionalAttributes:{zoomRange:{type:u.UNSIGNED_SHORT,count:2,packPrecisionFactor:z,packTessellation:({minZoom:e,maxZoom:t})=>[e||0,t||zr]},clipAngle:{type:u.UNSIGNED_BYTE,count:1,packTessellation:({clipAngle:e})=>Hr(e||0)},referenceSymbol:{type:u.BYTE,count:4,packPrecisionFactor:1,packTessellation:(e,t)=>{if(!e.referenceBounds)return[0,0,0,0];let r=de(t.horizontalAlignment),s=xe(t.verticalAlignment),{offsetX:i,offsetY:o,size:n}=e.referenceBounds;return[x(i),-x(o),x(n),r+1<<2|s+1]}}},attributes:{pos:{type:u.SHORT,count:2,pack:"position",packPrecisionFactor:10},id:{type:u.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:u.UNSIGNED_BYTE,count:1,packTessellation:({isBackground:e,mapAligned:t})=>D([[we,e],[ve,!!t]])},offset:{type:u.SHORT,count:2,packPrecisionFactor:8,packAlternating:{count:4,packTessellation:({offsets:e})=>{let{bottomLeft:t,bottomRight:r,topLeft:s,topRight:i}=e;return[s,i,t,r]}}},textureUV:{type:u.SHORT,count:2,packPrecisionFactor:4,packAlternating:{count:4,packTessellation:({texcoords:e})=>{let{bottomLeft:t,bottomRight:r,topLeft:s,topRight:i}=e;return[s,i,t,r]}}},color:{type:u.UNSIGNED_BYTE,count:4,normalized:!0,packTessellation:({color:e})=>e},fontSize:{type:u.UNSIGNED_SHORT,count:1,packPrecisionFactor:4,packTessellation:({fontSize:e})=>x(e)},referenceSize:{type:u.UNSIGNED_BYTE,count:1,packPrecisionFactor:4,packTessellation:({fontSize:e},{referenceSize:t})=>x(t??e)},haloColor:{type:u.UNSIGNED_BYTE,count:4,normalized:!0,pack:({haloColor:e})=>k(e)},haloFontSize:{type:u.UNSIGNED_SHORT,count:1,packPrecisionFactor:4,pack:({haloFontSize:e})=>x(e)}}},$e=class extends b{constructor(){super(...arguments),this.vertexSpec=Vr,this._textMeshParamsPropsInitialized=!1}ensurePacked(t,r,s){super.ensurePacked(t,r,s),this._textMeshParamsPropsInitialized&&!this._evaluator.hasDynamicProperties||(this._textMeshTransformProps=new It(this.evaluatedMeshParams),this._textMeshParamsPropsInitialized=!0)}_write(t,r,s){let i=this._getShaping();if(!i)return;let o=r.getDisplayId();if(this.evaluatedMeshParams.placement!=null)return this._writePlacedTextMarkers(t,r,i,s);if(s?.nextPath())return s.nextPoint(),this._writeGlyphs(t,o,s.x,s.y,i,0);if(r.geometryType==="esriGeometryPolygon"){let c=r.readCentroidForDisplay();if(!c)return;let[p,l]=c.coords;return this._writeGlyphs(t,o,p,l,i,0)}if(r.geometryType==="esriGeometryMultipoint")return void r.readGeometryForDisplay()?.forEachVertex((p,l)=>this._writeGlyphs(t,o,p,l,i,0));let n=r.readXForDisplay(),a=r.readYForDisplay();return this._writeGlyphs(t,o,n,a,i,0)}_writePlacedTextMarkers(t,r,s,i){let o=i??S.fromFeatureSetReaderCIM(r);if(!o)return;let n=-1,a=j.getPlacement(o,n,this.evaluatedMeshParams.placement,x(1),t.id,U());if(!a)return;let c=r.getDisplayId(),p=a.next();for(;p!=null;){let l=p.tx,f=-p.ty,h=-p.getAngle();this._writeGlyphs(t,c,l,f,s,h),p=a.next()}}_getShaping(t){let r=this._textMeshTransformProps,s=this.evaluatedMeshParams;if(!s.glyphs?.glyphs.length)return null;let i=Math.round(x(r.fontSize)),o=x(r.offsetX),n=x(r.offsetY),a=Lt(x(s.lineWidth),ne,ae),c=se*Lt(s.lineHeightRatio,.25,4);return ye(s.glyphs,{scale:i/ie,angle:r.postAngle,xOffset:o,yOffset:n,horizontalAlignment:s.horizontalAlignment,verticalAlignment:t||s.verticalAlignment,maxLineWidth:a,lineHeight:c,decoration:s.decoration,borderLineSizePx:x(s.boxBorderLineSize),hasBackground:!!s.boxBackgroundColor,useCIMAngleBehavior:s.useCIMAngleBehavior})}_writeGlyphs(t,r,s,i,o,n,a,c){let p=this.evaluatedMeshParams,l=this._textMeshTransformProps,f=l.fontSize,h=x(l.offsetX),m=x(l.offsetY),[d,y]=F(p.scaleInfo,this.getTileInfo());n!==0&&o.setRotation(n);let _=o.bounds,T=s+_.x+h,E=i+_.y-m,K=2*(p.minPixelBuffer?p.minPixelBuffer/f:1),I=Math.max(_.width,_.height)*K;o.textBox&&(t.recordStart(this.instanceId,this.attributeLayout,o.glyphs[0].textureBinding),t.recordBounds(T,E,I,I),this._writeTextBox(t,r,s,i,o.textBox,a,c),t.recordEnd());for(let C of o.glyphs){t.recordStart(this.instanceId,this.attributeLayout,C.textureBinding),t.recordBounds(T,E,I,I);let{texcoords:$,offsets:lt}=C;this._writeQuad(t,r,s,i,g({texcoords:$,offsets:lt,fontSize:f,color:k(p.color),isBackground:!1,referenceBounds:a,minZoom:d,maxZoom:y},c)),t.recordEnd()}n!==0&&o.setRotation(-n)}_writeTextBox(t,r,s,i,o,n,a){let c=this.evaluatedMeshParams,{fontSize:p}=this._textMeshTransformProps,{boxBackgroundColor:l,boxBorderLineColor:f}=c,h=g({isBackground:!0,fontSize:p,referenceBounds:n},a);l&&(this._writeQuad(t,r,s,i,g({texcoords:Gr,offsets:o.main,color:k(l)},h)),f||(this._writeQuad(t,r,s,i,g({texcoords:Nr,offsets:o.top,color:k(l)},h)),this._writeQuad(t,r,s,i,g({texcoords:Yr,offsets:o.bot,color:k(l)},h)),this._writeQuad(t,r,s,i,g({texcoords:Or,offsets:o.left,color:k(l)},h)),this._writeQuad(t,r,s,i,g({texcoords:Rr,offsets:o.right,color:k(l)},h)))),f&&(this._writeQuad(t,r,s,i,g({texcoords:je,offsets:o.top,color:k(f)},h)),this._writeQuad(t,r,s,i,g({texcoords:je,offsets:o.bot,color:k(f)},h)),this._writeQuad(t,r,s,i,g({texcoords:Ke,offsets:o.left,color:k(f)},h)),this._writeQuad(t,r,s,i,g({texcoords:Ke,offsets:o.right,color:k(f)},h)))}_writeQuad(t,r,s,i,o){let n=t.vertexCount();this._writeVertex(t,r,s,i,o),t.indexWrite(n+0),t.indexWrite(n+1),t.indexWrite(n+2),t.indexWrite(n+1),t.indexWrite(n+3),t.indexWrite(n+2)}},Hr=e=>Math.round(e*(254/360));var Ur={createComputedParams:e=>e,optionalAttributes:L.optionalAttributes,attributes:P(g({},L.attributes),{bitset:{type:u.UNSIGNED_BYTE,count:1,pack:({shouldSampleAlphaOnly:e,shouldScaleDash:t,isSDF:r})=>D([[gt,e],[Te,t],[be,r]])},tlbr:{type:u.UNSIGNED_SHORT,count:4,pack:({sprite:e})=>{let{rect:t,width:r,height:s}=e,i=t.x+A,o=t.y+A;return[i,o,i+r,o+s]}},accumulatedDistance:{type:u.UNSIGNED_SHORT,count:1,packTessellation:({distance:e})=>e},segmentDirection:{type:u.BYTE,count:2,packPrecisionFactor:16,packTessellation:({directionX:e,directionY:t})=>[e,t]}})},tr=class extends Q{constructor(t,r,s,i){super(t,r,s,i),this.vertexSpec=Ur,this._tessellationOptions.textured=!0}_write(t,r,s){let i=s??S.fromFeatureSetReaderCIM(r);if(!i)return;let{sprite:o}=this.evaluatedMeshParams;this._writeGeometry(t,r,i,o?.textureBinding)}};var At=class e{static from(t){return"width"in t?this.fromSimpleMeshParams(t):this.fromComplexMeshParams(t)}static fromSimpleMeshParams(t){let r=new e(t.sprite,t.color,t.outlineColor,t.minPixelBuffer,t.placement,t.scaleInfo,t.effects),{type:s,width:i,height:o,angle:n,alignment:a,outlineSize:c,referenceSize:p,sprite:l,overrideOutlineColor:f}=t;r.rawWidth=x(i),r.rawHeight=x(o),r.angle=n,r.alignment=a,r.outlineSize=x(c),r.referenceSize=x(p),r.overrideOutlineColor=f,r.offsetX=x(t.offsetX),r.offsetY=x(t.offsetY),s!=="simple"||l.sdf||(r.rawWidth=l.width,r.rawHeight=l.height);let h=2;return r.sizeRatio=l.sdf?h:1,r._computeSize(t,!1),r}static fromComplexMeshParams(t){let r=new e(t.sprite,t.color,t.outlineColor,t.minPixelBuffer,t.placement,t.scaleInfo,t.effects),{alignment:s,transforms:i,size:o,scaleX:n,anchorX:a,anchorY:c,angle:p,colorLocked:l,frameHeight:f,widthRatio:h,offsetX:m,offsetY:d,outlineSize:y,referenceSize:_,scaleFactor:T,sizeRatio:E,isAbsoluteAnchorPoint:K,rotateClockwise:I,scaleSymbolsProportionally:C,sprite:$}=t;if(i&&i.infos.length>0){let pt=xt(o,p,I,m,d,i);o=pt.size,p=pt.rotation,m=pt.offsetX,d=pt.offsetY,I=!1}T&&(o*=T,m*=T,d*=T);let lt=n*($.width/$.height);r.alignment=s,r.rawHeight=x(o),r.rawWidth=r.rawHeight*lt,r.referenceSize=x(_),r.sizeRatio=E,r.angle=p,r.rotateClockwise=I,r.anchorX=a,r.anchorY=c,r.offsetX=x(m),r.offsetY=x(d),K&&o&&($.sdf?r.anchorX=a/(o*h):r.anchorX=a/(o*lt),r.anchorY=c/o);let sr=C&&f?o/f:1;return r.outlineSize=y===0||isNaN(y)?0:x(y)*sr,r.scaleSymbolsProportionally=C,r.colorLocked=l,r._computeSize(t,!0),r}constructor(t,r,s,i,o,n,a){this.sprite=t,this.color=r,this.outlineColor=s,this.minPixelBuffer=i,this.placement=o,this.scaleInfo=n,this.effects=a,this.rawWidth=0,this.rawHeight=0,this.angle=0,this.outlineSize=0,this.referenceSize=0,this.sizeRatio=1,this.alignment=ft.SCREEN,this.scaleSymbolsProportionally=!1,this.overrideOutlineColor=!1,this.colorLocked=!1,this.anchorX=0,this.anchorY=0,this.computedWidth=0,this.computedHeight=0,this.texXmin=0,this.texYmin=0,this.texXmax=0,this.texYmax=0,this.offsetX=0,this.offsetY=0,this.rotateClockwise=!0}get boundsInfo(){return{size:Math.max(this.computedHeight,this.computedWidth),offsetX:this.offsetX,offsetY:this.offsetY}}_computeSize(t,r){let{sprite:s,hasSizeVV:i}=t,o=!!s.sdf,{rawWidth:n,rawHeight:a,sizeRatio:c,outlineSize:p}=this,l=n*c,f=a*c;if(o&&!i){let K=r&&n>a?l:n,I=a,C=p+2*1;this.computedWidth=Math.min(K+C,l),this.computedHeight=Math.min(I+C,f)}else this.computedWidth=l,this.computedHeight=f;let h=o?Math.max(s.width,s.height)/Math.max(l,f):1,m=.5*(l-this.computedWidth)*h,d=.5*(f-this.computedHeight)*h,y=s.rect.x+A+m,_=s.rect.y+A+d,T=y+s.width-2*m,E=_+s.height-2*d;this.texXmin=Math.floor(y),this.texYmin=Math.floor(_),this.texXmax=Math.ceil(T),this.texYmax=Math.ceil(E),this.computedWidth*=(this.texXmax-this.texXmin)/(T-y),this.computedHeight*=(this.texYmax-this.texYmin)/(E-_),this.anchorX*=l/this.computedWidth,this.anchorY*=f/this.computedHeight}};var Xr=3.14159265359/180,Zr=128/Math.PI;function qr(e,t){return e%=t,Math.abs(e>=0?e:e+t)}function Qr(e){return qr(e*Zr,256)}function Jr(e,t,r,s,i=!1){let o=me(),n=i?1:-1;return ue(o),(t||r)&&fe(o,o,[t,-r]),s&&he(o,o,n*Xr*-s),o}var jr={createComputedParams:e=>At.from(e),optionalAttributes:{zoomRange:{type:u.SHORT,count:2,packPrecisionFactor:z,pack:({scaleInfo:e},{tileInfo:t})=>F(e,t)}},attributes:{pos:{type:u.SHORT,count:2,pack:"position",packPrecisionFactor:10},id:{type:u.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:u.UNSIGNED_BYTE,count:1,pack:({sprite:e,alignment:t,scaleSymbolsProportionally:r,overrideOutlineColor:s,colorLocked:i})=>{let o=0;return e.sdf&&(o|=Z(R.bitset.isSDF)),t===ft.MAP&&(o|=Z(R.bitset.isMapAligned)),r&&(o|=Z(R.bitset.scaleSymbolsProportionally)),s&&(o|=Z(R.bitset.overrideOutlineColor)),i&&(o|=Z(R.bitset.colorLocked)),o}},offset:{type:u.SHORT,count:2,packPrecisionFactor:4,packAlternating:{count:4,pack:({angle:e,computedWidth:t,computedHeight:r,anchorX:s,anchorY:i,offsetX:o,offsetY:n,rotateClockwise:a})=>{let c=Jr(0,o,n,-e,a),p=-(.5+s)*t,l=-(.5-i)*r,f=[p,l],h=[p+t,l],m=[p,l+r],d=[p+t,l+r];return tt(f,f,c),tt(h,h,c),tt(m,m,c),tt(d,d,c),[f,h,m,d]}}},textureUV:{type:u.SHORT,count:2,packPrecisionFactor:4,packAlternating:{count:4,pack:({texXmax:e,texXmin:t,texYmax:r,texYmin:s})=>[[t,s],[e,s],[t,r],[e,r]]}},color:{type:u.UNSIGNED_BYTE,count:4,normalized:!0,pack:({color:e})=>k(e)},outlineColor:{type:u.UNSIGNED_BYTE,count:4,normalized:!0,pack:({outlineColor:e})=>k(e)},sizing:{type:u.UNSIGNED_BYTE,count:4,pack:({rawWidth:e,rawHeight:t,outlineSize:r,referenceSize:s})=>{let i=Math.max(e,t);return[bt(i,128),bt(r,128),bt(s,128),0]}},placementAngle:{type:u.UNSIGNED_BYTE,count:1,packTessellation:({placementAngle:e})=>Qr(e)},sizeRatio:{type:u.UNSIGNED_SHORT,count:1,packPrecisionFactor:64,pack:({sizeRatio:e})=>e}}},er=class extends b{constructor(){super(...arguments),this.vertexSpec=jr}getBoundsInfo(){return this.evaluatedMeshParams.boundsInfo}_write(t,r,s){let i=this.evaluatedMeshParams.sprite?.textureBinding,o=r.getDisplayId();t.recordStart(this.instanceId,this.attributeLayout,i);let n=this.evaluatedMeshParams.minPixelBuffer,a=Math.max(this.evaluatedMeshParams.computedWidth,n),c=Math.max(this.evaluatedMeshParams.computedHeight,n),p=this.evaluatedMeshParams.offsetX,l=-this.evaluatedMeshParams.offsetY;if(this.evaluatedMeshParams.placement!=null)this._writePlacedMarkers(t,r,s,a,c);else if(s?.nextPath()){s.nextPoint();let f=s.x,h=s.y;t.recordBounds(f+p,h+l,a,c),this._writeQuad(t,o,f,h)}else if(r.geometryType==="esriGeometryPolygon"){let f=r.readCentroidForDisplay();if(!f)return;let[h,m]=f.coords;t.recordBounds(h+p,m+l,a,c),this._writeQuad(t,o,h,m)}else if(r.geometryType==="esriGeometryPoint"){let f=r.readXForDisplay(),h=r.readYForDisplay();t.recordBounds(f+p,h+l,a,c),this._writeQuad(t,o,f,h)}else r.readGeometryForDisplay()?.forEachVertex((h,m)=>{t.recordBounds(h+p,m+l,a,c),Math.abs(h)>1024||Math.abs(m)>1024||this._writeQuad(t,o,h,m)});t.recordEnd()}_writePlacedMarkers(t,r,s,i,o){let n=s??S.fromFeatureSetReaderCIM(r)?.clone();if(!n)return;let a=-1,c=j.getPlacement(n,a,this.evaluatedMeshParams.placement,x(1),t.id,U());if(!c)return;let p=r.getDisplayId(),l=c.next(),f=this.evaluatedMeshParams.offsetX,h=-this.evaluatedMeshParams.offsetY;for(;l!=null;){let m=l.tx,d=-l.ty;if(Math.abs(m)>1024||Math.abs(d)>1024){l=c.next();continue}let y=-l.getAngle();t.recordBounds(m+f,d+h,i,o),this._writeQuad(t,p,m,d,y),l=c.next()}}_writeQuad(t,r,s,i,o){let n=t.vertexCount(),a=o==null?null:{placementAngle:o};this._writeVertex(t,r,s,i,a),t.indexWrite(n+0),t.indexWrite(n+1),t.indexWrite(n+2),t.indexWrite(n+1),t.indexWrite(n+3),t.indexWrite(n+2)}};var Kr={createComputedParams:e=>e,optionalAttributes:{},attributes:{pos:{type:u.SHORT,count:2,packPrecisionFactor:10,pack:"position"},id:{type:u.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:u.UNSIGNED_BYTE,count:1,pack:e=>0},offset:{type:u.SHORT,count:2,packPrecisionFactor:16,packAlternating:{count:4,pack:({size:e})=>{let t=x(e),r=-t/2,s=-t/2;return[[r,s],[r+t,s],[r,s+t],[r+t,s+t]]}}},texCoords:{type:u.SHORT,count:2,packPrecisionFactor:4,packAlternating:{count:4,pack:()=>[[0,1],[1,1],[0,0],[1,0]]}},size:{type:u.UNSIGNED_BYTE,count:2,pack:({size:e})=>[e,e]},referenceSize:{type:u.UNSIGNED_BYTE,count:1,pack:({size:e})=>x(e)},zoomRange:{type:u.UNSIGNED_BYTE,count:2,pack:({scaleInfo:e},{tileInfo:t})=>F(e,t)}}},rr=class extends b{constructor(){super(...arguments),this.vertexSpec=Kr}_write(t,r){let s=r.getDisplayId(),i=this.evaluatedMeshParams.minPixelBuffer,o=Math.max(x(this.evaluatedMeshParams.size),i),n,a;if(r.geometryType==="esriGeometryPoint")n=r.readXForDisplay(),a=r.readYForDisplay();else{let p=r.readCentroidForDisplay();if(!p)return;n=p?.coords[0],a=p?.coords[1]}t.recordStart(this.instanceId,this.attributeLayout),t.recordBounds(n,a,o,o);let c=t.vertexCount();this._writeVertex(t,s,n,a),t.indexWrite(c+0),t.indexWrite(c+1),t.indexWrite(c+2),t.indexWrite(c+1),t.indexWrite(c+3),t.indexWrite(c+2),t.recordEnd()}};export{St as a,Re as b,F as c,k as d,q as e,vt as f,Ue as g,Q as h,J as i,Ze as j,qe as k,Qe as l,zr as m,$e as n,tr as o,er as p,rr as q};
