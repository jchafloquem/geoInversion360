import{d as O}from"./chunk-KFCU4KQY.js";import{a as F}from"./chunk-DVSFGYL7.js";import{n as E}from"./chunk-OLIJD5I4.js";import{a as h,d,o as v,p as g}from"./chunk-BYQI7UDX.js";import{l as c}from"./chunk-4HUAEW4D.js";import{b as x}from"./chunk-DG5QI6E2.js";import{O as I,V as w,aa as k}from"./chunk-BRGZVJPZ.js";import{b as p,k as b}from"./chunk-BRWS572J.js";import{g as P}from"./chunk-JEGVIFEP.js";var J={esriGeometryPoint:"points",esriGeometryPolyline:"polylines",esriGeometryPolygon:"polygons"};function Q(s){let o=s.folders||[],t=o.slice(),e=new Map,n=new Map,a=new Map,f=new Map,y=new Map,l={esriGeometryPoint:n,esriGeometryPolyline:a,esriGeometryPolygon:f};(s.featureCollection?.layers||[]).forEach(r=>{let m=p(r);m.featureSet.features=[];let i=r.featureSet.geometryType;e.set(i,m);let S=r.layerDefinition.objectIdField;i==="esriGeometryPoint"?G(n,S,r.featureSet.features):i==="esriGeometryPolyline"?G(a,S,r.featureSet.features):i==="esriGeometryPolygon"&&G(f,S,r.featureSet.features)}),s.groundOverlays&&s.groundOverlays.forEach(r=>{y.set(r.id,r)}),o.forEach(r=>{r.networkLinkIds.forEach(m=>{let i=L(m,r.id,s.networkLinks);i&&t.push(i)})}),t.forEach(r=>{if(r.featureInfos){r.points=p(e.get("esriGeometryPoint")),r.polylines=p(e.get("esriGeometryPolyline")),r.polygons=p(e.get("esriGeometryPolygon")),r.mapImages=[];for(let m of r.featureInfos)switch(m.type){case"esriGeometryPoint":case"esriGeometryPolyline":case"esriGeometryPolygon":{let i=l[m.type].get(m.id);i&&r[J[m.type]]?.featureSet.features.push(i);break}case"GroundOverlay":{let i=y.get(m.id);i&&r.mapImages.push(i);break}}r.fullExtent=M([r])}});let u=M(t);return{folders:o,sublayers:t,extent:u}}function U(s,o,t,e){let n=w?.findCredential(s);s=I(s,{token:n?.token});let a=b.kmlServiceUrl;return k(a,{query:{url:s,model:"simple",folders:"",refresh:t!==0||void 0,outSR:JSON.stringify(o)},responseType:"json",signal:e})}function X(s,o,t=null,e=[]){let n=[],a={},f=o.sublayers,y=new Set(o.folders.map(l=>l.id));return f.forEach(l=>{let u=new s;if(t?u.read(l,t):u.read(l),e.length&&y.has(u.id)&&(u.visible=e.includes(u.id)),a[l.id]=u,l.parentFolderId!=null&&l.parentFolderId!==-1){let r=a[l.parentFolderId];r.sublayers||(r.sublayers=[]),r.sublayers?.unshift(u)}else n.unshift(u)}),n}function G(s,o,t){t.forEach(e=>{s.set(e.attributes[o],e)})}function N(s,o){let t;return o.some(e=>e.id===s&&(t=e,!0)),t}function L(s,o,t){let e=N(s,t);return e&&(e.parentFolderId=o,e.networkLink=e),e}function Y(s){return P(this,null,function*(){let o=F.fromJSON(s.featureSet).features,t=s.layerDefinition,e=O(t.drawingInfo.renderer),n=E.fromJSON(s.popupInfo),a=[];for(let f of o){let y=yield e.getSymbolAsync(f);f.symbol=y,f.popupTemplate=n,f.visible=!0,a.push(f)}return a})}function M(s){let o=h(g),t=h(g);for(let e of s){if(e.polygons?.featureSet?.features)for(let n of e.polygons.featureSet.features)c(o,n.geometry),d(t,o);if(e.polylines?.featureSet?.features)for(let n of e.polylines.featureSet.features)c(o,n.geometry),d(t,o);if(e.points?.featureSet?.features)for(let n of e.points.featureSet.features)c(o,n.geometry),d(t,o);if(e.mapImages)for(let n of e.mapImages)c(o,n.extent),d(t,o)}return v(t,g)?void 0:{xmin:t[0],ymin:t[1],zmin:t[2],xmax:t[3],ymax:t[4],zmax:t[5],spatialReference:x.WGS84}}export{Q as a,U as b,X as c,Y as d,M as e};
