import{a as f}from"./chunk-ILWXVJPX.js";import{h as s}from"./chunk-HUYHDVA2.js";import{a as c}from"./chunk-JKP4I6UL.js";function d(e){return e.frameDurations.reduce((t,n)=>t+n,0)}function F(e){let{width:t,height:n}=e,o=e.frameDurations.reverse(),r=a=>{let i=e.frameDurations.length-1-a;return e.getFrame(i)};return{frameCount:e.frameCount,duration:e.duration,frameDurations:o,getFrame:r,width:t,height:n}}function g(e,t){let{width:n,height:o,getFrame:r}=e,a=t/e.duration,i=e.frameDurations.map(m=>m*a);return{frameCount:e.frameCount,duration:e.duration,frameDurations:i,getFrame:r,width:n,height:o}}function _(e,t){let{width:n,height:o,getFrame:r}=e,a=e.frameDurations.slice(),i=a.shift();return a.unshift(i+t),{frameCount:e.frameCount,duration:e.duration+t,frameDurations:a,getFrame:r,width:n,height:o}}function l(e,t){let{width:n,height:o,getFrame:r}=e,a=e.frameDurations.slice(),i=a.pop();return a.push(i+t),{frameCount:e.frameCount,duration:e.duration+t,frameDurations:a,getFrame:r,width:n,height:o}}var h=class{constructor(t,n,o,r){this._animation=t,this._repeatType=o,this._onFrameData=r,this._direction=1,this._currentFrame=0,this.timeToFrame=this._animation.frameDurations[this._currentFrame];let a=0;for(;n>a;)a+=this.timeToFrame,this.nextFrame();let i=this._animation.getFrame(this._currentFrame);this._onFrameData(i)}nextFrame(){if(this._currentFrame+=this._direction,this._direction>0){if(this._currentFrame===this._animation.frameDurations.length)switch(this._repeatType){case s.None:this._currentFrame-=this._direction;break;case s.Loop:this._currentFrame=0;break;case s.Oscillate:this._currentFrame-=this._direction,this._direction=-1}}else if(this._currentFrame===-1)switch(this._repeatType){case s.None:this._currentFrame-=this._direction;break;case s.Loop:this._currentFrame=this._animation.frameDurations.length-1;break;case s.Oscillate:this._currentFrame-=this._direction,this._direction=1}this.timeToFrame=this._animation.frameDurations[this._currentFrame];let t=this._animation.getFrame(this._currentFrame);this._onFrameData(t)}};function p(e,t,n,o){let r,{repeatType:a}=t;if(a==null&&(a=s.Loop),t.reverseAnimation===!0&&(e=F(e)),t.duration!=null&&(e=g(e,1e3*t.duration)),t.repeatDelay!=null){let i=1e3*t.repeatDelay;a===s.Loop?e=l(e,i):a===s.Oscillate&&(e=_(l(e,i/2),i/2))}if(t.startTimeOffset!=null)r=1e3*t.startTimeOffset;else if(t.randomizeStartTime!=null){let m=t.randomizeStartSeed!=null?t.randomizeStartSeed:82749913,u=f(n,m);r=u*d(e)}else r=0;return new h(e,r,a,o)}function S(e,t,n,o){let r=t.playAnimation==null||t.playAnimation,a=p(e,t,n,o),i,m=a.timeToFrame;function u(){i=r?setTimeout(()=>{a.nextFrame(),m=a.timeToFrame,u()},m):void 0}return u(),c(()=>r&&clearTimeout(i))}export{S as a};
